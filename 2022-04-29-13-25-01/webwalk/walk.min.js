/*


  Shapespark 3D visualization viewer

  Copyright (C) 2014-present Shapespark

  The viewer uses the following open source libraries:

    Three.js: https://github.com/mrdoob/three.js,
    Copyright 2010-2015 three.js authors, MIT License

    PlayCanvas (GLSL shaders code): https://github.com/playcanvas/engine
    Copyright (C) 2011-2015 PlayCanvas Ltd., MIT License

    WebXR Polyfill: https://github.com/immersive-web/webxr-polyfill,
    Copyright (C) 2017 Google Inc, Apache 2.0 License

    Web Font Loader: https://github.com/typekit/webfontloader
    Copyright (C) 2010-2017 Adobe Systems Incorporated, Google Incorporated, Apache 2.0 License

    Basis Universal GPU Texture Codec: https://github.com/BinomialLLC/basis_universal
    Copyright (C) 2019 Binomial LLC., Apache License

    HTTP Live Streaming: https://github.com/video-dev/hls.js
    Copyright (c) 2017 Dailymotion (http://www.dailymotion.com), Apache 2.0 License

    node-qrcode: https://github.com/soldair/node-qrcode
    Copyright (c) 2012 Ryan Day,  MIT License

    Brotli: https://github.com/google/brotli
    Copyright (c) 2009, 2010, 2013-2016 by the Brotli Authors,  MIT License

  and the following open fonts:

    Open Sans: https://fonts.google.com/specimen/Open+Sans
    Copyright (C) Google Inc., Apache 2.0 License

    Font Awesome: https://fontawesome.com/
    Copyright (C) 2017 Fonticons Inc, SIL Open Font License
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):
$jscomp.POLYFILL_PREFIX+e),e=$jscomp.propertyToPolyfillSymbol[e],$jscomp.defineProperty(d,e,{configurable:!0,writable:!0,value:b})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(e,f){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:f})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c=0,d=function(e){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(e||"")+"_"+c++,e)};return d},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};
$jscomp.getConstructImplementation=function(){function a(){function c(){}new c;Reflect.construct(c,[],function(){});return new c instanceof c}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(a())return Reflect.construct;var b=Reflect.construct;return function(c,d,e){c=b(c,d);e&&Reflect.setPrototypeOf(c,e.prototype);return c}}return function(c,d,e){void 0===e&&(e=c);e=$jscomp.objectCreate(e.prototype||Object.prototype);return Function.prototype.apply.call(c,e,d)||
e}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var c=$jscomp.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};
$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};
$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,e){function f(g){g.done?d(g.value):Promise.resolve(g.value).then(b,c).then(f,e)}f(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.polyfill("Reflect",function(a){return a?a:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(a){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(a){if(a)return a;if($jscomp.setPrototypeOf){var b=$jscomp.setPrototypeOf;return function(c,d){try{return b(c,d),!0}catch(e){return!1}}}return null},"es6","es5");
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(g){return g instanceof e?g:new e(function(k,h){k(g)})}if(a&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return a;b.prototype.asyncExecute=function(g){if(null==this.batch_){this.batch_=[];var k=this;this.asyncExecuteFunction(function(){k.executeBatch_()})}this.batch_.push(g)};
var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(g){d(g,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var g=this.batch_;this.batch_=[];for(var k=0;k<g.length;++k){var h=g[k];g[k]=null;try{h()}catch(m){this.asyncThrow_(m)}}}this.batch_=null};b.prototype.asyncThrow_=function(g){this.asyncExecuteFunction(function(){throw g;})};var e=function(g){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=!1;var k=this.createResolveAndReject_();
try{g(k.resolve,k.reject)}catch(h){k.reject(h)}};e.prototype.createResolveAndReject_=function(){function g(m){return function(l){h||(h=!0,m.call(k,l))}}var k=this,h=!1;return{resolve:g(this.resolveTo_),reject:g(this.reject_)}};e.prototype.resolveTo_=function(g){if(g===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(g instanceof e)this.settleSameAsPromise_(g);else{a:switch(typeof g){case "object":var k=null!=g;break a;case "function":k=!0;break a;default:k=!1}k?this.resolveToNonPromiseObj_(g):
this.fulfill_(g)}};e.prototype.resolveToNonPromiseObj_=function(g){var k=void 0;try{k=g.then}catch(h){this.reject_(h);return}"function"==typeof k?this.settleSameAsThenable_(k,g):this.fulfill_(g)};e.prototype.reject_=function(g){this.settle_(2,g)};e.prototype.fulfill_=function(g){this.settle_(1,g)};e.prototype.settle_=function(g,k){if(0!=this.state_)throw Error("Cannot settle("+g+", "+k+"): Promise already settled in state"+this.state_);this.state_=g;this.result_=k;2===this.state_&&this.scheduleUnhandledRejectionCheck_();
this.executeOnSettledCallbacks_()};e.prototype.scheduleUnhandledRejectionCheck_=function(){var g=this;d(function(){if(g.notifyUnhandledRejection_()){var k=$jscomp.global.console;"undefined"!==typeof k&&k.error(g.result_)}},1)};e.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var g=$jscomp.global.CustomEvent,k=$jscomp.global.Event,h=$jscomp.global.dispatchEvent;if("undefined"===typeof h)return!0;"function"===typeof g?g=new g("unhandledrejection",{cancelable:!0}):
"function"===typeof k?g=new k("unhandledrejection",{cancelable:!0}):(g=$jscomp.global.document.createEvent("CustomEvent"),g.initCustomEvent("unhandledrejection",!1,!0,g));g.promise=this;g.reason=this.result_;return h(g)};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var g=0;g<this.onSettledCallbacks_.length;++g)f.asyncExecute(this.onSettledCallbacks_[g]);this.onSettledCallbacks_=null}};var f=new b;e.prototype.settleSameAsPromise_=function(g){var k=this.createResolveAndReject_();
g.callWhenSettled_(k.resolve,k.reject)};e.prototype.settleSameAsThenable_=function(g,k){var h=this.createResolveAndReject_();try{g.call(k,h.resolve,h.reject)}catch(m){h.reject(m)}};e.prototype.then=function(g,k){function h(n,p){return"function"==typeof n?function(r){try{m(n(r))}catch(x){l(x)}}:p}var m,l,q=new e(function(n,p){m=n;l=p});this.callWhenSettled_(h(g,m),h(k,l));return q};e.prototype.catch=function(g){return this.then(void 0,g)};e.prototype.callWhenSettled_=function(g,k){function h(){switch(m.state_){case 1:g(m.result_);
break;case 2:k(m.result_);break;default:throw Error("Unexpected state: "+m.state_);}}var m=this;null==this.onSettledCallbacks_?f.asyncExecute(h):this.onSettledCallbacks_.push(h);this.isRejectionHandled_=!0};e.resolve=c;e.reject=function(g){return new e(function(k,h){h(g)})};e.race=function(g){return new e(function(k,h){for(var m=$jscomp.makeIterator(g),l=m.next();!l.done;l=m.next())c(l.value).callWhenSettled_(k,h)})};e.all=function(g){var k=$jscomp.makeIterator(g),h=k.next();return h.done?c([]):new e(function(m,
l){function q(r){return function(x){n[r]=x;p--;0==p&&m(n)}}var n=[],p=0;do n.push(void 0),p++,c(h.value).callWhenSettled_(q(n.length-1),l),h=k.next();while(!h.done)})};return e},"es6","es3");$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.polyfill("Object.entries",function(a){return a?a:function(b){var c=[],d;for(d in b)$jscomp.owns(b,d)&&c.push([d,b[d]]);return c}},"es8","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var e=d.length,f=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var g=0;g<f&&c<e;)if(d[c++]!=b[g++])return!1;return g>=f}},"es6","es3");$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(c,d,e){return c==a&&"q"==d&&e==b}}));return!0===b.q}catch(c){return!1}};
$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();
$jscomp.polyfill("WeakMap",function(a){function b(){if(!a||!Object.seal)return!1;try{var m=Object.seal({}),l=Object.seal({}),q=new a([[m,2],[l,3]]);if(2!=q.get(m)||3!=q.get(l))return!1;q.delete(m);q.set(l,4);return!q.has(m)&&4==q.get(l)}catch(n){return!1}}function c(){}function d(m){var l=typeof m;return"object"===l&&null!==m||"function"===l}function e(m){if(!$jscomp.owns(m,g)){var l=new c;$jscomp.defineProperty(m,g,{value:l})}}function f(m){if(!$jscomp.ISOLATE_POLYFILLS){var l=Object[m];l&&(Object[m]=
function(q){if(q instanceof c)return q;Object.isExtensible(q)&&e(q);return l(q)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var g="$jscomp_hidden_"+Math.random();f("freeze");f("preventExtensions");f("seal");var k=0,h=function(m){this.id_=(k+=Math.random()+1).toString();if(m){m=$jscomp.makeIterator(m);for(var l;!(l=m.next()).done;)l=l.value,this.set(l[0],l[1])}};h.prototype.set=function(m,l){if(!d(m))throw Error("Invalid WeakMap key");
e(m);if(!$jscomp.owns(m,g))throw Error("WeakMap key fail: "+m);m[g][this.id_]=l;return this};h.prototype.get=function(m){return d(m)&&$jscomp.owns(m,g)?m[g][this.id_]:void 0};h.prototype.has=function(m){return d(m)&&$jscomp.owns(m,g)&&$jscomp.owns(m[g],this.id_)};h.prototype.delete=function(m){return d(m)&&$jscomp.owns(m,g)&&$jscomp.owns(m[g],this.id_)?delete m[g][this.id_]:!1};return h},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var h=Object.seal({x:4}),m=new a($jscomp.makeIterator([[h,"s"]]));if("s"!=m.get(h)||1!=m.size||m.get({x:4})||m.set({x:4},"t")!=m||2!=m.size)return!1;var l=m.entries(),q=l.next();if(q.done||q.value[0]!=h||"s"!=q.value[1])return!1;q=l.next();return q.done||4!=q.value[0].x||"t"!=q.value[1]||!l.next().done?!1:!0}catch(n){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var c=new WeakMap,d=function(h){this.data_={};this.head_=g();this.size=0;if(h){h=$jscomp.makeIterator(h);for(var m;!(m=h.next()).done;)m=m.value,this.set(m[0],m[1])}};d.prototype.set=function(h,m){h=0===h?0:h;var l=e(this,h);l.list||(l.list=this.data_[l.id]=[]);l.entry?l.entry.value=m:(l.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:h,value:m},l.list.push(l.entry),
this.head_.previous.next=l.entry,this.head_.previous=l.entry,this.size++);return this};d.prototype.delete=function(h){h=e(this,h);return h.entry&&h.list?(h.list.splice(h.index,1),h.list.length||delete this.data_[h.id],h.entry.previous.next=h.entry.next,h.entry.next.previous=h.entry.previous,h.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};d.prototype.has=function(h){return!!e(this,h).entry};d.prototype.get=function(h){return(h=
e(this,h).entry)&&h.value};d.prototype.entries=function(){return f(this,function(h){return[h.key,h.value]})};d.prototype.keys=function(){return f(this,function(h){return h.key})};d.prototype.values=function(){return f(this,function(h){return h.value})};d.prototype.forEach=function(h,m){for(var l=this.entries(),q;!(q=l.next()).done;)q=q.value,h.call(m,q[1],q[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var e=function(h,m){var l=m&&typeof m;"object"==l||"function"==l?c.has(m)?l=c.get(m):
(l=""+ ++k,c.set(m,l)):l="p_"+m;var q=h.data_[l];if(q&&$jscomp.owns(h.data_,l))for(h=0;h<q.length;h++){var n=q[h];if(m!==m&&n.key!==n.key||m===n.key)return{id:l,list:q,index:h,entry:n}}return{id:l,list:q,index:-1,entry:void 0}},f=function(h,m){var l=h.head_;return $jscomp.iteratorPrototype(function(){if(l){for(;l.head!=h.head_;)l=l.previous;for(;l.next!=l.head;)return l=l.next,{done:!1,value:m(l)};l=null}return{done:!0,value:void 0}})},g=function(){var h={};return h.previous=h.next=h.head=h},k=0;
return d},"es6","es3");
$jscomp.polyfill("Set",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_SET||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var d=Object.seal({x:4}),e=new a($jscomp.makeIterator([d]));if(!e.has(d)||1!=e.size||e.add(d)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var f=e.entries(),g=f.next();if(g.done||g.value[0]!=d||g.value[1]!=d)return!1;g=f.next();return g.done||g.value[0]==d||4!=g.value[0].x||g.value[1]!=g.value[0]?!1:f.next().done}catch(k){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var c=function(d){this.map_=new Map;if(d){d=$jscomp.makeIterator(d);for(var e;!(e=d.next()).done;)this.add(e.value)}this.size=this.map_.size};c.prototype.add=function(d){d=0===d?0:d;this.map_.set(d,d);this.size=this.map_.size;return this};c.prototype.delete=function(d){d=this.map_.delete(d);this.size=this.map_.size;return d};c.prototype.clear=function(){this.map_.clear();this.size=0};c.prototype.has=
function(d){return this.map_.has(d)};c.prototype.entries=function(){return this.map_.entries()};c.prototype.values=function(){return this.map_.values()};c.prototype.keys=c.prototype.values;c.prototype[Symbol.iterator]=c.prototype.values;c.prototype.forEach=function(d,e){var f=this;this.map_.forEach(function(g){return d.call(e,g,g,f)})};return c},"es6","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=d[c];if(f===b||Object.is(f,b))return!0}return!1}},"es7","es3");$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(b,c){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,c||0)}},"es6","es3");
$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)$jscomp.owns(d,e)&&(a[e]=d[e])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");$jscomp.polyfill("Object.setPrototypeOf",function(a){return a||$jscomp.setPrototypeOf},"es6","es5");
$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).i}},"es6","es3");$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");
$jscomp.polyfill("Math.sign",function(a){return a?a:function(b){b=Number(b);return 0===b||isNaN(b)?b:0<b?1:-1}},"es6","es3");$jscomp.polyfill("Math.log2",function(a){return a?a:function(b){return Math.log(b)/Math.LN2}},"es6","es3");$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(b,c,d){var e=this.length||0;0>c&&(c=Math.max(0,e+c));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(c=Number(c||0);c<d;c++)this[c]=b;return this}},"es6","es3");
$jscomp.typedArrayFill=function(a){return a?a:Array.prototype.fill};$jscomp.polyfill("Int8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8ClampedArray.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Int32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float64Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===c&&(c=d.length);c=Math.max(0,Math.min(c|0,d.length));for(var e=b.length;0<e&&0<c;)if(d[--c]!=b[--e])return!1;return 0>=e}},"es6","es3");$jscomp.polyfill("Object.values",function(a){return a?a:function(b){var c=[],d;for(d in b)$jscomp.owns(b,d)&&c.push(b[d]);return c}},"es8","es3");
$jscomp.polyfill("Number.EPSILON",function(a){return Math.pow(2,-52)},"es6","es3");$jscomp.polyfill("Promise.prototype.finally",function(a){return a?a:function(b){return this.then(function(c){return Promise.resolve(b()).then(function(){return c})},function(c){return Promise.resolve(b()).then(function(){throw c;})})}},"es9","es3");(function(){function a(P,Y,Ba){return P.call.apply(P.bind,arguments)}function b(P,Y,Ba){if(!P)throw Error();if(2<arguments.length){var la=Array.prototype.slice.call(arguments,2);return function(){var Fa=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(Fa,la);return P.apply(Y,Fa)}}return function(){return P.apply(Y,arguments)}}function c(P,Y,Ba){c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:b;return c.apply(null,arguments)}function d(P,
Y){this.a=P;this.m=Y||P;this.c=this.m.document}function e(P,Y,Ba,la){Y=P.c.createElement(Y);if(Ba)for(var Fa in Ba)Ba.hasOwnProperty(Fa)&&("style"==Fa?Y.style.cssText=Ba[Fa]:Y.setAttribute(Fa,Ba[Fa]));la&&Y.appendChild(P.c.createTextNode(la));return Y}function f(P,Y,Ba){(P=P.c.getElementsByTagName(Y)[0])||(P=document.documentElement);P.insertBefore(Ba,P.lastChild)}function g(P){P.parentNode&&P.parentNode.removeChild(P)}function k(P,Y,Ba){Y=Y||[];Ba=Ba||[];for(var la=P.className.split(/\s+/),Fa=0;Fa<
Y.length;Fa+=1){for(var ca=!1,ya=0;ya<la.length;ya+=1)if(Y[Fa]===la[ya]){ca=!0;break}ca||la.push(Y[Fa])}Y=[];for(Fa=0;Fa<la.length;Fa+=1){ca=!1;for(ya=0;ya<Ba.length;ya+=1)if(la[Fa]===Ba[ya]){ca=!0;break}ca||Y.push(la[Fa])}P.className=Y.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function h(P,Y){P=P.className.split(/\s+/);for(var Ba=0,la=P.length;Ba<la;Ba++)if(P[Ba]==Y)return!0;return!1}function m(P){if("string"===typeof P.f)return P.f;var Y=P.m.location.protocol;"about:"==Y&&(Y=P.a.location.protocol);
return"https:"==Y?"https:":"http:"}function l(P){return P.m.location.hostname||P.a.location.hostname}function q(P,Y,Ba){function la(){ma&&Fa&&ca&&(ma(ya),ma=null)}Y=e(P,"link",{rel:"stylesheet",href:Y,media:"all"});var Fa=!1,ca=!0,ya=null,ma=Ba||null;Ga?(Y.onload=function(){Fa=!0;la()},Y.onerror=function(){Fa=!0;ya=Error("Stylesheet failed to load");la()}):setTimeout(function(){Fa=!0;la()},0);f(P,"head",Y)}function n(P,Y,Ba,la){var Fa=P.c.getElementsByTagName("head")[0];if(Fa){var ca=e(P,"script",
{src:Y}),ya=!1;ca.onload=ca.onreadystatechange=function(){ya||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(ya=!0,Ba&&Ba(null),ca.onload=ca.onreadystatechange=null,"HEAD"==ca.parentNode.tagName&&Fa.removeChild(ca))};Fa.appendChild(ca);setTimeout(function(){ya||(ya=!0,Ba&&Ba(Error("Script load timeout")))},la||5E3);return ca}return null}function p(){this.a=0;this.c=null}function r(P){P.a++;return function(){P.a--;w(P)}}function x(P,Y){P.c=Y;w(P)}function w(P){0==P.a&&P.c&&
(P.c(),P.c=null)}function u(P){this.a=P||"-"}function A(P,Y){this.c=P;this.f=4;this.a="n";(P=(Y||"n4").match(/^([nio])([1-9])$/i))&&(this.a=P[1],this.f=parseInt(P[2],10))}function B(P){return E(P)+" "+(P.f+"00 300px ")+I(P.c)}function I(P){var Y=[];P=P.split(/,\s*/);for(var Ba=0;Ba<P.length;Ba++){var la=P[Ba].replace(/['"]/g,"");-1!=la.indexOf(" ")||/^\d/.test(la)?Y.push("'"+la+"'"):Y.push(la)}return Y.join(",")}function F(P){return P.a+P.f}function E(P){var Y="normal";"o"===P.a?Y="oblique":"i"===
P.a&&(Y="italic");return Y}function K(P,Y){this.c=P;this.f=P.m.document.documentElement;this.h=Y;this.a=new u("-");this.j=!1!==Y.events;this.g=!1!==Y.classes}function M(P){P.g&&k(P.f,[P.a.c("wf","loading")]);C(P,"loading")}function Z(P){if(P.g){var Y=h(P.f,P.a.c("wf","active")),Ba=[],la=[P.a.c("wf","loading")];Y||Ba.push(P.a.c("wf","inactive"));k(P.f,Ba,la)}C(P,"inactive")}function C(P,Y,Ba){if(P.j&&P.h[Y])if(Ba)P.h[Y](Ba.c,F(Ba));else P.h[Y]()}function U(){this.c={}}function O(P,Y,Ba){var la=[],
Fa;for(Fa in Y)if(Y.hasOwnProperty(Fa)){var ca=P.c[Fa];ca&&la.push(ca(Y[Fa],Ba))}return la}function W(P,Y){this.c=P;this.f=Y;this.a=e(this.c,"span",{"aria-hidden":"true"},this.f)}function aa(P){f(P.c,"body",P.a)}function R(P){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+I(P.c)+";font-style:"+(E(P)+";font-weight:"+(P.f+"00;"))}function S(P,Y,Ba,la,Fa,
ca){this.g=P;this.j=Y;this.a=la;this.c=Ba;this.f=Fa||3E3;this.h=ca||void 0}function fa(P,Y,Ba,la,Fa,ca,ya){this.v=P;this.B=Y;this.c=Ba;this.a=la;this.s=ya||"BESbswy";this.f={};this.w=Fa||3E3;this.u=ca||null;this.o=this.j=this.h=this.g=null;this.g=new W(this.c,this.s);this.h=new W(this.c,this.s);this.j=new W(this.c,this.s);this.o=new W(this.c,this.s);P=new A(this.a.c+",serif",F(this.a));P=R(P);this.g.a.style.cssText=P;P=new A(this.a.c+",sans-serif",F(this.a));P=R(P);this.h.a.style.cssText=P;P=new A("serif",
F(this.a));P=R(P);this.j.a.style.cssText=P;P=new A("sans-serif",F(this.a));P=R(P);this.o.a.style.cssText=P;aa(this.g);aa(this.h);aa(this.j);aa(this.o)}function X(){if(null===ia){var P=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);ia=!!P&&(536>parseInt(P[1],10)||536===parseInt(P[1],10)&&11>=parseInt(P[2],10))}return ia}function qa(P,Y,Ba){for(var la in L)if(L.hasOwnProperty(la)&&Y===P.f[L[la]]&&Ba===P.f[L[la]])return!0;return!1}function na(P){var Y=P.g.a.offsetWidth,Ba=P.h.a.offsetWidth,
la;(la=Y===P.f.serif&&Ba===P.f["sans-serif"])||(la=X()&&qa(P,Y,Ba));la?Pa()-P.A>=P.w?X()&&qa(P,Y,Ba)&&(null===P.u||P.u.hasOwnProperty(P.a.c))?wa(P,P.v):wa(P,P.B):xa(P):wa(P,P.v)}function xa(P){setTimeout(c(function(){na(this)},P),50)}function wa(P,Y){setTimeout(c(function(){g(this.g.a);g(this.h.a);g(this.j.a);g(this.o.a);Y(this.a)},P),0)}function ta(P,Y,Ba){this.c=P;this.a=Y;this.f=0;this.o=this.j=!1;this.s=Ba}function sa(P){0==--P.f&&P.j&&(P.o?(P=P.a,P.g&&k(P.f,[P.a.c("wf","active")],[P.a.c("wf",
"loading"),P.a.c("wf","inactive")]),C(P,"active")):Z(P.a))}function Da(P){this.j=P;this.a=new U;this.h=0;this.f=this.g=!0}function Q(P,Y,Ba,la,Fa){var ca=0==--P.h;(P.f||P.g)&&setTimeout(function(){var ya=Fa||null,ma=la||{};if(0===Ba.length&&ca)Z(Y.a);else{Y.f+=Ba.length;ca&&(Y.j=ca);var Ma,Qa=[];for(Ma=0;Ma<Ba.length;Ma++){var Ya=Ba[Ma],cb=ma[Ya.c],Na=Y.a,mb=Ya;Na.g&&k(Na.f,[Na.a.c("wf",mb.c,F(mb).toString(),"loading")]);C(Na,"fontloading",mb);Na=null;null===Aa&&(Aa=window.FontFace?(mb=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent))?
42<parseInt(mb[1],10):!0:!1);Aa?Na=new S(c(Y.g,Y),c(Y.h,Y),Y.c,Ya,Y.s,cb):Na=new fa(c(Y.g,Y),c(Y.h,Y),Y.c,Ya,Y.s,ya,cb);Qa.push(Na)}for(Ma=0;Ma<Qa.length;Ma++)Qa[Ma].start()}},0)}function J(P,Y,Ba){var la=[],Fa=Ba.timeout;M(Y);la=O(P.a,Ba,P.c);var ca=new ta(P.c,Y,Fa);P.h=la.length;Y=0;for(Ba=la.length;Y<Ba;Y++)la[Y].load(function(ya,ma,Ma){Q(P,ca,ya,ma,Ma)})}function N(P,Y){this.c=P;this.a=Y}function V(P,Y,Ba){var la=m(P.c);P=(P.a.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return la+
"//"+P+"/"+Y+".js"+(Ba?"?v="+Ba:"")}function ra(P,Y){this.c=P;this.a=Y}function ka(P,Y,Ba){P?this.c=P:this.c=Y+Ia;this.a=[];this.f=[];this.g=Ba||""}function za(P,Y){for(var Ba=Y.length,la=0;la<Ba;la++){var Fa=Y[la].split(":");3==Fa.length&&P.f.push(Fa.pop());var ca="";2==Fa.length&&""!=Fa[1]&&(ca=":");P.a.push(Fa.join(ca))}}function Ea(P){if(0==P.a.length)throw Error("No fonts to load!");if(-1!=P.c.indexOf("kit="))return P.c;for(var Y=P.a.length,Ba=[],la=0;la<Y;la++)Ba.push(P.a[la].replace(/ /g,"+"));
Y=P.c+"?family="+Ba.join("%7C");0<P.f.length&&(Y+="&subset="+P.f.join(","));0<P.g.length&&(Y+="&text="+encodeURIComponent(P.g));return Y}function pa(P){this.f=P;this.a=[];this.c={}}function ha(P){for(var Y=P.f.length,Ba=0;Ba<Y;Ba++){var la=P.f[Ba].split(":"),Fa=la[0].replace(/\+/g," "),ca=["n4"];if(2<=la.length){var ya=la[1];var ma=[];if(ya){ya=ya.split(",");for(var Ma=ya.length,Qa=0;Qa<Ma;Qa++){var Ya=ya[Qa];if(Ya.match(/^[\w-]+$/)){var cb=Sa.exec(Ya.toLowerCase());if(null==cb)Ya="";else{Ya=cb[2];
Ya=null==Ya||""==Ya?"n":Ra[Ya];cb=cb[1];if(null==cb||""==cb)cb="4";else{var Na=Va[cb];cb=Na?Na:isNaN(cb)?"4":cb.substr(0,1)}Ya=[Ya,cb].join("")}}else Ya="";Ya&&ma.push(Ya)}}0<ma.length&&(ca=ma);3==la.length&&(la=la[2],ma=[],la=la?la.split(","):ma,0<la.length&&(la=Ja[la[0]])&&(P.c[Fa]=la))}P.c[Fa]||(la=Ja[Fa])&&(P.c[Fa]=la);for(la=0;la<ca.length;la+=1)P.a.push(new A(Fa,ca[la]))}}function ja(P,Y){this.c=P;this.a=Y}function Ca(P,Y){this.c=P;this.a=Y}function Ta(P,Y){this.c=P;this.f=Y;this.a=[]}var Pa=
Date.now||function(){return+new Date},Ga=!!window.FontFace;u.prototype.c=function(P){for(var Y=[],Ba=0;Ba<arguments.length;Ba++)Y.push(arguments[Ba].replace(/[\W_]+/g,"").toLowerCase());return Y.join(this.a)};S.prototype.start=function(){var P=this.c.m.document,Y=this,Ba=Pa(),la=new Promise(function(ca,ya){function ma(){Pa()-Ba>=Y.f?ya():P.fonts.load(B(Y.a),Y.h).then(function(Ma){1<=Ma.length?ca():setTimeout(ma,25)},function(){ya()})}ma()}),Fa=new Promise(function(ca,ya){setTimeout(ya,Y.f)});Promise.race([Fa,
la]).then(function(){Y.g(Y.a)},function(){Y.j(Y.a)})};var L={D:"serif",C:"sans-serif"},ia=null;fa.prototype.start=function(){this.f.serif=this.j.a.offsetWidth;this.f["sans-serif"]=this.o.a.offsetWidth;this.A=Pa();na(this)};var Aa=null;ta.prototype.g=function(P){var Y=this.a;Y.g&&k(Y.f,[Y.a.c("wf",P.c,F(P).toString(),"active")],[Y.a.c("wf",P.c,F(P).toString(),"loading"),Y.a.c("wf",P.c,F(P).toString(),"inactive")]);C(Y,"fontactive",P);this.o=!0;sa(this)};ta.prototype.h=function(P){var Y=this.a;if(Y.g){var Ba=
h(Y.f,Y.a.c("wf",P.c,F(P).toString(),"active")),la=[],Fa=[Y.a.c("wf",P.c,F(P).toString(),"loading")];Ba||la.push(Y.a.c("wf",P.c,F(P).toString(),"inactive"));k(Y.f,la,Fa)}C(Y,"fontinactive",P);sa(this)};Da.prototype.load=function(P){this.c=new d(this.j,P.context||this.j);this.g=!1!==P.events;this.f=!1!==P.classes;J(this,new K(this.c,P),P)};N.prototype.load=function(P){function Y(){if(ca["__mti_fntLst"+la]){var ya=ca["__mti_fntLst"+la](),ma=[],Ma;if(ya)for(var Qa=0;Qa<ya.length;Qa++){var Ya=ya[Qa].fontfamily;
void 0!=ya[Qa].fontStyle&&void 0!=ya[Qa].fontWeight?(Ma=ya[Qa].fontStyle+ya[Qa].fontWeight,ma.push(new A(Ya,Ma))):ma.push(new A(Ya))}P(ma)}else setTimeout(function(){Y()},50)}var Ba=this,la=Ba.a.projectId,Fa=Ba.a.version;if(la){var ca=Ba.c.m;n(this.c,V(Ba,la,Fa),function(ya){ya?P([]):(ca["__MonotypeConfiguration__"+la]=function(){return Ba.a},Y())}).id="__MonotypeAPIScript__"+la}else P([])};ra.prototype.load=function(P){var Y,Ba=this.a.urls||[],la=this.a.families||[],Fa=this.a.testStrings||{},ca=
new p;var ya=0;for(Y=Ba.length;ya<Y;ya++)q(this.c,Ba[ya],r(ca));var ma=[];ya=0;for(Y=la.length;ya<Y;ya++)if(Ba=la[ya].split(":"),Ba[1])for(var Ma=Ba[1].split(","),Qa=0;Qa<Ma.length;Qa+=1)ma.push(new A(Ba[0],Ma[Qa]));else ma.push(new A(Ba[0]));x(ca,function(){P(ma,Fa)})};var Ia="//fonts.googleapis.com/css",Ja={latin:"BESbswy","latin-ext":"\u00e7\u00f6\u00fc\u011f\u015f",cyrillic:"\u0439\u044f\u0416",greek:"\u03b1\u03b2\u03a3",khmer:"\u1780\u1781\u1782",Hanuman:"\u1780\u1781\u1782"},Va={thin:"1",extralight:"2",
"extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Ra={i:"i",italic:"i",n:"n",normal:"n"},Sa=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/,db={Arimo:!0,Cousine:!0,Tinos:!0};ja.prototype.load=function(P){var Y=
new p,Ba=this.c,la=new ka(this.a.api,m(Ba),this.a.text),Fa=this.a.families;za(la,Fa);var ca=new pa(Fa);ha(ca);q(Ba,Ea(la),r(Y));x(Y,function(){P(ca.a,ca.c,db)})};Ca.prototype.load=function(P){var Y=this.a.id,Ba=this.c.m;Y?n(this.c,(this.a.api||"https://use.typekit.net")+"/"+Y+".js",function(la){if(la)P([]);else if(Ba.Typekit&&Ba.Typekit.config&&Ba.Typekit.config.fn){la=Ba.Typekit.config.fn;for(var Fa=[],ca=0;ca<la.length;ca+=2)for(var ya=la[ca],ma=la[ca+1],Ma=0;Ma<ma.length;Ma++)Fa.push(new A(ya,
ma[Ma]));try{Ba.Typekit.load({events:!1,classes:!1,async:!0})}catch(Qa){}P(Fa)}},2E3):P([])};Ta.prototype.load=function(P){var Y=this.f.id,Ba=this.c.m,la=this;Y?(Ba.__webfontfontdeckmodule__||(Ba.__webfontfontdeckmodule__={}),Ba.__webfontfontdeckmodule__[Y]=function(Fa,ca){Fa=0;for(var ya=ca.fonts.length;Fa<ya;++Fa){var ma=ca.fonts[Fa],Ma=la.a,Qa=Ma.push,Ya=ma.name;ma="font-weight:"+ma.weight+";font-style:"+ma.style;var cb=4,Na="n",mb=null;ma&&((mb=ma.match(/(normal|oblique|italic)/i))&&mb[1]&&(Na=
mb[1].substr(0,1).toLowerCase()),(mb=ma.match(/([1-9]00|normal|bold)/i))&&mb[1]&&(/bold/i.test(mb[1])?cb=7:/[1-9]00/.test(mb[1])&&(cb=parseInt(mb[1].substr(0,1),10))));Qa.call(Ma,new A(Ya,Na+cb))}P(la.a)},n(this.c,m(this.c)+(this.f.api||"//f.fontdeck.com/s/css/js/")+l(this.c)+"/"+Y+".js",function(Fa){Fa&&P([])})):P([])};var eb=new Da(window);eb.a.c.custom=function(P,Y){return new ra(Y,P)};eb.a.c.fontdeck=function(P,Y){return new Ta(Y,P)};eb.a.c.monotype=function(P,Y){return new N(Y,P)};eb.a.c.typekit=
function(P,Y){return new Ca(Y,P)};eb.a.c.google=function(P,Y){return new ja(Y,P)};var gb={load:c(eb.load,eb)};"function"===typeof define&&define.amd?define(function(){return gb}):"undefined"!==typeof module&&module.exports?module.exports=gb:(window.WebFont=gb,window.WebFontConfig&&eb.load(window.WebFontConfig))})();var THREE={REVISION:"71"};"object"===typeof module&&(module.exports=THREE);void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});THREE.log=function(){console.log.apply(console,arguments)};THREE.warn=function(){console.warn.apply(console,arguments)};THREE.error=function(){console.error.apply(console,arguments)};THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;
THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;
THREE.MinEquation=103;THREE.MaxEquation=104;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.UVMapping=300;THREE.CubeReflectionMapping=301;THREE.CubeRefractionMapping=302;
THREE.EquirectangularReflectionMapping=303;THREE.EquirectangularRefractionMapping=304;THREE.SphericalReflectionMapping=305;THREE.Color=function(a){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(a)};
THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(a){a instanceof THREE.Color?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(a,b,c){if(0===b)this.r=this.g=this.b=c;else{var d=function(e,f,g){0>g&&(g+=1);1<g&&--g;return g<1/6?e+6*(f-e)*g:
.5>g?f:g<2/3?e+6*(f-e)*(2/3-g):e};b=.5>=c?c*(1+b):c+b-c*b;c=2*c-b;this.r=d(c,b,a+1/3);this.g=d(c,b,a);this.b=d(c,b,a-1/3)}return this},setStyle:function(a){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(a))return a=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(a),this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,this;if(/^rgb\((\d+)%, ?(\d+)%, ?(\d+)%\)$/i.test(a))return a=/^rgb\((\d+)%, ?(\d+)%, ?(\d+)%\)$/i.exec(a),this.r=Math.min(100,
parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,this;if(/^#([0-9a-f]{6})$/i.test(a))return a=/^#([0-9a-f]{6})$/i.exec(a),this.setHex(parseInt(a[1],16)),this;if(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a))return a=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a),this.setHex(parseInt(a[1]+a[1]+a[2]+a[2]+a[3]+a[3],16)),this;if(/^(\w+)$/i.test(a))return this.setHex(THREE.ColorKeywords[a]),this},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;
return this},copyGammaToLinear:function(a,b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);b=0<b?1/b:1;this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);
return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var b=this.r,c=this.g,d=this.b,e=Math.max(b,c,d),f=Math.min(b,c,d),g,k=(f+e)/2;if(f===e)f=g=0;else{var h=e-f;f=.5>=k?h/(e+f):h/(2-e-f);switch(e){case b:g=(c-d)/h+(c<d?6:0);break;case c:g=(d-b)/h+2;break;case d:g=(b-c)/h+4}g/=6}a.h=g;a.s=f;a.l=k;return a},getStyle:function(){return"rgb("+(255*this.r|0)+
","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,b,c){var d=this.getHSL();d.h+=a;d.s+=b;d.l+=c;this.setHSL(d.h,d.s,d.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,
b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a){this.r=a[0];this.g=a[1];this.b=a[2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};
THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,
darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,
grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,
lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,
palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,
tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==d?d:1};
THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this.onChangeCallback();return this},copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;
this._w=a.w;this.onChangeCallback();return this},setFromEuler:function(a,b){if(!1===a instanceof THREE.Euler)throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var c=Math.cos(a._x/2),d=Math.cos(a._y/2),e=Math.cos(a._z/2),f=Math.sin(a._x/2),g=Math.sin(a._y/2),k=Math.sin(a._z/2);"XYZ"===a.order?(this._x=f*d*e+c*g*k,this._y=c*g*e-f*d*k,this._z=c*d*k+f*g*e,this._w=c*d*e-f*g*k):"YXZ"===a.order?(this._x=f*d*e+c*g*k,this._y=c*g*e-f*d*k,this._z=
c*d*k-f*g*e,this._w=c*d*e+f*g*k):"ZXY"===a.order?(this._x=f*d*e-c*g*k,this._y=c*g*e+f*d*k,this._z=c*d*k+f*g*e,this._w=c*d*e-f*g*k):"ZYX"===a.order?(this._x=f*d*e-c*g*k,this._y=c*g*e+f*d*k,this._z=c*d*k-f*g*e,this._w=c*d*e+f*g*k):"YZX"===a.order?(this._x=f*d*e+c*g*k,this._y=c*g*e+f*d*k,this._z=c*d*k-f*g*e,this._w=c*d*e-f*g*k):"XZY"===a.order&&(this._x=f*d*e-c*g*k,this._y=c*g*e-f*d*k,this._z=c*d*k+f*g*e,this._w=c*d*e+f*g*k);if(!1!==b)this.onChangeCallback();return this},setFromAxisAngle:function(a,
b){b/=2;var c=Math.sin(b);this._x=a.x*c;this._y=a.y*c;this._z=a.z*c;this._w=Math.cos(b);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var d=b[8],e=b[1],f=b[5],g=b[9],k=b[2],h=b[6];b=b[10];var m=c+f+b;0<m?(c=.5/Math.sqrt(m+1),this._w=.25/c,this._x=(h-g)*c,this._y=(d-k)*c,this._z=(e-a)*c):c>f&&c>b?(c=2*Math.sqrt(1+c-f-b),this._w=(h-g)/c,this._x=.25*c,this._y=(a+e)/c,this._z=(d+k)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this._w=(d-k)/c,this._x=(a+e)/c,this._y=
.25*c,this._z=(g+h)/c):(c=2*Math.sqrt(1+b-c-f),this._w=(e-a)/c,this._x=(d+k)/c,this._y=(g+h)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3);b=c.dot(d)+1;1E-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,d);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=
-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},
multiply:function(a,b){return void 0!==b?(THREE.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z;a=a._w;var f=b._x,g=b._y,k=b._z;b=b._w;this._x=c*b+a*f+d*k-e*g;this._y=d*b+a*g+e*f-c*k;this._z=e*b+a*k+c*g-d*f;this._w=a*b-c*f-d*g-e*k;this.onChangeCallback();return this},multiplyVector3:function(a){THREE.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");
return a.applyQuaternion(this)},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a);if(1<=g)return this._w=f,this._x=c,this._y=d,this._z=e,this;a=Math.acos(g);var k=Math.sqrt(1-g*g);if(.001>Math.abs(k))return this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;g=Math.sin((1-b)*a)/k;b=
Math.sin(b*a)/k;this._w=f*g+this._w*b;this._x=c*g+this._x*b;this._y=d*g+this._y*b;this._z=e*g+this._z*b;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=
a;return this},onChangeCallback:function(){},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}};THREE.Quaternion.slerp=function(a,b,c,d){return c.copy(a).slerp(b,d)};THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};
THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(a,b){this.x=a;this.y=b;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,
b){if(void 0!==b)return THREE.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},sub:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},
subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a):this.y=this.x=0;return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);return this},max:function(a){this.x<a.x&&(this.x=a.x);
this.y<a.y&&(this.y=a.y);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector2,b=new THREE.Vector2);a.set(c,c);b.set(d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=
Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},
distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},toArray:function(a,b){void 0===
a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];return this},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};
THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+
a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},sub:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=
a;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===b instanceof THREE.Euler&&THREE.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.");void 0===a&&(a=new THREE.Quaternion);this.applyQuaternion(a.setFromEuler(b));return this}}(),applyAxisAngle:function(){var a;return function(b,c){void 0===a&&(a=new THREE.Quaternion);this.applyQuaternion(a.setFromAxisAngle(b,
c));return this}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12];this.y=a[1]*b+a[5]*c+a[9]*d+a[13];this.z=a[2]*b+a[6]*c+a[10]*d+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*
c+a[8]*d+a[12])*e;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*e;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;a=a.w;var k=a*b+f*d-g*c,h=a*c+g*b-e*d,m=a*d+e*c-f*b;b=-e*b-f*c-g*d;this.x=k*a+b*-e+h*-g-m*-f;this.y=h*a+b*-f+m*-e-k*-g;this.z=m*a+b*-g+k*-f-h*-e;return this},project:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyProjection(a)}}(),
unproject:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyProjection(a)}}(),transformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;this.normalize();return this},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=
a):this.z=this.y=this.x=0;return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);return this},max:function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3,
b=new THREE.Vector3);a.set(c,c,c);b.set(d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):
Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},
setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},cross:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);b=this.x;var c=this.y,d=this.z;this.x=c*a.z-d*a.y;this.y=
d*a.x-b*a.z;this.z=b*a.y-c*a.x;return this},crossVectors:function(a,b){var c=a.x,d=a.y;a=a.z;var e=b.x,f=b.y;b=b.z;this.x=d*b-a*f;this.y=a*e-c*b;this.z=c*f-d*e;return this},projectOnVector:function(){var a,b;return function(c){void 0===a&&(a=new THREE.Vector3);a.copy(c).normalize();b=this.dot(a);return this.copy(a).multiplyScalar(b)}}(),projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;
return function(b){void 0===a&&(a=new THREE.Vector3);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=this.dot(a)/(this.length()*a.length());return Math.acos(THREE.Math.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},setEulerFromRotationMatrix:function(a,b){THREE.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},
setEulerFromQuaternion:function(a,b){THREE.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){THREE.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){THREE.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,
b){THREE.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(a,b)},setFromMatrixPosition:function(a){this.x=a.elements[12];this.y=a.elements[13];this.z=a.elements[14];return this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length();a=this.set(a.elements[8],a.elements[9],a.elements[10]).length();this.x=b;this.y=c;this.z=a;
return this},setFromMatrixColumn:function(a,b){a*=4;b=b.elements;this.x=b[a];this.y=b[a+1];this.z=b[a+2];return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+
2];return this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1};
THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;
case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,
b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},sub:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){this.x*=
a;this.y*=a;this.z*=a;this.w*=a;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*e;this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*e;this.z=a[2]*b+a[6]*c+a[10]*d+a[14]*e;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*e;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a):(this.z=this.y=this.x=0,this.w=1);return this},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>
b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){a=a.elements;var b=a[0];var c=a[4];var d=a[8],e=a[1],f=a[5],g=a[9];var k=a[2];var h=a[6];var m=a[10];if(.01>Math.abs(c-e)&&.01>Math.abs(d-k)&&.01>Math.abs(g-h)){if(.1>Math.abs(c+e)&&.1>Math.abs(d+k)&&.1>Math.abs(g+h)&&.1>Math.abs(b+f+m-3))return this.set(1,0,0,0),this;a=Math.PI;b=(b+1)/2;f=(f+1)/2;m=(m+1)/2;c=(c+e)/4;d=(d+k)/4;g=(g+h)/4;b>f&&b>m?.01>b?(h=0,c=k=.707106781):
(h=Math.sqrt(b),k=c/h,c=d/h):f>m?.01>f?(h=.707106781,k=0,c=.707106781):(k=Math.sqrt(f),h=c/k,c=g/k):.01>m?(k=h=.707106781,c=0):(c=Math.sqrt(m),h=d/c,k=g/c);this.set(h,k,c,a);return this}a=Math.sqrt((h-g)*(h-g)+(d-k)*(d-k)+(e-c)*(e-c));.001>Math.abs(a)&&(a=1);this.x=(h-g)/a;this.y=(d-k)/a;this.z=(e-c)/a;this.w=Math.acos((b+f+m-1)/2);return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);this.w>a.w&&(this.w=a.w);return this},max:function(a){this.x<a.x&&
(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);this.w<a.w&&(this.w=a.w);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z);this.w<a.w?this.w=a.w:this.w>b.w&&(this.w=b.w);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector4,b=new THREE.Vector4);a.set(c,c,c,c);b.set(d,d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=
Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);
this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+
Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},
fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];this.w=a.array[b+3];return this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};
THREE.Euler=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._order=d||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");THREE.Euler.DefaultOrder="XYZ";
THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},copy:function(a){this._x=
a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b,c){var d=THREE.Math.clamp,e=a.elements;a=e[0];var f=e[4],g=e[8],k=e[1],h=e[5],m=e[9],l=e[2],q=e[6];e=e[10];b=b||this._order;"XYZ"===b?(this._y=Math.asin(d(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(-m,e),this._z=Math.atan2(-f,a)):(this._x=Math.atan2(q,h),this._z=0)):"YXZ"===b?(this._x=Math.asin(-d(m,-1,1)),.99999>Math.abs(m)?(this._y=Math.atan2(g,e),this._z=Math.atan2(k,
h)):(this._y=Math.atan2(-l,a),this._z=0)):"ZXY"===b?(this._x=Math.asin(d(q,-1,1)),.99999>Math.abs(q)?(this._y=Math.atan2(-l,e),this._z=Math.atan2(-f,h)):(this._y=0,this._z=Math.atan2(k,a))):"ZYX"===b?(this._y=Math.asin(-d(l,-1,1)),.99999>Math.abs(l)?(this._x=Math.atan2(q,e),this._z=Math.atan2(k,a)):(this._x=0,this._z=Math.atan2(-f,h))):"YZX"===b?(this._z=Math.asin(d(k,-1,1)),.99999>Math.abs(k)?(this._x=Math.atan2(-m,h),this._y=Math.atan2(-l,a)):(this._x=0,this._y=Math.atan2(g,e))):"XZY"===b?(this._z=
Math.asin(-d(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(q,h),this._y=Math.atan2(g,a)):(this._x=Math.atan2(-m,e),this._y=0)):THREE.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+b);this._order=b;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeRotationFromQuaternion(b);this.setFromRotationMatrix(a,c,d);return this}}(),setFromVector3:function(a,b){return this.set(a.x,a.y,a.z,
b||this._order)},reorder:function(){var a=new THREE.Quaternion;return function(b){a.setFromEuler(this);this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._order;return a},toVector3:function(a){return a?
a.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}};THREE.Line3=function(a,b){this.start=void 0!==a?a:new THREE.Vector3;this.end=void 0!==b?b:new THREE.Vector3};
THREE.Line3.prototype={constructor:THREE.Line3,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},center:function(a){return(a||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,
b){b=b||new THREE.Vector3;return this.delta(b).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);c=b.dot(b);c=b.dot(a)/c;d&&(c=THREE.Math.clamp(c,0,1));return c}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);c=c||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);
this.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}};THREE.Box2=function(a,b){this.min=void 0!==a?a:new THREE.Vector2(Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector2(-Infinity,-Infinity)};
THREE.Box2.prototype={constructor:THREE.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new THREE.Vector2).addVectors(this.min,
this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&
this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector2).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector2;return function(b){return a.copy(b).clamp(this.min,
this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}};
THREE.Box3=function(a,b){this.min=void 0!==a?a:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};
THREE.Box3.prototype={constructor:THREE.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},
center:function(a){return(a||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<
this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector3).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<
this.min.z||a.min.z>this.max.z?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new THREE.Vector3;return function(b){b=b||new THREE.Sphere;b.center=this.center();b.radius=.5*this.size(a).length();return b}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);
this.max.max(a.max);return this},applyMatrix4:function(){var a=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(b){a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);
a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.makeEmpty();this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}};
THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&THREE.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")};
THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(a,b,c,d,e,f,g,k,h){var m=this.elements;m[0]=a;m[3]=b;m[6]=c;m[1]=d;m[4]=e;m[7]=f;m[2]=g;m[5]=k;m[8]=h;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},multiplyVector3:function(a){THREE.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},
multiplyVector3Array:function(a){THREE.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new THREE.Vector3;return function(b,c,d){void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix3(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=
a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],k=a[6],h=a[7];a=a[8];return b*f*a-b*g*h-c*e*a+c*g*k+d*e*h-d*f*k},getInverse:function(a,b){a=a.elements;var c=this.elements;c[0]=a[10]*a[5]-a[6]*a[9];c[1]=-a[10]*a[1]+a[2]*a[9];c[2]=a[6]*a[1]-a[2]*a[5];c[3]=-a[10]*a[4]+a[6]*a[8];c[4]=a[10]*a[0]-a[2]*a[8];c[5]=-a[6]*a[0]+a[2]*a[4];c[6]=a[9]*a[4]-a[5]*a[8];c[7]=-a[9]*a[0]+a[1]*a[8];c[8]=a[5]*a[0]-a[1]*a[4];
a=a[0]*c[0]+a[1]*c[3]+a[2]*c[6];if(0===a){if(b)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");THREE.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/a);return this},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];
a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a},getNormalMatrix:function(a){this.getInverse(a).transpose();return this},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]},clone:function(){return(new THREE.Matrix3).fromArray(this.elements)}};
THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&THREE.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")};
THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(a,b,c,d,e,f,g,k,h,m,l,q,n,p,r,x){var w=this.elements;w[0]=a;w[4]=b;w[8]=c;w[12]=d;w[1]=e;w[5]=f;w[9]=g;w[13]=k;w[2]=h;w[6]=m;w[10]=l;w[14]=q;w[3]=n;w[7]=p;w[11]=r;w[15]=x;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){this.elements.set(a.elements);return this},extractPosition:function(a){THREE.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(a)},
copyPosition:function(a){var b=this.elements;a=a.elements;b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,b,c){var d=this.elements;a.set(d[0],d[1],d[2]);b.set(d[4],d[5],d[6]);c.set(d[8],d[9],d[10]);return this},makeBasis:function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var a=new THREE.Vector3;return function(b){var c=this.elements;b=b.elements;var d=1/a.set(b[0],b[1],b[2]).length(),e=1/a.set(b[4],b[5],b[6]).length(),
f=1/a.set(b[8],b[9],b[10]).length();c[0]=b[0]*d;c[1]=b[1]*d;c[2]=b[2]*d;c[4]=b[4]*e;c[5]=b[5]*e;c[6]=b[6]*e;c[8]=b[8]*f;c[9]=b[9]*f;c[10]=b[10]*f;return this}}(),makeRotationFromEuler:function(a){!1===a instanceof THREE.Euler&&THREE.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c);c=Math.sin(c);var g=Math.cos(d);d=Math.sin(d);var k=Math.cos(e);e=Math.sin(e);if("XYZ"===a.order){a=f*k;var h=
f*e,m=c*k,l=c*e;b[0]=g*k;b[4]=-g*e;b[8]=d;b[1]=h+m*d;b[5]=a-l*d;b[9]=-c*g;b[2]=l-a*d;b[6]=m+h*d;b[10]=f*g}else"YXZ"===a.order?(a=g*k,h=g*e,m=d*k,l=d*e,b[0]=a+l*c,b[4]=m*c-h,b[8]=f*d,b[1]=f*e,b[5]=f*k,b[9]=-c,b[2]=h*c-m,b[6]=l+a*c,b[10]=f*g):"ZXY"===a.order?(a=g*k,h=g*e,m=d*k,l=d*e,b[0]=a-l*c,b[4]=-f*e,b[8]=m+h*c,b[1]=h+m*c,b[5]=f*k,b[9]=l-a*c,b[2]=-f*d,b[6]=c,b[10]=f*g):"ZYX"===a.order?(a=f*k,h=f*e,m=c*k,l=c*e,b[0]=g*k,b[4]=m*d-h,b[8]=a*d+l,b[1]=g*e,b[5]=l*d+a,b[9]=h*d-m,b[2]=-d,b[6]=c*g,b[10]=f*
g):"YZX"===a.order?(a=f*g,h=f*d,m=c*g,l=c*d,b[0]=g*k,b[4]=l-a*e,b[8]=m*e+h,b[1]=e,b[5]=f*k,b[9]=-c*k,b[2]=-d*k,b[6]=h*e+m,b[10]=a-l*e):"XZY"===a.order&&(a=f*g,h=f*d,m=c*g,l=c*d,b[0]=g*k,b[4]=-e,b[8]=d*k,b[1]=a*e+l,b[5]=f*k,b[9]=h*e-m,b[2]=m*e-h,b[6]=c*k,b[10]=l*e+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},setRotationFromQuaternion:function(a){THREE.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(a)},
makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,k=d+d,h=e+e;a=c*g;var m=c*k;c*=h;var l=d*k;d*=h;e*=h;g*=f;k*=f;f*=h;b[0]=1-(l+e);b[4]=m-f;b[8]=c+k;b[1]=m+f;b[5]=1-(a+e);b[9]=d-g;b[2]=c-k;b[6]=d+g;b[10]=1-(a+l);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f){var g=this.elements;c.subVectors(d,e).normalize();0===c.length()&&(c.z=1);a.crossVectors(f,
c).normalize();0===a.length()&&(c.x+=1E-4,a.crossVectors(f,c).normalize());b.crossVectors(c,a);g[0]=a.x;g[4]=b.x;g[8]=c.x;g[1]=a.y;g[5]=b.y;g[9]=c.y;g[2]=a.z;g[6]=b.z;g[10]=c.z;return this}}(),multiply:function(a,b){return void 0!==b?(THREE.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements;b=this.elements;a=c[0];var e=c[4],f=
c[8],g=c[12],k=c[1],h=c[5],m=c[9],l=c[13],q=c[2],n=c[6],p=c[10],r=c[14],x=c[3],w=c[7],u=c[11];c=c[15];var A=d[0],B=d[4],I=d[8],F=d[12],E=d[1],K=d[5],M=d[9],Z=d[13],C=d[2],U=d[6],O=d[10],W=d[14],aa=d[3],R=d[7],S=d[11];d=d[15];b[0]=a*A+e*E+f*C+g*aa;b[4]=a*B+e*K+f*U+g*R;b[8]=a*I+e*M+f*O+g*S;b[12]=a*F+e*Z+f*W+g*d;b[1]=k*A+h*E+m*C+l*aa;b[5]=k*B+h*K+m*U+l*R;b[9]=k*I+h*M+m*O+l*S;b[13]=k*F+h*Z+m*W+l*d;b[2]=q*A+n*E+p*C+r*aa;b[6]=q*B+n*K+p*U+r*R;b[10]=q*I+n*M+p*O+r*S;b[14]=q*F+n*Z+p*W+r*d;b[3]=x*A+w*E+u*C+
c*aa;b[7]=x*B+w*K+u*U+c*R;b[11]=x*I+w*M+u*O+c*S;b[15]=x*F+w*Z+u*W+c*d;return this},multiplyToArray:function(a,b,c){var d=this.elements;this.multiplyMatrices(a,b);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;
b[7]*=a;b[11]*=a;b[15]*=a;return this},multiplyVector3:function(a){THREE.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return a.applyProjection(this)},multiplyVector4:function(a){THREE.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector3Array:function(a){THREE.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");
return this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new THREE.Vector3;return function(b,c,d){void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix4(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),rotateAxis:function(a){THREE.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){THREE.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");
return a.applyMatrix4(this)},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],k=a[9],h=a[13],m=a[2],l=a[6],q=a[10],n=a[14];return a[3]*(+e*k*l-d*h*l-e*g*q+c*h*q+d*g*n-c*k*n)+a[7]*(+b*k*n-b*h*q+e*f*q-d*f*n+d*h*m-e*k*m)+a[11]*(+b*h*l-b*g*n-e*f*l+c*f*n+e*g*m-c*h*m)+a[15]*(-d*g*m-b*k*l+b*g*q+d*f*l-c*f*q+c*k*m)},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=
a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a},getPosition:function(){var a=new THREE.Vector3;return function(){THREE.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");
var b=this.elements;return a.set(b[12],b[13],b[14])}}(),setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var c=this.elements,d=a.elements;a=d[0];var e=d[4],f=d[8],g=d[12],k=d[1],h=d[5],m=d[9],l=d[13],q=d[2],n=d[6],p=d[10],r=d[14],x=d[3],w=d[7],u=d[11];d=d[15];c[0]=m*r*w-l*p*w+l*n*u-h*r*u-m*n*d+h*p*d;c[4]=g*p*w-f*r*w-g*n*u+e*r*u+f*n*d-e*p*d;c[8]=f*l*w-g*m*w+g*h*u-e*l*u-f*h*d+e*m*d;c[12]=g*m*n-f*l*n-g*h*p+e*l*p+f*h*r-e*m*r;c[1]=l*p*x-m*
r*x-l*q*u+k*r*u+m*q*d-k*p*d;c[5]=f*r*x-g*p*x+g*q*u-a*r*u-f*q*d+a*p*d;c[9]=g*m*x-f*l*x-g*k*u+a*l*u+f*k*d-a*m*d;c[13]=f*l*q-g*m*q+g*k*p-a*l*p-f*k*r+a*m*r;c[2]=h*r*x-l*n*x+l*q*w-k*r*w-h*q*d+k*n*d;c[6]=g*n*x-e*r*x-g*q*w+a*r*w+e*q*d-a*n*d;c[10]=e*l*x-g*h*x+g*k*w-a*l*w-e*k*d+a*h*d;c[14]=g*h*q-e*l*q-g*k*n+a*l*n+e*k*r-a*h*r;c[3]=m*n*x-h*p*x-m*q*w+k*p*w+h*q*u-k*n*u;c[7]=e*p*x-f*n*x+f*q*w-a*p*w-e*q*u+a*n*u;c[11]=f*h*x-e*m*x-f*k*w+a*m*w+e*k*u-a*h*u;c[15]=e*m*q-f*h*q+f*k*n-a*m*n-e*k*p+a*h*p;c=a*c[0]+k*c[4]+q*
c[8]+x*c[12];if(0==c){if(b)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");THREE.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/c);return this},translate:function(a){THREE.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(a){THREE.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(a){THREE.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(a){THREE.error("THREE.Matrix4: .rotateZ() has been removed.")},
rotateByAxis:function(a,b){THREE.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(a){var b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],Math.max(a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10])))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,
c,0,0,0,1);return this},makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b);b=Math.sin(b);var d=1-c,e=a.x,f=a.y;a=a.z;var g=d*e,k=d*f;this.set(g*e+c,g*f-b*a,g*a+b*
f,0,g*f+b*a,k*f+c,k*a-b*e,0,g*a-b*f,k*a+b*e,d*a*a+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a=new THREE.Vector3,b=new THREE.Matrix4;return function(c,d,e){var f=this.elements,g=a.set(f[0],f[1],f[2]).length(),k=a.set(f[4],f[5],f[6]).length(),h=a.set(f[8],f[9],f[10]).length();0>this.determinant()&&(g=-g);c.x=
f[12];c.y=f[13];c.z=f[14];b.elements.set(this.elements);c=1/g;f=1/k;var m=1/h;b.elements[0]*=c;b.elements[1]*=c;b.elements[2]*=c;b.elements[4]*=f;b.elements[5]*=f;b.elements[6]*=f;b.elements[8]*=m;b.elements[9]*=m;b.elements[10]*=m;d.setFromRotationMatrix(b);e.x=g;e.y=k;e.z=h;return this}}(),makeFrustum:function(a,b,c,d,e,f){var g=this.elements;g[0]=2*e/(b-a);g[4]=0;g[8]=(b+a)/(b-a);g[12]=0;g[1]=0;g[5]=2*e/(d-c);g[9]=(d+c)/(d-c);g[13]=0;g[2]=0;g[6]=0;g[10]=-(f+e)/(f-e);g[14]=-2*f*e/(f-e);g[3]=0;g[7]=
0;g[11]=-1;g[15]=0;return this},makePerspective:function(a,b,c,d){a=c*Math.tan(THREE.Math.degToRad(.5*a));var e=-a;return this.makeFrustum(e*b,a*b,e,a,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,k=b-a,h=c-d,m=f-e;g[0]=2/k;g[4]=0;g[8]=0;g[12]=-((b+a)/k);g[1]=0;g[5]=2/h;g[9]=0;g[13]=-((c+d)/h);g[2]=0;g[6]=0;g[10]=-2/m;g[14]=-((f+e)/m);g[3]=0;g[7]=0;g[11]=0;g[15]=1;return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],
a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)}};THREE.Triangle=function(a,b,c){this.a=void 0!==a?a:new THREE.Vector3;this.b=void 0!==b?b:new THREE.Vector3;this.c=void 0!==c?c:new THREE.Vector3};
THREE.Triangle.normal=function(){var a=new THREE.Vector3;return function(b,c,d,e){e=e||new THREE.Vector3;e.subVectors(d,c);a.subVectors(b,c);e.cross(a);b=e.lengthSq();return 0<b?e.multiplyScalar(1/Math.sqrt(b)):e.set(0,0,0)}}();
THREE.Triangle.barycoordFromPoint=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f,g,k){a.subVectors(g,e);b.subVectors(f,e);c.subVectors(d,e);d=a.dot(a);e=a.dot(b);f=a.dot(c);var h=b.dot(b);g=b.dot(c);var m=d*h-e*e;k=k||new THREE.Vector3;if(0==m)return k.set(-2,-1,-1);m=1/m;h=(h*f-e*g)*m;d=(d*g-e*f)*m;return k.set(1-h-d,d,h)}}();
THREE.Triangle.containsPoint=function(){var a=new THREE.Vector3;return function(b,c,d,e){b=THREE.Triangle.barycoordFromPoint(b,c,d,e,a);return 0<=b.x&&0<=b.y&&1>=b.x+b.y}}();
THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,this.b);return.5*a.cross(b).length()}}(),midpoint:function(a){return(a||
new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return THREE.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return THREE.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return THREE.Triangle.containsPoint(a,this.a,this.b,this.c)},equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)},
clone:function(){return(new THREE.Triangle).copy(this)}};THREE.Ray=function(a,b){this.origin=void 0!==a?a:new THREE.Vector3;this.direction=void 0!==b?b:new THREE.Vector3};
THREE.Ray.prototype={constructor:THREE.Ray,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){return(b||new THREE.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},recast:function(){var a=new THREE.Vector3;return function(b){this.origin.copy(this.at(b,a));return this}}(),closestPointToPoint:function(a,b){b=b||new THREE.Vector3;b.subVectors(a,this.origin);
a=b.dot(this.direction);return 0>a?b.copy(this.origin):b.copy(this.direction).multiplyScalar(a).add(this.origin)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceTo(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);return a.distanceTo(b)}}(),distanceSqToSegment:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f,g){a.copy(d).add(e).multiplyScalar(.5);
b.copy(e).sub(d).normalize();c.copy(this.origin).sub(a);var k=.5*d.distanceTo(e),h=-this.direction.dot(b),m=c.dot(this.direction),l=-c.dot(b),q=c.lengthSq(),n=Math.abs(1-h*h);if(0<n){d=h*l-m;e=h*m-l;var p=k*n;0<=d?e>=-p?e<=p?(k=1/n,d*=k,e*=k,h=d*(d+h*e+2*m)+e*(h*d+e+2*l)+q):(e=k,d=Math.max(0,-(h*e+m)),h=-d*d+e*(e+2*l)+q):(e=-k,d=Math.max(0,-(h*e+m)),h=-d*d+e*(e+2*l)+q):e<=-p?(d=Math.max(0,-(-h*k+m)),e=0<d?-k:Math.min(Math.max(-k,-l),k),h=-d*d+e*(e+2*l)+q):e<=p?(d=0,e=Math.min(Math.max(-k,-l),k),h=
e*(e+2*l)+q):(d=Math.max(0,-(h*k+m)),e=0<d?k:Math.min(Math.max(-k,-l),k),h=-d*d+e*(e+2*l)+q)}else e=0<h?-k:k,d=Math.max(0,-(h*e+m)),h=-d*d+e*(e+2*l)+q;f&&f.copy(this.direction).multiplyScalar(d).add(this.origin);g&&g.copy(b).multiplyScalar(e).add(a);return h}}(),isIntersectionSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},intersectSphere:function(){var a=new THREE.Vector3;return function(b,c){a.subVectors(b.center,this.origin);var d=a.dot(this.direction),e=a.dot(a)-d*d;b=b.radius*
b.radius;if(e>b)return null;b=Math.sqrt(b-e);e=d-b;d+=b;return 0>e&&0>d?null:0>e?this.at(d,c):this.at(e,c)}}(),isIntersectionPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0==b)return 0==a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){a=this.distanceToPlane(a);return null===a?null:this.at(a,
b)},isIntersectionBox:function(){var a=new THREE.Vector3;return function(b){return null!==this.intersectBox(b,a)}}(),intersectBox:function(a,b){var c=1/this.direction.x;var d=1/this.direction.y;var e=1/this.direction.z,f=this.origin;if(0<=c){var g=(a.min.x-f.x)*c;c*=a.max.x-f.x}else g=(a.max.x-f.x)*c,c*=a.min.x-f.x;if(0<=d){var k=(a.min.y-f.y)*d;d*=a.max.y-f.y}else k=(a.max.y-f.y)*d,d*=a.min.y-f.y;if(g>d||k>c)return null;if(k>g||g!==g)g=k;if(d<c||c!==c)c=d;0<=e?(k=(a.min.z-f.z)*e,a=(a.max.z-f.z)*
e):(k=(a.max.z-f.z)*e,a=(a.min.z-f.z)*e);if(g>a||k>c)return null;if(k>g||g!==g)g=k;if(a<c||c!==c)c=a;return 0>c?null:this.at(0<=g?g:c,b)},intersectTriangle:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(e,f,g,k,h){b.subVectors(f,e);c.subVectors(g,e);d.crossVectors(b,c);f=this.direction.dot(d);if(0<f){if(k)return null;k=1}else if(0>f)k=-1,f=-f;else return null;a.subVectors(this.origin,e);e=k*this.direction.dot(c.crossVectors(a,c));if(0>
e)return null;g=k*this.direction.dot(b.cross(a));if(0>g||e+g>f)return null;e=-k*a.dot(d);return 0>e?null:this.at(e/f,h)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}};
THREE.Sphere=function(a,b){this.center=void 0!==a?a:new THREE.Vector3;this.radius=void 0!==b?b:0};
THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new THREE.Box3;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).center(d);for(var e=c=0,f=b.length;e<f;e++)c=Math.max(c,d.distanceToSquared(b[e]));this.radius=Math.sqrt(c);return this}}(),copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=
this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},clampPoint:function(a,b){var c=this.center.distanceToSquared(a);b=b||new THREE.Vector3;b.copy(a);c>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center));return b},getBoundingBox:function(a){a=a||new THREE.Box3;a.set(this.center,this.center);a.expandByScalar(this.radius);
return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}};THREE.Plane=function(a,b){this.normal=void 0!==a?a:new THREE.Vector3(1,0,0);this.constant=void 0!==b?b:0};
THREE.Plane.prototype={constructor:THREE.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,e){d=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(d,
c);return this}}(),copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,
b){a=this.distanceToPoint(a);return(b||new THREE.Vector3).copy(this.normal).multiplyScalar(a)},isIntersectionLine:function(a){var b=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectLine:function(){var a=new THREE.Vector3;return function(b,c){c=c||new THREE.Vector3;var d=b.delta(a),e=this.normal.dot(d);if(0==e){if(0==this.distanceToPoint(b.start))return c.copy(b.start)}else if(e=-(b.start.dot(this.normal)+this.constant)/e,!(0>e||1<e))return c.copy(d).multiplyScalar(e).add(b.start)}}(),
coplanarPoint:function(a){return(a||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(d,e){e=e||c.getNormalMatrix(d);e=a.copy(this.normal).applyMatrix3(e);var f=this.coplanarPoint(b);f.applyMatrix4(d);this.setFromNormalAndCoplanarPoint(e,f);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&
a.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}};
THREE.Math={generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),b=Array(36),c=0,d;return function(){for(var e=0;36>e;e++)8==e||13==e||18==e||23==e?b[e]="-":14==e?b[e]="4":(2>=c&&(c=33554432+16777216*Math.random()|0),d=c&15,c>>=4,b[e]=a[19==e?d&3|8:d]);return b.join("")}}(),clamp:function(a,b,c){return a<b?b:a>c?c:a},clampBottom:function(a,b){return a<b?b:a},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){if(a<=
b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return Math.floor(this.randFloat(a,b))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(){var a=Math.PI/180;return function(b){return b*a}}(),radToDeg:function(){var a=
180/Math.PI;return function(b){return b*a}}(),isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a}};THREE.Clock=function(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};
THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();
a=.001*(b-this.oldTime);this.oldTime=b;this.elapsedTime+=a}return a}};THREE.EventDispatcher=function(){};
THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(a){a.addEventListener=THREE.EventDispatcher.prototype.addEventListener;a.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener;a.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener;a.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&
c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},removeEventListener:function(a,b){void 0!==this._listeners&&(a=this._listeners[a],void 0!==a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1)))},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;for(var c=[],d=b.length,e=0;e<d;e++)c[e]=b[e];for(e=0;e<d;e++)c[e].call(this,a)}}}};
THREE.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++});this.name="";this.parent=void 0;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var a=new THREE.Vector3,b=new THREE.Euler,c=new THREE.Quaternion,d=new THREE.Vector3(1,1,1);b.onChange(function(){c.setFromEuler(b,!1)});c.onChange(function(){b.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,value:b},quaternion:{enumerable:!0,value:c},
scale:{enumerable:!0,value:d}});this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.userData={}};THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0);
THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=
new THREE.Quaternion;return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new THREE.Vector3;return function(b,c){a.copy(b).applyQuaternion(this.quaternion);
this.position.add(a.multiplyScalar(c));return this}}(),translate:function(a,b){THREE.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(b,a)},translateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,
b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new THREE.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new THREE.Matrix4;return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a===this)return THREE.error("THREE.Object3D.add: object can't be added as a child of itself.",
a),this;a instanceof THREE.Object3D?(void 0!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):THREE.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a);return this},remove:function(a){if(1<arguments.length)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);b=this.children.indexOf(a);-1!==b&&(a.parent=void 0,a.dispatchEvent({type:"removed"}),this.children.splice(b,1))},getChildByName:function(a){THREE.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");
return this.getObjectByName(a)},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c].getObjectByProperty(a,b);if(void 0!==e)return e}},getWorldPosition:function(a){a=a||new THREE.Vector3;this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=
new THREE.Vector3,b=new THREE.Vector3;return function(c){c=c||new THREE.Quaternion;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,b);return c}}(),getWorldRotation:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Euler;this.getWorldQuaternion(a);return b.setFromQuaternion(a,this.rotation.order,!1)}}(),getWorldScale:function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(c){c=c||new THREE.Vector3;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,
b,c);return c}}(),getWorldDirection:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverseVisible(a)}},traverseAncestors:function(a){this.parent&&(a(this.parent),
this.parent.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},
clone:function(a,b){void 0===a&&(a=new THREE.Object3D);void 0===b&&(b=!0);a.name=this.name;a.up.copy(this.up);a.position.copy(this.position);a.quaternion.copy(this.quaternion);a.scale.copy(this.scale);a.rotationAutoUpdate=this.rotationAutoUpdate;a.matrix.copy(this.matrix);a.matrixWorld.copy(this.matrixWorld);a.matrixAutoUpdate=this.matrixAutoUpdate;a.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;a.visible=this.visible;a.castShadow=this.castShadow;a.receiveShadow=this.receiveShadow;a.frustumCulled=
this.frustumCulled;a.userData=JSON.parse(JSON.stringify(this.userData));if(!0===b)for(b=0;b<this.children.length;b++)a.add(this.children[b].clone());return a}};THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);THREE.Object3DIdCount=0;
THREE.Face3=function(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=d instanceof Array?d:[];this.color=e instanceof THREE.Color?e:new THREE.Color;this.vertexColors=e instanceof Array?e:[];this.vertexTangents=[];this.materialIndex=void 0!==f?f:0};
THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var a=new THREE.Face3(this.a,this.b,this.c);a.normal.copy(this.normal);a.color.copy(this.color);a.materialIndex=this.materialIndex;for(var b=0,c=this.vertexNormals.length;b<c;b++)a.vertexNormals[b]=this.vertexNormals[b].clone();b=0;for(c=this.vertexColors.length;b<c;b++)a.vertexColors[b]=this.vertexColors[b].clone();b=0;for(c=this.vertexTangents.length;b<c;b++)a.vertexTangents[b]=this.vertexTangents[b].clone();return a}};
THREE.BufferAttribute=function(a,b){this.array=a;this.itemSize=b;this.needsUpdate=!1};
THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return this.array.length},copyAt:function(a,b,c){a*=this.itemSize;c*=b.itemSize;for(var d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},setX:function(a,b){this.array[a*this.itemSize]=b;return this},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},setXY:function(a,
b,c){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;this.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=e;return this},clone:function(){return new THREE.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}};
THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.name="";this.attributes={};this.attributesKeys=[];this.offsets=this.drawcalls=[];this.boundingSphere=this.boundingBox=null};
THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(a,b){this.attributes[a]=b;this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(a){return this.attributes[a]},addDrawCall:function(a,b,c){this.drawcalls.push({start:a,count:b,index:void 0!==c?c:0})},applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),b.needsUpdate=!0);b=this.attributes.normal;void 0!==b&&((new THREE.Matrix3).getNormalMatrix(a).applyToVector3Array(b.array),
b.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.applyMatrix((new THREE.Matrix4).setPosition(a));return a},computeBoundingBox:function(){var a=new THREE.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var b=this.attributes.position.array;if(b){var c=this.boundingBox;c.makeEmpty();for(var d=0,e=b.length;d<
e;d+=3)a.set(b[d],b[d+1],b[d+2]),c.expandByPoint(a)}if(void 0===b||0===b.length)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0);(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&THREE.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var a=new THREE.Box3,b=new THREE.Vector3;return function(){null===this.boundingSphere&&
(this.boundingSphere=new THREE.Sphere);var c=this.attributes.position.array;if(c){a.makeEmpty();for(var d=this.boundingSphere.center,e=0,f=c.length;e<f;e+=3)b.set(c[e],c[e+1],c[e+2]),a.expandByPoint(b);a.center(d);var g=0;e=0;for(f=c.length;e<f;e+=3)b.set(c[e],c[e+1],c[e+2]),g=Math.max(g,d.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(g);isNaN(this.boundingSphere.radius)&&THREE.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),
computeVertexNormals:function(){var a=this.attributes;if(a.position){var b=a.position.array;if(void 0===a.normal)this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(b.length),3));else for(var c=a.normal.array,d=0,e=c.length;d<e;d++)c[d]=0;c=a.normal.array;var f=new THREE.Vector3,g=new THREE.Vector3,k=new THREE.Vector3,h=new THREE.Vector3,m=new THREE.Vector3;if(a.index)for(var l=a.index.array,q=0<this.offsets.length?this.offsets:[{start:0,count:l.length,index:0}],n=0,p=q.length;n<
p;++n){e=q[n].start;var r=q[n].count;var x=q[n].index;d=e;for(e+=r;d<e;d+=3){r=3*(x+l[d]);var w=3*(x+l[d+1]);var u=3*(x+l[d+2]);f.fromArray(b,r);g.fromArray(b,w);k.fromArray(b,u);h.subVectors(k,g);m.subVectors(f,g);h.cross(m);c[r]+=h.x;c[r+1]+=h.y;c[r+2]+=h.z;c[w]+=h.x;c[w+1]+=h.y;c[w+2]+=h.z;c[u]+=h.x;c[u+1]+=h.y;c[u+2]+=h.z}}else for(d=0,e=b.length;d<e;d+=9)f.fromArray(b,d),g.fromArray(b,d+3),k.fromArray(b,d+6),h.subVectors(k,g),m.subVectors(f,g),h.cross(m),c[d]=h.x,c[d+1]=h.y,c[d+2]=h.z,c[d+3]=
h.x,c[d+4]=h.y,c[d+5]=h.z,c[d+6]=h.x,c[d+7]=h.y,c[d+8]=h.z;this.normalizeNormals();a.normal.needsUpdate=!0}},computeTangents:function(){function a(N,V,ra){q.fromArray(d,3*N);n.fromArray(d,3*V);p.fromArray(d,3*ra);r.fromArray(f,2*N);x.fromArray(f,2*V);w.fromArray(f,2*ra);u=n.x-q.x;A=p.x-q.x;B=n.y-q.y;I=p.y-q.y;F=n.z-q.z;E=p.z-q.z;K=x.x-r.x;M=w.x-r.x;Z=x.y-r.y;C=w.y-r.y;U=1/(K*C-M*Z);O.set((C*u-Z*A)*U,(C*B-Z*I)*U,(C*F-Z*E)*U);W.set((K*A-M*u)*U,(K*I-M*B)*U,(K*E-M*F)*U);h[N].add(O);h[V].add(O);h[ra].add(O);
m[N].add(W);m[V].add(W);m[ra].add(W)}function b(N){ta.fromArray(e,3*N);sa.copy(ta);Q=h[N];xa.copy(Q);xa.sub(ta.multiplyScalar(ta.dot(Q))).normalize();wa.crossVectors(sa,Q);J=wa.dot(m[N]);Da=0>J?-1:1;k[4*N]=xa.x;k[4*N+1]=xa.y;k[4*N+2]=xa.z;k[4*N+3]=Da}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)THREE.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");
else{var c=this.attributes.index.array,d=this.attributes.position.array,e=this.attributes.normal.array,f=this.attributes.uv.array,g=d.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*g),4));for(var k=this.attributes.tangent.array,h=[],m=[],l=0;l<g;l++)h[l]=new THREE.Vector3,m[l]=new THREE.Vector3;var q=new THREE.Vector3,n=new THREE.Vector3,p=new THREE.Vector3,r=new THREE.Vector2,x=new THREE.Vector2,w=new THREE.Vector2,u,A,B,I,F,E,
K,M,Z,C,U,O=new THREE.Vector3,W=new THREE.Vector3,aa;0===this.drawcalls.length&&this.addDrawCall(0,c.length,0);var R=this.drawcalls;l=0;for(aa=R.length;l<aa;++l){var S=R[l].start;var fa=R[l].count;var X=R[l].index;g=S;for(S+=fa;g<S;g+=3){fa=X+c[g];var qa=X+c[g+1];var na=X+c[g+2];a(fa,qa,na)}}var xa=new THREE.Vector3,wa=new THREE.Vector3,ta=new THREE.Vector3,sa=new THREE.Vector3,Da,Q,J;l=0;for(aa=R.length;l<aa;++l)for(S=R[l].start,fa=R[l].count,X=R[l].index,g=S,S+=fa;g<S;g+=3)fa=X+c[g],qa=X+c[g+1],
na=X+c[g+2],b(fa),b(qa),b(na)}},normalizeNormals:function(){for(var a=this.attributes.normal.array,b,c,d,e=0,f=a.length;e<f;e+=3)b=a[e],c=a[e+1],d=a[e+2],b=1/Math.sqrt(b*b+c*c+d*d),a[e]*=b,a[e+1]*=b,a[e+2]*=b},clone:function(){var a=new THREE.BufferGeometry;for(b in this.attributes)a.addAttribute(b,this.attributes[b].clone());var b=0;for(var c=this.offsets.length;b<c;b++){var d=this.offsets[b];a.offsets.push({start:d.start,index:d.index,count:d.count})}return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};
THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);THREE.Camera=function(){THREE.Object3D.call(this);this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.getWorldDirection=function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,-1).applyQuaternion(a)}}();
THREE.Camera.prototype.lookAt=function(){var a=new THREE.Matrix4;return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();THREE.Camera.prototype.clone=function(a){void 0===a&&(a=new THREE.Camera);THREE.Object3D.prototype.clone.call(this,a);a.matrixWorldInverse.copy(this.matrixWorldInverse);a.projectionMatrix.copy(this.projectionMatrix);return a};
THREE.PerspectiveCamera=function(a,b,c,d){THREE.Camera.call(this);this.zoom=1;this.fov=void 0!==a?a:50;this.aspect=void 0!==b?b:1;this.near=void 0!==c?c:.1;this.far=void 0!==d?d:2E3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera;THREE.PerspectiveCamera.prototype.setLens=function(a,b){void 0===b&&(b=24);this.fov=2*THREE.Math.radToDeg(Math.atan(b/(2*a)));this.updateProjectionMatrix()};
THREE.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,d,e,f){this.fullWidth=a;this.fullHeight=b;this.x=c;this.y=d;this.width=e;this.height=f;this.updateProjectionMatrix()};
THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var a=THREE.Math.radToDeg(2*Math.atan(Math.tan(.5*THREE.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var b=this.fullWidth/this.fullHeight;a=Math.tan(THREE.Math.degToRad(.5*a))*this.near;var c=-a,d=b*c;b=Math.abs(b*a-d);c=Math.abs(a-c);this.projectionMatrix.makeFrustum(d+this.x*b/this.fullWidth,d+(this.x+this.width)*b/this.fullWidth,a-(this.y+this.height)*c/this.fullHeight,a-this.y*c/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(a,
this.aspect,this.near,this.far)};THREE.PerspectiveCamera.prototype.clone=function(){var a=new THREE.PerspectiveCamera;THREE.Camera.prototype.clone.call(this,a);a.zoom=this.zoom;a.fov=this.fov;a.aspect=this.aspect;a.near=this.near;a.far=this.far;a.projectionMatrix.copy(this.projectionMatrix);return a};THREE.OrthographicCamera=function(a,b,c,d,e,f){THREE.Camera.call(this);this.zoom=1;this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=void 0!==e?e:.1;this.far=void 0!==f?f:2E3;this.updateProjectionMatrix()};
THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera;THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(c-a,c+a,d+b,d-b,this.near,this.far)};
THREE.OrthographicCamera.prototype.clone=function(){var a=new THREE.OrthographicCamera;THREE.Camera.prototype.clone.call(this,a);a.zoom=this.zoom;a.left=this.left;a.right=this.right;a.top=this.top;a.bottom=this.bottom;a.near=this.near;a.far=this.far;a.projectionMatrix.copy(this.projectionMatrix);return a};THREE.Mesh=function(a,b){THREE.Object3D.call(this);this.geometry=void 0!==a?a:new THREE.Geometry;this.material=void 0!==b?b:new THREE.MeshBasicMaterial({color:16777215*Math.random()});this.updateMorphTargets()};
THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh.prototype.constructor=THREE.Mesh;
THREE.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}};
THREE.Mesh.prototype.getMorphTargetIndexByName=function(a){if(void 0!==this.morphTargetDictionary[a])return this.morphTargetDictionary[a];THREE.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};THREE.Mesh.prototype.clone=function(a,b){void 0===a&&(a=new THREE.Mesh(this.geometry,this.material));THREE.Object3D.prototype.clone.call(this,a,b);return a};THREE.Scene=function(){THREE.Object3D.call(this);this.overrideMaterial=null;this.autoUpdate=!0};
THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.clone=function(a){void 0===a&&(a=new THREE.Scene);THREE.Object3D.prototype.clone.call(this,a);null!==this.overrideMaterial&&(a.overrideMaterial=this.overrideMaterial.clone());a.autoUpdate=this.autoUpdate;a.matrixAutoUpdate=this.matrixAutoUpdate;return a};
THREE.UniformsUtils={merge:function(a){for(var b={},c=0;c<a.length;c++){var d=this.clone(a[c]),e;for(e in d)b[e]=d[e]}return b},clone:function(a){var b={},c;for(c in a){b[c]={};for(var d in a[c]){var e=a[c][d];b[c][d]=e&&void 0!==e.clone?e.clone():e instanceof Array?e.slice():e}}return b}};
THREE.BoxBufferGeometry=function(a,b,c,d,e,f){function g(n,p,r,x,w,u,A,B,I,F){var E=u/I,K=A/F,M=u/2,Z=A/2,C=B/2;A=I+1;var U=F+1;u=0;var O,W,aa=new THREE.Vector3;for(W=0;W<U;W++){var R=W*K-Z;for(O=0;O<A;O++)aa[n]=(O*E-M)*x,aa[p]=R*w,aa[r]=C,h.push(aa.x,aa.y,aa.z),aa[n]=0,aa[p]=0,aa[r]=0<B?1:-1,m.push(aa.x,aa.y,aa.z),l.push(O/I),l.push(1-W/F),u+=1}for(W=0;W<F;W++)for(O=0;O<I;O++)n=q+O+A*(W+1),p=q+(O+1)+A*(W+1),r=q+(O+1)+A*W,k.push(q+O+A*W,n,r),k.push(n,p,r);q+=u}THREE.BufferGeometry.call(this);this.parameters=
{width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};d=Math.floor(d)||1;e=Math.floor(e)||1;f=Math.floor(f)||1;var k=[],h=[],m=[],l=[],q=0;g("z","y","x",-1,-1,c,b,a,f,e);g("z","y","x",1,-1,c,b,-a,f,e);g("x","z","y",1,1,a,c,b,d,f);g("x","z","y",1,-1,a,c,-b,d,f);g("x","y","z",1,-1,a,b,c,d,e);g("x","y","z",-1,-1,a,b,-c,d,e);console.assert(65536>=h.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(k),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(h),
3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(m),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(l),2))};THREE.BoxBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.BoxBufferGeometry.prototype.constructor=THREE.BoxBufferGeometry;
THREE.SphereBufferGeometry=function(a,b,c,d,e,f,g){THREE.BufferGeometry.call(this);this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};a=a||50;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||6);d=void 0!==d?d:0;e=void 0!==e?e:2*Math.PI;f=void 0!==f?f:0;g=void 0!==g?g:Math.PI;var k=f+g,h,m,l=0,q=[],n=new THREE.Vector3,p=new THREE.Vector3,r=[],x=[],w=[],u=[];for(m=0;m<=c;m++){var A=[],B=m/c;for(h=0;h<=b;h++){var I=h/b;n.x=-a*Math.cos(d+
I*e)*Math.sin(f+B*g);n.y=a*Math.cos(f+B*g);n.z=a*Math.sin(d+I*e)*Math.sin(f+B*g);x.push(n.x,n.y,n.z);p.set(n.x,n.y,n.z).normalize();w.push(p.x,p.y,p.z);u.push(I,1-B);A.push(l++)}q.push(A)}for(m=0;m<c;m++)for(h=0;h<b;h++)a=q[m][h+1],d=q[m][h],e=q[m+1][h],g=q[m+1][h+1],(0!==m||0<f)&&r.push(a,d,g),(m!==c-1||k<Math.PI)&&r.push(d,e,g);console.assert(65536>=x.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(r),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(x),
3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(w),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(u),2))};THREE.SphereBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.SphereBufferGeometry.prototype.constructor=THREE.SphereBufferGeometry;
THREE.PlaneBufferGeometry=function(a,b,c,d){THREE.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};var e=a/2,f=b/2;c=c||1;d=d||1;var g=c+1,k=d+1,h=a/c,m=b/d;b=new Float32Array(g*k*3);a=new Float32Array(g*k*3);for(var l=new Float32Array(g*k*2),q=0,n=0,p=0;p<k;p++)for(var r=p*m-f,x=0;x<g;x++)b[q]=x*h-e,b[q+1]=-r,a[q+2]=1,l[n]=x/c,l[n+1]=1-p/d,q+=3,n+=2;q=0;e=new (65535<b.length/3?Uint32Array:Uint16Array)(c*d*6);for(p=0;p<d;p++)for(x=
0;x<c;x++)f=x+g*(p+1),k=x+1+g*(p+1),h=x+1+g*p,e[q]=x+g*p,e[q+1]=f,e[q+2]=h,e[q+3]=f,e[q+4]=k,e[q+5]=h,q+=6;this.addAttribute("index",new THREE.BufferAttribute(e,1));this.addAttribute("position",new THREE.BufferAttribute(b,3));this.addAttribute("normal",new THREE.BufferAttribute(a,3));this.addAttribute("uv",new THREE.BufferAttribute(l,2))};THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry;
THREE.CylinderBufferGeometry=function(a,b,c,d,e,f,g,k){function h(w){var u,A=new THREE.Vector2,B=new THREE.Vector3,I=!0===w?a:b,F=!0===w?1:-1;var E=p;for(u=1;u<=d;u++)l.push(0,x*F,0),q.push(0,F,0),n.push(.5,.5),p++;var K=p;for(u=0;u<=d;u++){var M=u/d*k+g,Z=Math.cos(M);M=Math.sin(M);B.x=I*M;B.y=x*F;B.z=I*Z;l.push(B.x,B.y,B.z);q.push(0,F,0);A.x=.5*Z+.5;A.y=.5*M*F+.5;n.push(A.x,A.y);p++}for(u=0;u<d;u++)A=E+u,B=K+u,!0===w?m.push(B,B+1,A):m.push(B+1,B,A)}THREE.BufferGeometry.call(this);this.parameters=
{radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:k};a=void 0!==a?a:20;b=void 0!==b?b:20;c=void 0!==c?c:100;d=Math.floor(d)||8;e=Math.floor(e)||1;f=void 0!==f?f:!1;g=void 0!==g?g:0;k=void 0!==k?k:2*Math.PI;var m=[],l=[],q=[],n=[],p=0,r=[],x=c/2;(function(){var w,u,A=new THREE.Vector3,B=new THREE.Vector3,I=(b-a)/c;for(u=0;u<=e;u++){var F=[],E=u/e,K=E*(b-a)+a;for(w=0;w<=d;w++){var M=w/d,Z=M*k+g,C=Math.sin(Z);Z=Math.cos(Z);B.x=K*C;B.y=-E*c+x;
B.z=K*Z;l.push(B.x,B.y,B.z);A.set(C,I,Z).normalize();q.push(A.x,A.y,A.z);n.push(M,1-E);F.push(p++)}r.push(F)}for(w=0;w<d;w++)for(u=0;u<e;u++)A=r[u+1][w],B=r[u+1][w+1],I=r[u][w+1],m.push(r[u][w],A,I),m.push(A,B,I)})();!1===f&&(0<a&&h(!0),0<b&&h(!1));console.assert(65536>=l.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(m),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(l),3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(q),
3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(n),2))};THREE.CylinderBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.CylinderBufferGeometry.prototype.constructor=THREE.CylinderBufferGeometry;
THREE.TorusBufferGeometry=function(a,b,c,d,e){THREE.BufferGeometry.call(this);this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};a=a||1;b=b||.4;c=Math.floor(c)||8;d=Math.floor(d)||6;e=e||2*Math.PI;var f=[],g=[],k=[],h=[],m=new THREE.Vector3,l=new THREE.Vector3,q=new THREE.Vector3,n,p;for(n=0;n<=c;n++)for(p=0;p<=d;p++){var r=p/d*e,x=n/c*Math.PI*2;l.x=(a+b*Math.cos(x))*Math.cos(r);l.y=(a+b*Math.cos(x))*Math.sin(r);l.z=b*Math.sin(x);g.push(l.x,l.y,l.z);m.x=a*Math.cos(r);m.y=a*
Math.sin(r);q.subVectors(l,m).normalize();k.push(q.x,q.y,q.z);h.push(p/d);h.push(n/c)}for(n=1;n<=c;n++)for(p=1;p<=d;p++)a=(d+1)*(n-1)+p-1,b=(d+1)*(n-1)+p,e=(d+1)*n+p,f.push((d+1)*n+p-1,a,e),f.push(a,b,e);console.assert(65536>=g.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(f),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(g),3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(k),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(h),
2))};THREE.TorusBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.TorusBufferGeometry.prototype.constructor=THREE.TorusBufferGeometry;(function(){function a(c){var d={};c&&c.substring(1).split("&").forEach(function(e){var f=e.indexOf("=");0<=f?d[e.substring(0,f)]=e.substring(f+1):d[e]=void 0});return d}function b(c){return c in a(window.location.hash)}window.WALK={EDIT_MODE:"editor"in a(window.location.search),DEBUG:b("debug"),DEBUG_SHARED_BUFFERS:b("debugbuffers"),ALWAYS_RENDER:!1,LOG_INFO:b("log")||b("savelog"),LOG_TO_SERVER:b("savelog"),LOG_TIME:!1,PROGRESSIVE_LOADER_AFTER_SEC:30,CONTEXT_LOST_RESTORE_LIMIT:4,HEAD_LIGHT:!1,RETRIES_ON_LOAD_ERROR:3,
DEFAULT_ANISOTROPY:4,NO_ANISOTROPY:1,FORCE_FXAA:!1,FORCE_WEBGL1:b("webgl1"),FONT_FAMILIES_TO_LOAD:[],MAX_TWO_POINTERS_IN_LINE_DIFF:40,CAMERA_WALK_NEAR:.01,CAMERA_ORBIT_NEAR_FROM_1M:.01,CAMERA_MIN_FAR:100,SKY_DISTANCE_TO_SCENE:100,CAMERA_DEFAULT_FOV:70,CAMERA_DEFAULT_MOVE_MAX_SPEED:1.11,CAMERA_MOVE_MAX_SPEED_SHIFT_FACTOR:2,CAMERA_LOOK_SPEED:Math.PI/1500,CAMERA_ARROWS_TURN_SPEED:Math.PI/2,CAMERA_SCROLL_SPEED:.5,CAMERA_FULL_ACCELERATION_TIME:.5,CAMERA_FULL_DECELERATION_TIME:.166,CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE:1,
MAX_GROUND_SEARCH_DEPTH:5.5,MATERIAL_PICKER_BALL_MAX_SIZE:.1,COVER_JSON_URL:"./cover.json",AUTO_TOUR_IN_VIEW_STILL_TIME_MS:3E3,CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE:.7,CLICK_MOVE_SHOW_TARGET_INDICATOR:!b("nomovetarget"),KEY_MOVE_MIN_DISTANCE_TO_OBSTACLE:.1,MIN_DISTANCE_TO_CEILING:.1,LIGHT_PROBE_MIRROR_SIZE:512,LIGHT_PROBE_MAX_MIP_SIZE:128,LIGHT_PROBE_MIN_MIP_SIZE:4,LIGHT_PROBE_GLOSS_FOR_MIP:[.99,.9,.85,.7,.4,.25],DEBUG_LIGHT_PROBE_MIPS:!1,ENABLE_AUTO_EXPOSURE_CONTROLS:!1,EDITOR_COVER_WIDTH:1920,EDITOR_COVER_HEIGHT:1080,
MAX_PANORAMA_SIZE:8192,OBJECT_VISIBILITY_TARGET_SIZE:128,DEFAULT_SKY_NAME:"default",EDITOR_CONTROLLED_SKY_NAME:"sky0",EDITOR_SELECTION_COLOR:(new THREE.Color(5021401)).convertGammaToLinear(),ALLOW_MOBILE_VR:!0,FALLBACK_CAMERA_HEIGHT:1.6,LOAD_PRIORITY:{CORE_RESOURCE:0,COLORMAP:1,UV0:1,DIFFUSE:2,LIGHTMAP:3,SKY:4,SPECULARITY:5,VIDEO:6},MERGE_TRANSPARENT_DISABLED:b("nomergetransparent"),urlHashContains:b,urlHashGetArgument:function(c){var d=a(window.location.hash);return c in d&&void 0!==d[c]?decodeURI(d[c]):
null},urlHashRemoveArgument:function(c){var d=a(window.location.hash);return Object.keys(d).filter(function(e){return e!==c}).map(function(e){var f=d[e];return e+(void 0===f?"":"="+f)}).join("&")},TELEPORT_TO_VIEW_MAX_TIME:3,TELEPORT_TO_POINT_MAX_TIME:4.5,TELEPORT_TO_VIEW_ACCELERATION:4,GAZE_POINTER_SHOW_LOADING_AFTER_S:2.5,GAZE_POINTER_ACTIVATE_AFTER_S:4.5,SPRITE_ANCHOR_FONT_SIZE:128,POINTER_PRIORITY:{TRANSFORM_CONTROLS:1,EDITOR_SELECTOR:2,INTERACTION_DISPATCHER:3},AVATAR_COLORS:"#65ffcc #dfe592 #99dd92 #cc96b1 #94c4d3 #93d8b9 #65c4ff #ff6565 #cca499 #b394cc #e29191 #ff65f4 #656bff #ffa560 #6bff63 #949ace #ad65ff #ff6584".split(" "),
STRINGS:{},DEFAULT_LANGUAGE:"English",ENABLE_MINIMAP:!0};window.WebXRConfig={cardboardConfig:{ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:null,CARDBOARD_UI_DISABLED:!1,K_FILTER:.98,ROTATE_INSTRUCTIONS_DISABLED:!1,PREDICTION_TIME_S:.04,YAW_ONLY:!1,BUFFER_SCALE:1,DIRTY_SUBMIT_FRAME_BINDINGS:!1}};window.GLC={REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,
LINEAR_MIPMAP_LINEAR:9987,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,
SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,HALF_FLOAT_OES:36193,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4x4_KHR:37808}})();/*
 Copyright (C) 2014-present Shapespark
*/
(function(){function a(c,d,e){return function(){c!==d.length&&(e(d[c]),WALK.defer(a(c+1,d,e)))}}var b=2*Math.PI;WALK.defer=function(c){setTimeout(c,0)};WALK.iterateAsync=function(c,d){WALK.defer(a(0,c,d))};WALK.find=function(c,d){for(var e=0;e<c.length;e+=1){var f=c[e];if(d(f))return f}};WALK.filter=function(c,d){for(var e=c.length,f=[],g=0;g<e;g+=1)d(c[g])&&f.push(c[g]);return f};WALK.indexOfMax=function(c,d){if(0===c.length)return null;for(var e=0,f=d?d(c[0]):c[0],g=1;g<c.length;g+=1){var k=d?d(c[g]):
c[g];k>f&&(e=g,f=k)}return e};WALK.any=function(c,d){for(var e=c.length,f=0;f<e;f+=1)if(d(c[f]))return!0;return!1};WALK.removeFromArray=function(c,d){c=d.indexOf(c);console.assert(-1!==c);return d.splice(c,1)};WALK.shiftItem=function(c,d,e){var f=c.indexOf(d);d=c[f];for(var g=e>f?1:-1;f!==e;f+=g)c[f]=c[f+g];c[e]=d};WALK.copyProperties=function(c,d,e){for(var f=0;f<d.length;f+=1){var g=d[f],k=c[g];void 0!==k&&(e[g]=k)}};WALK.normalizeRotation=function(c){c%=b;return c>Math.PI?-b+c:c<-Math.PI?b+c:c};
WALK.yawRotationToPoint=function(c,d){return Math.atan2(-(d.x-c.x),d.y-c.y)};WALK.setTextContent=function(c,d){void 0!==c.textContent?c.textContent=d:void 0!==c.innerText?c.innerText=d:console.warn("textContent and innerText properties are missing")};WALK.log2=function(c){return Math.log(c)/Math.log(2)};WALK.mipsCount=function(c,d){return WALK.log2(d)-WALK.log2(c)+1};WALK.LIGHT_PROBE_MIPS_COUNT=WALK.mipsCount(WALK.LIGHT_PROBE_MIN_MIP_SIZE,WALK.LIGHT_PROBE_MAX_MIP_SIZE);WALK.isModifierPressed=function(c){return c.ctrlKey||
c.altKey||c.metaKey};WALK.round=function(c,d){void 0===d&&(d=3);return+(Math.round(c+"e+"+d)+"e-"+d)};WALK.preloadImage=function(c){var d=new Image;d.src=c;return d};WALK.onVideoDataReady=function(c,d){function e(){c.readyState>=c.HAVE_CURRENT_DATA&&(c.removeEventListener("playing",e),c.removeEventListener("timeupdate",e),d(c))}c.readyState>=c.HAVE_CURRENT_DATA?d(c):(c.addEventListener("playing",e),c.addEventListener("timeupdate",e))};WALK.cloneObject=function(c){return JSON.parse(JSON.stringify(c))};
WALK.readOnlyCopy=function(c){return"object"===typeof c?Object.freeze(WALK.cloneObject(c)):c};WALK.deepEqual=function(c,d){if(c===d)return!0;if("object"!==typeof c||null===c||"object"!==typeof d||null===d||Object.keys(c).length!==Object.keys(d).length)return!1;for(var e=$jscomp.makeIterator(Object.keys(c)),f=e.next();!f.done;f=e.next())if(f=f.value,!d.hasOwnProperty(f)||!WALK.deepEqual(c[f],d[f]))return!1;return!0};WALK.executableOnlyOnce=function(c){var d=!1,e;return function(){if(d)return e;e=c();
c=null;d=!0;return e}};WALK.preventClosureCompilerDeadCodeRemoval=function(c){WALK.preventClosureCompilerDeadCodeRemoval[" "](c);return c};WALK.preventClosureCompilerDeadCodeRemoval[" "]=function(c){return null}})();(function(){function a(e,f,g){WALK.ICONS[e]={name:e,value:f,fontFamily:g}}function b(e,f){a(e,f,"FontAwesomeSolid")}function c(e,f){a(e,f,"FontAwesomeRegular")}function d(e,f){a(e,f,"FontAwesomeBrands")}WALK.ICONS={};b("address-book","\uf2b9");b("address-card","\uf2bb");b("area-chart","\uf1fe");b("arrows","\uf0b2");b("arrow-up","\uf062");b("arrow-down","\uf063");b("assistive-listening-systems","\uf2a2");b("asterisk","\uf069");b("audio-description","\uf29e");b("at","\uf1fa");b("bars","\uf0c9");b("bell",
"\uf0f3");b("book","\uf02d");b("bookmark","\uf02e");b("bullhorn","\uf0a1");b("calculator","\uf1ec");b("camera","\uf030");b("chart-bar","\uf080");b("chart-pie","\uf200");b("chevron-up","\uf077");b("chevron-down","\uf078");b("cloud","\uf0c2");b("cog","\uf013");b("comment","\uf075");c("compass","\uf14e");c("credit-card","\uf09d");b("crosshairs","\uf05b");b("desktop","\uf108");b("download","\uf019");b("envelope","\uf0e0");b("expand","\uf424");b("external-link","\uf35d");c("eye","\uf06e");b("eye-dropper",
"\uf1fb");b("film","\uf008");b("flag","\uf024");b("folder","\uf07b");b("gift","\uf06b");b("headphones","\uf025");b("highlighter","\uf591");b("home","\uf015");c("image","\uf03e");b("sign-in","\uf2f6");b("info","\uf129");c("lightbulb","\uf0eb");b("magic","\uf0d0");b("magnet","\uf076");b("map-marker","\uf3c5");b("map-pin","\uf276");b("map-signs","\uf277");b("paint-brush","\uf1fc");b("pencil","\uf303");b("pen","\uf304");b("phone","\uf095");b("question","\uf128");b("search","\uf002");b("share","\uf064");
b("share-alt","\uf1e0");b("shopping-cart","\uf07a");b("sliders","\uf1de");b("star","\uf005");c("sticky-note","\uf249");b("sync","\uf2f1");c("edit","\uf044");b("tachometer","\uf3fd");b("tag","\uf02b");b("video","\uf03d");b("wrench","\uf0ad");b("palette","\uf53f");b("paint-roller","\uf5aa");b("play","\uf04b");b("pause","\uf04c");b("plus","\uf067");d("youtube","\uf167");d("vimeo","\uf40a");d("facebook","\uf09a");d("twitter","\uf099");d("instagram","\uf16d");d("linkedin","\uf08c");d("skype","\uf17e");
d("whatsapp","\uf232");d("facebook-messenger","\uf39f");d("telegram","\uf2c6");d("slack","\uf198")})();(function(){function a(n){for(var p=$jscomp.makeIterator(Object.entries({"https://cdn0.shapespark.com/":"https://cdn0-jsbr.shapespark.com/","https://cdn0.dev.shapespark.com/":"https://cdn0-jsbr-dev.shapespark.com/","https://cdn0-shapespark-cn-dev.oss-accelerate.aliyuncs.com/":"https://cdn0-jsbr-cn-dev.shapespark.com.cn/","https://cdn0-shapespark-cn.oss-accelerate.aliyuncs.com/":"https://cdn0-jsbr.shapespark.com.cn/","https://cdncn0-shapespark.oss-accelerate.aliyuncs.com/":"https://cdncn0-jsbr.shapespark.com.cn/"})),
r=p.next();!r.done;r=p.next()){var x=$jscomp.makeIterator(r.value);r=x.next().value;x=x.next().value;if(n.startsWith(r))return n.replace(r,x)}return n}function b(n,p){return function(r){l.finished(n);p(r)}}function c(n){this.method=n;this.binaryResult=!1;this.dataContentType=this.data=null;"GET"===n?(this.retriesLeft=WALK.RETRIES_ON_LOAD_ERROR,this.retryDelay=.5+Math.random()):this.retryDelay=this.retriesLeft=0}function d(n,p,r,x,w,u){setTimeout(function(){e(n,p,r,x,w,u)},p.retryDelay);p.retryScheduled()}
function e(n,p,r,x,w,u){function A(E,K){var M=!0!==WALK.DETECTOR.canForceBrotliBuffers?m.NOT_NEEDED:0<=F.getAllResponseHeaders().toLowerCase().indexOf("js-content-encoding:")?m.NEEDED:"br"===F.getResponseHeader("content-encoding")?m.TEST_NEEDED:m.NOT_NEEDED;M===m.NOT_NEEDED?K(E):q.decode(E,M===m.NEEDED,K)}function B(){var E=F.status||0;E="GET"===p.method&&(500<=E||0===E)?0!==p.retriesLeft:!1;console.warn("Failed to "+p.method+": "+n+" ("+F.status+")"+(E?", retrying in "+p.retryDelay+"s":""));if(E)u&&
!h&&(console.warn("Switch to jsbr hosts."),h=!0),d(n,p,r,x,w,u);else if(void 0!==x){try{var K=JSON.parse(F.responseText).message}catch(M){K=void 0}x(F.status,K)}p=F=null}function I(){if(void 0!==r)if(p.binaryResult)A(F.response,r);else{var E=F.getResponseHeader("content-type"),K=F.responseText;K&&-1!==E.indexOf("text/plain")?A(K,r):K?A(K,function(M){r(JSON.parse(M))}):r()}p=F=null}var F=new XMLHttpRequest;void 0!==w&&F.addEventListener("progress",w,!1);F.addEventListener("load",function(){200<=F.status&&
300>F.status||0===F.status?I():B()},!1);F.addEventListener("error",B,!1);F.addEventListener("abort",B,!1);u&&h&&(n=a(n));F.open(p.method,n,!0);p.binaryResult&&(F.responseType="arraybuffer");p.dataContentType&&F.setRequestHeader("Content-Type",p.dataContentType);"POST"===p.method&&F.setRequestHeader("X-Requested-By","Shapespark");F.send(p.data)}function f(n,p,r,x,w){function u(){n(p,r,x,w)}return function(){console.warn("Failed to get: "+p+(u?", retrying in "+r.retryDelay+"s":""));0<r.retriesLeft?
(setTimeout(u,r.retryDelay),r.retryScheduled()):w()}}function g(n,p,r,x){var w=new Image;w.onload=function(){r(w);w=null};w.onerror=f(g,n,p,r,x);w.crossOrigin="anonymous";w.src=n}function k(n,p,r,x){var w=document.createElement("video");w.autoplay=!0;w.muted=!0;w.loop=!0;w.setAttribute("playsinline","");w.setAttribute("webkit-playsinline","");w.crossOrigin="anonymous";w.onerror=f(k,n,p,r,x);WALK.onVideoDataReady(w,function(){w.onerror=void 0;r(w);w=null});w.src=n;w.play().catch(function(){})}var h=
!1,m={NOT_NEEDED:0,TEST_NEEDED:1,NEEDED:2},l=new function(){function n(){for(x+=1;x<p.length;x+=1){var w=p[x];if(0<w.length){for(var u=0;u<w.length;u+=1)r[x]+=1,WALK.defer(w[u]);w.length=0;break}}}var p=[],r=[],x=Infinity;(function(){var w=0,u;for(u in WALK.LOAD_PRIORITY)WALK.LOAD_PRIORITY.hasOwnProperty(u)&&(w=Math.max(w,WALK.LOAD_PRIORITY[u]));for(u=0;u<=w;u+=1)p[u]=[],r[u]=0})();this.add=function(w,u){w<=x?(r[w]+=1,x=w,WALK.defer(u)):(p[w].push(u),0===r[x]&&n())};this.finished=function(w){--r[w];
var u=r[w];console.assert(0<=u);w===x&&0===u&&n()}},q=new function(){function n(E){E=new Int8Array(E);return(new BrotliDecode(E)).buffer}function p(E){B=E;for(var K=0;K<u.length;K+=1)u[K](E);u=null}function r(E){I?E():(A.push(E),1===A.length&&WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/brotli.min.js"),function(){I=!0;for(var K=0;K<A.length;K+=1)A[K]();A=null},function(){return WALK.USER_MSG.error("Cannot load required library")}))}function x(){200<=F.status&&300>F.status||0===F.status?p("SSSSSS"===
F.responseText):(console.error("br.buf response",F.status),p(!0))}function w(E){void 0!==B?E(B):(u.push(E),1===u.length&&(F.addEventListener("load",x,!1),F.open("GET",WALK.getViewerAssetUrl("3dassets/br.buf"),!0),F.send()))}var u=[],A=[],B=void 0,I=!1,F=new XMLHttpRequest;this.decode=function(E,K,M){K?r(function(){M(n(E))}):w(function(Z){Z?M(E):r(function(){M(n(E))})})}};c.prototype={constructor:c,retryScheduled:function(){console.assert(0<this.retriesLeft);--this.retriesLeft;this.retryDelay*=2}};
WALK.ajaxGet=function(n,p,r,x,w,u){var A=new c("GET");A.binaryResult=p;e(n,A,r,x,w,u)};WALK.queueAjaxGet=function(n,p,r,x,w,u,A){A=void 0===A?!1:A;l.add(n,function(){WALK.ajaxGet(p,r,b(n,x),b(n,w),u,A)})};WALK.ajaxPost=function(n,p,r,x,w,u){var A=new c("POST");A.data=r;A.dataContentType=p;e(n,A,x,w,u)};WALK.queueImageGet=function(n,p,r,x){l.add(n,function(){var w=new c("GET");g(p,w,b(n,r),b(n,x))})};WALK.queueVideoGet=function(n,p,r,x){l.add(n,function(){var w=new c("GET");k(p,w,b(n,r),b(n,x))})};
WALK.loadScriptAndExecute=function(){function n(w){r.add(w);var u=x.get(w);x.delete(w);u.forEach(function(A){try{(0,A.onSuccess)()}catch(B){console.log(B)}})}function p(w){var u=x.get(w);x.delete(w);console.error("Can't load script : "+w);u.forEach(function(A){if(void 0!==A.onError){A=A.onError.bind(null,w);try{A()}catch(B){console.log(B)}}})}var r=new Set,x=new Map;return function(w,u,A){if(r.has(w))u();else if(x.has(w))x.get(w).push({onSuccess:u,onError:A});else{x.set(w,[{onSuccess:u,onError:A}]);
u=n.bind(this,w);A=p.bind(this,w);var B=document.createElement("script");B.onload=u;B.onerror=A;B.src=w;B.type="text/javascript";document.body.appendChild(B)}}}();WALK.loadScriptsUrlAndExecute=function(n,p,r){function x(w){return new Promise(function(u,A){WALK.loadScriptAndExecute(w,u,A)})}n=n.map(function(w){return x(w)});Promise.all(n).then(p).catch(function(w){void 0!==r&&r(w)})}})();(function(){function a(d,e){for(d=d.toString();d.length<e;)d="0"+d;return d}function b(d){var e=console[d].bind(console);console[d]=function(){for(var f="",g="",k=0;k<arguments.length;++k)g+=(0===k?"":" ")+arguments[k];WALK.LOG_TIME&&(f=new Date,f=a(f.getHours(),2)+":"+a(f.getMinutes(),2)+":"+a(f.getSeconds(),2)+","+a(f.getMilliseconds(),3)+" ");k=f+d.toUpperCase()+" "+g;WALK.ajaxPost("./logs","application/json",JSON.stringify({logs:[k]}));e(f+g)}}function c(){window.onerror=function(d,e,f,g,k){console.error("Error occured: "+
d+" ("+e+"#"+f.toString()+":"+g.toString()+"/"+k+")");return!1}}WALK.log=function(){};WALK.logInfoMessages=function(){WALK.log=function(d){for(var e=[],f=0;f<arguments.length;++f)e[f-0]=arguments[f];console.log.apply(console,$jscomp.arrayFromIterable(e))}};WALK.initLoggingToServer=function(d){d&&(b("log"),b("info"));b("warn");b("error");c()};WALK.LOG_INFO&&WALK.logInfoMessages();WALK.LOG_TO_SERVER&&WALK.initLoggingToServer(!0)})();/*

 nosleep.js
 Copyright (c) 2017, Rich Tibbett

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

 webxr-polyfill
 Copyright (c) 2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 cardboard-vr-display
 Copyright (c) 2015-2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 webvr-polyfill-dpdb 
 Copyright (c) 2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 wglu-preserve-state
 Copyright (c) 2016, Brandon Jones.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
*/
(function(a,b){"object"===typeof exports&&"undefined"!==typeof module?module.exports=b():"function"===typeof define&&define.amd?define(b):a.WebXRPolyfill=b()})(this,function(){function a(){var t=new S(16);S!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0);t[0]=1;t[5]=1;t[10]=1;t[15]=1;return t}function b(t){t[0]=1;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=1;t[6]=0;t[7]=0;t[8]=0;t[9]=0;t[10]=1;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return t}function c(t,
y){var G=y[0],H=y[1],da=y[2],ua=y[3],va=y[4],Ka=y[5],Xa=y[6],$a=y[7],Za=y[8],jb=y[9],wb=y[10],ob=y[11],pb=y[12],nb=y[13],xb=y[14];y=y[15];var hb=G*Ka-H*va,ab=G*Xa-da*va,qb=G*$a-ua*va,rb=H*Xa-da*Ka,bb=H*$a-ua*Ka,Hb=da*$a-ua*Xa,Ob=Za*nb-jb*pb,Pb=Za*xb-wb*pb,Lb=Za*y-ob*pb,Qb=jb*xb-wb*nb,Rb=jb*y-ob*nb,Mb=wb*y-ob*xb,ub=hb*Mb-ab*Rb+qb*Qb+rb*Lb-bb*Pb+Hb*Ob;if(!ub)return null;ub=1/ub;t[0]=(Ka*Mb-Xa*Rb+$a*Qb)*ub;t[1]=(da*Rb-H*Mb-ua*Qb)*ub;t[2]=(nb*Hb-xb*bb+y*rb)*ub;t[3]=(wb*bb-jb*Hb-ob*rb)*ub;t[4]=(Xa*Lb-
va*Mb-$a*Pb)*ub;t[5]=(G*Mb-da*Lb+ua*Pb)*ub;t[6]=(xb*qb-pb*Hb-y*ab)*ub;t[7]=(Za*Hb-wb*qb+ob*ab)*ub;t[8]=(va*Rb-Ka*Lb+$a*Ob)*ub;t[9]=(H*Lb-G*Rb-ua*Ob)*ub;t[10]=(pb*bb-nb*qb+y*hb)*ub;t[11]=(jb*qb-Za*bb-ob*hb)*ub;t[12]=(Ka*Pb-va*Qb-Xa*Ob)*ub;t[13]=(G*Qb-H*Pb+da*Ob)*ub;t[14]=(nb*ab-pb*rb-xb*hb)*ub;t[15]=(Za*rb-jb*ab+wb*hb)*ub;return t}function d(t,y,G){var H=y[0],da=y[1],ua=y[2],va=y[3],Ka=y[4],Xa=y[5],$a=y[6],Za=y[7],jb=y[8],wb=y[9],ob=y[10],pb=y[11],nb=y[12],xb=y[13],hb=y[14];y=y[15];var ab=G[0],qb=
G[1],rb=G[2],bb=G[3];t[0]=ab*H+qb*Ka+rb*jb+bb*nb;t[1]=ab*da+qb*Xa+rb*wb+bb*xb;t[2]=ab*ua+qb*$a+rb*ob+bb*hb;t[3]=ab*va+qb*Za+rb*pb+bb*y;ab=G[4];qb=G[5];rb=G[6];bb=G[7];t[4]=ab*H+qb*Ka+rb*jb+bb*nb;t[5]=ab*da+qb*Xa+rb*wb+bb*xb;t[6]=ab*ua+qb*$a+rb*ob+bb*hb;t[7]=ab*va+qb*Za+rb*pb+bb*y;ab=G[8];qb=G[9];rb=G[10];bb=G[11];t[8]=ab*H+qb*Ka+rb*jb+bb*nb;t[9]=ab*da+qb*Xa+rb*wb+bb*xb;t[10]=ab*ua+qb*$a+rb*ob+bb*hb;t[11]=ab*va+qb*Za+rb*pb+bb*y;ab=G[12];qb=G[13];rb=G[14];bb=G[15];t[12]=ab*H+qb*Ka+rb*jb+bb*nb;t[13]=
ab*da+qb*Xa+rb*wb+bb*xb;t[14]=ab*ua+qb*$a+rb*ob+bb*hb;t[15]=ab*va+qb*Za+rb*pb+bb*y;return t}function e(t,y,G){var H=y[0],da=y[1],ua=y[2],va=y[3],Ka=H+H,Xa=da+da,$a=ua+ua;y=H*Ka;var Za=H*Xa;H*=$a;var jb=da*Xa;da*=$a;ua*=$a;Ka*=va;Xa*=va;va*=$a;t[0]=1-(jb+ua);t[1]=Za+va;t[2]=H-Xa;t[3]=0;t[4]=Za-va;t[5]=1-(y+ua);t[6]=da+Ka;t[7]=0;t[8]=H+Xa;t[9]=da-Ka;t[10]=1-(y+jb);t[11]=0;t[12]=G[0];t[13]=G[1];t[14]=G[2];t[15]=1;return t}function f(t,y){t[0]=y[12];t[1]=y[13];t[2]=y[14];return t}function g(t,y){var G=
y[0]+y[5]+y[10];0<G?(G=2*Math.sqrt(G+1),t[3]=.25*G,t[0]=(y[6]-y[9])/G,t[1]=(y[8]-y[2])/G,t[2]=(y[1]-y[4])/G):y[0]>y[5]&&y[0]>y[10]?(G=2*Math.sqrt(1+y[0]-y[5]-y[10]),t[3]=(y[6]-y[9])/G,t[0]=.25*G,t[1]=(y[1]+y[4])/G,t[2]=(y[8]+y[2])/G):y[5]>y[10]?(G=2*Math.sqrt(1+y[5]-y[0]-y[10]),t[3]=(y[8]-y[2])/G,t[0]=(y[1]+y[4])/G,t[1]=.25*G,t[2]=(y[6]+y[9])/G):(G=2*Math.sqrt(1+y[10]-y[0]-y[5]),t[3]=(y[1]-y[4])/G,t[0]=(y[8]+y[2])/G,t[1]=(y[6]+y[9])/G,t[2]=.25*G);return t}function k(t,y,G,H,da){y=1/Math.tan(y/2);
t[0]=y/G;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=y;t[6]=0;t[7]=0;t[8]=0;t[9]=0;t[11]=-1;t[12]=0;t[13]=0;t[15]=0;null!=da&&Infinity!==da?(G=1/(H-da),t[10]=(da+H)*G,t[14]=2*da*H*G):(t[10]=-1,t[14]=-2*H);return t}function h(){var t=new S(3);S!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0);return t}function m(t){var y=new S(3);y[0]=t[0];y[1]=t[1];y[2]=t[2];return y}function l(t,y,G){var H=new S(3);H[0]=t;H[1]=y;H[2]=G;return H}function q(t,y){t[0]=y[0];t[1]=y[1];t[2]=y[2];return t}function n(t,y,G){t[0]=y[0]+G[0];t[1]=
y[1]+G[1];t[2]=y[2]+G[2];return t}function p(t,y,G){t[0]=y[0]*G;t[1]=y[1]*G;t[2]=y[2]*G;return t}function r(t,y){var G=y[0],H=y[1],da=y[2];G=G*G+H*H+da*da;0<G&&(G=1/Math.sqrt(G),t[0]=y[0]*G,t[1]=y[1]*G,t[2]=y[2]*G);return t}function x(t,y){return t[0]*y[0]+t[1]*y[1]+t[2]*y[2]}function w(t,y,G){var H=y[0],da=y[1];y=y[2];var ua=G[0],va=G[1];G=G[2];t[0]=da*G-y*va;t[1]=y*ua-H*G;t[2]=H*va-da*ua;return t}function u(t,y,G){var H=G[0],da=G[1],ua=G[2],va=y[0],Ka=y[1];y=y[2];var Xa=da*y-ua*Ka,$a=ua*va-H*y,
Za=H*Ka-da*va;G=2*G[3];t[0]=va+Xa*G+2*(da*Za-ua*$a);t[1]=Ka+$a*G+2*(ua*Xa-H*Za);t[2]=y+Za*G+2*(H*$a-da*Xa);return t}function A(){var t=new S(9);S!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0);t[0]=1;t[4]=1;t[8]=1;return t}function B(){var t=new S(4);S!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0);return t}function I(){var t=new S(4);S!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0);t[3]=1;return t}function F(t,y,G){var H=y[0],da=y[1],ua=y[2];y=y[3];var va=G[0],Ka=G[1],Xa=G[2];G=G[3];t[0]=H*G+y*
va+da*Xa-ua*Ka;t[1]=da*G+y*Ka+ua*va-H*Xa;t[2]=ua*G+y*Xa+H*Ka-da*va;t[3]=y*G-H*va-da*Ka-ua*Xa;return t}function E(t,y,G,H){var da=y[0],ua=y[1],va=y[2];y=y[3];var Ka=G[0],Xa=G[1],$a=G[2];G=G[3];var Za=da*Ka+ua*Xa+va*$a+y*G;0>Za&&(Za=-Za,Ka=-Ka,Xa=-Xa,$a=-$a,G=-G);if(1E-6<1-Za){var jb=Math.acos(Za);var wb=Math.sin(jb);Za=Math.sin((1-H)*jb)/wb;H=Math.sin(H*jb)/wb}else Za=1-H;t[0]=Za*da+H*Ka;t[1]=Za*ua+H*Xa;t[2]=Za*va+H*$a;t[3]=Za*y+H*G;return t}function K(t,y){var G=y[0],H=y[1],da=y[2];y=y[3];var ua=
G*G+H*H+da*da+y*y;ua=ua?1/ua:0;t[0]=-G*ua;t[1]=-H*ua;t[2]=-da*ua;t[3]=y*ua;return t}function M(t,y){t=new Event(t,y);t[Fa]={frame:y.frame,inputSource:y.inputSource};Object.setPrototypeOf(t,M.prototype);Object.defineProperty(t,"frame",{get:function(){return this[Fa].frame}});Object.defineProperty(t,"inputSource",{get:function(){return this[Fa].inputSource}});return t}function Z(t,y){t=new Event(t,y);t[ca]={session:y.session};Object.setPrototypeOf(t,Z.prototype);Object.defineProperty(t,"session",{get:function(){return this[ca].session}});
return t}function C(t,y){t=new Event(t,y);t[ya]={session:y.session,added:y.added,removed:y.removed};Object.setPrototypeOf(t,C.prototype);Object.defineProperty(t,"session",{get:function(){return this[ya].session}});Object.defineProperty(t,"added",{get:function(){return this[ya].added}});Object.defineProperty(t,"removed",{get:function(){return this[ya].removed}});return t}function U(t,y){t=new Event(t,y);t[Na]={referenceSpace:y.referenceSpace,transform:y.transform||null};Object.setPrototypeOf(t,U.prototype);
Object.defineProperty(t,"referenceSpace",{get:function(){return this[Na].referenceSpace}});Object.defineProperty(t,"transform",{get:function(){return this[Na].transform}});return t}function O(t,y,G){function H(Xa,$a,Za){return Xa<$a?$a:Xa>Za?Za:Xa}var da=y[0]*y[0],ua=y[1]*y[1],va=y[2]*y[2],Ka=y[3]*y[3];"XYZ"===G?(t[0]=Math.atan2(2*(y[0]*y[3]-y[1]*y[2]),Ka-da-ua+va),t[1]=Math.asin(H(2*(y[0]*y[2]+y[1]*y[3]),-1,1)),t[2]=Math.atan2(2*(y[2]*y[3]-y[0]*y[1]),Ka+da-ua-va)):"YXZ"===G?(t[0]=Math.asin(H(2*(y[0]*
y[3]-y[1]*y[2]),-1,1)),t[1]=Math.atan2(2*(y[0]*y[2]+y[1]*y[3]),Ka-da-ua+va),t[2]=Math.atan2(2*(y[0]*y[1]+y[2]*y[3]),Ka-da+ua-va)):"ZXY"===G?(t[0]=Math.asin(H(2*(y[0]*y[3]+y[1]*y[2]),-1,1)),t[1]=Math.atan2(2*(y[1]*y[3]-y[2]*y[0]),Ka-da-ua+va),t[2]=Math.atan2(2*(y[2]*y[3]-y[0]*y[1]),Ka-da+ua-va)):"ZYX"===G?(t[0]=Math.atan2(2*(y[0]*y[3]+y[2]*y[1]),Ka-da-ua+va),t[1]=Math.asin(H(2*(y[1]*y[3]-y[0]*y[2]),-1,1)),t[2]=Math.atan2(2*(y[0]*y[1]+y[2]*y[3]),Ka+da-ua-va)):"YZX"===G?(t[0]=Math.atan2(2*(y[0]*y[3]-
y[2]*y[1]),Ka-da+ua-va),t[1]=Math.atan2(2*(y[1]*y[3]-y[0]*y[2]),Ka+da-ua-va),t[2]=Math.asin(H(2*(y[0]*y[1]+y[2]*y[3]),-1,1))):"XZY"===G?(t[0]=Math.atan2(2*(y[0]*y[3]+y[1]*y[2]),Ka-da+ua-va),t[1]=Math.atan2(2*(y[0]*y[2]+y[1]*y[3]),Ka+da-ua-va),t[2]=Math.asin(H(2*(y[2]*y[3]-y[0]*y[1]),-1,1))):console.log("No order given for quaternion to euler conversion.")}var W="undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{},aa=Symbol("@@webxr-polyfill/EventTarget"),
R=function(){this[aa]={listeners:new Map}};R.prototype.addEventListener=function(t,y){if("string"!==typeof t)throw Error("`type` must be a string");if("function"!==typeof y)throw Error("`listener` must be a function");var G=this[aa].listeners.get(t)||[];G.push(y);this[aa].listeners.set(t,G)};R.prototype.removeEventListener=function(t,y){if("string"!==typeof t)throw Error("`type` must be a string");if("function"!==typeof y)throw Error("`listener` must be a function");t=this[aa].listeners.get(t)||[];
for(var G=t.length;0<=G;G--)t[G]===y&&t.pop()};R.prototype.dispatchEvent=function(t,y){for(var G=this[aa].listeners.get(t)||[],H=[],da=0;da<G.length;da++)H[da]=G[da];G=$jscomp.makeIterator(H);for(H=G.next();!H.done;H=G.next())H=H.value,H(y);if("function"===typeof this["on"+t])this["on"+t](y)};var S="undefined"!==typeof Float32Array?Float32Array:Array;(function(){var t=h();return function(y,G,H,da,ua,va){G||(G=3);H||(H=0);for(da=da?Math.min(da*G+H,y.length):y.length;H<da;H+=G)t[0]=y[H],t[1]=y[H+1],
t[2]=y[H+2],ua(t,t,va),y[H]=t[0],y[H+1]=t[1],y[H+2]=t[2];return y}})();(function(){var t=B();return function(y,G,H,da,ua,va){G||(G=4);H||(H=0);for(da=da?Math.min(da*G+H,y.length):y.length;H<da;H+=G)t[0]=y[H],t[1]=y[H+1],t[2]=y[H+2],t[3]=y[H+3],ua(t,t,va),y[H]=t[0],y[H+1]=t[1],y[H+2]=t[2],y[H+3]=t[3];return y}})();var fa=function(t){var y=new S(4);y[0]=t[0];y[1]=t[1];y[2]=t[2];y[3]=t[3];return y},X=function(t,y){t[0]=y[0];t[1]=y[1];t[2]=y[2];t[3]=y[3];return t},qa=function(t,y){var G=y[0],H=y[1],da=
y[2];y=y[3];var ua=G*G+H*H+da*da+y*y;0<ua&&(ua=1/Math.sqrt(ua),t[0]=G*ua,t[1]=H*ua,t[2]=da*ua,t[3]=y*ua);return t};(function(){var t=h(),y=l(1,0,0),G=l(0,1,0);return function(H,da,ua){var va=x(da,ua);if(-.999999>va){w(t,y,da);ua=t[0];va=t[1];var Ka=t[2];1E-6>Math.sqrt(ua*ua+va*va+Ka*Ka)&&w(t,G,da);r(t,t);da=Math.PI;da*=.5;ua=Math.sin(da);H[0]=ua*t[0];H[1]=ua*t[1];H[2]=ua*t[2];H[3]=Math.cos(da);return H}if(.999999<va)return H[0]=0,H[1]=0,H[2]=0,H[3]=1,H;w(t,da,ua);H[0]=t[0];H[1]=t[1];H[2]=t[2];H[3]=
1+va;return qa(H,H)}})();(function(){var t=I(),y=I();return function(G,H,da,ua,va,Ka){E(t,H,va,Ka);E(y,da,ua,Ka);E(G,t,y,2*Ka*(1-Ka));return G}})();(function(){var t=A();return function(y,G,H,da){t[0]=H[0];t[3]=H[1];t[6]=H[2];t[1]=da[0];t[4]=da[1];t[7]=da[2];t[2]=-G[0];t[5]=-G[1];t[8]=-G[2];G=t[0]+t[4]+t[8];if(0<G)G=Math.sqrt(G+1),y[3]=.5*G,G=.5/G,y[0]=(t[5]-t[7])*G,y[1]=(t[6]-t[2])*G,y[2]=(t[1]-t[3])*G;else{H=0;t[4]>t[0]&&(H=1);t[8]>t[3*H+H]&&(H=2);da=(H+1)%3;var ua=(H+2)%3;G=Math.sqrt(t[3*H+H]-
t[3*da+da]-t[3*ua+ua]+1);y[H]=.5*G;G=.5/G;y[3]=(t[3*da+ua]-t[3*ua+da])*G;y[da]=(t[3*da+H]+t[3*H+da])*G;y[ua]=(t[3*ua+H]+t[3*H+ua])*G}return qa(y,y)}})();if(!("DOMPointReadOnly"in window)){var na=Symbol("@@webxr-polyfill/DOMPointReadOnly"),xa=function(t,y,G,H){if(1===arguments.length)this[na]={x:t.x,y:t.y,z:t.z,w:t.w};else if(4===arguments.length)this[na]={x:t,y:y,z:G,w:H};else throw new TypeError("Must supply either 1 or 4 arguments");};xa.fromPoint=function(t){return new xa(t.x,t.y,t.z,t.w)};$jscomp.global.Object.defineProperties(xa.prototype,
{x:{configurable:!0,enumerable:!0,get:function(){return this[na].x}},y:{configurable:!0,enumerable:!0,get:function(){return this[na].y}},z:{configurable:!0,enumerable:!0,get:function(){return this[na].z}},w:{configurable:!0,enumerable:!0,get:function(){return this[na].w}}});window.DOMPointReadOnly=xa}var wa=Symbol("@@webxr-polyfill/XRRigidTransform"),ta=function(){this[wa]={matrix:null,position:null,orientation:null,inverse:null};if(0===arguments.length)this[wa].matrix=b(new Float32Array(16));else if(1===
arguments.length)arguments[0]instanceof Float32Array?this[wa].matrix=arguments[0]:(this[wa].position=this._getPoint(arguments[0]),this[wa].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(2===arguments.length)this[wa].position=this._getPoint(arguments[0]),this[wa].orientation=this._getPoint(arguments[1]);else throw Error("Too many arguments!");if(this[wa].matrix){var t=h();f(t,this[wa].matrix);this[wa].position=DOMPointReadOnly.fromPoint({x:t[0],y:t[1],z:t[2]});t=I();g(t,this[wa].matrix);
this[wa].orientation=DOMPointReadOnly.fromPoint({x:t[0],y:t[1],z:t[2],w:t[3]})}else{this[wa].matrix=b(new Float32Array(16));t=this[wa].matrix;var y=this[wa].orientation.x,G=this[wa].orientation.y,H=this[wa].orientation.z,da=this[wa].orientation.w,ua=new S(4);ua[0]=y;ua[1]=G;ua[2]=H;ua[3]=da;e(t,ua,l(this[wa].position.x,this[wa].position.y,this[wa].position.z))}};ta.prototype._getPoint=function(t){return t instanceof DOMPointReadOnly?t:DOMPointReadOnly.fromPoint(t)};$jscomp.global.Object.defineProperties(ta.prototype,
{matrix:{configurable:!0,enumerable:!0,get:function(){return this[wa].matrix}},position:{configurable:!0,enumerable:!0,get:function(){return this[wa].position}},orientation:{configurable:!0,enumerable:!0,get:function(){return this[wa].orientation}},inverse:{configurable:!0,enumerable:!0,get:function(){if(null===this[wa].inverse){var t=b(new Float32Array(16));c(t,this[wa].matrix);this[wa].inverse=new ta(t);this[wa].inverse[wa].inverse=this}return this[wa].inverse}}});var sa=Symbol("@@webxr-polyfill/XRSpace"),
Da=function(t,y){this[sa]={specialType:void 0===t?null:t,inputSource:void 0===y?null:y,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}};Da.prototype._ensurePoseUpdated=function(t,y){y!=this[sa].lastFrameId&&(this[sa].lastFrameId=y,this._onPoseUpdate(t))};Da.prototype._onPoseUpdate=function(t){"viewer"==this[sa].specialType&&(this._baseMatrix=t.getBasePoseMatrix())};Da.prototype._getSpaceRelativeTransform=function(t){if(!this._inverseBaseMatrix||!t._baseMatrix)return null;var y=new Float32Array(16);
d(y,this._inverseBaseMatrix,t._baseMatrix);return new ta(y)};$jscomp.global.Object.defineProperties(Da.prototype,{_specialType:{configurable:!0,enumerable:!0,get:function(){return this[sa].specialType}},_inputSource:{configurable:!0,enumerable:!0,get:function(){return this[sa].inputSource}},_baseMatrix:{configurable:!0,enumerable:!0,set:function(t){this[sa].baseMatrix=t;this[sa].inverseBaseMatrix=null},get:function(){!this[sa].baseMatrix&&this[sa].inverseBaseMatrix&&(this[sa].baseMatrix=new Float32Array(16),
c(this[sa].baseMatrix,this[sa].inverseBaseMatrix));return this[sa].baseMatrix}},_inverseBaseMatrix:{configurable:!0,enumerable:!0,set:function(t){this[sa].inverseBaseMatrix=t;this[sa].baseMatrix=null},get:function(){!this[sa].inverseBaseMatrix&&this[sa].baseMatrix&&(this[sa].inverseBaseMatrix=new Float32Array(16),c(this[sa].inverseBaseMatrix,this[sa].baseMatrix));return this[sa].inverseBaseMatrix}}});var Q=Symbol("@@webxr-polyfill/XRReferenceSpace"),J=["viewer","local","local-floor","bounded-floor",
"unbounded"],N=function(t,y){y=void 0===y?null:y;if(!J.includes(t))throw Error("XRReferenceSpaceType must be one of "+J);var G=Da.call(this,t)||this;if("bounded-floor"===t&&!y)throw Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");"bounded-floor"!==t&&"local-floor"!==t||y||(y=b(new Float32Array(16)),y[13]=1.6);G._inverseBaseMatrix=y||b(new Float32Array(16));G[Q]={type:t,transform:y,originOffset:b(new Float32Array(16))};return G};$jscomp.inherits(N,
Da);N.prototype._transformBasePoseMatrix=function(t,y){d(t,this._inverseBaseMatrix,y)};N.prototype._originOffsetMatrix=function(){return this[Q].originOffset};N.prototype._adjustForOriginOffset=function(t){var y=new Float32Array(16);c(y,this[Q].originOffset);d(t,y,t)};N.prototype._getSpaceRelativeTransform=function(t){t=Da.prototype._getSpaceRelativeTransform.call(this,t);this._adjustForOriginOffset(t.matrix);return new XRRigidTransform(t.matrix)};N.prototype.getOffsetReferenceSpace=function(t){var y=
new N(this[Q].type,this[Q].transform,this[Q].bounds);d(y[Q].originOffset,this[Q].originOffset,t.matrix);return y};var V=Symbol("@@webxr-polyfill/XR"),ra=["inline","immersive-vr","immersive-ar"],ka={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}},za=function(t){var y=R.call(this)||this;y[V]={device:null,devicePromise:t,immersiveSession:null,inlineSessions:new Set};
t.then(function(G){y[V].device=G});return y};$jscomp.inherits(za,R);za.prototype.isSessionSupported=function(t){var y=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){return 1==G.nextAddress?y[V].device?G.jumpTo(2):G.yield(y[V].devicePromise,2):"inline"!=t?G.return(Promise.resolve(y[V].device.isSessionSupported(t))):G.return(Promise.resolve(!0))})};za.prototype.requestSession=function(t,y){var G=this,H,da,ua,va,Ka,Xa,$a,Za,jb,wb,ob,pb,nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xb){if(1==
xb.nextAddress){if(G[V].device)return xb.jumpTo(2);if("inline"!=t)throw Error("Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode\nor navigator.xr.requestSession('inline') prior to requesting an immersive\nsession. This is a limitation specific to the WebXR Polyfill and does not apply\nto native implementations of the API.");return xb.yield(G[V].devicePromise,2)}if(5!=xb.nextAddress){if(!ra.includes(t))throw new TypeError("The provided value '"+t+"' is not a valid enum value of type XRSessionMode");
H=ka[t];da=H.requiredFeatures.concat(y&&y.requiredFeatures?y.requiredFeatures:[]);ua=H.optionalFeatures.concat(y&&y.optionalFeatures?y.optionalFeatures:[]);va=new Set;Ka=!1;Xa=$jscomp.makeIterator(da);for($a=Xa.next();!$a.done;$a=Xa.next())Za=$a.value,G[V].device.isFeatureSupported(Za)?va.add(Za):(console.error("The required feature '"+Za+"' is not supported"),Ka=!0);if(Ka)throw new DOMException("Session does not support some required features","NotSupportedError");jb=$jscomp.makeIterator(ua);for($a=
jb.next();!$a.done;$a=jb.next())wb=$a.value,G[V].device.isFeatureSupported(wb)?va.add(wb):console.log("The optional feature '"+wb+"' is not supported");return xb.yield(G[V].device.requestSession(t,va),5)}ob=xb.yieldResult;pb=new XRSession(G[V].device,t,ob);"inline"==t?G[V].inlineSessions.add(pb):G[V].immersiveSession=pb;nb=function(){"inline"==t?G[V].inlineSessions.delete(pb):G[V].immersiveSession=null;pb.removeEventListener("end",nb)};pb.addEventListener("end",nb);return xb.return(pb)})};if(!1===
"performance"in W){var Ea=Date.now();var pa=function(){return Date.now()-Ea}}else pa=function(){return performance.now()};var ha=pa,ja=Symbol("@@webxr-polyfill/XRPose"),Ca=function(t,y){this[ja]={transform:t,emulatedPosition:y}};$jscomp.global.Object.defineProperties(Ca.prototype,{transform:{configurable:!0,enumerable:!0,get:function(){return this[ja].transform}},emulatedPosition:{configurable:!0,enumerable:!0,get:function(){return this[ja].emulatedPosition}}});var Ta=Symbol("@@webxr-polyfill/XRViewerPose"),
Pa=function(t,y,G){t=Ca.call(this,t,void 0===G?!1:G)||this;t[Ta]={views:y};return t};$jscomp.inherits(Pa,Ca);$jscomp.global.Object.defineProperties(Pa.prototype,{views:{configurable:!0,enumerable:!0,get:function(){return this[Ta].views}}});var Ga=Symbol("@@webxr-polyfill/XRViewport"),L=function(t){this[Ga]={target:t}};$jscomp.global.Object.defineProperties(L.prototype,{x:{configurable:!0,enumerable:!0,get:function(){return this[Ga].target.x}},y:{configurable:!0,enumerable:!0,get:function(){return this[Ga].target.y}},
width:{configurable:!0,enumerable:!0,get:function(){return this[Ga].target.width}},height:{configurable:!0,enumerable:!0,get:function(){return this[Ga].target.height}}});var ia=["left","right","none"],Aa=Symbol("@@webxr-polyfill/XRView"),Ia=function(t,y,G,H){if(!ia.includes(G))throw Error("XREye must be one of: "+ia);var da=Object.create(null),ua=new L(da);this[Aa]={device:t,eye:G,viewport:ua,temp:da,sessionId:H,transform:y}};Ia.prototype._getViewport=function(t){if(this[Aa].device.getViewport(this[Aa].sessionId,
this.eye,t,this[Aa].temp))return this[Aa].viewport};$jscomp.global.Object.defineProperties(Ia.prototype,{eye:{configurable:!0,enumerable:!0,get:function(){return this[Aa].eye}},projectionMatrix:{configurable:!0,enumerable:!0,get:function(){return this[Aa].device.getProjectionMatrix(this.eye)}},transform:{configurable:!0,enumerable:!0,get:function(){return this[Aa].transform}}});var Ja=Symbol("@@webxr-polyfill/XRFrame"),Va=0,Ra=function(t,y,G){this[Ja]={id:++Va,active:!1,animationFrame:!1,device:t,
session:y,sessionId:G}};Ra.prototype.getViewerPose=function(t){if(!this[Ja].animationFrame)throw new DOMException("getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.","InvalidStateError");if(!this[Ja].active)throw new DOMException("XRFrame access outside the callback that produced it is invalid.","InvalidStateError");var y=this[Ja].device,G=this[Ja].session;G[ma].viewerSpace._ensurePoseUpdated(y,this[Ja].id);t._ensurePoseUpdated(y,this[Ja].id);
var H=t._getSpaceRelativeTransform(G[ma].viewerSpace),da=[];G=$jscomp.makeIterator(G[ma].viewSpaces);for(var ua=G.next();!ua.done;ua=G.next()){ua=ua.value;ua._ensurePoseUpdated(y,this[Ja].id);var va=t._getSpaceRelativeTransform(ua);ua=new Ia(y,va,ua.eye,this[Ja].sessionId);da.push(ua)}return new Pa(H,da,!1)};Ra.prototype.getPose=function(t,y){if(!this[Ja].active)throw new DOMException("XRFrame access outside the callback that produced it is invalid.","InvalidStateError");var G=this[Ja].device;if("target-ray"===
t._specialType||"grip"===t._specialType)return G.getInputPose(t._inputSource,y,t._specialType);t._ensurePoseUpdated(G,this[Ja].id);y._ensurePoseUpdated(G,this[Ja].id);return(t=y._getSpaceRelativeTransform(t))?new XRPose(t,!1):null};$jscomp.global.Object.defineProperties(Ra.prototype,{session:{configurable:!0,enumerable:!0,get:function(){return this[Ja].session}}});var Sa=Symbol("@@webxr-polyfill/XRRenderState"),db=Object.freeze({depthNear:.1,depthFar:1E3,inlineVerticalFieldOfView:null,baseLayer:null}),
eb=function(t){t=void 0===t?{}:t;t=Object.assign({},db,t);this[Sa]={config:t}};$jscomp.global.Object.defineProperties(eb.prototype,{depthNear:{configurable:!0,enumerable:!0,get:function(){return this[Sa].config.depthNear}},depthFar:{configurable:!0,enumerable:!0,get:function(){return this[Sa].config.depthFar}},inlineVerticalFieldOfView:{configurable:!0,enumerable:!0,get:function(){return this[Sa].config.inlineVerticalFieldOfView}},baseLayer:{configurable:!0,enumerable:!0,get:function(){return this[Sa].config.baseLayer}}});
var gb=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),P=Symbol("@@webxr-polyfill/xr-compatible"),Y=Symbol("@@webxr-polyfill/XRWebGLLayer"),Ba=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1}),la=function(t,y,G){G=void 0===G?{}:G;G=Object.assign({},Ba,G);if(!(t instanceof Qa))throw Error("session must be a XRSession");if(t.ended)throw Error("InvalidStateError");if(y[gb]&&!0!==y[P])throw Error("InvalidStateError");var H=y.getParameter(y.FRAMEBUFFER_BINDING);
this[Y]={context:y,config:G,framebuffer:H,session:t}};la.prototype.getViewport=function(t){return t._getViewport(this)};la.getNativeFramebufferScaleFactor=function(t){if(!t)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return t[ma].ended?0:1};$jscomp.global.Object.defineProperties(la.prototype,{context:{configurable:!0,enumerable:!0,get:function(){return this[Y].context}},antialias:{configurable:!0,enumerable:!0,get:function(){return this[Y].config.antialias}},ignoreDepthValues:{configurable:!0,
enumerable:!0,get:function(){return!0}},framebuffer:{configurable:!0,enumerable:!0,get:function(){return this[Y].framebuffer}},framebufferWidth:{configurable:!0,enumerable:!0,get:function(){return this[Y].context.drawingBufferWidth}},framebufferHeight:{configurable:!0,enumerable:!0,get:function(){return this[Y].context.drawingBufferHeight}},_session:{configurable:!0,enumerable:!0,get:function(){return this[Y].session}}});var Fa=Symbol("@@webxr-polyfill/XRInputSourceEvent"),ca=Symbol("@@webxr-polyfill/XRSessionEvent"),
ya=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent"),ma=Symbol("@@webxr-polyfill/XRSession"),Ma=function(t){return Da.call(this,t)||this};$jscomp.inherits(Ma,Da);Ma.prototype._onPoseUpdate=function(t){this._inverseBaseMatrix=t.getBaseViewMatrix(this._specialType)};$jscomp.global.Object.defineProperties(Ma.prototype,{eye:{configurable:!0,enumerable:!0,get:function(){return this._specialType}}});var Qa=function(t,y,G){var H=R.call(this)||this;var da="inline"!=y,ua=new eb({inlineVerticalFieldOfView:da?
null:.5*Math.PI});H[ma]={device:t,mode:y,immersive:da,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:G,activeRenderState:ua,pendingRenderState:null,viewerSpace:new N("viewer"),viewSpaces:[],currentInputSources:[]};da?H[ma].viewSpaces.push(new Ma("left"),new Ma("right")):H[ma].viewSpaces.push(new Ma("none"));H[ma].onDeviceFrame=function(){if(!H[ma].ended&&!H[ma].suspended){H[ma].deviceFrameHandle=null;H[ma].startDeviceFrameLoop();if(null!==
H[ma].pendingRenderState&&(H[ma].activeRenderState=new eb(H[ma].pendingRenderState),H[ma].pendingRenderState=null,H[ma].activeRenderState.baseLayer))H[ma].device.onBaseLayerSet(H[ma].id,H[ma].activeRenderState.baseLayer);if(null!==H[ma].activeRenderState.baseLayer){var va=new Ra(t,H,H[ma].id),Ka=H[ma].currentFrameCallbacks=H[ma].frameCallbacks;H[ma].frameCallbacks=[];va[Ja].active=!0;va[Ja].animationFrame=!0;H[ma].device.onFrameStart(H[ma].id,H[ma].activeRenderState);H._checkInputSourcesChange();
for(var Xa=ha(),$a=0;$a<Ka.length;$a++)try{Ka[$a].cancelled||"function"!==typeof Ka[$a].callback||Ka[$a].callback(Xa,va)}catch(Za){console.error(Za)}H[ma].currentFrameCallbacks=null;va[Ja].active=!1;H[ma].device.onFrameEnd(H[ma].id)}}};H[ma].startDeviceFrameLoop=function(){null===H[ma].deviceFrameHandle&&(H[ma].deviceFrameHandle=H[ma].device.requestAnimationFrame(H[ma].onDeviceFrame))};H[ma].stopDeviceFrameLoop=function(){var va=H[ma].deviceFrameHandle;null!==va&&(H[ma].device.cancelAnimationFrame(va),
H[ma].deviceFrameHandle=null)};H[ma].onPresentationEnd=function(va){va!==H[ma].id?(H[ma].suspended=!1,H[ma].startDeviceFrameLoop(),H.dispatchEvent("focus",{session:H})):(H[ma].ended=!0,H[ma].stopDeviceFrameLoop(),t.removeEventListener("@@webxr-polyfill/vr-present-end",H[ma].onPresentationEnd),t.removeEventListener("@@webxr-polyfill/vr-present-start",H[ma].onPresentationStart),t.removeEventListener("@@webxr-polyfill/input-select-start",H[ma].onSelectStart),t.removeEventListener("@@webxr-polyfill/input-select-end",
H[ma].onSelectEnd),H.dispatchEvent("end",Z("end",{session:H})))};t.addEventListener("@@webxr-polyfill/vr-present-end",H[ma].onPresentationEnd);H[ma].onPresentationStart=function(va){va!==H[ma].id&&(H[ma].suspended=!0,H[ma].stopDeviceFrameLoop(),H.dispatchEvent("blur",{session:H}))};t.addEventListener("@@webxr-polyfill/vr-present-start",H[ma].onPresentationStart);H[ma].onSelectStart=function(va){va.sessionId===H[ma].id&&H[ma].dispatchInputSourceEvent("selectstart",va.inputSource)};t.addEventListener("@@webxr-polyfill/input-select-start",
H[ma].onSelectStart);H[ma].onSelectEnd=function(va){va.sessionId===H[ma].id&&(H[ma].dispatchInputSourceEvent("selectend",va.inputSource),H[ma].dispatchInputSourceEvent("select",va.inputSource))};t.addEventListener("@@webxr-polyfill/input-select-end",H[ma].onSelectEnd);H[ma].onSqueezeStart=function(va){va.sessionId===H[ma].id&&H[ma].dispatchInputSourceEvent("squeezestart",va.inputSource)};t.addEventListener("@@webxr-polyfill/input-squeeze-start",H[ma].onSqueezeStart);H[ma].onSqueezeEnd=function(va){va.sessionId===
H[ma].id&&(H[ma].dispatchInputSourceEvent("squeezeend",va.inputSource),H[ma].dispatchInputSourceEvent("squeeze",va.inputSource))};t.addEventListener("@@webxr-polyfill/input-squeeze-end",H[ma].onSqueezeEnd);H[ma].dispatchInputSourceEvent=function(va,Ka){var Xa=new Ra(t,H,H[ma].id);Ka=M(va,{frame:Xa,inputSource:Ka});Xa[Ja].active=!0;H.dispatchEvent(va,Ka);Xa[Ja].active=!1};H[ma].startDeviceFrameLoop();H.onblur=void 0;H.onfocus=void 0;H.onresetpose=void 0;H.onend=void 0;H.onselect=void 0;H.onselectstart=
void 0;H.onselectend=void 0;return H};$jscomp.inherits(Qa,R);Qa.prototype.requestReferenceSpace=function(t){var y=this,G,H;return $jscomp.asyncExecutePromiseGeneratorProgram(function(da){if(1==da.nextAddress){if(y[ma].ended)return da.return();if(!J.includes(t))throw new TypeError("XRReferenceSpaceType must be one of "+J);if(!y[ma].device.doesSessionSupportReferenceSpace(y[ma].id,t))throw new DOMException("The "+t+" reference space is not supported by this session.","NotSupportedError");return"viewer"===
t?da.return(y[ma].viewerSpace):da.yield(y[ma].device.requestFrameOfReferenceTransform(t),2)}G=da.yieldResult;if("bounded-floor"===t){if(!G)throw new DOMException(t+" XRReferenceSpace not supported by this device.","NotSupportedError");H=y[ma].device.requestStageBounds();if(!H)throw new DOMException(t+" XRReferenceSpace not supported by this device.","NotSupportedError");throw new DOMException("The WebXR polyfill does not support the "+t+" reference space yet.","NotSupportedError");}return da.return(new N(t,
G))})};Qa.prototype.requestAnimationFrame=function(t){if(!this[ma].ended){var y=++this[ma].frameHandle;this[ma].frameCallbacks.push({handle:y,callback:t,cancelled:!1});return y}};Qa.prototype.cancelAnimationFrame=function(t){var y=this[ma].frameCallbacks,G=y.findIndex(function(H){return H&&H.handle===t});-1<G&&(y[G].cancelled=!0,y.splice(G,1));if(y=this[ma].currentFrameCallbacks)G=y.findIndex(function(H){return H&&H.handle===t}),-1<G&&(y[G].cancelled=!0)};Qa.prototype.end=function(){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(y){if(t[ma].ended)return y.return();
t[ma].immersive&&(t[ma].ended=!0,t[ma].device.removeEventListener("@@webxr-polyfill/vr-present-start",t[ma].onPresentationStart),t[ma].device.removeEventListener("@@webxr-polyfill/vr-present-end",t[ma].onPresentationEnd),t[ma].device.removeEventListener("@@webxr-polyfill/input-select-start",t[ma].onSelectStart),t[ma].device.removeEventListener("@@webxr-polyfill/input-select-end",t[ma].onSelectEnd),t.dispatchEvent("end",Z("end",{session:t})));t[ma].stopDeviceFrameLoop();return y.return(t[ma].device.endSession(t[ma].id))})};
Qa.prototype.updateRenderState=function(t){if(this[ma].ended)throw Error("Can't call updateRenderState on an XRSession that has already ended.");if(t.baseLayer&&t.baseLayer._session!==this)throw Error("Called updateRenderState with a base layer that was created by a different session.");if(null!==t.inlineVerticalFieldOfView&&void 0!==t.inlineVerticalFieldOfView){if(this[ma].immersive)throw Error("inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.");
t.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,t.inlineVerticalFieldOfView))}if(null===this[ma].pendingRenderState){var y=this[ma].activeRenderState;this[ma].pendingRenderState={depthNear:y.depthNear,depthFar:y.depthFar,inlineVerticalFieldOfView:y.inlineVerticalFieldOfView,baseLayer:y.baseLayer}}Object.assign(this[ma].pendingRenderState,t)};Qa.prototype._checkInputSourcesChange=function(){for(var t=[],y=[],G=this.inputSources,H=this[ma].currentInputSources,da=$jscomp.makeIterator(G),ua=da.next();!ua.done;ua=
da.next())ua=ua.value,H.includes(ua)||t.push(ua);H=$jscomp.makeIterator(H);for(da=H.next();!da.done;da=H.next())da=da.value,G.includes(da)||y.push(da);(0<t.length||0<y.length)&&this.dispatchEvent("inputsourceschange",C("inputsourceschange",{session:this,added:t,removed:y}));this[ma].currentInputSources.length=0;t=$jscomp.makeIterator(G);for(ua=t.next();!ua.done;ua=t.next())this[ma].currentInputSources.push(ua.value)};$jscomp.global.Object.defineProperties(Qa.prototype,{renderState:{configurable:!0,
enumerable:!0,get:function(){return this[ma].activeRenderState}},environmentBlendMode:{configurable:!0,enumerable:!0,get:function(){return this[ma].device.environmentBlendMode||"opaque"}},inputSources:{configurable:!0,enumerable:!0,get:function(){return this[ma].device.getInputSources()}}});var Ya=Symbol("@@webxr-polyfill/XRInputSource"),cb=function(t){this[Ya]={impl:t,gripSpace:new Da("grip",this),targetRaySpace:new Da("target-ray",this)}};$jscomp.global.Object.defineProperties(cb.prototype,{handedness:{configurable:!0,
enumerable:!0,get:function(){return this[Ya].impl.handedness}},targetRayMode:{configurable:!0,enumerable:!0,get:function(){return this[Ya].impl.targetRayMode}},gripSpace:{configurable:!0,enumerable:!0,get:function(){var t=this[Ya].impl.targetRayMode;return"gaze"===t||"screen"===t?null:this[Ya].gripSpace}},targetRaySpace:{configurable:!0,enumerable:!0,get:function(){return this[Ya].targetRaySpace}},profiles:{configurable:!0,enumerable:!0,get:function(){return this[Ya].impl.profiles}},gamepad:{configurable:!0,
enumerable:!0,get:function(){return this[Ya].impl.gamepad}}});var Na=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent"),mb={XRSystem:za,XRSession:Qa,XRSessionEvent:Z,XRFrame:Ra,XRView:Ia,XRViewport:L,XRViewerPose:Pa,XRWebGLLayer:la,XRSpace:Da,XRReferenceSpace:N,XRReferenceSpaceEvent:U,XRInputSource:cb,XRInputSourceEvent:M,XRInputSourcesChangeEvent:C,XRRenderState:eb,XRRigidTransform:ta,XRPose:Ca},Cb=function(t){if("function"===typeof t.prototype.makeXRCompatible)return!1;t.prototype.makeXRCompatible=
function(){this[P]=!0;return Promise.resolve()};return!0},Ub=function(t){var y=t.prototype.getContext;t.prototype.getContext=function(G,H){if(G=y.call(this,G,H))G[gb]=!0,H&&"xrCompatible"in H&&(G[P]=H.xrCompatible);return G}},Vb=function(t){var y=!1;t=t.navigator.userAgent||t.navigator.vendor||t.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,
4)))y=!0;return y},Nb="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},mc=function(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t["default"]:t}(function(t,y){return y={exports:{}},t(y,y.exports),y.exports}(function(t,y){(function(G,H){t.exports=H()})(Nb,function(){function G(v,z,D,T){this.gl=v;this.cardboardUI=z;this.bufferScale=D;this.dirtySubmitFrameBindings=T;this.ctxAttribs=v.getContextAttributes();this.instanceExt=
v.getExtension("ANGLE_instanced_arrays");this.meshHeight=this.meshWidth=20;this.bufferWidth=v.drawingBufferWidth;this.bufferHeight=v.drawingBufferHeight;this.realBindFramebuffer=v.bindFramebuffer;this.realEnable=v.enable;this.realDisable=v.disable;this.realColorMask=v.colorMask;this.realClearColor=v.clearColor;this.realViewport=v.viewport;bb()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(v.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(v.canvas.__proto__,
"height"));this.isPatched=!1;this.lastBoundFramebuffer=null;this.stencilTest=this.scissorTest=this.blend=this.depthTest=this.cullFace=!1;this.viewport=[0,0,0,0];this.colorMask=[!0,!0,!0,!0];this.clearColor=[0,0,0,0];this.attribs={position:0,texCoord:1};this.program=xc(v,"attribute vec2 position;\nattribute vec3 texCoord;\nvarying vec2 vTexCoord;\nuniform vec4 viewportOffsetScale[2];\nvoid main() {\n  vec4 viewport = viewportOffsetScale[int(texCoord.z)];\n  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;\n  gl_Position = vec4( position, 1.0, 1.0 );\n}",
"precision mediump float;\nuniform sampler2D diffuse;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(diffuse, vTexCoord);\n}",this.attribs);this.uniforms=yc(v,this.program);this.viewportOffsetScale=new Float32Array(8);this.setTextureBounds();this.vertexBuffer=v.createBuffer();this.indexBuffer=v.createBuffer();this.indexCount=0;this.renderTarget=v.createTexture();this.framebuffer=v.createFramebuffer();this.stencilBuffer=this.depthBuffer=this.depthStencilBuffer=null;this.ctxAttribs.depth&&
this.ctxAttribs.stencil?this.depthStencilBuffer=v.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=v.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=v.createRenderbuffer());this.patch();this.onResize()}function H(v){this.gl=v;this.attribs={position:0};this.program=xc(v,"attribute vec2 position;\nuniform mat4 projectionMat;\nvoid main() {\n  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );\n}","precision mediump float;\nuniform vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}",
this.attribs);this.uniforms=yc(v,this.program);this.vertexBuffer=v.createBuffer();this.arrowVertexCount=this.arrowOffset=this.gearVertexCount=this.gearOffset=0;this.projMat=new Float32Array(16);this.listener=null;this.onResize()}function da(v){this.coefficients=v}function ua(v){this.width=v.width||Xb();this.height=v.height||Yb();this.widthMeters=v.widthMeters;this.heightMeters=v.heightMeters;this.bevelMeters=v.bevelMeters}function va(v,z){this.viewer=qc.CardboardV2;this.updateDeviceParams(v);this.distortion=
new da(this.viewer.distortionCoefficients);for(v=0;v<z.length;v++){var D=z[v];qc[D.id]=new Ka(D)}}function Ka(v){this.id=v.id;this.label=v.label;this.fov=v.fov;this.interLensDistance=v.interLensDistance;this.baselineLensDistance=v.baselineLensDistance;this.screenLensDistance=v.screenLensDistance;this.distortionCoefficients=v.distortionCoefficients;this.inverseCoefficients=v.inverseCoefficients}function Xa(v,z){this.dpdb=Kc;this.recalculateDeviceParams_();if(v){this.onDeviceParamsUpdated=z;var D=new XMLHttpRequest,
T=this;D.open("GET",v,!0);D.addEventListener("load",function(){T.loading=!1;200<=D.status&&299>=D.status?(T.dpdb=JSON.parse(D.response),T.recalculateDeviceParams_()):console.error("Error loading online DPDB!")});D.send()}}function $a(v){this.xdpi=v.xdpi;this.ydpi=v.ydpi;this.bevelMm=v.bevelMm}function Za(v,z){this.set(v,z)}function jb(v,z){this.kFilter=v;this.isDebug=z;this.currentAccelMeasurement=new Za;this.currentGyroMeasurement=new Za;this.previousGyroMeasurement=new Za;bb()?this.filterQ=new kb(-1,
0,0,1):this.filterQ=new kb(1,0,0,1);this.previousFilterQ=new kb;this.previousFilterQ.copy(this.filterQ);this.accelQ=new kb;this.isOrientationInitialized=!1;this.estimatedGravity=new yb;this.measuredGravity=new yb;this.gyroIntegralQ=new kb}function wb(v,z){this.predictionTimeS=v;this.isDebug=z;this.previousQ=new kb;this.previousTimestampS=null;this.deltaQ=new kb;this.outQ=new kb}function ob(v,z,D,T){this.yawOnly=D;this.accelerometer=new yb;this.gyroscope=new yb;this.filter=new jb(v,T);this.posePredictor=
new wb(z,T);this.isFirefoxAndroid=Pb();this.isIOS=bb();v=Lb();this.isDeviceMotionInRadians=!this.isIOS&&v&&66>v;this.isWithoutDeviceMotion=Rb()||Qb();this.filterToWorldQ=new kb;bb()?this.filterToWorldQ.setFromAxisAngle(new yb(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new yb(1,0,0),-Math.PI/2);this.inverseWorldToScreenQ=new kb;this.worldToScreenQ=new kb;this.originalPoseAdjustQ=new kb;this.originalPoseAdjustQ.setFromAxisAngle(new yb(0,0,1),-window.orientation*Math.PI/180);this.setScreenTransform_();
ub()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ);this.resetQ=new kb;this.orientationOut_=new Float32Array(4);this.start()}function pb(){this.loadIcon_();var v=document.createElement("div"),z=v.style;z.position="fixed";z.top=0;z.right=0;z.bottom=0;z.left=0;z.backgroundColor="gray";z.fontFamily="sans-serif";z.zIndex=1E6;var D=document.createElement("img");D.src=this.icon;z=D.style;z.marginLeft="25%";z.marginTop="25%";z.width="50%";v.appendChild(D);D=document.createElement("div");z=D.style;
z.textAlign="center";z.fontSize="16px";z.lineHeight="24px";z.margin="24px 25%";z.width="50%";D.innerHTML="Place your phone into your Cardboard viewer.";v.appendChild(D);var T=document.createElement("div");z=T.style;z.backgroundColor="#CFD8DC";z.position="fixed";z.bottom=0;z.width="100%";z.height="48px";z.padding="14px 24px";z.boxSizing="border-box";z.color="#656A6B";v.appendChild(T);var oa=document.createElement("div");oa.style.float="left";oa.innerHTML="No Cardboard viewer?";var ba=document.createElement("a");
ba.href="https://www.google.com/get/cardboard/get-cardboard/";ba.innerHTML="get one";ba.target="_blank";z=ba.style;z.float="right";z.fontWeight=600;z.textTransform="uppercase";z.borderLeft="1px solid gray";z.paddingLeft="24px";z.textDecoration="none";z.color="#656A6B";T.appendChild(oa);T.appendChild(ba);this.overlay=v;this.text=D;this.hide()}function nb(v){try{this.selectedKey=localStorage.getItem("WEBVR_CARDBOARD_VIEWER")}catch(z){console.error("Failed to load viewer profile: %s",z)}this.selectedKey||
(this.selectedKey=v||"CardboardV1");this.dialog=this.createDialog_(va.Viewers);this.root=null;this.onChangeCallbacks_=[]}function xb(v){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:v.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:v.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:v.canPresent},maxLayers:{writable:!1,enumerable:!0,value:v.maxLayers},hasOrientation:{enumerable:!0,get:function(){Sb("VRDisplayCapabilities.prototype.hasOrientation",
"VRDisplay.prototype.getFrameData");return v.hasOrientation}}})}function hb(v){v=v||{};v="wakelock"in v?v.wakelock:!0;this.isPolyfilled=!0;this.displayId=Lc++;this.displayName="";this.depthNear=.01;this.depthFar=1E4;this.isPresenting=!1;Object.defineProperty(this,"isConnected",{get:function(){Sb("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay");return!1}});this.capabilities=new xb({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1});
this.stageParameters=null;this.waitingForPresent_=!1;this.fullscreenErrorHandler_=this.fullscreenChangeHandler_=this.fullscreenEventTarget_=this.fullscreenElementCachedStyle_=this.fullscreenWrapper_=this.fullscreenElement_=this.originalParent_=this.layer_=null;v&&rc()&&(this.wakelock_=new Mc)}function ab(v){var z=zc({},Nc);v=zc(z,v||{});hb.call(this,{wakelock:v.MOBILE_WAKE_LOCK});this.config=v;this.displayName="Cardboard VRDisplay";this.capabilities=new xb({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,
canPresent:!0,maxLayers:1});this.stageParameters=null;this.bufferScale_=this.config.BUFFER_SCALE;this.poseSensor_=new Oc(this.config);this.cardboardUI_=this.distorter_=null;this.dpdb_=new Xa(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this));this.deviceInfo_=new va(this.dpdb_.getDeviceParams(),v.ADDITIONAL_VIEWERS);this.viewerSelector_=new nb(v.DEFAULT_VIEWER);this.viewerSelector_.onChange(this.onViewerChanged_.bind(this));this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer());
this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new pb);bb()&&window.addEventListener("resize",this.onResize_.bind(this))}var qb=function(){function v(z,D){for(var T=0;T<D.length;T++){var oa=D[T];oa.enumerable=oa.enumerable||!1;oa.configurable=!0;"value"in oa&&(oa.writable=!0);Object.defineProperty(z,oa.key,oa)}}return function(z,D,T){D&&v(z.prototype,D);T&&v(z,T);return z}}(),rb=function(){return function(v,z){if(Array.isArray(v))return v;if(Symbol.iterator in Object(v)){var D=
[],T=!0,oa=!1,ba=void 0;try{for(var ea=v[Symbol.iterator](),Ha;!(T=(Ha=ea.next()).done)&&(D.push(Ha.value),!z||D.length!==z);T=!0);}catch(Oa){oa=!0,ba=Oa}finally{try{if(!T&&ea["return"])ea["return"]()}finally{if(oa)throw ba;}}return D}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),bb=function(){var v=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return v}}(),Hb=function(){var v=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&
-1!==navigator.userAgent.indexOf("Chrome");return function(){return v}}(),Ob=function(){var v=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return v}}(),Pb=function(){var v=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android");return function(){return v}}(),Lb=function(){var v=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),z=v?parseInt(v[1],10):null;return function(){return z}}(),Qb=function(){var v=!1;v=bb()&&Ob()&&-1!==navigator.userAgent.indexOf("13_4");
return function(){return v}}(),Rb=function(){var v=!1;if(65===Lb()){var z=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(z){z=z[1].split(".");z=rb(z,4);var D=z[3];v=3325===parseInt(z[2],10)&&148>parseInt(D,10)}}return function(){return v}}(),Mb=function(){var v=-1!==navigator.userAgent.indexOf("R7 Build");return function(){return v}}(),ub=function(){var v=90==window.orientation||-90==window.orientation;return Mb()?!v:v},Xb=function(){return Math.max(window.screen.width,window.screen.height)*
window.devicePixelRatio},Yb=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},Pc=function(v){if(Hb())return!1;if(v.requestFullscreen)v.requestFullscreen();else if(v.webkitRequestFullscreen)v.webkitRequestFullscreen();else if(v.mozRequestFullScreen)v.mozRequestFullScreen();else if(v.msRequestFullscreen)v.msRequestFullscreen();else return!1;return!0},Ac=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();
else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},xc=function(v,z,D,T){var oa=v.createShader(v.VERTEX_SHADER);v.shaderSource(oa,z);v.compileShader(oa);z=v.createShader(v.FRAGMENT_SHADER);v.shaderSource(z,D);v.compileShader(z);D=v.createProgram();v.attachShader(D,oa);v.attachShader(D,z);for(var ba in T)v.bindAttribLocation(D,T[ba],ba);v.linkProgram(D);v.deleteShader(oa);v.deleteShader(z);return D},
yc=function(v,z){for(var D={},T=v.getProgramParameter(z,v.ACTIVE_UNIFORMS),oa,ba=0;ba<T;ba++)oa=v.getActiveUniform(z,ba).name.replace("[0]",""),D[oa]=v.getUniformLocation(z,oa);return D},rc=function(){var v=!1,z=navigator.userAgent||navigator.vendor||window.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(z)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(z.substr(0,
4)))v=!0;return v},zc=function(v,z){for(var D in z)z.hasOwnProperty(D)&&(v[D]=z[D]);return v},sc=function(v){if(bb()){var z=v.style.width,D=v.style.height;v.style.width=parseInt(z)+1+"px";v.style.height=parseInt(D)+"px";setTimeout(function(){v.style.width=z;v.style.height=D},100)}window.canvas=v},Qc=function(){function v(ba,ea,Ha,Oa,La,Ua){var Wa=Oa||null;Oa=Ua.depthNear;Ua=Ua.depthFar;var fb=Math.tan(Wa?Wa.upDegrees*z:D),lb=Math.tan(Wa?Wa.downDegrees*z:D),zb=Math.tan(Wa?Wa.leftDegrees*z:D);Wa=Math.tan(Wa?
Wa.rightDegrees*z:D);var ib=2/(zb+Wa),vb=2/(fb+lb);ba[0]=ib;ba[1]=0;ba[2]=0;ba[3]=0;ba[4]=0;ba[5]=vb;ba[6]=0;ba[7]=0;ba[8]=-((zb-Wa)*ib*.5);ba[9]=(fb-lb)*vb*.5;ba[10]=Ua/(Oa-Ua);ba[11]=-1;ba[12]=0;ba[13]=0;ba[14]=Ua*Oa/(Oa-Ua);ba[15]=0;ba=Ha.orientation||T;Ha=Ha.position||oa;lb=ba[0];ib=ba[1];vb=ba[2];Ua=ba[3];var Eb=lb+lb;Wa=ib+ib;fb=vb+vb;ba=lb*Eb;Oa=lb*Wa;lb*=fb;zb=ib*Wa;ib*=fb;vb*=fb;Eb*=Ua;Wa*=Ua;Ua*=fb;ea[0]=1-(zb+vb);ea[1]=Oa+Ua;ea[2]=lb-Wa;ea[3]=0;ea[4]=Oa-Ua;ea[5]=1-(ba+vb);ea[6]=ib+Eb;ea[7]=
0;ea[8]=lb+Wa;ea[9]=ib-Eb;ea[10]=1-(ba+zb);ea[11]=0;ea[12]=Ha[0];ea[13]=Ha[1];ea[14]=Ha[2];ea[15]=1;if(La)if(Ha=La[0],ba=La[1],La=La[2],ea===ea)ea[12]=ea[0]*Ha+ea[4]*ba+ea[8]*La+ea[12],ea[13]=ea[1]*Ha+ea[5]*ba+ea[9]*La+ea[13],ea[14]=ea[2]*Ha+ea[6]*ba+ea[10]*La+ea[14],ea[15]=ea[3]*Ha+ea[7]*ba+ea[11]*La+ea[15];else{Oa=ea[0];Ua=ea[1];fb=ea[2];lb=ea[3];zb=ea[4];Wa=ea[5];ib=ea[6];vb=ea[7];Eb=ea[8];var Ib=ea[9];var Jb=ea[10];var Kb=ea[11];ea[0]=Oa;ea[1]=Ua;ea[2]=fb;ea[3]=lb;ea[4]=zb;ea[5]=Wa;ea[6]=ib;ea[7]=
vb;ea[8]=Eb;ea[9]=Ib;ea[10]=Jb;ea[11]=Kb;ea[12]=Oa*Ha+zb*ba+Eb*La+ea[12];ea[13]=Ua*Ha+Wa*ba+Ib*La+ea[13];ea[14]=fb*Ha+ib*ba+Jb*La+ea[14];ea[15]=lb*Ha+vb*ba+Kb*La+ea[15]}La=ea[0];Ha=ea[1];ba=ea[2];Oa=ea[3];Ua=ea[4];fb=ea[5];lb=ea[6];zb=ea[7];Wa=ea[8];ib=ea[9];vb=ea[10];Eb=ea[11];Ib=ea[12];Jb=ea[13];Kb=ea[14];var Wb=ea[15],Zb=La*fb-Ha*Ua,$b=La*lb-ba*Ua,ac=La*zb-Oa*Ua,bc=Ha*lb-ba*fb,cc=Ha*zb-Oa*fb,dc=ba*zb-Oa*lb,ec=Wa*Jb-ib*Ib,fc=Wa*Kb-vb*Ib,gc=Wa*Wb-Eb*Ib,hc=ib*Kb-vb*Jb,ic=ib*Wb-Eb*Jb,jc=vb*Wb-Eb*Kb,
Bb=Zb*jc-$b*ic+ac*hc+bc*gc-cc*fc+dc*ec;Bb&&(Bb=1/Bb,ea[0]=(fb*jc-lb*ic+zb*hc)*Bb,ea[1]=(ba*ic-Ha*jc-Oa*hc)*Bb,ea[2]=(Jb*dc-Kb*cc+Wb*bc)*Bb,ea[3]=(vb*cc-ib*dc-Eb*bc)*Bb,ea[4]=(lb*gc-Ua*jc-zb*fc)*Bb,ea[5]=(La*jc-ba*gc+Oa*fc)*Bb,ea[6]=(Kb*ac-Ib*dc-Wb*$b)*Bb,ea[7]=(Wa*dc-vb*ac+Eb*$b)*Bb,ea[8]=(Ua*ic-fb*gc+zb*ec)*Bb,ea[9]=(Ha*gc-La*ic-Oa*ec)*Bb,ea[10]=(Ib*cc-Jb*ac+Wb*Zb)*Bb,ea[11]=(ib*ac-Wa*cc-Eb*Zb)*Bb,ea[12]=(fb*fc-Ua*hc-lb*ec)*Bb,ea[13]=(La*hc-Ha*fc+ba*ec)*Bb,ea[14]=(Jb*$b-Ib*bc-Kb*Zb)*Bb,ea[15]=(Wa*
bc-ib*$b+vb*Zb)*Bb)}var z=Math.PI/180,D=.25*Math.PI,T=new Float32Array([0,0,0,1]),oa=new Float32Array([0,0,0]);return function(ba,ea,Ha){if(!ba||!ea)return!1;ba.pose=ea;ba.timestamp=ea.timestamp;v(ba.leftProjectionMatrix,ba.leftViewMatrix,ea,Ha._getFieldOfView("left"),Ha._getEyeOffset("left"),Ha);v(ba.rightProjectionMatrix,ba.rightViewMatrix,ea,Ha._getFieldOfView("right"),Ha._getEyeOffset("right"),Ha);return!0}}(),Bc=function(v){var z=v.indexOf("://");z=v.indexOf("/",-1!==z?z+3:0);-1===z&&(z=v.length);
return v.substring(0,z)},tc=function(){var v={};return function(z,D){void 0===v[z]&&(console.warn("webvr-polyfill: "+D),v[z]=!0)}}(),Sb=function(v,z){tc(v,v+" has been deprecated. This may not work on native WebVR displays. "+(z?"Please use "+z+" instead.":""))},kc=function(v,z,D){if(z){for(var T=[],oa=null,ba=0;ba<z.length;++ba){var ea=z[ba];switch(ea){case v.TEXTURE_BINDING_2D:case v.TEXTURE_BINDING_CUBE_MAP:var Ha=z[++ba];if(Ha<v.TEXTURE0||Ha>v.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit");
T.push(null,null);break}oa||(oa=v.getParameter(v.ACTIVE_TEXTURE));v.activeTexture(Ha);T.push(v.getParameter(ea),null);break;case v.ACTIVE_TEXTURE:oa=v.getParameter(v.ACTIVE_TEXTURE);T.push(null);break;default:T.push(v.getParameter(ea))}}D(v);for(ba=0;ba<z.length;++ba){ea=z[ba];D=T[ba];switch(ea){case v.ACTIVE_TEXTURE:break;case v.ARRAY_BUFFER_BINDING:v.bindBuffer(v.ARRAY_BUFFER,D);break;case v.COLOR_CLEAR_VALUE:v.clearColor(D[0],D[1],D[2],D[3]);break;case v.COLOR_WRITEMASK:v.colorMask(D[0],D[1],D[2],
D[3]);break;case v.CURRENT_PROGRAM:v.useProgram(D);break;case v.ELEMENT_ARRAY_BUFFER_BINDING:v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,D);break;case v.FRAMEBUFFER_BINDING:v.bindFramebuffer(v.FRAMEBUFFER,D);break;case v.RENDERBUFFER_BINDING:v.bindRenderbuffer(v.RENDERBUFFER,D);break;case v.TEXTURE_BINDING_2D:Ha=z[++ba];if(Ha<v.TEXTURE0||Ha>v.TEXTURE31)break;v.activeTexture(Ha);v.bindTexture(v.TEXTURE_2D,D);break;case v.TEXTURE_BINDING_CUBE_MAP:Ha=z[++ba];if(Ha<v.TEXTURE0||Ha>v.TEXTURE31)break;v.activeTexture(Ha);
v.bindTexture(v.TEXTURE_CUBE_MAP,D);break;case v.VIEWPORT:v.viewport(D[0],D[1],D[2],D[3]);break;case v.BLEND:case v.CULL_FACE:case v.DEPTH_TEST:case v.SCISSOR_TEST:case v.STENCIL_TEST:D?v.enable(ea):v.disable(ea);break;default:console.log("No GL restore behavior for 0x"+ea.toString(16))}oa&&v.activeTexture(oa)}}else D(v)};G.prototype.destroy=function(){var v=this.gl;this.unpatch();v.deleteProgram(this.program);v.deleteBuffer(this.vertexBuffer);v.deleteBuffer(this.indexBuffer);v.deleteTexture(this.renderTarget);
v.deleteFramebuffer(this.framebuffer);this.depthStencilBuffer&&v.deleteRenderbuffer(this.depthStencilBuffer);this.depthBuffer&&v.deleteRenderbuffer(this.depthBuffer);this.stencilBuffer&&v.deleteRenderbuffer(this.stencilBuffer);this.cardboardUI&&this.cardboardUI.destroy()};G.prototype.onResize=function(){var v=this.gl,z=this;kc(v,[v.RENDERBUFFER_BINDING,v.TEXTURE_BINDING_2D,v.TEXTURE0],function(D){z.realBindFramebuffer.call(D,D.FRAMEBUFFER,null);z.scissorTest&&z.realDisable.call(D,D.SCISSOR_TEST);
z.realColorMask.call(D,!0,!0,!0,!0);z.realViewport.call(D,0,0,D.drawingBufferWidth,D.drawingBufferHeight);z.realClearColor.call(D,0,0,0,1);D.clear(D.COLOR_BUFFER_BIT);z.realBindFramebuffer.call(D,D.FRAMEBUFFER,z.framebuffer);D.bindTexture(D.TEXTURE_2D,z.renderTarget);D.texImage2D(D.TEXTURE_2D,0,z.ctxAttribs.alpha?D.RGBA:D.RGB,z.bufferWidth,z.bufferHeight,0,z.ctxAttribs.alpha?D.RGBA:D.RGB,D.UNSIGNED_BYTE,null);D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.LINEAR);D.texParameteri(D.TEXTURE_2D,
D.TEXTURE_MIN_FILTER,D.LINEAR);D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE);D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE);D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_2D,z.renderTarget,0);z.ctxAttribs.depth&&z.ctxAttribs.stencil?(D.bindRenderbuffer(D.RENDERBUFFER,z.depthStencilBuffer),D.renderbufferStorage(D.RENDERBUFFER,D.DEPTH_STENCIL,z.bufferWidth,z.bufferHeight),D.framebufferRenderbuffer(D.FRAMEBUFFER,D.DEPTH_STENCIL_ATTACHMENT,D.RENDERBUFFER,
z.depthStencilBuffer)):z.ctxAttribs.depth?(D.bindRenderbuffer(D.RENDERBUFFER,z.depthBuffer),D.renderbufferStorage(D.RENDERBUFFER,D.DEPTH_COMPONENT16,z.bufferWidth,z.bufferHeight),D.framebufferRenderbuffer(D.FRAMEBUFFER,D.DEPTH_ATTACHMENT,D.RENDERBUFFER,z.depthBuffer)):z.ctxAttribs.stencil&&(D.bindRenderbuffer(D.RENDERBUFFER,z.stencilBuffer),D.renderbufferStorage(D.RENDERBUFFER,D.STENCIL_INDEX8,z.bufferWidth,z.bufferHeight),D.framebufferRenderbuffer(D.FRAMEBUFFER,D.STENCIL_ATTACHMENT,D.RENDERBUFFER,
z.stencilBuffer));!D.checkFramebufferStatus(D.FRAMEBUFFER)===D.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!");z.realBindFramebuffer.call(D,D.FRAMEBUFFER,z.lastBoundFramebuffer);z.scissorTest&&z.realEnable.call(D,D.SCISSOR_TEST);z.realColorMask.apply(D,z.colorMask);z.realViewport.apply(D,z.viewport);z.realClearColor.apply(D,z.clearColor)});if(this.cardboardUI)this.cardboardUI.onResize()};G.prototype.patch=function(){if(!this.isPatched){var v=this,z=this.gl.canvas,D=this.gl;bb()||(z.width=
Xb()*this.bufferScale,z.height=Yb()*this.bufferScale,Object.defineProperty(z,"width",{configurable:!0,enumerable:!0,get:function(){return v.bufferWidth},set:function(T){v.bufferWidth=T;v.realCanvasWidth.set.call(z,T);v.onResize()}}),Object.defineProperty(z,"height",{configurable:!0,enumerable:!0,get:function(){return v.bufferHeight},set:function(T){v.bufferHeight=T;v.realCanvasHeight.set.call(z,T);v.onResize()}}));this.lastBoundFramebuffer=D.getParameter(D.FRAMEBUFFER_BINDING);null==this.lastBoundFramebuffer&&
(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(D.FRAMEBUFFER,this.framebuffer));this.gl.bindFramebuffer=function(T,oa){v.lastBoundFramebuffer=oa?oa:v.framebuffer;v.realBindFramebuffer.call(D,T,v.lastBoundFramebuffer)};this.cullFace=D.getParameter(D.CULL_FACE);this.depthTest=D.getParameter(D.DEPTH_TEST);this.blend=D.getParameter(D.BLEND);this.scissorTest=D.getParameter(D.SCISSOR_TEST);this.stencilTest=D.getParameter(D.STENCIL_TEST);D.enable=function(T){switch(T){case D.CULL_FACE:v.cullFace=
!0;break;case D.DEPTH_TEST:v.depthTest=!0;break;case D.BLEND:v.blend=!0;break;case D.SCISSOR_TEST:v.scissorTest=!0;break;case D.STENCIL_TEST:v.stencilTest=!0}v.realEnable.call(D,T)};D.disable=function(T){switch(T){case D.CULL_FACE:v.cullFace=!1;break;case D.DEPTH_TEST:v.depthTest=!1;break;case D.BLEND:v.blend=!1;break;case D.SCISSOR_TEST:v.scissorTest=!1;break;case D.STENCIL_TEST:v.stencilTest=!1}v.realDisable.call(D,T)};this.colorMask=D.getParameter(D.COLOR_WRITEMASK);D.colorMask=function(T,oa,ba,
ea){v.colorMask[0]=T;v.colorMask[1]=oa;v.colorMask[2]=ba;v.colorMask[3]=ea;v.realColorMask.call(D,T,oa,ba,ea)};this.clearColor=D.getParameter(D.COLOR_CLEAR_VALUE);D.clearColor=function(T,oa,ba,ea){v.clearColor[0]=T;v.clearColor[1]=oa;v.clearColor[2]=ba;v.clearColor[3]=ea;v.realClearColor.call(D,T,oa,ba,ea)};this.viewport=D.getParameter(D.VIEWPORT);D.viewport=function(T,oa,ba,ea){v.viewport[0]=T;v.viewport[1]=oa;v.viewport[2]=ba;v.viewport[3]=ea;v.realViewport.call(D,T,oa,ba,ea)};this.isPatched=!0;
sc(z)}};G.prototype.unpatch=function(){if(this.isPatched){var v=this.gl,z=this.gl.canvas;bb()||(Object.defineProperty(z,"width",this.realCanvasWidth),Object.defineProperty(z,"height",this.realCanvasHeight));z.width=this.bufferWidth;z.height=this.bufferHeight;v.bindFramebuffer=this.realBindFramebuffer;v.enable=this.realEnable;v.disable=this.realDisable;v.colorMask=this.realColorMask;v.clearColor=this.realClearColor;v.viewport=this.realViewport;this.lastBoundFramebuffer==this.framebuffer&&v.bindFramebuffer(v.FRAMEBUFFER,
null);this.isPatched=!1;setTimeout(function(){sc(z)},1)}};G.prototype.setTextureBounds=function(v,z){v||(v=[0,0,.5,1]);z||(z=[.5,0,.5,1]);this.viewportOffsetScale[0]=v[0];this.viewportOffsetScale[1]=v[1];this.viewportOffsetScale[2]=v[2];this.viewportOffsetScale[3]=v[3];this.viewportOffsetScale[4]=z[0];this.viewportOffsetScale[5]=z[1];this.viewportOffsetScale[6]=z[2];this.viewportOffsetScale[7]=z[3]};G.prototype.submitFrame=function(){var v=this.gl,z=this,D=[];this.dirtySubmitFrameBindings||D.push(v.CURRENT_PROGRAM,
v.ARRAY_BUFFER_BINDING,v.ELEMENT_ARRAY_BUFFER_BINDING,v.TEXTURE_BINDING_2D,v.TEXTURE0);kc(v,D,function(T){z.realBindFramebuffer.call(T,T.FRAMEBUFFER,null);var oa=0,ba=0;z.instanceExt&&(oa=T.getVertexAttrib(z.attribs.position,z.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),ba=T.getVertexAttrib(z.attribs.texCoord,z.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE));z.cullFace&&z.realDisable.call(T,T.CULL_FACE);z.depthTest&&z.realDisable.call(T,T.DEPTH_TEST);z.blend&&z.realDisable.call(T,T.BLEND);z.scissorTest&&
z.realDisable.call(T,T.SCISSOR_TEST);z.stencilTest&&z.realDisable.call(T,T.STENCIL_TEST);z.realColorMask.call(T,!0,!0,!0,!0);z.realViewport.call(T,0,0,T.drawingBufferWidth,T.drawingBufferHeight);if(z.ctxAttribs.alpha||bb())z.realClearColor.call(T,0,0,0,1),T.clear(T.COLOR_BUFFER_BIT);T.useProgram(z.program);T.bindBuffer(T.ELEMENT_ARRAY_BUFFER,z.indexBuffer);T.bindBuffer(T.ARRAY_BUFFER,z.vertexBuffer);T.enableVertexAttribArray(z.attribs.position);T.enableVertexAttribArray(z.attribs.texCoord);T.vertexAttribPointer(z.attribs.position,
2,T.FLOAT,!1,20,0);T.vertexAttribPointer(z.attribs.texCoord,3,T.FLOAT,!1,20,8);z.instanceExt&&(0!=oa&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.position,0),0!=ba&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.texCoord,0));T.activeTexture(T.TEXTURE0);T.uniform1i(z.uniforms.diffuse,0);T.bindTexture(T.TEXTURE_2D,z.renderTarget);T.uniform4fv(z.uniforms.viewportOffsetScale,z.viewportOffsetScale);T.drawElements(T.TRIANGLES,z.indexCount,T.UNSIGNED_SHORT,0);z.cardboardUI&&z.cardboardUI.renderNoState();
z.realBindFramebuffer.call(z.gl,T.FRAMEBUFFER,z.framebuffer);z.ctxAttribs.preserveDrawingBuffer||(z.realClearColor.call(T,0,0,0,0),T.clear(T.COLOR_BUFFER_BIT));z.dirtySubmitFrameBindings||z.realBindFramebuffer.call(T,T.FRAMEBUFFER,z.lastBoundFramebuffer);z.cullFace&&z.realEnable.call(T,T.CULL_FACE);z.depthTest&&z.realEnable.call(T,T.DEPTH_TEST);z.blend&&z.realEnable.call(T,T.BLEND);z.scissorTest&&z.realEnable.call(T,T.SCISSOR_TEST);z.stencilTest&&z.realEnable.call(T,T.STENCIL_TEST);z.realColorMask.apply(T,
z.colorMask);z.realViewport.apply(T,z.viewport);!z.ctxAttribs.alpha&&z.ctxAttribs.preserveDrawingBuffer||z.realClearColor.apply(T,z.clearColor);z.instanceExt&&(0!=oa&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.position,oa),0!=ba&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.texCoord,ba))});bb()&&(v=v.canvas,v.width!=z.bufferWidth||v.height!=z.bufferHeight)&&(z.bufferWidth=v.width,z.bufferHeight=v.height,z.onResize())};G.prototype.updateDeviceInfo=function(v){var z=this.gl,D=this;kc(z,[z.ARRAY_BUFFER_BINDING,
z.ELEMENT_ARRAY_BUFFER_BINDING],function(T){var oa=D.computeMeshVertices_(D.meshWidth,D.meshHeight,v);T.bindBuffer(T.ARRAY_BUFFER,D.vertexBuffer);T.bufferData(T.ARRAY_BUFFER,oa,T.STATIC_DRAW);D.indexCount||(oa=D.computeMeshIndices_(D.meshWidth,D.meshHeight),T.bindBuffer(T.ELEMENT_ARRAY_BUFFER,D.indexBuffer),T.bufferData(T.ELEMENT_ARRAY_BUFFER,oa,T.STATIC_DRAW),D.indexCount=oa.length)})};G.prototype.computeMeshVertices_=function(v,z,D){for(var T=new Float32Array(2*v*z*5),oa=D.getLeftEyeVisibleTanAngles(),
ba=D.getLeftEyeNoLensTanAngles(),ea=D.getLeftEyeVisibleScreenRect(ba),Ha=0,Oa=0;2>Oa;Oa++){for(var La=0;La<z;La++)for(var Ua=0;Ua<v;Ua++,Ha++){var Wa=Ua/(v-1),fb=La/(z-1),lb=Wa,zb=fb,ib=oa[0];Wa=ib+(oa[2]-ib)*Wa;ib=oa[3];var vb=ib+(oa[1]-ib)*fb;fb=Math.sqrt(Wa*Wa+vb*vb);ib=D.distortion.distortInverse(fb);vb=vb*ib/fb;Wa=(Wa*ib/fb-ba[0])/(ba[2]-ba[0]);fb=(vb-ba[3])/(ba[1]-ba[3]);Wa=2*(ea.x+Wa*ea.width-.5);fb=2*(ea.y+fb*ea.height-.5);T[5*Ha]=Wa;T[5*Ha+1]=fb;T[5*Ha+2]=lb;T[5*Ha+3]=zb;T[5*Ha+4]=Oa}La=
oa[2]-oa[0];oa[0]=-(La+oa[0]);oa[2]=La-oa[2];La=ba[2]-ba[0];ba[0]=-(La+ba[0]);ba[2]=La-ba[2];ea.x=1-(ea.x+ea.width)}return T};G.prototype.computeMeshIndices_=function(v,z){for(var D=new Uint16Array(2*(v-1)*(z-1)*6),T=v/2,oa=z/2,ba=0,ea=0,Ha=0;2>Ha;Ha++)for(var Oa=0;Oa<z;Oa++)for(var La=0;La<v;La++,ba++)0!=La&&0!=Oa&&(La<=T==Oa<=oa?(D[ea++]=ba,D[ea++]=ba-v-1,D[ea++]=ba-v,D[ea++]=ba-v-1,D[ea++]=ba,D[ea++]=ba-1):(D[ea++]=ba-1,D[ea++]=ba-v,D[ea++]=ba,D[ea++]=ba-v,D[ea++]=ba-1,D[ea++]=ba-v-1));return D};
G.prototype.getOwnPropertyDescriptor_=function(v,z){v=Object.getOwnPropertyDescriptor(v,z);if(void 0===v.get||void 0===v.set)v.configurable=!0,v.enumerable=!0,v.get=function(){return this.getAttribute(z)},v.set=function(D){this.setAttribute(z,D)};return v};var Cc=Math.PI/180;H.prototype.destroy=function(){var v=this.gl;this.listener&&v.canvas.removeEventListener("click",this.listener,!1);v.deleteProgram(this.program);v.deleteBuffer(this.vertexBuffer)};H.prototype.listen=function(v,z){var D=this.gl.canvas;
this.listener=function(T){var oa=D.clientWidth/2,ba=T.touches?T.touches[0].clientX:T.clientX,ea=T.touches?T.touches[0].clientY:T.clientY;ba>oa-42&&ba<oa+42&&ea>D.clientHeight-42?v(T):42>ba&&42>ea&&z(T)};D.addEventListener("click",this.listener,!1);D.addEventListener("touchstart",this.listener,!1)};H.prototype.onResize=function(){var v=this.gl,z=this;kc(v,[v.ARRAY_BUFFER_BINDING],function(D){function T(lb,zb){var ib=(90-lb)*Cc;lb=Math.cos(ib);ib=Math.sin(ib);ba.push(.3125*lb*Ua+ea,.3125*ib*Ua+Ua);
ba.push(zb*lb*Ua+ea,zb*ib*Ua+Ua)}function oa(lb,zb){ba.push(Wa+lb,D.drawingBufferHeight-Wa-zb)}var ba=[],ea=D.drawingBufferWidth/2,Ha=D.drawingBufferWidth/(Math.max(screen.width,screen.height)*window.devicePixelRatio)*window.devicePixelRatio,Oa=4*Ha/2,La=42*Ha,Ua=28*Ha/2,Wa=14*Ha;ba.push(ea-Oa,La);ba.push(ea-Oa,D.drawingBufferHeight);ba.push(ea+Oa,La);ba.push(ea+Oa,D.drawingBufferHeight);z.gearOffset=ba.length/2;for(La=0;6>=La;La++){var fb=60*La;T(fb,1);T(fb+12,1);T(fb+20,.75);T(fb+40,.75);T(fb+48,
1)}z.gearVertexCount=ba.length/2-z.gearOffset;z.arrowOffset=ba.length/2;La=Oa/Math.sin(45*Cc);oa(0,Ua);oa(Ua,0);oa(Ua+La,La);oa(La,Ua+La);oa(La,Ua-La);oa(0,Ua);oa(Ua,2*Ua);oa(Ua+La,2*Ua-La);oa(La,Ua-La);oa(0,Ua);oa(La,Ua-Oa);oa(28*Ha,Ua-Oa);oa(La,Ua+Oa);oa(28*Ha,Ua+Oa);z.arrowVertexCount=ba.length/2-z.arrowOffset;D.bindBuffer(D.ARRAY_BUFFER,z.vertexBuffer);D.bufferData(D.ARRAY_BUFFER,new Float32Array(ba),D.STATIC_DRAW)})};H.prototype.render=function(){var v=this.gl,z=this;kc(v,[v.CULL_FACE,v.DEPTH_TEST,
v.BLEND,v.SCISSOR_TEST,v.STENCIL_TEST,v.COLOR_WRITEMASK,v.VIEWPORT,v.CURRENT_PROGRAM,v.ARRAY_BUFFER_BINDING],function(D){D.disable(D.CULL_FACE);D.disable(D.DEPTH_TEST);D.disable(D.BLEND);D.disable(D.SCISSOR_TEST);D.disable(D.STENCIL_TEST);D.colorMask(!0,!0,!0,!0);D.viewport(0,0,D.drawingBufferWidth,D.drawingBufferHeight);z.renderNoState()})};H.prototype.renderNoState=function(){var v=this.gl;v.useProgram(this.program);v.bindBuffer(v.ARRAY_BUFFER,this.vertexBuffer);v.enableVertexAttribArray(this.attribs.position);
v.vertexAttribPointer(this.attribs.position,2,v.FLOAT,!1,8,0);v.uniform4f(this.uniforms.color,1,1,1,1);var z=this.projMat,D=v.drawingBufferWidth,T=v.drawingBufferHeight,oa=1/(0-D),ba=1/(0-T),ea=1/-1023.9;z[0]=-2*oa;z[1]=0;z[2]=0;z[3]=0;z[4]=0;z[5]=-2*ba;z[6]=0;z[7]=0;z[8]=0;z[9]=0;z[10]=2*ea;z[11]=0;z[12]=(0+D)*oa;z[13]=(T+0)*ba;z[14]=1024.1*ea;z[15]=1;v.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat);v.drawArrays(v.TRIANGLE_STRIP,0,4);v.drawArrays(v.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount);
v.drawArrays(v.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};da.prototype.distortInverse=function(v){for(var z=0,D=1,T=v-this.distort(z);1E-4<Math.abs(D-z);){var oa=v-this.distort(D);T=D-(D-z)/(oa-T)*oa;z=D;D=T;T=oa}return D};da.prototype.distort=function(v){for(var z=v*v,D=0,T=0;T<this.coefficients.length;T++)D=z*(D+this.coefficients[T]);return(D+1)*v};var Fb=Math.PI/180,Gb=180/Math.PI,yb=function(v,z,D){this.x=v||0;this.y=z||0;this.z=D||0};yb.prototype={constructor:yb,set:function(v,z,
D){this.x=v;this.y=z;this.z=D;return this},copy:function(v){this.x=v.x;this.y=v.y;this.z=v.z;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var v=this.length();0!==v?this.multiplyScalar(1/v):this.z=this.y=this.x=0;return this},multiplyScalar:function(v){this.x*=v;this.y*=v;this.z*=v},applyQuaternion:function(v){var z=this.x,D=this.y,T=this.z,oa=v.x,ba=v.y,ea=v.z;v=v.w;var Ha=v*z+ba*T-ea*D,Oa=v*D+ea*z-oa*T,La=v*T+oa*D-ba*z;z=-oa*z-ba*
D-ea*T;this.x=Ha*v+z*-oa+Oa*-ea-La*-ba;this.y=Oa*v+z*-ba+La*-oa-Ha*-ea;this.z=La*v+z*-ea+Ha*-ba-Oa*-oa;return this},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z},crossVectors:function(v,z){var D=v.x,T=v.y;v=v.z;var oa=z.x,ba=z.y;z=z.z;this.x=T*z-v*ba;this.y=v*oa-D*z;this.z=D*ba-T*oa;return this}};var kb=function(v,z,D,T){this.x=v||0;this.y=z||0;this.z=D||0;this.w=void 0!==T?T:1};kb.prototype={constructor:kb,set:function(v,z,D,T){this.x=v;this.y=z;this.z=D;this.w=T;return this},copy:function(v){this.x=
v.x;this.y=v.y;this.z=v.z;this.w=v.w;return this},setFromEulerXYZ:function(v,z,D){var T=Math.cos(v/2),oa=Math.cos(z/2),ba=Math.cos(D/2);v=Math.sin(v/2);z=Math.sin(z/2);D=Math.sin(D/2);this.x=v*oa*ba+T*z*D;this.y=T*z*ba-v*oa*D;this.z=T*oa*D+v*z*ba;this.w=T*oa*ba-v*z*D;return this},setFromEulerYXZ:function(v,z,D){var T=Math.cos(v/2),oa=Math.cos(z/2),ba=Math.cos(D/2);v=Math.sin(v/2);z=Math.sin(z/2);D=Math.sin(D/2);this.x=v*oa*ba+T*z*D;this.y=T*z*ba-v*oa*D;this.z=T*oa*D-v*z*ba;this.w=T*oa*ba+v*z*D;return this},
setFromAxisAngle:function(v,z){z/=2;var D=Math.sin(z);this.x=v.x*D;this.y=v.y*D;this.z=v.z*D;this.w=Math.cos(z);return this},multiply:function(v){return this.multiplyQuaternions(this,v)},multiplyQuaternions:function(v,z){var D=v.x,T=v.y,oa=v.z;v=v.w;var ba=z.x,ea=z.y,Ha=z.z;z=z.w;this.x=D*z+v*ba+T*Ha-oa*ea;this.y=T*z+v*ea+oa*ba-D*Ha;this.z=oa*z+v*Ha+D*ea-T*ba;this.w=v*z-D*ba-T*ea-oa*Ha;return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;this.normalize();return this},normalize:function(){var v=
Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===v?(this.z=this.y=this.x=0,this.w=1):(v=1/v,this.x*=v,this.y*=v,this.z*=v,this.w*=v);return this},slerp:function(v,z){if(0===z)return this;if(1===z)return this.copy(v);var D=this.x,T=this.y,oa=this.z,ba=this.w,ea=ba*v.w+D*v.x+T*v.y+oa*v.z;0>ea?(this.w=-v.w,this.x=-v.x,this.y=-v.y,this.z=-v.z,ea=-ea):this.copy(v);if(1<=ea)return this.w=ba,this.x=D,this.y=T,this.z=oa,this;v=Math.acos(ea);var Ha=Math.sqrt(1-ea*ea);if(.001>Math.abs(Ha))return this.w=
.5*(ba+this.w),this.x=.5*(D+this.x),this.y=.5*(T+this.y),this.z=.5*(oa+this.z),this;ea=Math.sin((1-z)*v)/Ha;z=Math.sin(z*v)/Ha;this.w=ba*ea+this.w*z;this.x=D*ea+this.x*z;this.y=T*ea+this.y*z;this.z=oa*ea+this.z*z;return this},setFromUnitVectors:function(){var v,z;return function(D,T){void 0===v&&(v=new yb);z=D.dot(T)+1;1E-6>z?(z=0,Math.abs(D.x)>Math.abs(D.z)?v.set(-D.y,D.x,0):v.set(0,-D.z,D.y)):v.crossVectors(D,T);this.x=v.x;this.y=v.y;this.z=v.z;this.w=z;this.normalize();return this}}()};var Rc=
new ua({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),Sc=new ua({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),qc={CardboardV1:new Ka({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new Ka({id:"CardboardV2",label:"Cardboard I/O 2015",
fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-9.904169E-4,6.183535E-5,-1.6981803E-6]})};va.prototype.updateDeviceParams=function(v){this.device=this.determineDevice_(v)||this.device};va.prototype.getDevice=function(){return this.device};va.prototype.setViewer=function(v){this.viewer=v;this.distortion=new da(this.viewer.distortionCoefficients)};
va.prototype.determineDevice_=function(v){if(!v){if(bb())return console.warn("Using fallback iOS device measurements."),Sc;console.warn("Using fallback Android device measurements.");return Rc}var z=.0254/v.xdpi,D=.0254/v.ydpi,T=Xb(),oa=Yb();return new ua({widthMeters:z*T,heightMeters:D*oa,bevelMeters:.001*v.bevelMm})};va.prototype.getDistortedFieldOfViewLeftEye=function(){var v=this.viewer,z=this.device,D=this.distortion,T=v.screenLensDistance,oa=v.interLensDistance/2,ba=v.baselineLensDistance-z.bevelMeters,
ea=z.heightMeters-ba;z=Gb*Math.atan(D.distort((z.widthMeters-v.interLensDistance)/2/T));oa=Gb*Math.atan(D.distort(oa/T));ba=Gb*Math.atan(D.distort(ba/T));D=Gb*Math.atan(D.distort(ea/T));return{leftDegrees:Math.min(z,v.fov),rightDegrees:Math.min(oa,v.fov),downDegrees:Math.min(ba,v.fov),upDegrees:Math.min(D,v.fov)}};va.prototype.getLeftEyeVisibleTanAngles=function(){var v=this.viewer,z=this.device,D=this.distortion,T=Math.tan(-Fb*v.fov),oa=Math.tan(Fb*v.fov),ba=Math.tan(Fb*v.fov),ea=Math.tan(-Fb*v.fov),
Ha=z.widthMeters/4,Oa=z.heightMeters/2,La=v.interLensDistance/2-Ha,Ua=-(v.baselineLensDistance-z.bevelMeters-Oa),Wa=v.screenLensDistance;v=D.distort((La-Ha)/Wa);z=D.distort((Ua+Oa)/Wa);Ha=D.distort((La+Ha)/Wa);D=D.distort((Ua-Oa)/Wa);Oa=new Float32Array(4);Oa[0]=Math.max(T,v);Oa[1]=Math.min(oa,z);Oa[2]=Math.min(ba,Ha);Oa[3]=Math.max(ea,D);return Oa};va.prototype.getLeftEyeNoLensTanAngles=function(){var v=this.viewer,z=this.device,D=this.distortion,T=new Float32Array(4),oa=D.distortInverse(Math.tan(-Fb*
v.fov)),ba=D.distortInverse(Math.tan(Fb*v.fov)),ea=D.distortInverse(Math.tan(Fb*v.fov));D=D.distortInverse(Math.tan(-Fb*v.fov));var Ha=z.widthMeters/4,Oa=z.heightMeters/2,La=v.interLensDistance/2-Ha;z=-(v.baselineLensDistance-z.bevelMeters-Oa);v=v.screenLensDistance;T[0]=Math.max(oa,(La-Ha)/v);T[1]=Math.min(ba,(z+Oa)/v);T[2]=Math.min(ea,(La+Ha)/v);T[3]=Math.max(D,(z-Oa)/v);return T};va.prototype.getLeftEyeVisibleScreenRect=function(v){var z=this.viewer,D=this.device,T=z.screenLensDistance,oa=(D.widthMeters-
z.interLensDistance)/2;z=z.baselineLensDistance-D.bevelMeters;var ba=(v[0]*T+oa)/D.widthMeters,ea=(v[3]*T+z)/D.heightMeters;return{x:ba,y:ea,width:(v[2]*T+oa)/D.widthMeters-ba,height:(v[1]*T+z)/D.heightMeters-ea}};va.prototype.getFieldOfViewLeftEye=function(v){return v?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()};va.prototype.getFieldOfViewRightEye=function(v){v=this.getFieldOfViewLeftEye(v);return{leftDegrees:v.rightDegrees,rightDegrees:v.leftDegrees,upDegrees:v.upDegrees,
downDegrees:v.downDegrees}};va.prototype.getUndistortedFieldOfViewLeftEye=function(){var v=this.getUndistortedParams_();return{leftDegrees:Gb*Math.atan(v.outerDist),rightDegrees:Gb*Math.atan(v.innerDist),downDegrees:Gb*Math.atan(v.bottomDist),upDegrees:Gb*Math.atan(v.topDist)}};va.prototype.getUndistortedViewportLeftEye=function(){var v=this.getUndistortedParams_(),z=this.device,D=this.viewer.screenLensDistance,T=z.width/(z.widthMeters/D);z=z.height/(z.heightMeters/D);D=Math.round((v.eyePosX-v.outerDist)*
T);var oa=Math.round((v.eyePosY-v.bottomDist)*z);return{x:D,y:oa,width:Math.round((v.eyePosX+v.innerDist)*T)-D,height:Math.round((v.eyePosY+v.topDist)*z)-oa}};va.prototype.getUndistortedParams_=function(){var v=this.viewer,z=this.device,D=v.screenLensDistance,T=v.interLensDistance/2/D,oa=z.heightMeters/D,ba=z.widthMeters/D/2-T;z=(v.baselineLensDistance-z.bevelMeters)/D;v=this.distortion.distortInverse(Math.tan(Fb*v.fov));return{outerDist:Math.min(ba,v),innerDist:Math.min(T,v),topDist:Math.min(oa-
z,v),bottomDist:Math.min(z,v),eyePosX:ba,eyePosY:z}};va.Viewers=qc;var Kc={format:1,last_updated:"2019-11-09T17:36:14Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1E3},
{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},
{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],
dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],
bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},
{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},
{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,
316.1],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},
{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},
{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},
{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},
{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],
dpi:[196.7,205.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,
437.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,
431.6],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],
bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,
256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,
bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,
518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},
{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],
dpi:307.9,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1E3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1E3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[1125,2001]}],
dpi:[410.9,415.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],
dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}]};Xa.prototype.getDeviceParams=function(){return this.deviceParams};Xa.prototype.recalculateDeviceParams_=function(){var v=this.calcDeviceParams_();
if(v){if(this.deviceParams=v,this.onDeviceParamsUpdated)this.onDeviceParamsUpdated(this.deviceParams)}else console.error("Failed to recalculate device parameters.")};Xa.prototype.calcDeviceParams_=function(){var v=this.dpdb;if(!v)return console.error("DPDB not available."),null;if(1!=v.format)return console.error("DPDB has unexpected format version."),null;if(!v.devices||!v.devices.length)return console.error("DPDB does not have a devices section."),null;var z=navigator.userAgent||navigator.vendor||
window.opera,D=Xb(),T=Yb();if(!v.devices)return console.error("DPDB has no devices section."),null;for(var oa=0;oa<v.devices.length;oa++){var ba=v.devices[oa];if(!ba.rules)console.warn("Device["+oa+"] has no rules section.");else if("ios"!=ba.type&&"android"!=ba.type)console.warn("Device["+oa+"] has invalid type.");else if(bb()==("ios"==ba.type)){for(var ea=!1,Ha=0;Ha<ba.rules.length;Ha++)if(this.ruleMatches_(ba.rules[Ha],z,D,T)){ea=!0;break}if(ea)return new $a({xdpi:ba.dpi[0]||ba.dpi,ydpi:ba.dpi[1]||
ba.dpi,bevelMm:ba.bw})}}console.warn("No DPDB device match.");return null};Xa.prototype.ruleMatches_=function(v,z,D,T){if(!v.ua&&!v.res)return!1;v.ua&&"SM"===v.ua.substring(0,2)&&(v.ua=v.ua.substring(0,7));if(v.ua&&0>z.indexOf(v.ua))return!1;if(v.res){if(!v.res[0]||!v.res[1])return!1;z=v.res[0];v=v.res[1];if(Math.min(D,T)!=Math.min(z,v)||Math.max(D,T)!=Math.max(z,v))return!1}return!0};Za.prototype.set=function(v,z){this.sample=v;this.timestampS=z};Za.prototype.copy=function(v){this.set(v.sample,v.timestampS)};
jb.prototype.addAccelMeasurement=function(v,z){this.currentAccelMeasurement.set(v,z)};jb.prototype.addGyroMeasurement=function(v,z){this.currentGyroMeasurement.set(v,z);v=z-this.previousGyroMeasurement.timestampS;isNaN(v)||.001>=v||1<v||this.run_();this.previousGyroMeasurement.copy(this.currentGyroMeasurement)};jb.prototype.run_=function(){if(this.isOrientationInitialized){var v=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS);
this.gyroIntegralQ.multiply(v);this.filterQ.copy(this.previousFilterQ);this.filterQ.multiply(v);v=new kb;v.copy(this.filterQ);v.inverse();this.estimatedGravity.set(0,0,-1);this.estimatedGravity.applyQuaternion(v);this.estimatedGravity.normalize();this.measuredGravity.copy(this.currentAccelMeasurement.sample);this.measuredGravity.normalize();v=new kb;v.setFromUnitVectors(this.estimatedGravity,this.measuredGravity);v.inverse();if(this.isDebug){var z=console,D=z.log;if(1<v.w){console.warn("getQuaternionAngle: w > 1");
var T=0}else T=2*Math.acos(v.w);D.call(z,"Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",Gb*T,this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1))}z=new kb;z.copy(this.filterQ);z.multiply(v);this.filterQ.slerp(z,1-this.kFilter);this.previousFilterQ.copy(this.filterQ)}else this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),
this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0};jb.prototype.getOrientation=function(){return this.filterQ};jb.prototype.accelToQuaternion_=function(v){var z=new yb;z.copy(v);z.normalize();v=new kb;v.setFromUnitVectors(new yb(0,0,-1),z);v.inverse();return v};jb.prototype.gyroToQuaternionDelta_=function(v,z){var D=new kb,T=new yb;T.copy(v);T.normalize();D.setFromAxisAngle(T,v.length()*z);return D};wb.prototype.getPrediction=function(v,z,D){if(!this.previousTimestampS)return this.previousQ.copy(v),
this.previousTimestampS=D,v;var T=new yb;T.copy(z);T.normalize();z=z.length();if(z<20*Fb)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(Gb*z).toFixed(1)),this.outQ.copy(v),this.previousQ.copy(v),this.outQ;this.deltaQ.setFromAxisAngle(T,z*this.predictionTimeS);this.outQ.copy(this.previousQ);this.outQ.multiply(this.deltaQ);this.previousQ.copy(v);this.previousTimestampS=D;return this.outQ};ob.prototype.getPosition=function(){return null};ob.prototype.getOrientation=function(){var v=
void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var D=(new kb).setFromAxisAngle(new yb(0,0,-1),0),T=new kb;-90===window.orientation?T.setFromAxisAngle(new yb(0,1,0),Math.PI/-2):T.setFromAxisAngle(new yb(0,1,0),Math.PI/2);return D.multiply(T)}();this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var D=new kb;D.setFromAxisAngle(new yb(1,0,0),-Math.PI/2);return D}();v=this._deviceOrientationQ;
var z=new kb;z.copy(v);z.multiply(this.deviceOrientationFilterToWorldQ);z.multiply(this.resetQ);z.multiply(this.worldToScreenQ);z.multiplyQuaternions(this.deviceOrientationFixQ,z);this.yawOnly&&(z.x=0,z.z=0,z.normalize());this.orientationOut_[0]=z.x;this.orientationOut_[1]=z.y;this.orientationOut_[2]=z.z;this.orientationOut_[3]=z.w;return this.orientationOut_}v=this.filter.getOrientation();v=this.posePredictor.getPrediction(v,this.gyroscope,this.previousTimestampS);z=new kb;z.copy(this.filterToWorldQ);
z.multiply(this.resetQ);z.multiply(v);z.multiply(this.worldToScreenQ);this.yawOnly&&(z.x=0,z.z=0,z.normalize());this.orientationOut_[0]=z.x;this.orientationOut_[1]=z.y;this.orientationOut_[2]=z.z;this.orientationOut_[3]=z.w;return this.orientationOut_};ob.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation());this.resetQ.x=0;this.resetQ.y=0;this.resetQ.z*=-1;this.resetQ.normalize();ub()&&this.resetQ.multiply(this.inverseWorldToScreenQ);this.resetQ.multiply(this.originalPoseAdjustQ)};
ob.prototype.onDeviceOrientation_=function(v){this._deviceOrientationQ=this._deviceOrientationQ||new kb;var z=v.alpha,D=v.beta;v=v.gamma;z=(z||0)*Math.PI/180;D=(D||0)*Math.PI/180;v=(v||0)*Math.PI/180;this._deviceOrientationQ.setFromEulerYXZ(D,z,-v)};ob.prototype.onDeviceMotion_=function(v){this.updateDeviceMotion_(v)};ob.prototype.updateDeviceMotion_=function(v){var z=v.accelerationIncludingGravity,D=v.rotationRate;v=v.timeStamp/1E3;var T=v-this.previousTimestampS;0>T?tc("fusion-pose-sensor:invalid:non-monotonic",
"Invalid timestamps detected: non-monotonic timestamp from devicemotion"):.001>=T||1<T?tc("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."):(this.accelerometer.set(-z.x,-z.y,-z.z),D&&(Mb()?this.gyroscope.set(-D.beta,D.alpha,D.gamma):this.gyroscope.set(D.alpha,D.beta,D.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,v)),this.filter.addAccelMeasurement(this.accelerometer,
v));this.previousTimestampS=v};ob.prototype.onOrientationChange_=function(v){this.setScreenTransform_()};ob.prototype.onMessage_=function(v){(v=v.data)&&v.type&&"devicemotion"===v.type.toLowerCase()&&this.updateDeviceMotion_(v.deviceMotionEvent)};ob.prototype.setScreenTransform_=function(){this.worldToScreenQ.set(0,0,0,1);switch(window.orientation){case 90:this.worldToScreenQ.setFromAxisAngle(new yb(0,0,1),-Math.PI/2);break;case -90:this.worldToScreenQ.setFromAxisAngle(new yb(0,0,1),Math.PI/2)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ);
this.inverseWorldToScreenQ.inverse()};ob.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this);this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this);this.onMessageCallback_=this.onMessage_.bind(this);this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this);var v;if(v=bb()){v=window.self!==window.top;var z=Bc(document.referrer),D=Bc(window.location.href);v=v&&z!==D}v&&window.addEventListener("message",this.onMessageCallback_);window.addEventListener("orientationchange",
this.onOrientationChangeCallback_);this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)};ob.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_);window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_);window.removeEventListener("orientationchange",this.onOrientationChangeCallback_);window.removeEventListener("message",
this.onMessageCallback_)};var Tc=new yb(1,0,0),Uc=new yb(0,0,1),uc=new kb;uc.setFromAxisAngle(Tc,-Math.PI/2);uc.multiply((new kb).setFromAxisAngle(Uc,Math.PI/2));var Oc=function(){function v(z){if(!(this instanceof v))throw new TypeError("Cannot call a class as a function");this.config=z;this.fusionSensor=this.sensor=null;this._out=new Float32Array(4);this.api=null;this.errors=[];this._sensorQ=new kb;this._outQ=new kb;this._onSensorRead=this._onSensorRead.bind(this);this._onSensorError=this._onSensorError.bind(this);
this.init()}qb(v,[{key:"init",value:function(){var z=null;try{z=new RelativeOrientationSensor({frequency:60,referenceFrame:"screen"}),z.addEventListener("error",this._onSensorError)}catch(D){this.errors.push(D),"SecurityError"===D.name?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):"ReferenceError"===D.name?this.useDeviceMotion():
console.error(D)}z&&(this.api="sensor",this.sensor=z,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion";this.fusionSensor=new ob(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG);this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();
if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var z=this.sensor.quaternion;this._sensorQ.set(z[0],z[1],z[2],z[3]);z=this._outQ;z.copy(uc);z.multiply(this._sensorQ);this.config.YAW_ONLY&&(z.x=z.z=0,z.normalize());this._out[0]=z.x;this._out[1]=z.y;this._out[2]=z.z;this._out[3]=z.w;return this._out}},{key:"_onSensorError",value:function(z){this.errors.push(z.error);"NotAllowedError"===z.error.name?console.error("Permission to access sensor was denied"):
"NotReadableError"===z.error.name?console.error("Sensor could not be read"):console.error(z.error);this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]);return v}();pb.prototype.show=function(v){v||this.overlay.parentElement?v&&(this.overlay.parentElement&&this.overlay.parentElement!=v&&this.overlay.parentElement.removeChild(this.overlay),v.appendChild(this.overlay)):document.body.appendChild(this.overlay);this.overlay.style.display="block";v=this.overlay.querySelector("img").style;
ub()?(v.width="20%",v.marginLeft="40%",v.marginTop="3%"):(v.width="50%",v.marginLeft="25%",v.marginTop="25%")};pb.prototype.hide=function(){this.overlay.style.display="none"};pb.prototype.showTemporarily=function(v,z){this.show(z);this.timer=setTimeout(this.hide.bind(this),v)};pb.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)};pb.prototype.update=function(){this.disableShowTemporarily();!ub()&&rc()?this.show():this.hide()};pb.prototype.loadIcon_=function(){this.icon="data:image/svg+xml,"+
encodeURIComponent("<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>")};
nb.prototype.show=function(v){this.root=v;v.appendChild(this.dialog);this.dialog.querySelector("#"+this.selectedKey).checked=!0;this.dialog.style.display="block"};nb.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog);this.dialog.style.display="none"};nb.prototype.getCurrentViewer=function(){return va.Viewers[this.selectedKey]};nb.prototype.getSelectedKey_=function(){var v=this.dialog.querySelector("input[name=field]:checked");return v?v.id:null};
nb.prototype.onChange=function(v){this.onChangeCallbacks_.push(v)};nb.prototype.fireOnChange_=function(v){for(var z=0;z<this.onChangeCallbacks_.length;z++)this.onChangeCallbacks_[z](v)};nb.prototype.onSave_=function(){if((this.selectedKey=this.getSelectedKey_())&&va.Viewers[this.selectedKey]){this.fireOnChange_(va.Viewers[this.selectedKey]);try{localStorage.setItem("WEBVR_CARDBOARD_VIEWER",this.selectedKey)}catch(v){console.error("Failed to save viewer profile: %s",v)}this.hide()}else console.error("ViewerSelector.onSave_: this should never happen!")};
nb.prototype.createDialog_=function(v){var z=document.createElement("div");z.classList.add("webvr-polyfill-viewer-selector");z.style.display="none";var D=document.createElement("div"),T=D.style;T.position="fixed";T.left=0;T.top=0;T.width="100%";T.height="100%";T.background="rgba(0, 0, 0, 0.3)";D.addEventListener("click",this.hide.bind(this));var oa=document.createElement("div");T=oa.style;T.boxSizing="border-box";T.position="fixed";T.top="24px";T.left="50%";T.marginLeft="-140px";T.width="280px";T.padding=
"24px";T.overflow="hidden";T.background="#fafafa";T.fontFamily="'Roboto', sans-serif";T.boxShadow="0px 5px 20px #666";oa.appendChild(this.createH1_("Select your viewer"));for(var ba in v)oa.appendChild(this.createChoice_(ba,v[ba].label));oa.appendChild(this.createButton_("Save",this.onSave_.bind(this)));z.appendChild(D);z.appendChild(oa);return z};nb.prototype.createH1_=function(v){var z=document.createElement("h1"),D=z.style;D.color="black";D.fontSize="20px";D.fontWeight="bold";D.marginTop=0;D.marginBottom=
"24px";z.innerHTML=v;return z};nb.prototype.createChoice_=function(v,z){var D=document.createElement("div");D.style.marginTop="8px";D.style.color="black";var T=document.createElement("input");T.style.fontSize="30px";T.setAttribute("id",v);T.setAttribute("type","radio");T.setAttribute("value",v);T.setAttribute("name","field");var oa=document.createElement("label");oa.style.marginLeft="4px";oa.setAttribute("for",v);oa.innerHTML=z;D.appendChild(T);D.appendChild(oa);return D};nb.prototype.createButton_=
function(v,z){var D=document.createElement("button");D.innerHTML=v;v=D.style;v.float="right";v.textTransform="uppercase";v.color="#1094f7";v.fontSize="14px";v.letterSpacing=0;v.border=0;v.background="none";v.marginTop="16px";D.addEventListener("click",z);return D};var Vc="undefined"!==typeof window?window:"undefined"!==typeof Nb?Nb:"undefined"!==typeof self?self:{},Mc=function(v){return v&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v["default"]:v}(function(v,z){return z={exports:{}},
v(z,z.exports),z.exports}(function(v,z){(function(D,T){v.exports=T()})(Vc,function(){return function(D){function T(ba){if(oa[ba])return oa[ba].exports;var ea=oa[ba]={i:ba,l:!1,exports:{}};D[ba].call(ea.exports,ea,ea.exports,T);ea.l=!0;return ea.exports}var oa={};T.m=D;T.c=oa;T.d=function(ba,ea,Ha){T.o(ba,ea)||Object.defineProperty(ba,ea,{configurable:!1,enumerable:!0,get:Ha})};T.n=function(ba){var ea=ba&&ba.__esModule?function(){return ba["default"]}:function(){return ba};T.d(ea,"a",ea);return ea};
T.o=function(ba,ea){return Object.prototype.hasOwnProperty.call(ba,ea)};T.p="";return T(T.s=0)}([function(D,T,oa){var ba=function(){function Oa(La,Ua){for(var Wa=0;Wa<Ua.length;Wa++){var fb=Ua[Wa];fb.enumerable=fb.enumerable||!1;fb.configurable=!0;"value"in fb&&(fb.writable=!0);Object.defineProperty(La,fb.key,fb)}}return function(La,Ua,Wa){Ua&&Oa(La.prototype,Ua);Wa&&Oa(La,Wa);return La}}(),ea=oa(1),Ha="undefined"!==typeof navigator&&10>parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||
[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))&&!window.MSStream;T=function(){function Oa(){if(!(this instanceof Oa))throw new TypeError("Cannot call a class as a function");Ha?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",ea),this.noSleepVideo.addEventListener("timeupdate",function(La){.5<this.noSleepVideo.currentTime&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}
ba(Oa,[{key:"enable",value:function(){Ha?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/";window.setTimeout(window.stop,0)},15E3)):this.noSleepVideo.play()}},{key:"disable",value:function(){Ha?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]);return Oa}();D.exports=T},function(D,T,oa){D.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})})),
Lc=1E3,Wc=[0,0,.5,1],Xc=[.5,0,.5,1],Yc=window.requestAnimationFrame,Zc=window.cancelAnimationFrame;hb.prototype.getFrameData=function(v){return Qc(v,this._getPose(),this)};hb.prototype.getPose=function(){Sb("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData");return this._getPose()};hb.prototype.resetPose=function(){Sb("VRDisplay.prototype.resetPose");return this._resetPose()};hb.prototype.getImmediatePose=function(){Sb("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData");
return this._getPose()};hb.prototype.requestAnimationFrame=function(v){return Yc(v)};hb.prototype.cancelAnimationFrame=function(v){return Zc(v)};hb.prototype.wrapForFullscreen=function(v){if(bb())return v;this.fullscreenWrapper_||(this.fullscreenWrapper_=document.createElement("div"),this.fullscreenWrapper_.setAttribute("style",["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important; left: 0 !important; right: 0 !important; border: 0; margin: 0; padding: 0; z-index: 999999 !important; position: fixed"].join("; ")+
";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper"));if(this.fullscreenElement_==v)return this.fullscreenWrapper_;this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_));this.fullscreenElement_=v;(this.originalParent_=v.parentElement)||document.body.appendChild(v);this.fullscreenWrapper_.parentElement||(v=this.fullscreenElement_.parentElement,v.insertBefore(this.fullscreenWrapper_,
this.fullscreenElement_),v.removeChild(this.fullscreenElement_));this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild);this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");this.fullscreenElement_&&this.fullscreenElement_.setAttribute("style",["position: absolute; top: 0; left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0; margin: 0; padding: 0"].join("; ")+
";");return this.fullscreenWrapper_};hb.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var v=this.fullscreenElement_;this.fullscreenElementCachedStyle_?v.setAttribute("style",this.fullscreenElementCachedStyle_):v.removeAttribute("style");this.fullscreenElementCachedStyle_=this.fullscreenElement_=null;var z=this.fullscreenWrapper_.parentElement;this.fullscreenWrapper_.removeChild(v);this.originalParent_===z?z.insertBefore(v,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(v);
z.removeChild(this.fullscreenWrapper_);return v}};hb.prototype.requestPresent=function(v){var z=this.isPresenting,D=this;v instanceof Array||(Sb("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),v=[v]);return new Promise(function(T,oa){if(D.capabilities.canPresent)if(0==v.length||v.length>D.capabilities.maxLayers)oa(Error("Invalid number of layers."));else{var ba=v[0];if(ba.source){var ea=ba.leftBounds||Wc,Ha=ba.rightBounds||Xc;if(z){var Oa=
D.layer_;Oa.source!==ba.source&&(Oa.source=ba.source);for(ba=0;4>ba;ba++)Oa.leftBounds[ba]=ea[ba],Oa.rightBounds[ba]=Ha[ba];D.wrapForFullscreen(D.layer_.source);D.updatePresent_();T()}else{D.layer_={predistorted:ba.predistorted,source:ba.source,leftBounds:ea.slice(0),rightBounds:Ha.slice(0)};D.waitingForPresent_=!1;if(D.layer_&&D.layer_.source){var La=D.wrapForFullscreen(D.layer_.source);D.addFullscreenListeners_(La,function(){D.isPresenting=La===(document.fullscreenElement||document.webkitFullscreenElement||
document.mozFullScreenElement||document.msFullscreenElement);D.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(Ua){console.error("screen.orientation.lock() failed due to",Ua.message)}),D.waitingForPresent_=!1,D.beginPresent_(),T()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),D.removeFullscreenWrapper(),D.disableWakeLock(),D.endPresent_(),D.removeFullscreenListeners_());D.fireVRDisplayPresentChange_()},
function(){D.waitingForPresent_&&(D.removeFullscreenWrapper(),D.removeFullscreenListeners_(),D.disableWakeLock(),D.waitingForPresent_=!1,D.isPresenting=!1,oa(Error("Unable to present.")))});if(Pc(La))D.enableWakeLock(),D.waitingForPresent_=!0;else if(bb()||Hb())D.enableWakeLock(),D.isPresenting=!0,D.beginPresent_(),D.fireVRDisplayPresentChange_(),T()}D.waitingForPresent_||bb()||(Ac(),oa(Error("Unable to present.")))}}else T()}else oa(Error("VRDisplay is not capable of presenting."))})};hb.prototype.exitPresent=
function(){var v=this.isPresenting,z=this;this.isPresenting=!1;this.layer_=null;this.disableWakeLock();return new Promise(function(D,T){v?(!Ac()&&bb()&&(z.endPresent_(),z.fireVRDisplayPresentChange_()),Hb()&&(z.removeFullscreenWrapper(),z.removeFullscreenListeners_(),z.endPresent_(),z.fireVRDisplayPresentChange_()),D()):T(Error("Was not presenting to VRDisplay."))})};hb.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]};hb.prototype.fireVRDisplayPresentChange_=function(){var v=new CustomEvent("vrdisplaypresentchange",
{detail:{display:this}});window.dispatchEvent(v)};hb.prototype.fireVRDisplayConnect_=function(){var v=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(v)};hb.prototype.addFullscreenListeners_=function(v,z,D){this.removeFullscreenListeners_();this.fullscreenEventTarget_=v;this.fullscreenChangeHandler_=z;this.fullscreenErrorHandler_=D;z&&(document.fullscreenEnabled?v.addEventListener("fullscreenchange",z,!1):document.webkitFullscreenEnabled?v.addEventListener("webkitfullscreenchange",
z,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",z,!1):document.msFullscreenEnabled&&v.addEventListener("msfullscreenchange",z,!1));D&&(document.fullscreenEnabled?v.addEventListener("fullscreenerror",D,!1):document.webkitFullscreenEnabled?v.addEventListener("webkitfullscreenerror",D,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",D,!1):document.msFullscreenEnabled&&v.addEventListener("msfullscreenerror",D,!1))};hb.prototype.removeFullscreenListeners_=
function(){if(this.fullscreenEventTarget_){var v=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var z=this.fullscreenChangeHandler_;v.removeEventListener("fullscreenchange",z,!1);v.removeEventListener("webkitfullscreenchange",z,!1);document.removeEventListener("mozfullscreenchange",z,!1);v.removeEventListener("msfullscreenchange",z,!1)}this.fullscreenErrorHandler_&&(z=this.fullscreenErrorHandler_,v.removeEventListener("fullscreenerror",z,!1),v.removeEventListener("webkitfullscreenerror",
z,!1),document.removeEventListener("mozfullscreenerror",z,!1),v.removeEventListener("msfullscreenerror",z,!1));this.fullscreenErrorHandler_=this.fullscreenChangeHandler_=this.fullscreenEventTarget_=null}};hb.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()};hb.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()};hb.prototype.beginPresent_=function(){};hb.prototype.endPresent_=function(){};hb.prototype.submitFrame=function(v){};hb.prototype.getEyeParameters=
function(v){return null};var Nc={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};ab.prototype=Object.create(hb.prototype);ab.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,
angularAcceleration:null}};ab.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()};ab.prototype._getFieldOfView=function(v){if("left"==v)v=this.deviceInfo_.getFieldOfViewLeftEye();else if("right"==v)v=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",v),null;return v};ab.prototype._getEyeOffset=function(v){if("left"==v)v=[.5*-this.deviceInfo_.viewer.interLensDistance,0,0];else if("right"==v)v=[.5*this.deviceInfo_.viewer.interLensDistance,
0,0];else return console.error("Invalid eye provided: %s",v),null;return v};ab.prototype.getEyeParameters=function(v){var z=this._getEyeOffset(v),D=this._getFieldOfView(v);v={offset:z,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};Object.defineProperty(v,"fieldOfView",{enumerable:!0,get:function(){Sb("VRFieldOfView","VRFrameData's projection matrices");return D}});return v};ab.prototype.onDeviceParamsUpdated_=function(v){this.config.DEBUG&&
console.log("DPDB reported that device params were updated.");this.deviceInfo_.updateDeviceParams(v);this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)};ab.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)};ab.prototype.beginPresent_=function(){var v=this.layer_.source.getContext("webgl");v||(v=this.layer_.source.getContext("experimental-webgl"));
v||(v=this.layer_.source.getContext("webgl2"));v&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(v.canvas.width=Xb()*this.bufferScale_,v.canvas.height=Yb()*this.bufferScale_,this.cardboardUI_=new H(v)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new H(v)),this.distorter_=new G(v,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(z){this.viewerSelector_.show(this.layer_.source.parentElement);
z.stopPropagation();z.preventDefault()}.bind(this),function(z){this.exitPresent();z.stopPropagation();z.preventDefault()}.bind(this)),this.rotateInstructions_&&(ub()&&rc()?this.rotateInstructions_.showTemporarily(3E3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",
this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())};ab.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null);this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null);this.rotateInstructions_&&this.rotateInstructions_.hide();this.viewerSelector_.hide();window.removeEventListener("orientationchange",this.orientationHandler);window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)};ab.prototype.updatePresent_=
function(){this.endPresent_();this.beginPresent_()};ab.prototype.submitFrame=function(v){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){(v=this.layer_.source.getContext("webgl"))||(v=this.layer_.source.getContext("experimental-webgl"));v||(v=this.layer_.source.getContext("webgl2"));v=v.canvas;if(v.width!=this.lastWidth||v.height!=this.lastHeight)this.cardboardUI_.onResize();this.lastWidth=v.width;this.lastHeight=v.height;this.cardboardUI_.render()}};
ab.prototype.onOrientationChange_=function(v){this.viewerSelector_.hide();this.rotateInstructions_&&this.rotateInstructions_.update();this.onResize_()};ab.prototype.onResize_=function(v){this.layer_&&((v=this.layer_.source.getContext("webgl"))||(v=this.layer_.source.getContext("experimental-webgl")),v||(v=this.layer_.source.getContext("webgl2")),v.canvas.setAttribute("style","position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; border: 0; margin: 0; padding: 0px; box-sizing: content-box;"),
sc(v.canvas))};ab.prototype.onViewerChanged_=function(v){this.deviceInfo_.setViewer(v);this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_);this.fireVRDisplayDeviceParamsChange_()};ab.prototype.fireVRDisplayDeviceParamsChange_=function(){var v=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(v)};ab.VRFrameData=function(){this.leftProjectionMatrix=new Float32Array(16);this.leftViewMatrix=new Float32Array(16);this.rightProjectionMatrix=
new Float32Array(16);this.rightViewMatrix=new Float32Array(16);this.pose=null};ab.VRDisplay=hb;return ab})})),sb=function(t){var y=R.call(this)||this;y.global=t;y.onWindowResize=y.onWindowResize.bind(y);y.global.window.addEventListener("resize",y.onWindowResize);y.environmentBlendMode="opaque";return y};$jscomp.inherits(sb,R);sb.prototype.onBaseLayerSet=function(t,y){throw Error("Not implemented");};sb.prototype.isSessionSupported=function(t){throw Error("Not implemented");};sb.prototype.isFeatureSupported=
function(t){throw Error("Not implemented");};sb.prototype.requestSession=function(t,y){return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){throw Error("Not implemented");})};sb.prototype.requestAnimationFrame=function(t){throw Error("Not implemented");};sb.prototype.onFrameStart=function(t){throw Error("Not implemented");};sb.prototype.onFrameEnd=function(t){throw Error("Not implemented");};sb.prototype.doesSessionSupportReferenceSpace=function(t,y){throw Error("Not implemented");};sb.prototype.requestStageBounds=
function(){throw Error("Not implemented");};sb.prototype.requestFrameOfReferenceTransform=function(t,y){return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){return G.return(void 0)})};sb.prototype.cancelAnimationFrame=function(t){throw Error("Not implemented");};sb.prototype.endSession=function(t){throw Error("Not implemented");};sb.prototype.getViewport=function(t,y,G,H){throw Error("Not implemented");};sb.prototype.getProjectionMatrix=function(t){throw Error("Not implemented");};sb.prototype.getBasePoseMatrix=
function(){throw Error("Not implemented");};sb.prototype.getBaseViewMatrix=function(t){throw Error("Not implemented");};sb.prototype.getInputSources=function(){throw Error("Not implemented");};sb.prototype.getInputPose=function(t,y,G){throw Error("Not implemented");};sb.prototype.onWindowResize=function(){this.onWindowResize()};var nc={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],
axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},vc={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},$c={"Daydream Controller":{mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,
2:0}},"Gear VR Controller":{mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,0,1]}},"HTC Vive Focus Controller":{mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},"Oculus Go Controller":{mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,
0,1]}},"Oculus Touch (Right)":nc,"Oculus Touch (Left)":nc,"OpenVR Gamepad":{mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[-.08*Math.PI,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,
3]}}}},"Spatial Controller (Spatial Interaction Source) 045E-065A":vc,"Spatial Controller (Spatial Interaction Source) 045E-065D":{mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},"Windows Mixed Reality (Right)":vc,"Windows Mixed Reality (Left)":vc},Dc=l(.155,-.465,-.15),ad=l(-.155,-.465,-.15),bd=l(0,0,-.25),cd=l(0,0,
.05),Ec=l(-.08,.14,.08),Fc=180/Math.PI,Tb=function(){this.hand="right";this.headElbowOffset=Dc;this.controllerQ=I();this.lastControllerQ=I();this.headQ=I();this.headPos=h();this.elbowPos=h();this.wristPos=h();this.lastTime=this.time=null;this.rootQ=I();this.position=h()};Tb.prototype.setHandedness=function(t){this.hand!=t&&(this.hand=t,this.headElbowOffset="left"==this.hand?ad:Dc)};Tb.prototype.update=function(t,y){this.time=ha();t&&(X(this.lastControllerQ,this.controllerQ),X(this.controllerQ,t));
y&&(f(this.headPos,y),g(this.headQ,y));t=this.getHeadYawOrientation_();y=this.quatAngle_(this.lastControllerQ,this.controllerQ);.61<y/((this.time-this.lastTime)/1E3)?E(this.rootQ,this.rootQ,t,Math.min(y/.175,1)):X(this.rootQ,t);t=l(0,0,-1);u(t,t,this.controllerQ);t=x(t,[0,1,0]);t=this.clamp_((t-.12)/.87,0,1);var G=fa(this.rootQ);K(G,G);F(G,G,this.controllerQ);y=this.elbowPos;q(y,this.headPos);n(y,y,this.headElbowOffset);var H=m(Ec);p(H,H,t);n(y,y,H);H=this.quatAngle_(G,I())*Fc;var da=(1-Math.pow(H/
180,4))*(.4+.24*t);H=I();E(H,H,G,da);da=K(I(),H);G=fa(G);F(G,G,da);da=this.wristPos;q(da,cd);u(da,da,H);n(da,da,bd);u(da,da,G);n(da,da,y);y=m(Ec);p(y,y,t);n(this.position,this.wristPos,y);u(this.position,this.position,this.rootQ);this.lastTime=this.time};Tb.prototype.getPosition=function(){return this.position};Tb.prototype.getHeadYawOrientation_=function(){var t=h();O(t,this.headQ,"YXZ");var y=I(),G=t[1]*Fc;t=.5*Math.PI/180;var H=0*t;G*=t;var da=0*t;t=Math.sin(H);H=Math.cos(H);var ua=Math.sin(G);
G=Math.cos(G);var va=Math.sin(da);da=Math.cos(da);y[0]=t*G*da-H*ua*va;y[1]=H*ua*da+t*G*va;y[2]=H*G*va-t*ua*da;y[3]=H*G*da+t*ua*va;return y};Tb.prototype.clamp_=function(t,y,G){return Math.min(Math.max(t,y),G)};Tb.prototype.quatAngle_=function(t,y){var G=[0,0,-1],H=[0,0,-1];u(G,G,t);u(H,H,y);t=l(G[0],G[1],G[2]);H=l(H[0],H[1],H[2]);r(t,t);r(H,H);H=x(t,H);H=1<H?0:-1>H?Math.PI:Math.acos(H);return H};var Db=Symbol("@@webxr-polyfill/XRRemappedGamepad"),Gc={pressed:!1,touched:!1,value:0};Object.freeze(Gc);
var wc=function(t,y,G){G||(G={});if(G.userAgentOverrides)for(var H in G.userAgentOverrides)if(navigator.userAgent.includes(H)){H=G.userAgentOverrides[H];for(var da in H)da in G?Object.assign(G[da],H[da]):G[da]=H[da];break}da=Array(G.axes&&G.axes.length?G.axes.length:t.axes.length);H=Array(G.buttons&&G.buttons.length?G.buttons.length:t.buttons.length);var ua=null;if(G.gripTransform){var va=G.gripTransform.orientation||[0,0,0,1];ua=a();e(ua,qa(va,va),G.gripTransform.position||[0,0,0])}va=null;if(G.targetRayTransform){var Ka=
G.targetRayTransform.orientation||[0,0,0,1];va=a();e(va,qa(Ka,Ka),G.targetRayTransform.position||[0,0,0])}Ka=G.profiles;G.displayProfiles&&y.displayName in G.displayProfiles&&(Ka=G.displayProfiles[y.displayName]);this[Db]={gamepad:t,map:G,profiles:Ka||[t.id],mapping:G.mapping||t.mapping,axes:da,buttons:H,gripTransform:ua,targetRayTransform:va};this._update()};wc.prototype._update=function(){for(var t=this[Db].gamepad,y=this[Db].map,G=this[Db].axes,H=0;H<G.length;++H)G[H]=y.axes&&H in y.axes?null===
y.axes[H]?0:t.axes[y.axes[H]]:t.axes[H];if(y.axes&&y.axes.invert){H=$jscomp.makeIterator(y.axes.invert);for(var da=H.next();!da.done;da=H.next())da=da.value,da<G.length&&(G[da]*=-1)}G=this[Db].buttons;for(H=0;H<G.length;++H)G[H]=y.buttons&&H in y.buttons?null===y.buttons[H]?Gc:t.buttons[y.buttons[H]]:t.buttons[H]};$jscomp.global.Object.defineProperties(wc.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return""}},_profiles:{configurable:!0,enumerable:!0,get:function(){return this[Db].profiles}},
index:{configurable:!0,enumerable:!0,get:function(){return-1}},connected:{configurable:!0,enumerable:!0,get:function(){return this[Db].gamepad.connected}},timestamp:{configurable:!0,enumerable:!0,get:function(){return this[Db].gamepad.timestamp}},mapping:{configurable:!0,enumerable:!0,get:function(){return this[Db].mapping}},axes:{configurable:!0,enumerable:!0,get:function(){return this[Db].axes}},buttons:{configurable:!0,enumerable:!0,get:function(){return this[Db].buttons}},hapticActuators:{configurable:!0,
enumerable:!0,get:function(){return this[Db].gamepad.hapticActuators}}});var lc=function(t,y,G,H){G=void 0===G?0:G;H=void 0===H?-1:H;this.polyfill=t;this.display=y;this.gamepad=this.nativeGamepad=null;this.inputSource=new cb(this);this.lastPosition=h();this.emulatedPosition=!1;this.basePoseMatrix=a();this.outputMatrix=a();this.primaryButtonIndex=G;this.primaryActionPressed=!1;this.primarySqueezeButtonIndex=H;this.primarySqueezeActionPressed=!1;this.handedness="";this.targetRayMode="gaze";this.armModel=
null};lc.prototype.updateFromGamepad=function(t){this.nativeGamepad!==t&&(this.gamepad=(this.nativeGamepad=t)?new wc(t,this.display,$c[t.id]):null);this.handedness=""===t.hand?"none":t.hand;this.gamepad&&this.gamepad._update();t.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!t.pose.hasPosition):""===t.hand&&(this.targetRayMode="gaze",this.emulatedPosition=!1)};lc.prototype.updateBasePoseMatrix=function(){if(this.nativeGamepad&&this.nativeGamepad.pose){var t=this.nativeGamepad.pose,
y=t.position,G=t.orientation;if(!y&&!G)return;y?(this.lastPosition[0]=y[0],this.lastPosition[1]=y[1],this.lastPosition[2]=y[2]):t.hasPosition?y=this.lastPosition:(this.armModel||(this.armModel=new Tb),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(G,this.polyfill.getBasePoseMatrix()),y=this.armModel.getPosition());e(this.basePoseMatrix,G,y)}else t=this.basePoseMatrix,y=this.polyfill.getBasePoseMatrix(),t[0]=y[0],t[1]=y[1],t[2]=y[2],t[3]=y[3],t[4]=y[4],t[5]=y[5],t[6]=y[6],
t[7]=y[7],t[8]=y[8],t[9]=y[9],t[10]=y[10],t[11]=y[11],t[12]=y[12],t[13]=y[13],t[14]=y[14],t[15]=y[15];return this.basePoseMatrix};lc.prototype.getXRPose=function(t,y){this.updateBasePoseMatrix();switch(y){case "target-ray":t._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix);this.gamepad&&this.gamepad[Db].targetRayTransform&&d(this.outputMatrix,this.outputMatrix,this.gamepad[Db].targetRayTransform);break;case "grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;t._transformBasePoseMatrix(this.outputMatrix,
this.basePoseMatrix);this.gamepad&&this.gamepad[Db].gripTransform&&d(this.outputMatrix,this.outputMatrix,this.gamepad[Db].gripTransform);break;default:return null}t._adjustForOriginOffset(this.outputMatrix);return new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)};$jscomp.global.Object.defineProperties(lc.prototype,{profiles:{configurable:!0,enumerable:!0,get:function(){return this.gamepad?this.gamepad._profiles:[]}}});var Hc={highRefreshRate:!0},Ic={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1},
dd=0,ed=function(t,y,G){G=void 0===G?{}:G;this.mode=t;this.enabledFeatures=y;this.outputContext=null;this.immersive="immersive-vr"==t||"immersive-ar"==t;this.baseLayer=this.ended=null;this.id=++dd;this.modifiedCanvasLayer=!1;this.outputContext&&(this.renderContext=this.outputContext.canvas.getContext(G.renderContextType||"2d"))},tb=function(t,y){var G=y.capabilities.canPresent;var H=sb.call(this,t)||this;H.display=y;H.frame=new t.VRFrameData;H.sessions=new Map;H.immersiveSession=null;H.canPresent=
G;H.baseModelMatrix=a();H.gamepadInputSources={};H.tempVec3=new Float32Array(3);H.onVRDisplayPresentChange=H.onVRDisplayPresentChange.bind(H);t.window.addEventListener("vrdisplaypresentchange",H.onVRDisplayPresentChange);H.CAN_USE_GAMEPAD=t.navigator&&"getGamepads"in t.navigator;H.HAS_BITMAP_SUPPORT=!(!t.ImageBitmapRenderingContext||!t.createImageBitmap);return H};$jscomp.inherits(tb,sb);tb.prototype.onBaseLayerSet=function(t,y){var G=this,H=this.sessions.get(t),da=y.context.canvas;if(H.immersive){t=
this.display.getEyeParameters("left");var ua=this.display.getEyeParameters("right");da.width=2*Math.max(t.renderWidth,ua.renderWidth);da.height=Math.max(t.renderHeight,ua.renderHeight);this.display.requestPresent([{source:da,attributes:Hc}]).then(function(){G.global.document.body.contains(da)||(H.modifiedCanvasLayer=!0,G.global.document.body.appendChild(da),da.style.display="block",da.style.position="absolute",da.style.width=da.style.height="1px",da.style.top=da.style.left="0px");H.baseLayer=y})}else H.baseLayer=
y};tb.prototype.isSessionSupported=function(t){return"immersive-ar"==t||"immersive-vr"==t&&!1===this.canPresent?!1:!0};tb.prototype.isFeatureSupported=function(t){switch(t){case "viewer":return!0;case "local":return!0;case "local-floor":return!0;case "bounded":return!1;case "unbounded":return!1;default:return!1}};tb.prototype.requestSession=function(t,y){var G=this,H,da,ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){if(1==va.nextAddress){if(!G.isSessionSupported(t))return va.return(Promise.reject());
H="immersive-vr"==t;if(!H)return va.jumpTo(2);da=G.global.document.createElement("canvas");da.getContext("webgl");return va.yield(G.display.requestPresent([{source:da,attributes:Hc}]),2)}ua=new ed(t,y,{renderContextType:G.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});G.sessions.set(ua.id,ua);H&&(G.immersiveSession=ua,G.dispatchEvent("@@webxr-polyfill/vr-present-start",ua.id));return va.return(Promise.resolve(ua.id))})};tb.prototype.requestAnimationFrame=function(t){return this.display.requestAnimationFrame(t)};
tb.prototype.getPrimaryButtonIndex=function(t){var y=0,G=t.id.toLowerCase(),H;for(H in Ic)if(G.includes(H)){y=Ic[H];break}return Math.min(y,t.buttons.length-1)};tb.prototype.onFrameStart=function(t,y){this.display.depthNear=y.depthNear;this.display.depthFar=y.depthFar;this.display.getFrameData(this.frame);t=this.sessions.get(t);if(t.immersive&&this.CAN_USE_GAMEPAD){var G=this.gamepadInputSources;this.gamepadInputSources={};for(var H=this.global.navigator.getGamepads(),da=0;da<H.length;++da){var ua=
H[da];if(ua&&0<ua.displayId){var va=G[da];va||(va=new lc(this,this.display,this.getPrimaryButtonIndex(ua)));va.updateFromGamepad(ua);this.gamepadInputSources[da]=va;if(-1!=va.primaryButtonIndex){var Ka=ua.buttons[va.primaryButtonIndex].pressed;Ka&&!va.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:t.id,inputSource:va.inputSource}):!Ka&&va.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:t.id,inputSource:va.inputSource});
va.primaryActionPressed=Ka}-1!=va.primarySqueezeButtonIndex&&((ua=ua.buttons[va.primarySqueezeButtonIndex].pressed)&&!va.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:t.id,inputSource:va.inputSource}):!ua&&va.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:t.id,inputSource:va.inputSource}),va.primarySqueezeActionPressed=ua)}}}!t.immersive&&t.baseLayer&&(t=t.baseLayer.context.canvas,k(this.frame.leftProjectionMatrix,
y.inlineVerticalFieldOfView,t.width/t.height,y.depthNear,y.depthFar))};tb.prototype.onFrameEnd=function(t){t=this.sessions.get(t);if(!t.ended&&t.baseLayer){if(t.outputContext&&(!t.immersive||this.display.capabilities.hasExternalDisplay)){var y=t.baseLayer.context.canvas,G=t.immersive&&this.display.capabilities.hasExternalDisplay?y.width/2:y.width,H=y.height,da=t.outputContext.canvas,ua=da.width;da=da.height;var va=t.renderContext;this.HAS_BITMAP_SUPPORT?y.transferToImageBitmap?va.transferFromImageBitmap(y.transferToImageBitmap()):
this.global.createImageBitmap(y,0,0,G,H,{resizeWidth:ua,resizeHeight:da}).then(function(Ka){return va.transferFromImageBitmap(Ka)}):va.drawImage(y,0,0,G,H,0,0,ua,da)}t.immersive&&t.baseLayer&&this.display.submitFrame()}};tb.prototype.cancelAnimationFrame=function(t){this.display.cancelAnimationFrame(t)};tb.prototype.endSession=function(t){var y=this,G;return $jscomp.asyncExecutePromiseGeneratorProgram(function(H){G=y.sessions.get(t);if(G.ended)return H.return();if(G.immersive)return H.return(y.display.exitPresent());
G.ended=!0;H.jumpToEnd()})};tb.prototype.doesSessionSupportReferenceSpace=function(t,y){t=this.sessions.get(t);return t.ended?!1:t.enabledFeatures.has(y)};tb.prototype.requestStageBounds=function(){if(this.display.stageParameters){var t=this.display.stageParameters.sizeX,y=this.display.stageParameters.sizeZ,G=[];G.push(-t/2);G.push(-y/2);G.push(t/2);G.push(-y/2);G.push(t/2);G.push(y/2);G.push(-t/2);G.push(y/2);return G}return null};tb.prototype.requestFrameOfReferenceTransform=function(t,y){var G=
this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(H){return("local-floor"===t||"bounded-floor"===t)&&G.display.stageParameters&&G.display.stageParameters.sittingToStandingTransform?H.return(G.display.stageParameters.sittingToStandingTransform):H.return(null)})};tb.prototype.getProjectionMatrix=function(t){if("left"===t)return this.frame.leftProjectionMatrix;if("right"===t)return this.frame.rightProjectionMatrix;if("none"===t)return this.frame.leftProjectionMatrix;throw Error("eye must be of type 'left' or 'right'");
};tb.prototype.getViewport=function(t,y,G,H){t=this.sessions.get(t);var da=G.context.canvas;G=da.width;da=da.height;if(!t.immersive)return H.x=H.y=0,H.width=G,H.height=da,!0;if("left"===y||"none"===y)H.x=0;else if("right"===y)H.x=G/2;else return!1;H.y=0;H.width=G/2;H.height=da;return!0};tb.prototype.getBasePoseMatrix=function(){var t=this.frame.pose,y=t.position;t=t.orientation;if(!y&&!t)return this.baseModelMatrix;y||(y=this.tempVec3,y[0]=y[1]=y[2]=0);e(this.baseModelMatrix,t,y);return this.baseModelMatrix};
tb.prototype.getBaseViewMatrix=function(t){if("left"===t||"none"===t)return this.frame.leftViewMatrix;if("right"===t)return this.frame.rightViewMatrix;throw Error("eye must be of type 'left' or 'right'");};tb.prototype.getInputSources=function(){var t=[],y;for(y in this.gamepadInputSources)t.push(this.gamepadInputSources[y].inputSource);return t};tb.prototype.getInputPose=function(t,y,G){if(!y)return null;for(var H in this.gamepadInputSources){var da=this.gamepadInputSources[H];if(da.inputSource===
t)return da.getXRPose(y,G)}return null};tb.prototype.onWindowResize=function(){};tb.prototype.onVRDisplayPresentChange=function(t){var y=this;this.display.isPresenting||this.sessions.forEach(function(G){if(G.immersive&&!G.ended){if(G.modifiedCanvasLayer){var H=G.baseLayer.context.canvas;document.body.removeChild(H);H.setAttribute("style","")}y.immersiveSession===G&&(y.immersiveSession=null);y.dispatchEvent("@@webxr-polyfill/vr-present-end",G.id)}})};$jscomp.global.Object.defineProperties(tb.prototype,
{depthNear:{configurable:!0,enumerable:!0,get:function(){return this.display.depthNear},set:function(t){this.display.depthNear=t}},depthFar:{configurable:!0,enumerable:!0,get:function(){return this.display.depthFar},set:function(t){this.display.depthFar=t}}});var Jc=function(t,y){y=new mc(y||{});t=tb.call(this,t,y)||this;t.display=y;t.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),
pose:null,timestamp:null};return t};$jscomp.inherits(Jc,tb);var fd=0,gd=function(t,y){this.mode=t;this.enabledFeatures=y;this.baseLayer=this.ended=null;this.id=++fd},Ab=function(t){t=sb.call(this,t)||this;t.sessions=new Map;t.projectionMatrix=a();t.identityMatrix=a();return t};$jscomp.inherits(Ab,sb);Ab.prototype.onBaseLayerSet=function(t,y){this.sessions.get(t).baseLayer=y};Ab.prototype.isSessionSupported=function(t){return"inline"==t};Ab.prototype.isFeatureSupported=function(t){switch(t){case "viewer":return!0;
default:return!1}};Ab.prototype.requestSession=function(t,y){var G=this,H;return $jscomp.asyncExecutePromiseGeneratorProgram(function(da){if(!G.isSessionSupported(t))return da.return(Promise.reject());H=new gd(t,y);G.sessions.set(H.id,H);return da.return(Promise.resolve(H.id))})};Ab.prototype.requestAnimationFrame=function(t){return window.requestAnimationFrame(t)};Ab.prototype.cancelAnimationFrame=function(t){window.cancelAnimationFrame(t)};Ab.prototype.onFrameStart=function(t,y){t=this.sessions.get(t);
t.baseLayer&&(t=t.baseLayer.context.canvas,k(this.projectionMatrix,y.inlineVerticalFieldOfView,t.width/t.height,y.depthNear,y.depthFar))};Ab.prototype.onFrameEnd=function(t){};Ab.prototype.endSession=function(t){var y=this,G;return $jscomp.asyncExecutePromiseGeneratorProgram(function(H){G=y.sessions.get(t);G.ended=!0;H.jumpToEnd()})};Ab.prototype.doesSessionSupportReferenceSpace=function(t,y){t=this.sessions.get(t);return t.ended?!1:t.enabledFeatures.has(y)};Ab.prototype.requestStageBounds=function(){return null};
Ab.prototype.requestFrameOfReferenceTransform=function(t,y){return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){return G.return(null)})};Ab.prototype.getProjectionMatrix=function(t){return this.projectionMatrix};Ab.prototype.getViewport=function(t,y,G,H){this.sessions.get(t);y=G.context.canvas;t=y.width;y=y.height;H.x=H.y=0;H.width=t;H.height=y;return!0};Ab.prototype.getBasePoseMatrix=function(){return this.identityMatrix};Ab.prototype.getBaseViewMatrix=function(t){return this.identityMatrix};
Ab.prototype.getInputSources=function(){return[]};Ab.prototype.getInputPose=function(t,y,G){return null};Ab.prototype.onWindowResize=function(){};var hd=function(t){var y,G;return $jscomp.asyncExecutePromiseGeneratorProgram(function(H){switch(H.nextAddress){case 1:y=null;if(!("getVRDisplays"in t.navigator)){H.jumpTo(2);break}H.setCatchFinallyBlocks(3);return H.yield(t.navigator.getVRDisplays(),5);case 5:(G=H.yieldResult)&&G.length&&(y=new tb(t,G[0]));H.leaveTryBlock(2);break;case 3:H.enterCatchBlock();
case 2:return H.return(y)}})},id=function(t,y){var G,H;return $jscomp.asyncExecutePromiseGeneratorProgram(function(da){return 1==da.nextAddress?y.webvr?da.yield(hd(t),3):da.jumpTo(2):2!=da.nextAddress&&(G=da.yieldResult)?da.return(G):(H=Vb(t))&&y.cardboard||!H&&y.allowCardboardOnDesktop?(t.VRFrameData||(t.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16);this.leftViewMatrix=new Float32Array(16);this.rightProjectionMatrix=new Float32Array(16);this.leftProjectionMatrix=new Float32Array(16);
this.pose=null}),da.return(new Jc(t,y.cardboardConfig))):da.return(new Ab(t))})},jd={global:W,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},oc=["navigator","HTMLCanvasElement","WebGLRenderingContext"],pc=function(t){t=void 0===t?{}:t;this.config=Object.freeze(Object.assign({},jd,t));this.global=this.config.global;this.nativeWebXR="xr"in this.global.navigator;this.injected=!1;this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)};pc.prototype._injectPolyfill=
function(t){if(!oc.every(function(H){return!!t[H]}))throw Error("Global must have the following attributes : "+oc);for(var y=$jscomp.makeIterator(Object.keys(mb)),G=y.next();!G.done;G=y.next())G=G.value,void 0!==t[G]?console.warn(G+" already defined on global."):t[G]=mb[G];Cb(t.WebGLRenderingContext)&&(Ub(t.HTMLCanvasElement),t.OffscreenCanvas&&Ub(t.OffscreenCanvas),t.WebGL2RenderingContext&&Cb(t.WebGL2RenderingContext),window.isSecureContext||console.warn("WebXR Polyfill Warning:\nThis page is not running in a secure context (https:// or localhost)!\nThis means that although the page may be able to use the WebXR Polyfill it will\nnot be able to use native WebXR implementations, and as such will not be able to\naccess dedicated VR or AR hardware, and will not be able to take advantage of\nany performance improvements a native WebXR implementation may offer. Please\nhost this content on a secure origin for the best user experience.\n"));
this.injected=!0;this._patchNavigatorXR()};pc.prototype._patchNavigatorXR=function(){var t=id(this.global,this.config);this.xr=new mb.XRSystem(t);Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})};pc.prototype._injectCompatibilityShims=function(t){if(!oc.every(function(G){return!!t[G]}))throw Error("Global must have the following attributes : "+oc);if(t.navigator.xr&&"supportsSession"in t.navigator.xr&&!("isSessionSupported"in t.navigator.xr)){var y=t.navigator.xr.supportsSession;
t.navigator.xr.isSessionSupported=function(G){return y.call(this,G).then(function(){return!0}).catch(function(){return!1})};t.navigator.xr.supportsSession=function(G){console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves.");return y.call(this,G)}}};return pc});(function(){var a=function(b,c,d,e,f,g,k){this.id=b;this.name=c;this.parentTexture=d;this.extractedTexture=this.stdExt=this.rawExt=null;this.uvOffsetScale=new THREE.Vector4(e,f,g,k);this.isCutout=!1;this.importAutoScale=this.importGpuCompress=!0};a.prototype={addLoadedListener:function(b){this.parentTexture.addLoadedListener(b)},get hasAlpha(){return this.parentTexture.hasAlpha},serialize:function(){return{id:this.id,name:this.name,atlasId:this.parentTexture.id,atlasOffset:[this.uvOffsetScale.x,this.uvOffsetScale.y],
atlasScale:[this.uvOffsetScale.z,this.uvOffsetScale.w],rawExt:this.rawExt,stdExt:this.stdExt,webFormats:[],alpha:this.hasAlpha,importGpuCompress:this.importGpuCompress,importAutoScale:this.importAutoScale}}};WALK.Texture=function(b,c,d,e,f,g,k,h){this.webFormats=this.stdExt=this.rawExt=this.name=this.id=null;this.isCube=!1;this.image=void 0!==b?b:WALK.Texture.DEFAULT_IMAGE;this.height=this.width=null;this.mipmaps=[];this.wrapS=void 0!==c?c:GLC.CLAMP_TO_EDGE;this.wrapT=void 0!==d?d:GLC.CLAMP_TO_EDGE;
this.magFilter=void 0!==e?e:GLC.LINEAR;this.minFilter=void 0!==f?f:GLC.LINEAR_MIPMAP_LINEAR;this.anisotropy=void 0!==h?h:1;this.isRgbm=this.isCutout=this.hasAlpha=this.isAnimated=!1;this.format=void 0!==g?g:GLC.RGBA;this.type=void 0!==k?k:GLC.UNSIGNED_BYTE;this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this._atlasEntries=null;this._needsUpdate=!1;this.releaseOnLoadedToGpu=!0;this.loaded=!1;this._loadedListeners=[];this.__webglSlot=this.__webglTexture=null;this.importAutoScale=
this.importGpuCompress=!0};WALK.Texture.DEFAULT_IMAGE=void 0;WALK.Texture.prototype={constructor:WALK.Texture,sleepAnimation:function(){console.assert(!1)},wakeAnimation:function(){console.assert(!1)},get needsUpdate(){return this._needsUpdate},set needsUpdate(b){this._needsUpdate=b},isAtlas:function(){return null!==this._atlasEntries},enableAtlas:function(){console.assert(!this.isAtlas());this._atlasEntries={}},getAtlasEntry:function(b,c,d,e,f,g){var k=this._atlasEntries[c];if(k)return k;console.assert(!this.loaded);
k=new a(b,c,this,d,e,f,g);return this._atlasEntries[c]=k},forEachAtlasEntry:function(b){for(var c in this._atlasEntries)this._atlasEntries.hasOwnProperty(c)&&b(this._atlasEntries[c])},clone:function(b){void 0===b&&(b=new WALK.Texture);b.isCube=b.isCube;b.image=this.image;b.mipmaps=this.mipmaps.slice(0);b.wrapS=this.wrapS;b.wrapT=this.wrapT;b.magFilter=this.magFilter;b.minFilter=this.minFilter;b.anisotropy=this.anisotropy;b.isCutout=this.isCutout;b.isAnimated=this.isAnimated;b.hasAlpha=this.hasAlpha;
b.format=this.format;b.type=this.type;b.generateMipmaps=this.generateMipmaps;b.premultiplyAlpha=this.premultiplyAlpha;b.flipY=this.flipY;b.unpackAlignment=this.unpackAlignment;return b},serialize:function(){var b={id:this.id,name:this.name,stdExt:this.stdExt,webFormats:this.webFormats,alpha:this.hasAlpha,importGpuCompress:this.importGpuCompress,importAutoScale:this.importAutoScale};this.rawExt&&(b.rawExt=this.rawExt);this.isRgbm&&(b.rgbm=!0);return b},dispose:function(){this._loadedListeners=[];this.dispatchEvent({type:"dispose"})},
addLoadedListener:function(b){this.loaded?b():this._loadedListeners.push(b)},notifyLoaded:function(){this.loaded=!0;for(var b=this._loadedListeners,c=0;c<b.length;c+=1)b[c]();b.length=0}};THREE.EventDispatcher.prototype.apply(WALK.Texture.prototype)})();(function(){WALK.CompressedTexture=function(a,b,c,d,e,f,g,k,h,m){WALK.Texture.call(this,null,f,g,k,h,d,e,m);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1};WALK.CompressedTexture.prototype=Object.create(WALK.Texture.prototype);WALK.CompressedTexture.prototype.constructor=WALK.CompressedTexture;WALK.CompressedTexture.prototype.clone=function(){var a=new WALK.CompressedTexture;WALK.Texture.prototype.clone.call(this,a);return a}})();(function(){WALK.DataTexture=function(a,b,c,d,e,f,g,k,h,m){WALK.Texture.call(this,null,f,g,k,h,d,e,m);this.image={data:a,width:b,height:c}};WALK.DataTexture.prototype=Object.create(WALK.Texture.prototype);WALK.DataTexture.prototype.constructor=WALK.DataTexture;WALK.DataTexture.prototype.clone=function(){var a=new WALK.DataTexture;WALK.Texture.prototype.clone.call(this,a);return a}})();(function(){WALK.VideoTexture=function(a,b,c,d,e,f,g,k,h){var m=this;WALK.Texture.call(this,a,b,c,d,e,f,g,k,h);this.generateMipmaps=!1;this.isAnimated=!0;this.releaseOnLoadedToGpu=!1;this._isPlaying=!0;this._pauseRequested=this._isSleeping=!1;this._videoSrc=null;this._pausedTime=0;this._interruptible=!0;this._resizedListeners=[];this._handlePaused=function(){m._pauseRequested?m._pauseRequested=!1:m._isSleeping=!0;!m._isPlaying&&m._interruptible&&(m.video.src="")};this._handleEnded=function(){m._isPlaying=
!1;m._isSleeping=!1};this._notifyResized=function(){m.width=m.video.videoWidth;m.height=m.video.videoHeight;for(var l=0;l<m._resizedListeners.length;l+=1)m._resizedListeners[l]()}};WALK.VideoTexture.prototype=Object.create(WALK.Texture.prototype);WALK.VideoTexture.prototype.constructor=WALK.VideoTexture;WALK.VideoTexture.prototype._srcAtPausedPosition=function(){return this._videoSrc+"#t="+this._pausedTime};WALK.VideoTexture.prototype._pauseVideo=function(){this._pausedTime=this.video.currentTime;
this.video.pause()};Object.defineProperty(WALK.VideoTexture.prototype,"video",{get:function(){return this.image},set:function(a){console.assert(void 0===this.image,"Video already attached to texture.");this.image=a;this._videoSrc=a.src;this._isPlaying=!a.paused&&!a.ended;a.addEventListener("pause",this._handlePaused);a.addEventListener("ended",this._handleEnded);a.addEventListener("resize",this._notifyResized);this._isSleeping&&this._isPlaying&&this._pauseVideo()}});Object.defineProperty(WALK.VideoTexture.prototype,
"muted",{get:function(){return this.video.muted},set:function(a){this.video.muted=a}});Object.defineProperty(WALK.VideoTexture.prototype,"loop",{get:function(){return this.video.loop},set:function(a){this.video.loop=a}});Object.defineProperty(WALK.VideoTexture.prototype,"isPlaying",{get:function(){return!this._isSleeping&&this._isPlaying}});WALK.VideoTexture.prototype.play=function(){var a=this;if(!this._isPlaying)if(this._isSleeping)this._isPlaying=!0;else{var b=this.video;this._interruptible&&(b.src=
this._srcAtPausedPosition());var c=b.play();c?(this._isPlaying=!0,c.catch(function(d){console.log("Can't play video texture: "+d);a._isPlaying=!1})):this._isPlaying=!b.paused&&!b.ended}};WALK.VideoTexture.prototype.pause=function(){this._isPlaying&&(this._isPlaying=!1,this._isSleeping||(this._pauseRequested=!0,this._pauseVideo()))};WALK.VideoTexture.prototype.sleepAnimation=function(){this._isSleeping||(this._isPlaying&&this.video&&this._pauseVideo(),this._isSleeping=!0)};WALK.VideoTexture.prototype.wakeAnimation=
function(){this._isSleeping&&(this._isPlaying&&this.video&&(this._interruptible&&(this.video.src=this._srcAtPausedPosition()),this.video.play()),this._isSleeping=!1)};WALK.VideoTexture.prototype.dispose=function(){WALK.Texture.prototype.dispose.call(this);this._isPlaying&&this.pause();var a=this.video;this.image=null;this._videoSrc="";this._isPlaying=!1;a.src="";a.removeEventListener("pause",this._handlePaused);a.removeEventListener("ended",this._handleEnded);a.removeEventListener("resize",this._notifyResized);
this._resizedListeners.length=0};WALK.VideoTexture.prototype.addResizedListener=function(a){this._resizedListeners.push(a)};WALK.VideoTexture.prototype.serialize=function(){var a=WALK.Texture.prototype.serialize.call(this);a.video=!0;return a};Object.defineProperty(WALK.VideoTexture.prototype,"needsUpdate",{get:function(){return this._needsUpdate||this.isPlaying&&this.video&&!0!==this.video.seeking&&this.video.readyState>=this.video.HAVE_CURRENT_DATA},set:function(a){this._needsUpdate=a}})})();(function(){WALK.WebGLRenderTarget=function(a,b,c){this.y=this.x=0;this.width=a;this.height=b;c=c||{};this.wrapS=void 0!==c.wrapS?c.wrapS:GLC.CLAMP_TO_EDGE;this.wrapT=void 0!==c.wrapT?c.wrapT:GLC.CLAMP_TO_EDGE;this.magFilter=void 0!==c.magFilter?c.magFilter:GLC.LINEAR;this.minFilter=void 0!==c.minFilter?c.minFilter:GLC.LINEAR_MIPMAP_LINEAR;this.anisotropy=void 0!==c.anisotropy?c.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=void 0!==c.format?c.format:
GLC.RGBA;this.type=void 0!==c.type?c.type:GLC.UNSIGNED_BYTE;this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0;this.generateMipmaps=c.generateMipmaps||!1;this.shareDepthFrom=void 0!==c.shareDepthFrom?c.shareDepthFrom:null;this.isCube=!1;this.loaded=!0;this.__webglSlot=this.__webglTexture=this.__webglRenderbuffer=this.__webglFramebuffer=null};WALK.WebGLRenderTarget.prototype={constructor:WALK.WebGLRenderTarget,dispose:function(){this.dispatchEvent({type:"dispose"})}};
THREE.EventDispatcher.prototype.apply(WALK.WebGLRenderTarget.prototype);WALK.WebGLRenderTargetVR=function(a){this.__webglFramebuffer=a;this.height=this.width=this.y=this.x=null;this.isCube=!1};WALK.WebGLRenderTargetVR.prototype={constructor:WALK.WebGLRenderTargetVR,dispose:function(){this.__webglFramebuffer=null;this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(WALK.WebGLRenderTargetVR.prototype)})();(function(){WALK.WebGLRenderTargetCube=function(a,b,c){WALK.WebGLRenderTarget.call(this,a,b,c);this.activeCubeFace=0;this.isCube=!0;this.__webglFramebuffer=[];this.__webglRenderbuffer=[]};WALK.WebGLRenderTargetCube.prototype=Object.create(WALK.WebGLRenderTarget.prototype);WALK.WebGLRenderTargetCube.prototype.constructor=WALK.WebGLRenderTargetCube})();(function(){var a=WALK.DEBUG;WALK.CutoutTextureDetector=function(b){var c={format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1},d=[b.createRenderTarget(1024,1024,c),b.createRenderTarget(512,512,c)];c={uniforms:{map:{type:"t",value:null},mapUvStep:{type:"v2",value:null},mapUvOffsetScale:{type:"v4",value:null}},vertexShader:WALK.getShader("alpha_stats_vertex.glsl"),fragmentShader:WALK.getShader("alpha_stats_fragment.glsl")};var e=new THREE.ShaderPass(c,
"map");e.material.depthTest=!1;e.material.depthWrite=!1;var f=new THREE.Vector2,g=new THREE.Vector4;e.uniforms.mapUvStep.value=f;e.uniforms.mapUvOffsetScale.value=g;c={uniforms:{map:{type:"t",value:null},mapUvStep:{type:"v2",value:null},mapUvScale:{type:"v2",value:null}},vertexShader:WALK.getShader("alpha_stats_vertex.glsl"),fragmentShader:WALK.getShader("alpha_stats_combine_fragment.glsl")};var k=new THREE.ShaderPass(c,"map");k.material.depthTest=!1;k.material.depthWrite=!1;var h=new THREE.Vector2;
k.uniforms.mapUvScale.value=h;k.uniforms.mapUvStep.value=f;var m=new Uint8Array(4096),l=null;a&&(l=new WALK.Timer);this.isCutoutTexture=function(q){var n=void 0!==q.parentTexture;if(n){var p=q.parentTexture;var r=q.uvOffsetScale.x;var x=q.uvOffsetScale.y;var w=q.uvOffsetScale.z;var u=q.uvOffsetScale.w}else p=q,r=x=0,w=u=1;if(!p.hasAlpha||p.video)q.isCutout=!1;else{a&&l.reset();b.enableScissorTest(!0);var A=p.width*w,B=p.height*u;f.set(1/A,1/B);g.set(r,x,w,u);A=Math.max(Math.floor(A/2),1);B=Math.max(Math.floor(B/
2),1);b.setRenderTarget(d[0]);b.setViewport(0,0,A,B);b.setScissor(0,0,A,B);e.render(b,d[0],p);for(var I=1,F=d[0];1!==A&&1!==B;){f.set(1/F.width,1/F.height);h.set(A/F.width,B/F.height);A=Math.floor(A/2);B=Math.floor(B/2);var E=d[I];b.setRenderTarget(E);b.setViewport(0,0,A,B);b.setScissor(0,0,A,B);k.render(b,E,F);F=E;I=(I+1)%2}b.readPixels(A,B,m);F=I=0;A=Math.max(A,B);for(B=0;B<A;++B)I+=m[4*B],F+=m[4*B+1];I=100*I/(255*A);F=100*F/(255*A);q.isCutout=20>I||50<F;a&&(A="",n&&(A+="From atlas: "+p.name+" ["+
r+", "+x+", "+w+", "+u+"]\n"),console.log(q.name+" "+p.width+"x"+p.height+"\n "+A+"Is cutout: "+q.isCutout+"\n Partialy transparent regions: "+I+"%\n Fully transparent pixels: "+F+"%\n Time: "+l.elapsedSec()));b.enableScissorTest(!1)}};this.dispose=function(){d[0].dispose();d[1].dispose();e.dispose();k.dispose()}}})();(function(){WALK.TextureCropper=function(a){var b=new THREE.ShaderPass({uniforms:{srcTexture:{type:"t",value:null},uvOffsetScale:{type:"v4",value:null}},vertexShader:WALK.getShader("crop_texture_vertex.glsl"),fragmentShader:WALK.getShader("crop_texture_fragment.glsl")},"srcTexture");b.material.depthTest=!1;b.material.depthWrite=!1;this.cropTextureToPoTTarget=function(c,d){var e=THREE.Math.nextPowerOfTwo(d.z*c.width),f=THREE.Math.nextPowerOfTwo(d.w*c.height);e=a.createRenderTarget(e,f,{wrapS:GLC.REPEAT,
wrapT:GLC.REPEAT,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR_MIPMAP_LINEAR,format:GLC.RGBA,type:GLC.UNSIGNED_BYTE,depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!0});b.uniforms.uvOffsetScale.value=d;b.render(a,e,c);a.deallocateRenderTargetRenderingBuffers(e);return e}}})();WALK.SHADERS={};WALK.SHADERS["aabb_query_fragment.glsl"]="//AUTO GENERATED\nvarIn vec3 vPositionW;\nuniform int axis;\nvec4 encodeFloat(in float x) {\nfloat xabs = abs(x);\nfloat r = floor(xabs);\nfloat g = fract(xabs);\nreturn vec4(r / 255.0, g, 0.0, 0.0);\n}\nvoid main() {\nvec3 viewW = cameraPosition - vPositionW;\nif (axis == 0) {\nfragColor = encodeFloat(viewW.x);\n} else if (axis == 1) {\nfragColor = encodeFloat(viewW.y);\n} else if (axis == 2) {\nfragColor = encodeFloat(viewW.z);\n}\n}\n";
WALK.SHADERS["aabb_query_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarOut vec3 vPositionW;\nvoid main() {\nvec4 transformedPosition = transformPosition();\nvPositionW = (modelMatrix * transformedPosition).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";
WALK.SHADERS["accumulate_fragment.glsl"]="//AUTO GENERATED\nuniform float weight;\nuniform sampler2D inputBuffer;\nvarIn vec2 vUv;\nvoid main() {\nvec3 inputColor = texture2D(inputBuffer, vUv).rgb;\nfragColor = vec4(inputColor, weight);\n}\n";WALK.SHADERS["accumulate_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["alpha_stats_combine_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D map;\nuniform vec2 mapUvStep;\nuniform vec2 mapUvScale;\nvarIn vec2 vUv;\nvoid main() {\nvec2 corner = vUv * mapUvScale- mapUvStep;\nvec2 uv = corner + 0.5 * mapUvStep;\nvec4 p0 = texture2D(map, uv);\nvec4 p1 = texture2D(map, uv + vec2(0.0, mapUvStep.y));\nvec4 p2 = texture2D(map, uv + vec2(mapUvStep.x, 0.0));\nvec4 p3 = texture2D(map, uv + vec2(mapUvStep.x, mapUvStep.y));\nfragColor = vec4((p0.r + p1.r + p2.r + p3.r) / 4.0,\n(p0.g + p1.g + p2.g + p3.g) / 4.0, 0.0, 1.0);\nreturn;\n}\n";
WALK.SHADERS["alpha_stats_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D map;\nuniform vec2 mapUvStep;\nuniform vec4 mapUvOffsetScale;\nvarIn vec2 vUv;\nvoid main() {\nvec2 corner = vUv * mapUvOffsetScale.zw + mapUvOffsetScale.xy - mapUvStep;\nvec2 uv = corner + 0.5 * mapUvStep;\nconst float bias = -1.0;\nfloat a0 = texture2D(map, uv, bias).a;\nfloat a1 = texture2D(map, uv + vec2(0.0, mapUvStep.y), bias).a;\nfloat a2 = texture2D(map, uv + vec2(mapUvStep.x, 0.0), bias).a;\nfloat a3 = texture2D(map, uv + vec2(mapUvStep.x, mapUvStep.y), bias).a;\nfloat fully_transparent_count = step(0.0, -a0) + step(0.0, -a1) +\nstep(0.0, -a2) + step(0.0, -a3);\nfloat partialy_transparent_count =\nstep(0.0, -abs(clamp(a0, 0.05, 0.95) - a0)) +\nstep(0.0, -abs(clamp(a1, 0.05, 0.95) - a1)) +\nstep(0.0, -abs(clamp(a2, 0.05, 0.95) - a2)) +\nstep(0.0, -abs(clamp(a3, 0.05, 0.95) - a3));\nfragColor = vec4(step(4.0, partialy_transparent_count),\nfully_transparent_count / 4.0,\n0.0, 1.0);\nreturn;\n}\n";
WALK.SHADERS["alpha_stats_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["anchor_sprite_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\nvec4 mvPosition = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);\nvec2 scale;\nscale.x = length(modelMatrix[0].xyz);\nscale.y = length(modelMatrix[1].xyz);\nvec2 alignedPosition = position.xy * scale;\nmvPosition.xy += alignedPosition;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["anchor_vertex.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarOut vec2 vUv;\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvarOut vec3 vNormalV;\nvarOut vec3 vPositionV;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarOut vec3 vNormalW;\nvarOut vec3 vPositionW;\n#endif\nvoid main() {\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvec3 positionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvec3 normal = sphericalDecode(sphericalNormal);\nvec3 normalW = mat3(modelMatrix[0].xyz,\nmodelMatrix[1].xyz,\nmodelMatrix[2].xyz) * normal;\nnormalW = normalize(normalW);\n#endif\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE)\nvec3 anchorCenterW = vec3(modelMatrix[3].xyz);\nvec3 cameraUpW = vec3(modelViewMatrix[0].y,\nmodelViewMatrix[1].y,\nmodelViewMatrix[2].y);\nvec3 forwardW = normalize(anchorCenterW - cameraPosition);\nvec3 rightW = cross(forwardW, cameraUpW);\nrightW.z = 0.0;\nrightW = normalize(rightW);\nvec3 upW = cross(rightW, forwardW);\nvUv = vec2(dot(normalW, rightW) * 0.5 + 0.5, dot(normalW, upW) * 0.5 + 0.5);\n#endif\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n#if defined(USE_BUMP_TEXTURE)\nvPositionV = -mvPosition.xyz;\nvNormalV = normalize(normalMatrix * normal);\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvNormalW = normalW;\nvPositionW = positionW;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["cap_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 color;\nvoid main() {\nfragColor = vec4(color, 1.0);\n}\n";WALK.SHADERS["cap_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvoid main() {\nvec4 transformedPosition = transformPosition();\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";
WALK.SHADERS["copy_opaque_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D tDiffuse;\nvarIn vec2 vUv;\nvoid main() {\nfragColor = vec4(texture2D(tDiffuse, vUv).rgb, 1.0);\n}\n";WALK.SHADERS["copy_opaque_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["crop_texture_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D srcTexture;\nuniform vec4 uvOffsetScale;\nvarIn vec2 vUv;\nvoid main() {\nfragColor = texture2D(srcTexture, uvOffsetScale.xy + vUv * uvOffsetScale.zw);\n}\n";
WALK.SHADERS["crop_texture_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["cubemap_filter_fragment.glsl"]="//AUTO GENERATED\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat rnd(vec2 uv) {\nreturn fract(sin(dot(uv, vec2(12.9898, 78.233) * 2.0)) * 43758.5453);\n}\nvec3 hemisphereSample_cos(vec2 uv, mat3 vecSpace, vec3 cubeDir, float gloss) {\nfloat phi = uv.y * 2.0 * PI;\nfloat cosTheta = sqrt(1.0 - uv.x);\nfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\nvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\nreturn normalize(mix(vecSpace * sampleDir, cubeDir, gloss));\n}\nmat3 matrixFromVector(vec3 n) { // frisvad\nfloat a = 1.0 / (1.0 + n.z);\nfloat b = -n.x * n.y * a;\nvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\nvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\nreturn mat3(b1, b2, n);\n}\nuniform samplerCube envMap;\nuniform float mipSize;\nuniform float face;\nuniform float gloss;\nvoid main(void) {\nvec2 st = 2.0 * floor(gl_FragCoord.xy) / (mipSize - 1.0) - 1.0;\nvec3 vec;\nif (face == 0.0) {\nvec = vec3(1, -st.y, -st.x);\n} else if (face == 1.0) {\nvec = vec3(-1, -st.y, st.x);\n} else if (face == 2.0) {\nvec = vec3(st.x, 1, st.y);\n} else if (face == 3.0) {\nvec = vec3(st.x, -1, -st.y);\n} else if (face == 4.0) {\nvec = vec3(st.x, -st.y, 1);\n} else {\nvec = vec3(-st.x, -st.y, -1);\n}\nmat3 vecSpace = matrixFromVector(normalize(vec));\nvec3 color = vec3(0.0);\nconst int samples = 200;\nvec3 vect;\nfor(int i = 0; i < samples; i++) {\nfloat sini = sin(float(i));\nfloat cosi = cos(float(i));\nfloat rand = rnd(vec2(sini, cosi));\nvect = hemisphereSample_cos(\nvec2(float(i) / float(samples), rand), vecSpace, vec, gloss);\ncolor += hdrDecode(textureCube(envMap, vect));\n}\ncolor /= float(samples);\nfragColor = hdrEncode(color);\n}\n";
WALK.SHADERS["cubemap_filter_vertex.glsl"]="//AUTO GENERATED\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["cube_to_equirect_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nuniform samplerCube panoramaCube;\nvarIn vec2 vUv;\nvoid main() {\nvec2 uv = vUv;\nfloat longitude = uv.x * 2. * PI;\nfloat latitude = uv.y * PI;\nvec3 dir = vec3(\nsin(longitude) * sin(latitude),\ncos(longitude) * sin(latitude),\ncos(latitude));\nfragColor = textureCube(panoramaCube, normalize(dir));\n}\n";
WALK.SHADERS["cube_to_equirect_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main()  {\nvUv = vec2(uv.x, uv.y - 1.0);\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["editor_light_fragment.glsl"]="//AUTO GENERATED\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nuniform vec3 color;\nuniform vec3 highlight;\nuniform float highlightMix;\nvarIn vec3 vNormal;\nvarIn vec3 vViewPosition;\nvoid main() {\nvec3 lVector = normalize(vViewPosition.xyz);\nfloat pointDiffuse = max(dot(normalize(vNormal), lVector), 0.0);\nvec3 lightColor = color * pointDiffuse;\nlightColor = mix(lightColor, highlight, highlightMix);\nfragColor.xyz = min(linearToGamma(lightColor), 1.0);\n}\n";
WALK.SHADERS["editor_light_vertex.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nvarOut vec3 vNormal;\nvarOut vec3 vViewPosition;\nvoid main() {\nvec3 normal = sphericalDecode(sphericalNormal);\nvNormal = normalize(normalMatrix * normal);\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nvViewPosition = -mvPosition.xyz;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["equirect_sky_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\nuniform sampler2D map;\nuniform float exposure;\nuniform float cameraGamma;\nvarIn vec2 vUv;\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D lut, in vec3 color) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(lut, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(lut, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color0, color1, bOffset);\n}\nuniform sampler2D colorMap;\n#endif\nvoid main() {\n#ifdef USE_RGBM_MAP\nvec4 colorRgbm = texture2D(map, vUv);\nvec3 colorLinear = hdrDecode(colorRgbm);\n#else\nvec3 colorLinear = gammaToLinear(texture2D(map, vUv).xyz);\n#endif\n#ifdef HDR_OUTPUT\n#ifdef USE_RGBM_MAP\nfragColor = colorRgbm;\n#else\nfragColor = hdrEncode(10.0 * colorLinear);\n#endif\n#else\nvec3 colorExposed = pow(exposure * colorLinear, vec3(cameraGamma));\nvec3 colorGamma =  linearToGammaUnreal(colorExposed);\n#ifdef USE_COLORMAP\nfragColor = vec4(colormap(colorMap, colorGamma), 1.0);\n#else\nfragColor = vec4(colorGamma, 1.0);\n#endif\n#endif\n}\n";
WALK.SHADERS["equirect_sky_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["gaze_pointer_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nconst float pointRadius = 0.01;\nconst float pointBorder = 0.005;\nconst float timerRadius = 0.04;\nconst float timerBorder = 0.02;\nconst vec3 timerColor =  vec3(0.298, 0.619, 0.851);\nvarIn vec2 coords;\nuniform float circleSpan;\nvoid main() {\nfloat dist =  sqrt(dot(coords, coords));\nif (dist < pointRadius) {\nfloat a = 1.0 - smoothstep(pointRadius - pointBorder, pointRadius, dist);\nfragColor = vec4(1.0, 1.0, 1.0, a);\n} else if (-atan(coords.x, -coords.y) < circleSpan) {\nfloat a2 = smoothstep(timerRadius - timerBorder, timerRadius, dist) -\nsmoothstep(timerRadius, timerRadius + timerBorder, dist);\nfragColor = vec4(timerColor, a2);\n} else {\ndiscard;\n}\n}\n";
WALK.SHADERS["gaze_pointer_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 coords;\nvoid main() {\ncoords = vec2(position.x, position.y);\nvec4 outPosition = projectionMatrix *  modelViewMatrix * vec4(position, 1.0);\noutPosition.z = -0.1;\ngl_Position = outPosition;\n}\n";WALK.SHADERS["luma_fragment.glsl"]="//AUTO GENERATED\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\n#ifdef USE_LIGHTMAP\nwebgl2centroid varIn vec2 vUv2;\nuniform sampler2D lightMap;\nvec3 getLightIntensity() {\nreturn hdrDecode(texture2D(lightMap, vUv2));\n}\n#else // NOT USE_LIGHTMAP\nvec3 getLightIntensity() {\nreturn vec3(1.0);\n}\n#endif\nuniform vec3 color;\nvoid main() {\nvec3 receivedLight = getLightIntensity();\nvec3 diffuseLight = receivedLight * color;\nfloat luma = 0.299 * diffuseLight.r +\n0.587 * diffuseLight.g +\n0.114 * diffuseLight.b;\nfragColor.r = fract(luma);\nfragColor.g = floor(luma) / 255.0;\n}\n";
WALK.SHADERS["mirror_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 mirrorColor;\nuniform sampler2D mirrorSampler;\nvarIn vec4 mirrorCoord;\nfloat blendOverlay(float base, float blend) {\nreturn (base < 0.5 ? (2.0 * base * blend) :\n(1.0 - 2.0 * (1.0 - base) * (1.0 - blend)));\n}\nvoid main() {\nvec4 color = texture2DProj(mirrorSampler, mirrorCoord);\ncolor = vec4(blendOverlay(mirrorColor.r, color.r),\nblendOverlay(mirrorColor.g, color.g),\nblendOverlay(mirrorColor.b, color.b), 1.0);\nfragColor = color;\n}\n";
WALK.SHADERS["mirror_vertex.glsl"]="//AUTO GENERATED\nuniform mat4 textureMatrix;\nvarOut vec4 mirrorCoord;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nvec4 worldPosition = modelMatrix * vec4(position, 1.0);\nmirrorCoord = textureMatrix * worldPosition;\ngl_Position = projectionMatrix * mvPosition;\n}\n";WALK.SHADERS["object_distance_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarOut vec3 vPositionW;\nvoid main() {\nvec4 transformedPosition = transformPosition();\nvPositionW = (modelMatrix * transformedPosition).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";
WALK.SHADERS["object_id_distance_fragment.glsl"]="//AUTO GENERATED\nuniform int objectId;\nvarIn vec3 vPositionW;\nvoid main(void) {\nfloat cameraDistance = min(distance(cameraPosition, vPositionW), 255.0);\nint x = objectId / 256;\nint y = objectId - 256 * x;\nfloat z = floor(cameraDistance);\nfloat a = fract(cameraDistance);\nfragColor = vec4(float(x) / 255.0, float(y) / 255.0,\nz / 255.0, a);\n}\n";WALK.SHADERS["object_id_fragment.glsl"]="//AUTO GENERATED\nuniform int objectId;\nvarIn vec3 vPositionW;\nvoid main(void) {\nint x = objectId / (256 * 256);\nint y = (objectId - 256 * 256 * x) / 256;\nint z = (objectId - 256 * 256 * x - 256 * y);\nfragColor = vec4(float(x) / 255.0, float(y) / 255.0,\nfloat(z) / 255.0, 0);\n}\n";
WALK.SHADERS["outline_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 color;\nvoid main() {\nfragColor = vec4(color, 1.0);\n}\n";WALK.SHADERS["outline_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nuniform float thickness;\nvoid main() {\nvec3 n = sphericalDecode(sphericalNormal);\nvec3 normal = vec3(\nt0.x * n.x + t0.y * n.y + t0.z * n.z,\nt1.x * n.x + t1.y * n.y + t1.z * n.z,\nt2.x * n.x + t2.y * n.y + t2.z * n.z);\nvec4 transformedPosition = transformPosition();\nfloat distToCamera = cameraPosition.z - transformedPosition.z;\nvec4 movedPosition = vec4(\ntransformedPosition.x - distToCamera * thickness * normal.x,\ntransformedPosition.y - distToCamera * thickness * normal.y,\ntransformedPosition.z, transformedPosition.w);\ngl_Position = projectionMatrix * modelViewMatrix * movedPosition;\n}\n";
WALK.SHADERS["procedural_sky_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nuniform vec3 topColor;\nuniform vec3 bottomColor;\nuniform float sinBottomAngle;\nuniform float exponent;\nvarIn vec3 vWorldDirection;\n#ifdef HDR_OUTPUT\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\n#endif\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D lut, in vec3 color) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(lut, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(lut, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color0, color1, bOffset);\n}\nuniform sampler2D colorMap;\n#endif\nvoid main() {\nfloat sinDirection = normalize(vWorldDirection).z;\nfloat w = max(0.0, (sinDirection - sinBottomAngle) / (1.0 - sinBottomAngle));\nvec3 colorGamma = mix(bottomColor, topColor, pow(w, exponent));\n#ifdef HDR_OUTPUT\nvec3 colorLinear = gammaToLinear(colorGamma);\nfragColor = hdrEncode(10.0 * colorLinear);\n#else\n#ifdef USE_COLORMAP\nfragColor = vec4(colormap(colorMap, colorGamma), 1.0);\n#else\nfragColor = vec4(colorGamma, 1.0);\n#endif\n#endif\n}\n";
WALK.SHADERS["procedural_sky_vertex.glsl"]="//AUTO GENERATED\nvarOut vec3 vWorldDirection;\nvoid main() {\nvec3 positionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvWorldDirection = positionW - cameraPosition;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["rotate_gizmo_material_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 color;\nuniform float opacity;\nuniform vec3 gizmoPosition;\nuniform float sphereRadius;\nvarIn vec4 mPosition;\nvoid discardIfRayIntersectsSphere(vec3 r0, vec3 rd, vec3 s0, float sr) {\nfloat a = dot(rd, rd);\nvec3 s0_r0 = r0 - s0;\nfloat b = 2.0 * dot(rd, s0_r0);\nfloat c = dot(s0_r0, s0_r0) - (sr * sr);\nfloat delta = b * b - 4.0 * a * c;\nif (delta >= 0.0 && -b - sqrt(delta) > 0.0) {\ndiscard;\n}\n}\nvoid main() {\nvec4 outColor;\noutColor.rgb = color;\noutColor.a = opacity;\nvec3 toCamera = normalize(cameraPosition - gizmoPosition);\ndiscardIfRayIntersectsSphere(mPosition.xyz, toCamera, gizmoPosition, sphereRadius);\nfragColor = outColor;\n}\n";
WALK.SHADERS["rotate_gizmo_material_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarOut vec4 mPosition;\nvoid main() {\nvec4 p = vec4(position, 1.0);\nmPosition = modelMatrix * p;\nvec4 mvPosition = modelViewMatrix * p;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["standard_material_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarIn vec3 vNormalW;\nvarIn vec3 vPositionW;\n#endif\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarIn vec2 vUv;\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvarIn vec3 vPositionV;\nvarIn vec3 vNormalV;\nuniform float bumpScale;\nuniform sampler2D bumpTexture;\nvec2 dBumpdxy() {\nvec2 texdx = dFdx(vUv);\nvec2 texdy = dFdy(vUv);\nfloat Hll = bumpScale * texture2D(bumpTexture, vUv).x;\nfloat dBx = bumpScale * texture2D(bumpTexture, vUv + texdx).x - Hll;\nfloat dBy = bumpScale * texture2D(bumpTexture, vUv + texdy).x - Hll;\nreturn vec2(dBx, dBy);\n}\nvec3 perturbNormal(in vec3 surfPos, in vec3 surfNorm) {\nvec2 dBdxy = dBumpdxy();\nvec3 vSigmaX = dFdx(surfPos);\nvec3 vSigmaY = dFdy(surfPos);\nvec3 R1 = cross(vSigmaY, surfNorm);\nvec3 R2 = cross(surfNorm, vSigmaX);\nfloat fDet = dot(vSigmaX, R1);\nvec3 vGrad = sign(fDet) * (dBdxy.x * R1 + dBdxy.y * R2);\nreturn normalize(abs(fDet) * surfNorm - vGrad);\n}\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE\nuniform sampler2D baseColorTexture;\nuniform vec4 baseColorAtlasUvMod;\nuniform float alphaDiscardThreshold;\n#ifdef USE_PARALLAX_CORRECTION\n#endif\n#else\nuniform vec3 baseColor;\n#endif\nuniform float opacity;\nuniform vec4 baseColorCorrection;\nvec3 getBaseColor(out float alpha) {\n#ifdef USE_BASE_COLOR_TEXTURE\n#ifdef USE_PARALLAX_CORRECTION\n#else\nvec2 uv = vUv;\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE_ATLAS_REPEAT\nvec2 uvScaled = uv * baseColorAtlasUvMod.zw;\nvec2 dfdx = dFdx(uvScaled);\nvec2 dfdy = dFdy(uvScaled);\nuv = fract(uv) * baseColorAtlasUvMod.zw + baseColorAtlasUvMod.xy;\nvec4 baseColorGamma = texture2DGradEXT(baseColorTexture, uv, dfdx, dfdy);\nfloat textureAlpha = baseColorGamma.a;\n#else\nuv = uv * baseColorAtlasUvMod.zw + baseColorAtlasUvMod.xy;\n#ifdef USE_ALPHA_IN_LOWER_HALF\nvec4 baseColorGamma = texture2D(baseColorTexture,\nvec2(uv.x, .5 + .5 * uv.y));\nfloat textureAlpha = texture2D(baseColorTexture,\nvec2(uv.x, .5 * uv.y)).r;\n#else\nvec4 baseColorGamma = texture2D(baseColorTexture, uv);\nfloat textureAlpha = baseColorGamma.a;\n#endif\n#endif\nvec3 baseColor = gammaToLinear(baseColorGamma.rgb);\nalpha = opacity * textureAlpha;\n#else // NOT USE_BASE_COLOR_TEXTURE\nalpha = opacity;\n#endif\nvec3 baseColorCorrected = baseColorCorrection.a * baseColor +\nbaseColorCorrection.rgb;\nreturn clamp(baseColorCorrected, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n}\n#ifdef USE_LIGHTMAP\nwebgl2centroid varIn vec2 vUv2;\nuniform sampler2D lightMap;\nvec3 getLightIntensity() {\nreturn hdrDecode(texture2D(lightMap, vUv2));\n}\n#else // NOT USE_LIGHTMAP\nvec3 getLightIntensity() {\nreturn vec3(1.0);\n}\n#endif\n#ifdef USE_ROUGHNESS_TEXTURE\nuniform sampler2D roughnessTexture;\n#else\nuniform float roughness;\n#endif\n#ifdef USE_METALLIC_TEXTURE\nuniform sampler2D metallicTexture;\n#else\nuniform float metallic;\n#endif\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity);\n#if defined(USE_ENVMAP)\nconst float DLT = 0.001;\nuniform samplerCube envMap;\nuniform float envMipsCount;\n#ifdef HAVE_TEXTURE_LOD\n#else\nuniform samplerCube envMap2;\n#endif\nstruct Roughness {\nfloat envFresnel; // (1.0 - roughness)^2, used for Fresnel with env map\nfloat envMipLevel0;\nfloat envMipLevel1;\nfloat envMipMixFactor;\n};\nRoughness getRoughnessFactors() {\nRoughness r;\n#ifdef USE_ROUGHNESS_TEXTURE\nfloat roughness = texture2D(roughnessTexture, vUv).x;\n#endif // else roughness is a uniform\nfloat roughness2 = roughness * roughness;\nfloat maxMipLevel = envMipsCount - 1.0;\nfloat mipSelector = roughness * maxMipLevel;\nr.envMipLevel0 = floor(mipSelector);\nr.envMipLevel1 = min(r.envMipLevel0 + 1.0, maxMipLevel);\nr.envMipMixFactor = fract(mipSelector);\nr.envFresnel = (roughness2 - 2.0 * roughness + 1.0);\nreturn r;\n}\n#ifdef USE_ENVMAP_PROJECT\nuniform vec3 envBoxMin;\nuniform vec3 envBoxMax;\nuniform vec3 envMapPosW;\nconst vec3 infBox = vec3(1000.0);\nvec3 cubeMapProject(vec3 reflectionW) {\nvec3 firstPlaneIntersect = (envBoxMax - vPositionW) / reflectionW;\nvec3 secondPlaneIntersect = (envBoxMin - vPositionW) / reflectionW;\nvec3 furthestPlane = max(firstPlaneIntersect, secondPlaneIntersect);\nvec3 furthestPlaneNonNeg =\nstep(0.0, -furthestPlane) * infBox + abs(furthestPlane);\nfloat distance = min(min(furthestPlaneNonNeg.x, furthestPlaneNonNeg.y),\nfurthestPlaneNonNeg.z);\n/*if (furthestPlane.x > 0.0){\ndistance = furthestPlane.x;\n}\nif (furthestPlane.y > 0.0) {\ndistance = min(distance, furthestPlane.y);\n}\nif (furthestPlane.z > 0.0) {\ndistance = min(distance, furthestPlane.z);\n}*/\nvec3 intersectionPosW = vPositionW + reflectionW * distance;\nreturn intersectionPosW - envMapPosW;\n}\n#endif // USE_ENVMAP_PROJECT\nvec3 fixSeams(vec3 vec, float mipLevel) {\nfloat scale = 1.0 - exp2(mipLevel) / 128.0;\nfloat M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\nif (abs(vec.x) != M) vec.x *= scale;\nif (abs(vec.y) != M) vec.y *= scale;\nif (abs(vec.z) != M) vec.z *= scale;\nreturn vec;\n}\nvec3 getEnvColor(in samplerCube envMap, in Roughness roughness,\nin vec3 reflectionW) {\nvec3 reflectionNormW = normalize(reflectionW);\n#ifdef USE_ENVMAP_PROJECT\nif (envBoxMin.x != envBoxMax.x) {\nreflectionNormW = cubeMapProject(reflectionNormW);\n}\n#endif\nvec3 reflectionNormFixedW = fixSeams(reflectionNormW,\nroughness.envMipLevel0);\n#ifdef HAVE_TEXTURE_LOD\nvec4 cubeColorRaw0 = textureCubeLodEXT(envMap, reflectionNormFixedW,\nroughness.envMipLevel0);\n#else\nvec4 cubeColorRaw0 = textureCube(envMap, reflectionNormFixedW);\n#endif\nvec3 cubeColor0 = hdrDecode(cubeColorRaw0);\n#ifdef HAVE_TEXTURE_LOD\nvec4 cubeColorRaw1 = textureCubeLodEXT(envMap, reflectionNormFixedW,\nroughness.envMipLevel1);\n#else\nvec4 cubeColorRaw1 = textureCube(envMap2, reflectionNormFixedW);\n#endif\nvec3 cubeColor1 = hdrDecode(cubeColorRaw1);\nreturn mix(cubeColor0, cubeColor1, roughness.envMipMixFactor);\n}\nvec3 fresnelSchlickEnv(in vec3 specularColor, in Roughness roughness,\nin float clampCosnv, inout float opacity) {\nfloat fresnel = 1.0 - clampCosnv;\nfloat fresnel2 = fresnel * fresnel;\nfresnel *= fresnel2 * fresnel2;\nfresnel *= roughness.envFresnel;\nopacity = opacity + (1.0 - opacity) * fresnel;\nreturn specularColor + (1.0 - specularColor) * fresnel;\n}\nvec3 getSpecularColor(in vec3 baseColor, float metalic) {\nconst float dielectricF0 = 0.04;\nreturn mix(vec3(dielectricF0), baseColor, metalic);\n}\nfloat getLuminance(in vec3 color) {\nreturn 0.2126 * color.r + 0.7152 * color.g + 0.0722 * color.b;\n}\nvec3 getNormalW() {\n#ifdef USE_BUMP_TEXTURE\nvec3 normalPerturbedV = perturbNormal(-vPositionV, normalize(vNormalV));\nreturn normalize(\ninverseTransformDirection(normalPerturbedV, viewMatrix));\n#else\nreturn normalize(vNormalW);\n#endif\n}\nvec3 addSpecular(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nvec3 totalSpec = vec3(0.0, 0.0, 0.0);\n#ifdef USE_METALLIC_TEXTURE\nfloat metallic = texture2D(metallicTexture, vUv).x;\n#endif // else metallic is a uniform\nvec3 diffuseIntensity = totalIntensity * (1.0 - mix(0.04, 1.0, metallic));\nvec3 viewW = normalize(cameraPosition - vPositionW);\nvec3 normalW = getNormalW();\nfloat clampCosnv = saturate(dot(normalW, viewW));\nvec3 reflectionW = reflect(-viewW, normalW);\nvec3 specularColor = getSpecularColor(baseColor, metallic);\nRoughness roughness = getRoughnessFactors();\nvec3 envColor = getEnvColor(envMap, roughness, reflectionW);\nvec3 fresnel = fresnelSchlickEnv(specularColor, roughness,\nclampCosnv, opacity);\ntotalSpec = envColor * fresnel;\nfloat luminance = getLuminance(totalIntensity);\nreturn (baseColor * diffuseIntensity +\ntotalSpec * mix(0.4, 1.0, luminance));\n}\n#else // NOT USE_ENVMAP\nvec3 addSpecular(vec3 baseColor, in vec3 lightIntensity, in float opacity) {\nreturn baseColor * lightIntensity;\n}\n#endif\n#ifdef USE_HIGHLIGTH\nuniform vec3 highlight;\nuniform float highlightMix;\n#endif\n#if defined(HDR_OUTPUT)\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\n#endif\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D lut, in vec3 color) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(lut, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(lut, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color0, color1, bOffset);\n}\nuniform sampler2D colorMap;\n#endif\n#ifdef USE_CHROMA_KEY\nuniform vec3 chromaKeyColor;\nuniform vec3 chromaKeyDeltaCoeff;\nconst float k32 = sqrt(3.0) / 2.0;\nvec3 rgb2abi(vec3 color) {\nfloat r = color.r;\nfloat g = color.g;\nfloat b = color.b;\nreturn vec3(\nr - 0.5 * g - 0.5 * b,\nk32 * (g - b),\n0.3333 * (r + g + b));\n}\nconst float IPI2 = 0.5 / 3.1415926538;\nvec3 rgb2hci(vec3 color) {\nvec3 abi = rgb2abi(color);\nreturn vec3(\natan(abi.y, abi.x) * IPI2,\nlength(abi.xy),\nabi.z);\n}\nfloat chromaKeyShapeFn(vec3 delta, vec3 color, vec3 key) {\nvec3 diff = color - key;\nvec3 v = delta * vec3(\n0.5 - abs(abs(diff.x) - 0.5),\nabs(diff.y),\nabs(diff.z));\nfloat x = max(v.r, max(v.g, v.b));\nreturn x * x;\n}\nfloat chromaKeyEdgeFn(float a) {\nreturn clamp(.2/.5 * (a - 1.0), 0.0, 1.0);\n}\n#endif\nuniform float emissionStrength;\nuniform float exposure;\nuniform float cameraGamma;\nvoid main() {\nfloat alpha;\nvec3 baseColor = getBaseColor(alpha);\n#ifdef USE_CHROMA_KEY\nfloat dist = chromaKeyShapeFn(chromaKeyDeltaCoeff, rgb2hci(baseColor), rgb2hci(chromaKeyColor));\nalpha *= chromaKeyEdgeFn(dist);\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE\nif (alpha < alphaDiscardThreshold) {\ndiscard;\n}\n#endif\nvec3 lightIntensity = getLightIntensity();\n#ifdef USE_HIGHLIGTH\nbaseColor = mix(baseColor, highlight, highlightMix);\nalpha = mix(alpha, 1.0, highlightMix);\n#endif\nvec3 diffuseSpecular = addSpecularHook(baseColor, lightIntensity, alpha);\n#ifdef USE_HEADLIGHT\nvec3 lightW = normalize(cameraPosition - vPositionW.xyz);\nfloat pointDiffuse = max(dot(normalize(vNormalW), lightW), 0.0);\ndiffuseSpecular *= pointDiffuse;\n#endif\nvec3 diffuseSpecularEmissive = diffuseSpecular + baseColor * emissionStrength;\n#ifdef HDR_OUTPUT\nif (alpha < 0.5) {\ndiscard;\n}\nfragColor = hdrEncode(diffuseSpecularEmissive);\n#else // no HDR_OUTPUT\nvec3 exposedColor = pow(exposure * diffuseSpecularEmissive.xyz,\nvec3(cameraGamma));\nvec3 gammaColor =  linearToGammaUnreal(exposedColor);\n#ifdef USE_COLORMAP\nfragColor = vec4(colormap(colorMap, min(gammaColor, 1.0)), alpha);\n#else\nfragColor = vec4(gammaColor, alpha);\n#endif\n#endif // no HDR_OUTPUT\n}\n";
WALK.SHADERS["standard_material_vertex.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarOut vec2 vUv;\nuniform vec4 uvMod;\n#endif\n#ifdef USE_LIGHTMAP\nwebgl2centroid varOut vec2 vUv2;\n#endif\n#ifdef USE_BUMP_TEXTURE\nvarOut vec3 vPositionV;\nvarOut vec3 vNormalV;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarOut vec3 vNormalW;\nvarOut vec3 vPositionW;\n#endif\nvoid main() {\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvUv = uv * uvMod.zw + uvMod.xy;\n#endif\nvec4 transformedPosition = transformPosition();\nvec4 mvPosition = modelViewMatrix * transformedPosition;\n#ifdef USE_LIGHTMAP\nfloat zeroOrOne = min(uv2.x + uv2.y, 1.0);\nvUv2 = uv2 * uv2Mod.zw + uv2Mod.xy * zeroOrOne;\n#endif\n#if defined(USE_BUMP_TEXTURE) || defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvec3 n = sphericalDecode(sphericalNormal);\nvec3 normal = vec3(\nt0.x * n.x + t0.y * n.y + t0.z * n.z,\nt1.x * n.x + t1.y * n.y + t1.z * n.z,\nt2.x * n.x + t2.y * n.y + t2.z * n.z);\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvPositionV = -mvPosition.xyz;\nvNormalV = normalize(normalMatrix * normal);\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvNormalW = mat3(modelMatrix[0].xyz,\nmodelMatrix[1].xyz,\nmodelMatrix[2].xyz) * normal;\nvNormalW = normalize(vNormalW);\nvPositionW = (modelMatrix * transformedPosition).xyz;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["static_render_fragment.glsl"]="//AUTO GENERATED\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nuniform sampler2D staticRender;\nuniform vec2 sizeInv;\nvoid main() {\nvec3 colorLinear = texture2D(staticRender, gl_FragCoord.xy * sizeInv).rgb;\nfragColor = vec4(linearToGammaUnreal(colorLinear), 1.0);\n}\n";
WALK.SHADERS["static_render_vertex.glsl"]="//AUTO GENERATED\nvoid main() {\ngl_Position = modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["water.glsl"]="//AUTO GENERATED\n#ifdef USE_NORMAL_TEXTURE\nuniform float time;\nuniform float wavesScale;\nuniform float refractionFactor;\nuniform sampler2D normalTexture;\nvec4 getNoise(in vec2 uv) {\nvec2 uv0 = (uv / 103.0) + vec2(time / 17.0, time / 29.0);\nvec2 uv1 = uv / 107.0 - vec2(time / -19.0, time / 31.0);\nvec2 uv2 = uv / vec2(897.0, 983.0) + vec2(time / 101.0, time / 97.0);\nvec2 uv3 = uv / vec2(991.0, 877.0) - vec2(time / 109.0, time / -113.0);\nvec4 noise = texture2D(normalTexture, uv0) +\ntexture2D(normalTexture, uv1) +\ntexture2D(normalTexture, uv2) +\ntexture2D(normalTexture, uv3);\nreturn noise * 0.5 - 1.0;\n}\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nvec3 toEyeW = cameraPosition - vPositionW;\nvec3 viewW = normalize(toEyeW);\nvec4 noise = getNoise(vPositionW.xy * wavesScale);\nvec3 normalW = normalize(noise.xyz);\nfloat clampCosnv = saturate(dot(normalW, viewW));\nRoughness roughness;\nroughness.envMipLevel0 = 0.0;\nroughness.envMipLevel1 = 0.0;\nroughness.envMipMixFactor = 0.0;\nroughness.envFresnel = 1.0;\nconst float waterF0 = 0.02;\nvec3 specularColor = vec3(waterF0);\nvec3 reflectionW = reflect(-viewW, normalW);\nvec3 refractionW = refract(-viewW, normalW, 0.75);\nvec3 reflectedEnv = getEnvColor(envMap, roughness, normalize(reflectionW));\nvec3 refractedEnv = refractionFactor *\ngetEnvColor(envMap, roughness, normalize(refractionW));\nvec3 fresnel = fresnelSchlickEnv(specularColor, roughness,\nclampCosnv, opacity);\nvec3 totalSpec = reflectedEnv * fresnel + refractedEnv * (1.0 - fresnel);\nvec3 diffuseIntensity = totalIntensity * 0.98;\nfloat luminance = getLuminance(totalIntensity);\nreturn totalSpec * mix(0.4, 1.0, luminance) + baseColor * diffuseIntensity;\n}\n#else // NOT USE_NORMAL_TEXTURE\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nreturn baseColor * totalIntensity;\n}\n#endif\n";
WALK.SHADERS["wireframe_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 lineColor;\nuniform float lineMaxAlpha;\nuniform vec3 highlight;\nuniform float highlightMix;\nvarIn vec3 vBaryCentric;\nfloat edgeFactor(){\nvec3 d = fwidth(vBaryCentric);\nvec3 r = smoothstep(vec3(0.0), d * 1.5, vBaryCentric);\nreturn min(min(r.x, r.y), r.z);\n}\nvoid main(void){\nfloat edge = edgeFactor();\nif (edge < 1.0) {\nfragColor = vec4(lineColor, (1.0 - edge) * lineMaxAlpha);\n} else {\nfragColor = vec4(highlight, highlightMix);\n}\n}\n";
WALK.SHADERS["wireframe_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nattr float order;\nvarOut vec3 vBaryCentric;\nvoid main() {\nif (order == 0.0) {\nvBaryCentric = vec3(1.0, 0.0, 0.0);\n} else if (order == 1.0) {\nvBaryCentric = vec3(0.0, 1.0, 0.0);\n} else {\nvBaryCentric = vec3(0.0, 0.0, 1.0);\n}\nvec4 transformedPosition = transformPosition();\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";(function(){WALK.Shader=function(b,c){this.id=b;this.code=c};var a=0;WALK.InlineShader=function(b){WALK.Shader.call(this,"inline:"+a,b);a+=1};WALK.getShader=function(b){return new WALK.Shader(b,WALK.SHADERS[b])}})();(function(){var a=0,b=[0,0],c=Object.freeze({uv:b,uv2:b,uv2Mod:[0,0,1/65535,1/65535],t0:[1,0,0,0],t1:[0,1,0,0],t2:[0,0,1,0]}),d=Object.freeze("position sphericalNormal uv uv2 uv2Mod t0 t1 t2".split(" ")),e=new WALK.InlineShader("");WALK.BaseMaterial=function(f,g,k){k=void 0===k?e:k;a+=1;Object.defineProperty(this,"id",{value:a});this.name="";this.side=THREE.FrontSide;this.doNotOverrideSide=!1;this.opacity=1;this.transparent=!1;this.transparentRenderOrder=0;this.blending=THREE.NoBlending;this.blendSrc=
GLC.SRC_ALPHA;this.blendDst=GLC.ONE_MINUS_SRC_ALPHA;this.blendEquation=GLC.FUNC_ADD;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.colorWrite=this.depthWrite=this.depthTest=!0;this._hideFromLightProbes=!1;this._defines=new Set;this._definesString=null;this._textureLodExtension=this._standardDerivativesExtension=!1;this.uniforms={};this.attributes=d;this._vertexShaderBody=f;this._fragmentShaderBody=g;this._fragmentShaderHooks=k;this.defaultAttributeValues=c;this.index0AttributeName=
void 0;this._programNeedsUpdate=this.visible=!0;this.program=null};WALK.BaseMaterial.prototype={constructor:WALK.BaseMaterial,get isAnimated(){return!1},get isPlaying(){return!1},update:function(f){},play:function(){console.assert(!1)},pause:function(){console.assert(!1)},get hideFromLightProbes(){return this._hideFromLightProbes},set hideFromLightProbes(f){this._hideFromLightProbes=f},get programNeedsUpdate(){return this._programNeedsUpdate},set programNeedsUpdate(f){this._definesString=null;this._programNeedsUpdate=
f},hasDefine:function(f){return this._defines.has(f)},addDefine:function(f){this.hasDefine(f)||(this._defines.add(f),this.programNeedsUpdate=!0)},removeDefine:function(f){this.hasDefine(f)&&(this._defines.delete(f),this.programNeedsUpdate=!0)},condDefine:function(f,g){f?this.addDefine(g):this.removeDefine(g);return f},_getDefinesString:function(){if(null===this._definesString){for(var f=[],g=$jscomp.makeIterator(this._defines),k=g.next();!k.done;k=g.next())f.push("#define "+k.value);f.sort();this._definesString=
f.join("\n")}return this._definesString},generateProgramId:function(){return[this._fragmentShaderBody.id,this._fragmentShaderHooks.id,this._getDefinesString(),this._vertexShaderBody.id,this._standardDerivativesExtension?"+":"",this._textureLodExtension?"+":""].join("$")},enableStandardDerivativesExtension:function(){WALK.DETECTOR.gl.webgl2||this._standardDerivativesExtension||(this.programNeedsUpdate=this._standardDerivativesExtension=!0)},enableTextureLodExtension:function(){WALK.DETECTOR.gl.webgl2||
this._textureLodExtension||(this.programNeedsUpdate=this._textureLodExtension=!0)},_getShaderHeader:function(){return WALK.DETECTOR.gl.webgl2?"#version 300 es\n#define texture2D texture\n#define textureCube texture\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define attr in\n#define varOut out\n#define varIn in\n#define webgl2centroid centroid\n":"\n#define attr attribute\n#define varOut varying\n#define varIn varying\n#define webgl2centroid\n"},generateVertexShader:function(){return[this._getShaderHeader(),
"precision highp float;\nprecision highp int;",this._getDefinesString(),"uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattr vec3 position;\nattr vec2 sphericalNormal;\nattr vec2 uv;\nattr vec2 uv2;\nattr vec4 uv2Mod;\nattr vec4 t0;\nattr vec4 t1;\nattr vec4 t2;",this._vertexShaderBody.code].join("\n")},generateFragmentShader:function(){return[this._getShaderHeader(),this._standardDerivativesExtension?
"#extension GL_OES_standard_derivatives : enable":"",this._textureLodExtension?"#extension GL_EXT_shader_texture_lod : require":"","precision "+WALK.DETECTOR.gl.fragmentPrecision+" float;","precision "+WALK.DETECTOR.gl.fragmentPrecision+" int;",this._getDefinesString(),"uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;",WALK.DETECTOR.gl.webgl2?"out vec4 fragColor;":"#define fragColor gl_FragColor",this._fragmentShaderBody.code,this._fragmentShaderHooks.code].join("\n")},dispose:function(){this.dispatchEvent({type:"dispose"})},
setUniform:function(f,g,k){this.uniforms[f]={type:g,value:k}},propertyFromUniform:function(f){Object.defineProperty(this,f,{get:function(){return this.uniforms[f].value},set:function(g){this.uniforms[f].value=g}})},hash:function(){console.assert(!1,"hash not implemented")},canMerge:function(f){console.assert(!1,"canMerge not implemented")}};THREE.EventDispatcher.prototype.apply(WALK.BaseMaterial.prototype)})();(function(){WALK.CompressedTextureLoader=function(){this._parser=null};WALK.CompressedTextureLoader.prototype={constructor:WALK.CompressedTextureLoader,load:function(a,b,c,d){var e=this,f=[],g=new WALK.CompressedTexture;g.image=f;WALK.queueAjaxGet(a,b,!0,function(k){k=e._parser(k,!0);if(k.isCubemap)for(var h=k.mipmaps.length/k.mipmapCount,m=0;m<h;m+=1){f[m]={mipmaps:[]};for(var l=0;l<k.mipmapCount;l+=1)f[m].mipmaps.push(k.mipmaps[m*k.mipmapCount+l]),f[m].format=k.format,f[m].width=k.width,f[m].height=
k.height}else g.image.width=k.width,g.image.height=k.height,g.mipmaps=k.mipmaps;1===k.mipmapCount&&(g.minFilter=GLC.LINEAR);g.format=k.format;g.width=k.width;g.height=k.height;c&&c(g)},d);return g}}})();THREE.FXAAShader={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)}},vertexShader:new WALK.InlineShader("void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"),fragmentShader:new WALK.InlineShader("uniform sampler2D tDiffuse;\nuniform vec2 resolution;\n#define FXAA_REDUCE_MIN   (1.0/128.0)\n#define FXAA_REDUCE_MUL   (1.0/8.0)\n#define FXAA_SPAN_MAX     8.0\nvoid main() {\nvec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;\nvec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;\nvec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );\nvec3 rgbM  = rgbaM.xyz;\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat lumaNW = dot( rgbNW, luma );\nfloat lumaNE = dot( rgbNE, luma );\nfloat lumaSW = dot( rgbSW, luma );\nfloat lumaSE = dot( rgbSE, luma );\nfloat lumaM  = dot( rgbM,  luma );\nfloat lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\nfloat lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\nvec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\nfloat rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\ndir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),\nmax( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\ndir * rcpDirMin)) * resolution;\nvec4 rgbA = (1.0/2.0) * (\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (1.0/3.0 - 0.5)) +\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (2.0/3.0 - 0.5)));\nvec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (0.0/3.0 - 0.5)) +\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (3.0/3.0 - 0.5)));\nfloat lumaB = dot(rgbB, vec4(luma, 0.0));\nif ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {\nfragColor = rgbA;\n} else {\nfragColor = rgbB;\n}\n}")};THREE.EffectComposer=function(a){this.renderer=a;this.renderTarget2=this.renderTarget1=null;this.passes=[]};
THREE.EffectComposer.prototype={addPass:function(a){this.passes.push(a)},disposeTarget:function(){this.renderTarget1&&(this.renderTarget1.dispose(),this.renderTarget1=null);this.renderTarget2&&(this.renderTarget2.dispose(),this.renderTarget2=null)},configureTarget:function(a,b,c){this.disposeTarget();this.renderTarget1=this.renderer.createRenderTarget(a,b,c);this.renderTarget2=this.renderer.createRenderTarget(a,b,c)},render:function(){var a,b;return function(c){a=this.renderTarget1;b=this.renderTarget2;
var d,e=this.passes.length;for(d=0;d<e;d++){var f=this.passes[d];f.enabled&&(f.render(this.renderer,a,b,c),f.needsSwap&&d!=e-1&&(f=b,b=a,a=f))}}}()};THREE.ShaderPass=function(a,b){this.textureID=void 0!==b?b:"tDiffuse";this.material=new WALK.BaseMaterial(a.vertexShader,a.fragmentShader);this.material.uniforms=THREE.UniformsUtils.clone(a.uniforms);this.uniforms=this.material.uniforms;this.renderToScreen=!1;this.needsSwap=this.enabled=!0;this.clear=!1;this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);this.scene=new THREE.Scene;this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),this.material);this.scene.add(this.quad)};
THREE.ShaderPass.prototype={render:function(a,b,c,d){if(d=this.material.uniforms[this.textureID])d.value=c;this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)},dispose:function(){this.material.dispose();this.quad.geometry.dispose()}};THREE.RenderPass=function(a,b,c){this.scene=a;this.camera=b;this.overrideMaterial=c;this.needsSwap=this.clear=this.enabled=!0};THREE.RenderPass.prototype={render:function(a,b,c,d){c=this.scene.overrideMaterial;this.overrideMaterial&&(this.scene.overrideMaterial=this.overrideMaterial);a.render(this.scene,this.camera,b,this.clear);this.scene.overrideMaterial=c}};(function(a){function b(f){return!isNaN(f)&&isFinite(f)}function c(f,g){for(var k=0,h=f.length;k<h;k++)if(f[k]===g)return k;return-1}a.Octree=function(f){f=f||{};this.nodeCount=0;this.INDEX_INSIDE_CROSS=-1;this.INDEX_OUTSIDE_OFFSET=2;this.INDEX_OUTSIDE_POS_X=b(f.INDEX_OUTSIDE_POS_X)?f.INDEX_OUTSIDE_POS_X:0;this.INDEX_OUTSIDE_NEG_X=b(f.INDEX_OUTSIDE_NEG_X)?f.INDEX_OUTSIDE_NEG_X:1;this.INDEX_OUTSIDE_POS_Y=b(f.INDEX_OUTSIDE_POS_Y)?f.INDEX_OUTSIDE_POS_Y:2;this.INDEX_OUTSIDE_NEG_Y=b(f.INDEX_OUTSIDE_NEG_Y)?
f.INDEX_OUTSIDE_NEG_Y:3;this.INDEX_OUTSIDE_POS_Z=b(f.INDEX_OUTSIDE_POS_Z)?f.INDEX_OUTSIDE_POS_Z:4;this.INDEX_OUTSIDE_NEG_Z=b(f.INDEX_OUTSIDE_NEG_Z)?f.INDEX_OUTSIDE_NEG_Z:5;this.INDEX_OUTSIDE_MAP=[];this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_X]={index:this.INDEX_OUTSIDE_POS_X,count:0,x:1,y:0,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_X]={index:this.INDEX_OUTSIDE_NEG_X,count:0,x:-1,y:0,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Y]={index:this.INDEX_OUTSIDE_POS_Y,count:0,x:0,y:1,z:0};
this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Y]={index:this.INDEX_OUTSIDE_NEG_Y,count:0,x:0,y:-1,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Z]={index:this.INDEX_OUTSIDE_POS_Z,count:0,x:0,y:0,z:1};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Z]={index:this.INDEX_OUTSIDE_NEG_Z,count:0,x:0,y:0,z:-1};this.FLAG_POS_X=1<<this.INDEX_OUTSIDE_POS_X+1;this.FLAG_NEG_X=1<<this.INDEX_OUTSIDE_NEG_X+1;this.FLAG_POS_Y=1<<this.INDEX_OUTSIDE_POS_Y+1;this.FLAG_NEG_Y=1<<this.INDEX_OUTSIDE_NEG_Y+1;this.FLAG_POS_Z=
1<<this.INDEX_OUTSIDE_POS_Z+1;this.FLAG_NEG_Z=1<<this.INDEX_OUTSIDE_NEG_Z+1;this.utilVec31Search=new a.Vector3;this.utilVec32Search=new a.Vector3;if(this.scene=f.scene)this.visualGeometry=new a.BoxBufferGeometry(1,1,1),this.visualGeometry.addTriangleOrderAttribute(),this.visualMaterial=new WALK.WireframeMaterial(new a.Color(65280));this.depthMax=b(f.depthMax)?f.depthMax:Infinity;this.objectsThreshold=b(f.objectsThreshold)?f.objectsThreshold:8;this.overlapPct=b(f.overlapPct)?f.overlapPct:.15;this.root=
new a.OctreeNode({tree:this,parent:null,position:new a.Vector3})};a.Octree.prototype={add:function(f,g,k){g||(g=f.geometry.boundingSphere.center,k=f.geometry.boundingSphere.radius);0!==k&&this.root.addObject(new a.OctreeObjectData(f,g,k))},search:function(f,g,k){var h,m=[];this.root.appendObjectsFromNode(m);0<g||(g=Number.MAX_VALUE);if(k instanceof a.Vector3){k=this.utilVec31Search.copy(k).normalize();var l=this.utilVec32Search.set(1,1,1).divide(k)}var q=0;for(h=this.root.nodesIndices.length;q<h;q++){var n=
this.root.nodesByIndex[this.root.nodesIndices[q]];n.search(f,g,k,l,m)}return m},setRoot:function(f){f instanceof a.OctreeNode&&(this.root=f,this.root.updateProperties())},getDepthEnd:function(){return this.root.getDepthEnd()},getNodeCountEnd:function(){return this.root.getNodeCountEnd()},getObjectCountEnd:function(){return this.root.getObjectCountEnd()},toConsole:function(){this.root.toConsole()}};a.OctreeObjectData=function(f,g,k){this.object=f;this.radius=k;this.position=g};var d=new a.Vector3,
e=new a.Vector3;new a.Vector3;a.OctreeNode=function(f){this.tree=f.tree;this.id=this.tree.nodeCount++;this.position=f.position;this.radius=0<f.radius?f.radius:1;this.indexOctant=f.indexOctant;this.depth=0;this.reset();this.setParent(f.parent);this.overlap=this.radius*this.tree.overlapPct;this.radiusOverlap=this.radius+this.overlap;this.left=this.position.x-this.radiusOverlap;this.right=this.position.x+this.radiusOverlap;this.bottom=this.position.y-this.radiusOverlap;this.top=this.position.y+this.radiusOverlap;
this.back=this.position.z-this.radiusOverlap;this.front=this.position.z+this.radiusOverlap;this.tree.scene&&(this.visual=new a.Mesh(this.tree.visualGeometry,this.tree.visualMaterial),this.visual.scale.set(2*this.radiusOverlap,2*this.radiusOverlap,2*this.radiusOverlap),this.visual.position.copy(this.position),this.tree.scene.add(this.visual),this.tree.scene.updateMatrixWorld())};a.OctreeNode.prototype={setParent:function(f){f!==this&&this.parent!==f&&(this.parent=f,this.updateProperties())},updateProperties:function(){var f;
this.parent instanceof a.OctreeNode?(this.tree=this.parent.tree,this.depth=this.parent.depth+1):this.depth=0;var g=0;for(f=this.nodesIndices.length;g<f;g++)this.nodesByIndex[this.nodesIndices[g]].updateProperties()},reset:function(f,g){var k,h=this.nodesIndices||[],m=this.nodesByIndex;this.objects=[];this.nodesIndices=[];this.nodesByIndex={};var l=0;for(k=h.length;l<k;l++){var q=m[h[l]];q.setParent(void 0);!0===f&&q.reset(f,g)}!0===g&&this.visual&&this.visual.parent&&this.visual.parent.remove(this.visual)},
addNode:function(f,g){f.indexOctant=g;-1===c(this.nodesIndices,g)&&this.nodesIndices.push(g);this.nodesByIndex[g]=f;f.parent!==this&&f.setParent(this)},removeNode:function(f){var g=c(this.nodesIndices,f);this.nodesIndices.splice(g,1);var k=k||this.nodesByIndex[f];delete this.nodesByIndex[f];k.parent===this&&k.setParent(void 0)},addObject:function(f){var g=this.getOctantIndex(f);-1<g&&0<this.nodesIndices.length?(g=this.branch(g),g.addObject(f)):-1>g&&this.parent instanceof a.OctreeNode?this.parent.addObject(f):
(g=c(this.objects,f),-1===g&&this.objects.push(f),f.node=this,this.checkGrow())},addObjectWithoutCheck:function(f){var g;var k=0;for(g=f.length;k<g;k++){var h=f[k];this.objects.push(h);h.node=this}},checkGrow:function(){this.objects.length>this.tree.objectsThreshold&&0<this.tree.objectsThreshold&&this.grow()},grow:function(){var f=[],g=[],k=[],h=[],m=[],l;var q=0;for(l=this.objects.length;q<l;q++){var n=this.objects[q];var p=this.getOctantIndex(n);-1<p?(k.push(n),h.push(p)):-1>p?(f.push(n),g.push(p)):
m.push(n)}0<k.length&&(m=m.concat(this.split(k,h)));0<f.length&&(m=m.concat(this.expand(f,g)));this.objects=m;this.checkMerge()},split:function(f,g){var k;if(this.depth<this.tree.depthMax){f=f||this.objects;g=g||[];var h=[];var m=0;for(k=f.length;m<k;m++){var l=f[m];var q=g[m];-1<q?(q=this.branch(q),q.addObject(l)):h.push(l)}f===this.objects&&(this.objects=h)}else h=this.objects;return h},branch:function(f){if(this.nodesByIndex[f]instanceof a.OctreeNode)var g=this.nodesByIndex[f];else{g=.5*this.radiusOverlap;
var k=g*this.tree.overlapPct;k=g-k;k=d.set(f&1?k:-k,f&2?k:-k,f&4?k:-k);k=(new a.Vector3).addVectors(this.position,k);g=new a.OctreeNode({tree:this.tree,parent:this,position:k,radius:g,indexOctant:f});this.addNode(g,f)}return g},expand:function(f,g){var k,h=this.tree.INDEX_OUTSIDE_MAP;if(this.tree.root.getDepthEnd()<this.tree.depthMax){f=f||this.objects;g=g||[];var m=[];var l=[];var q=0;for(k=h.length;q<k;q++)h[q].count=0;q=0;for(k=f.length;q<k;q++){var n=f[q];var p=g[q];-1>p?(p=-p-this.tree.INDEX_OUTSIDE_OFFSET,
p&this.tree.FLAG_POS_X?h[this.tree.INDEX_OUTSIDE_POS_X].count++:p&this.tree.FLAG_NEG_X&&h[this.tree.INDEX_OUTSIDE_NEG_X].count++,p&this.tree.FLAG_POS_Y?h[this.tree.INDEX_OUTSIDE_POS_Y].count++:p&this.tree.FLAG_NEG_Y&&h[this.tree.INDEX_OUTSIDE_NEG_Y].count++,p&this.tree.FLAG_POS_Z?h[this.tree.INDEX_OUTSIDE_POS_Z].count++:p&this.tree.FLAG_NEG_Z&&h[this.tree.INDEX_OUTSIDE_NEG_Z].count++,l.push(n)):m.push(n)}if(0<l.length){var r=h.slice(0);r.sort(function(u,A){return A.count-u.count});p=r[0];q=p.index|
1;n=r[1];h=r[2];g=(n.index|1)!==q?n:h;k=g.index|1;n=r[2];h=r[3];r=r[4];var x=n.index|1;var w=h.index|1;n=x!==q&&x!==k?n:w!==q&&w!==k?h:r;q=p.x+g.x+n.x;k=p.y+g.y+n.y;g=p.z+g.z+n.z;p=this.getOctantIndexFromPosition(q,k,g);g=this.getOctantIndexFromPosition(-q,-k,-g);k=this.overlap;n=this.radius;q=0<this.tree.overlapPct?k/(.5*this.tree.overlapPct*(1+this.tree.overlapPct)):2*n;h=q*this.tree.overlapPct;k=q+h-(n+k);e.set(p&1?k:-k,p&2?k:-k,p&4?k:-k);p=(new a.Vector3).addVectors(this.position,e);p=new a.OctreeNode({tree:this.tree,
position:p,radius:q});p.addNode(this,g);this.tree.setRoot(p);q=0;for(k=l.length;q<k;q++)this.tree.root.addObject(l[q])}f===this.objects&&(this.objects=m)}else m=f;return m},shrink:function(){this.checkMerge();this.tree.root.checkContract()},checkMerge:function(){for(var f=this,g;f.parent instanceof a.OctreeNode&&f.getObjectCountEnd()<this.tree.objectsThreshold;)g=f,f=f.parent;f!==this&&f.merge(g)},merge:function(f){var g;f=f?"[object Array]"===Object.prototype.toString.call(f)!==!0?[f]:f:[];var k=
0;for(g=f.length;k<g;k++){var h=f[k];this.addObjectWithoutCheck(h.getObjectsEnd());h.reset(!0,!0);this.removeNode(h.indexOctant,h)}this.checkMerge()},checkContract:function(){var f;if(0<this.nodesIndices.length){var g=0;var k=this.objects.length;var h=0;for(f=this.nodesIndices.length;h<f;h++){var m=this.nodesByIndex[this.nodesIndices[h]];var l=m.getObjectCountEnd();k+=l;if(!1===q instanceof a.OctreeNode||l>g){var q=m;g=l}}k-g<this.tree.objectsThreshold&&q instanceof a.OctreeNode&&this.contract(q)}},
contract:function(f){var g;var k=0;for(g=this.nodesIndices.length;k<g;k++){var h=this.nodesByIndex[this.nodesIndices[k]];h!==f&&(f.addObjectWithoutCheck(h.getObjectsEnd()),h.reset(!0,!0))}f.addObjectWithoutCheck(this.objects);this.reset(!1,!0);this.tree.setRoot(f);f.checkContract()},getOctantIndex:function(f){var g=this.position,k=this.radiusOverlap,h=this.overlap,m=0;if(f instanceof a.OctreeObjectData){var l=f.radius;var q=f.position}else f instanceof a.OctreeNode&&(q=f.position,l=0);var n=q.x-g.x;
var p=q.y-g.y;q=q.z-g.z;g=Math.abs(n);var r=Math.abs(p);var x=Math.abs(q);if(Math.max(g,r,x)+l>k)return g+l>k&&(m^=0<n?this.tree.FLAG_POS_X:this.tree.FLAG_NEG_X),r+l>k&&(m^=0<p?this.tree.FLAG_POS_Y:this.tree.FLAG_NEG_Y),x+l>k&&(m^=0<q?this.tree.FLAG_POS_Z:this.tree.FLAG_NEG_Z),f.indexOctant=-m-this.tree.INDEX_OUTSIDE_OFFSET,f.indexOctant;if(n-l>-h)m|=1;else if(!(n+l<h))return f.indexOctant=this.tree.INDEX_INSIDE_CROSS,f.indexOctant;if(p-l>-h)m|=2;else if(!(p+l<h))return f.indexOctant=this.tree.INDEX_INSIDE_CROSS,
f.indexOctant;if(q-l>-h)m|=4;else if(!(q+l<h))return f.indexOctant=this.tree.INDEX_INSIDE_CROSS,f.indexOctant;f.indexOctant=m;return f.indexOctant},getOctantIndexFromPosition:function(f,g,k){var h=0;0<f&&(h|=1);0<g&&(h|=2);0<k&&(h|=4);return h},appendObjectsFromNode:function(f){var g,k=this.objects;var h=0;for(g=k.length;h<g;h+=1)f.push(k[h].object)},search:function(f,g,k,h,m){var l;if(!0===this.intersectRay(f,k,g,h)){this.appendObjectsFromNode(m);var q=0;for(l=this.nodesIndices.length;q<l;q++){var n=
this.nodesByIndex[this.nodesIndices[q]];n.search(f,g,k,h,m)}}},intersectRay:function(f,g,k,h){g=(this.left-f.x)*h.x;var m=(this.right-f.x)*h.x,l=(this.bottom-f.y)*h.y,q=(this.top-f.y)*h.y,n=(this.back-f.z)*h.z;h=(this.front-f.z)*h.z;f=Math.min(Math.min(Math.max(g,m),Math.max(l,q)),Math.max(n,h));if(0>f)return!1;g=Math.max(Math.max(Math.min(g,m),Math.min(l,q)),Math.min(n,h));return g>f||g>k?!1:!0},getDepthEnd:function(f){var g;if(0<this.nodesIndices.length){var k=0;for(g=this.nodesIndices.length;k<
g;k++){var h=this.nodesByIndex[this.nodesIndices[k]];f=h.getDepthEnd(f)}}else f=!f||this.depth>f?this.depth:f;return f},getNodeCountEnd:function(){return this.tree.root.getNodeCountRecursive()+1},getNodeCountRecursive:function(){var f,g=this.nodesIndices.length;var k=0;for(f=this.nodesIndices.length;k<f;k++)g+=this.nodesByIndex[this.nodesIndices[k]].getNodeCountRecursive();return g},getObjectsEnd:function(f){var g;f=(f||[]).concat(this.objects);var k=0;for(g=this.nodesIndices.length;k<g;k++){var h=
this.nodesByIndex[this.nodesIndices[k]];f=h.getObjectsEnd(f)}return f},getObjectCountEnd:function(){var f,g=this.objects.length;var k=0;for(f=this.nodesIndices.length;k<f;k++)g+=this.nodesByIndex[this.nodesIndices[k]].getObjectCountEnd();return g},getObjectCountStart:function(){for(var f=this.objects.length,g=this.parent;g instanceof a.OctreeNode;)f+=g.objects.length,g=g.parent;return f},toConsole:function(f){var g;f="string"===typeof f?f:"   ";console.log(this.parent?f+" octree NODE > ":" octree ROOT > ",
this," // id: ",this.id," // indexOctant: ",this.indexOctant," // position: ",this.position.x,this.position.y,this.position.z," // radius: ",this.radius," // depth: ",this.depth);console.log(this.parent?f+" ":" ","+ objects ( ",this.objects.length," ) ",this.objects);console.log(this.parent?f+" ":" ","+ children ( ",this.nodesIndices.length," )",this.nodesIndices,this.nodesByIndex);var k=0;for(g=this.nodesIndices.length;k<g;k++){var h=this.nodesByIndex[this.nodesIndices[k]];h.toConsole(f+"   ")}}}})(THREE);THREE.PolyhedronBufferGeometry=function(a,b,c,d){function e(m){k.push(m.x,m.y,m.z)}function f(m,l){m*=3;l.x=a[m+0];l.y=a[m+1];l.z=a[m+2]}function g(m,l,q,n){0>n&&1===m.x&&(h[l]=m.x-1);0===q.x&&0===q.z&&(h[l]=n/2/Math.PI+.5)}THREE.BufferGeometry.call(this);this.type="PolyhedronBufferGeometry";this.parameters={vertices:a,indices:b,radius:c,detail:d};c=c||1;d=d||0;var k=[],h=[];(function(m){for(var l=new THREE.Vector3,q=new THREE.Vector3,n=new THREE.Vector3,p=0;p<b.length;p+=3){f(b[p+0],l);f(b[p+1],
q);f(b[p+2],n);var r,x,w=l,u=q,A=n,B=Math.pow(2,m),I=[];for(x=0;x<=B;x++){I[x]=[];var F=w.clone().lerp(A,x/B),E=u.clone().lerp(A,x/B),K=B-x;for(r=0;r<=K;r++)I[x][r]=0===r&&x===B?F:F.clone().lerp(E,r/K)}for(x=0;x<B;x++)for(r=0;r<2*(B-x)-1;r++)w=Math.floor(r/2),0===r%2?(e(I[x][w+1]),e(I[x+1][w]),e(I[x][w])):(e(I[x][w+1]),e(I[x+1][w+1]),e(I[x+1][w]))}})(d);(function(m){for(var l=new THREE.Vector3,q=0;q<k.length;q+=3)l.x=k[q+0],l.y=k[q+1],l.z=k[q+2],l.normalize().multiplyScalar(m),k[q+0]=l.x,k[q+1]=l.y,
k[q+2]=l.z})(c);(function(){for(var m=new THREE.Vector3,l=0;l<k.length;l+=3)m.x=k[l+0],m.y=k[l+1],m.z=k[l+2],h.push(Math.atan2(m.z,-m.x)/2/Math.PI+.5,1-(Math.atan2(-m.y,Math.sqrt(m.x*m.x+m.z*m.z))/Math.PI+.5));m=new THREE.Vector3;l=new THREE.Vector3;for(var q=new THREE.Vector3,n=new THREE.Vector3,p=new THREE.Vector2,r=new THREE.Vector2,x=new THREE.Vector2,w=0,u=0;w<k.length;w+=9,u+=6){m.set(k[w+0],k[w+1],k[w+2]);l.set(k[w+3],k[w+4],k[w+5]);q.set(k[w+6],k[w+7],k[w+8]);p.set(h[u+0],h[u+1]);r.set(h[u+
2],h[u+3]);x.set(h[u+4],h[u+5]);n.copy(m).add(l).add(q).divideScalar(3);var A=Math.atan2(n.z,-n.x);g(p,u+0,m,A);g(r,u+2,l,A);g(x,u+4,q,A)}for(m=0;m<h.length;m+=6)l=h[m+0],q=h[m+2],n=h[m+4],p=Math.min(l,q,n),.9<Math.max(l,q,n)&&.1>p&&(.2>l&&(h[m+0]+=1),.2>q&&(h[m+2]+=1),.2>n&&(h[m+4]+=1))})();this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(k),3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(k.slice()),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(h),
2));0===d?this.computeVertexNormals():this.normalizeNormals()};THREE.PolyhedronBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PolyhedronBufferGeometry.prototype.constructor=THREE.PolyhedronBufferGeometry;THREE.IcosahedronBufferGeometry=function(a,b){var c=(1+Math.sqrt(5))/2;THREE.PolyhedronBufferGeometry.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type="IcosahedronBufferGeometry";this.parameters={radius:a,detail:b}};THREE.IcosahedronBufferGeometry.prototype=Object.create(THREE.PolyhedronBufferGeometry.prototype);
THREE.IcosahedronBufferGeometry.prototype.constructor=THREE.IcosahedronBufferGeometry;(function(){WALK.ColorUtils={linearToGamma:function(a){return.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055},gammaToLinear:function(a){return.04045>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)},hdrEncode:function(a,b){var c=Math.sqrt(a.r)/2.82842712,d=Math.sqrt(a.g)/2.82842712;a=Math.sqrt(a.b)/2.82842712;var e=Math.max(Math.max(c,d),a);e=THREE.Math.clamp(e,1/255,1);e=Math.ceil(255*e)/255;b.setRGB(c/e,d/e,a/e);return 1-e}};THREE.Color.prototype.copyGammaToLinear=void 0;THREE.Color.prototype.copyLinearToGamma=
void 0;THREE.Color.prototype.convertLinearToGamma=void 0;THREE.Color.prototype.convertGammaToLinear=function(){this.r=WALK.ColorUtils.gammaToLinear(this.r);this.g=WALK.ColorUtils.gammaToLinear(this.g);this.b=WALK.ColorUtils.gammaToLinear(this.b)};THREE.Color.prototype.roundChannels=function(){this.r=WALK.round(this.r,3);this.g=WALK.round(this.g,3);this.b=WALK.round(this.b,3);return this}})();/*
 Copyright (C) 2017-present Shapespark
*/
(function(){var a=new THREE.Vector3;WALK.Math={toSnorm8:function(b){return Math.round(127*THREE.Math.clamp(b,-1,1))},minBytesToHold:function(b){return 127>=b?1:32767>=b?2:4},anyPositiveRootOfQuadraticEquation:function(b,c,d){d=c*c-4*b*d;if(0>d)return null;d=Math.sqrt(d);var e=(-c-d)/(2*b);if(0<e)return e;b=(-c+d)/(2*b);return 0<b?b:null},spheresUnion:function(b,c){if(c.empty())c.copy(b);else{var d=c.center.distanceTo(b.center);if(b.radius>c.radius){var e=b;b=c}else e=c;var f=(e.radius+b.radius+d)/
2;f<=e.radius?c.copy(e):(d=(f-e.radius)/d,console.assert(0<d),a.copy(b.center).sub(e.center).multiplyScalar(d),c.center.copy(e.center).add(a),c.radius=f)}}}})();(function(){WALK.Euler=function(a,b,c){THREE.Euler.call(this,b,c,a,"ZXY")};WALK.Euler.prototype=Object.create(THREE.Euler.prototype);WALK.Euler.prototype.constructor=WALK.Euler;Object.defineProperty(WALK.Euler.prototype,"yaw",{get:function(){return this.z},set:function(a){this.z=a}});Object.defineProperty(WALK.Euler.prototype,"pitch",{get:function(){return this.x},set:function(a){this.x=a}});Object.defineProperty(WALK.Euler.prototype,"roll",{get:function(){return this.y},set:function(a){this.y=a}});
Object.defineProperty(WALK.Euler.prototype,"yawDeg",{get:function(){return THREE.Math.radToDeg(this.yaw)},set:function(a){this.yaw=THREE.Math.degToRad(a)}});Object.defineProperty(WALK.Euler.prototype,"pitchDeg",{get:function(){return THREE.Math.radToDeg(this.pitch)},set:function(a){this.pitch=THREE.Math.degToRad(a)}});Object.defineProperty(WALK.Euler.prototype,"rollDeg",{get:function(){return THREE.Math.radToDeg(this.roll)},set:function(a){this.roll=THREE.Math.degToRad(a)}});WALK.Euler.prototype.setFromDegTriple=
function(a){var b=THREE.Math.degToRad(a[0]),c=THREE.Math.degToRad(a[1]);a=THREE.Math.degToRad(a[2]);this.set(c,a,b);return this};WALK.Euler.prototype.toDegTriple=function(){return[this.yawDeg,this.pitchDeg,this.rollDeg]};WALK.Euler.prototype.setFromDirection=function(a){this.set(Math.asin(a.z),0,Math.atan2(-a.x,a.y));return this};WALK.Euler.prototype.toQuaternion=function(){var a=new THREE.Quaternion;a.setFromEuler(this);return a};WALK.Euler.prototype.toRotationMatrix=function(){var a=new THREE.Matrix4;
a.makeRotationFromEuler(this);return a}})();(function(){var a=new THREE.Sphere;WALK.Frustum=function(){this.planes=[new THREE.Plane,new THREE.Plane,new THREE.Plane,new THREE.Plane,new THREE.Plane,new THREE.Plane]};WALK.Frustum.prototype={constructor:WALK.Frustum,setFromMatrix:function(b){var c=this.planes,d=b.elements;b=d[0];var e=d[1],f=d[2],g=d[3],k=d[4],h=d[5],m=d[6],l=d[7],q=d[8],n=d[9],p=d[10],r=d[11],x=d[12],w=d[13],u=d[14];d=d[15];c[0].setComponents(g-b,l-k,r-q,d-x).normalize();c[1].setComponents(g+b,l+k,r+q,d+x).normalize();c[2].setComponents(g+
e,l+h,r+n,d+w).normalize();c[3].setComponents(g-e,l-h,r-n,d-w).normalize();c[4].setComponents(g-f,l-m,r-p,d-u).normalize();c[5].setComponents(g+f,l+m,r+p,d+u).normalize();return this},intersectsObject:function(b){var c=b.geometry;null===c.boundingSphere&&c.computeBoundingSphere();b.matrixWorld?(a.copy(c.boundingSphere),a.applyMatrix4(b.matrixWorld),b=a):b=c.boundingSphere;return this.intersectsSphere(b)},nearPlaneDistanceToCenter:function(b){var c=b.geometry,d=this.planes[5];b.matrixWorld?(a.copy(c.boundingSphere),
a.applyMatrix4(b.matrixWorld),b=a):b=c.boundingSphere;return d.distanceToPoint(b.center)},intersectsSphere:function(b){var c=this.planes,d=b.center;b=-b.radius;for(var e=0;6>e;e+=1)if(c[e].distanceToPoint(d)<b)return!1;return!0},intersectsBox:function(){var b=new THREE.Vector3,c=new THREE.Vector3;return function(d){for(var e=this.planes,f=0;6>f;f+=1){var g=e[f];b.x=0<g.normal.x?d.min.x:d.max.x;c.x=0<g.normal.x?d.max.x:d.min.x;b.y=0<g.normal.y?d.min.y:d.max.y;c.y=0<g.normal.y?d.max.y:d.min.y;b.z=0<
g.normal.z?d.min.z:d.max.z;c.z=0<g.normal.z?d.max.z:d.min.z;var k=g.distanceToPoint(b);g=g.distanceToPoint(c);if(0>k&&0>g)return!1}return!0}}(),containsPoint:function(b){for(var c=this.planes,d=0;6>d;d+=1)if(0>c[d].distanceToPoint(b))return!1;return!0}}})();(function(){WALK.DETECTOR=new function(){function a(h){var m=document.createElement("a");m.href=h;return m.protocol+"//"+m.host}function b(h,m){h=h.toLowerCase();m=m.toLowerCase();return-1!==h.indexOf(m)}function c(h){return navigator&&navigator.userAgent?b(navigator.userAgent,h):!1}function d(h,m){console.assert(void 0===e[h]);e[h]=m;void 0!==e.webp&&(k.forEach(function(l){return l()}),k.length=0)}var e=this;this.https="https:"===window.location.protocol;this.localhost="localhost"===window.location.hostname||
"127.0.0.1"===window.location.hostname;this.canForceBrotliBuffers=!1;this.ipad=/iPad/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints;this.mobile=/mobile|ip(hone|od)|android|silk/i.test(navigator.userAgent)||this.ipad||WALK.urlHashContains("mobile");this.ios=/iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||this.ipad;this.android=/Android/.test(navigator.userAgent);this.facebookApp=/FBAN|FBAV/.test(navigator.userAgent);this.whatsApp=/WhatsApp/.test(navigator.userAgent);
this.inCrossOriginIframe=function(){var h=window.self!==window.top,m=a(document.referrer),l=a(window.location.href);return h&&m!==l}();this.firefox=c("firefox");this.opera=c("opera")||c("OPR/");var f;(f=c("msie"))||(f=navigator&&navigator.appVersion?b(navigator.appVersion,"trident/"):!1);this.ie=f;this.edge=c("edge/");this.safari=c("safari/")&&!(c("chrome/")||c("chromium/"));this.mac=c("macintosh")&&!this.ipad;this.BASIS_DECODE_WORKERS=this.safari||this.ios?0:Math.min(4,navigator.hardwareConcurrency||
4);this.gl=null;var g=function(h){function m(p){var r=q[p];if(void 0!==r)return r;switch(p){case "EXT_texture_filter_anisotropic":r=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":r=h.getExtension("WEBGL_compressed_texture_s3tc")||h.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||h.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case "WEBGL_compressed_texture_pvrtc":r=
h.getExtension("WEBGL_compressed_texture_pvrtc")||h.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case "WEBGL_compressed_texture_etc1":r=h.getExtension("WEBGL_compressed_texture_etc1");break;default:r=h.getExtension(p)}return q[p]=r}function l(){var p=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return p?parseInt(p[2],10):!1}var q={};this.extension=m;this.webgl2="undefined"!==typeof WebGL2RenderingContext&&h instanceof WebGL2RenderingContext;this.antialiasNative=h.getContextAttributes().antialias&&
1<h.getParameter(h.SAMPLES);this.antialiasSamples=h.getParameter(h.SAMPLES);this.antialiasPostprocess=!e.mobile;this.floatTextures=this.webgl2||m("OES_texture_float");this.standardDerivatives=this.webgl2||m("OES_standard_derivatives");this.maxAnisotropy=function(){var p=m("EXT_texture_filter_anisotropic");return null!==p?h.getParameter(p.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}();this.indexUint=this.webgl2||m("OES_element_index_uint");this.instances=this.webgl2||m("ANGLE_instanced_arrays");this.fragmentPrecision=
void 0===h.getShaderPrecisionFormat||0<h.getShaderPrecisionFormat(h.FRAGMENT_SHADER,h.HIGH_FLOAT).precision?"highp":0<h.getShaderPrecisionFormat(h.FRAGMENT_SHADER,h.MEDIUM_FLOAT).precision?"mediump":"lowp";var n=4096>h.getParameter(h.MAX_TEXTURE_SIZE)?"Your graphics card does not have sufficient capabilities, texture sizes 4096x4096 need to be supported.":null;this.missingCapabilities=n;this.maxRenderBufferSize=h.getParameter(h.MAX_RENDERBUFFER_SIZE);this.dxtTextures=function(){try{if(WALK.urlHashContains("nodxt"))return!1;
for(var p=m("WEBGL_compressed_texture_s3tc"),r=h.getParameter(h.COMPRESSED_TEXTURE_FORMATS),x=!1,w=!1,u=0;u<r.length;u+=1)x=x||r[u]===p.COMPRESSED_RGB_S3TC_DXT1_EXT,w=w||r[u]===p.COMPRESSED_RGBA_S3TC_DXT5_EXT;return x&&w}catch(A){}return!1}();n=WALK.urlHashContains("nopvr")?!1:m("WEBGL_compressed_texture_pvrtc");this.pvrtcTextures=n;n=WALK.urlHashContains("noetc1")?!1:m("WEBGL_compressed_texture_etc1")&&e.mobile;this.etc1Textures=n;this.astcTextures=!1;this.textureLod=this.webgl2||m("EXT_shader_texture_lod")&&
(!e.firefox||!e.android);this.mirrorCubeMaps=!e.mobile||WALK.urlHashContains("mobilehi");this.disableTextureSlotReuse=e.mac||83===l();this.reportToConsole=function(){WALK.log("WebGL"+(this.webgl2?"2":"")+"; "+this.fragmentPrecision+" fragment precision.");this.dxtTextures||WALK.log("DXT textures not supported.");this.textureLod||WALK.log("Texture fetch level of detail not supported.");this.floatTextures||WALK.log("Float textures not supported.");this.antialiasNative?WALK.log("Native anti-aliasing supported with "+
this.antialiasSamples+" samples."):WALK.log("Native anti-aliasing not supported");this.disableTextureSlotReuse&&WALK.log("WebGL texture slot reuse disabled.");this.indexUint||WALK.log("Uint index not supported");this.instances||WALK.log("Instanced geometry not supported")}};this.resetGlDetector=function(h){this.gl=new g(h)};this.webp=void 0;var k=[];(function(){var h=new Image;h.onload=function(){d("webp",0<h.width&&0<h.height)};h.onerror=function(){d("webp",!1)};h.src="data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA=="})();
this.onAsyncPropertiesDetected=function(h){void 0!==e.webp?h():this._asyncPropertiesDetectionListeners.push(h)}}})();(function(){WALK.Viewer=function(a,b,c){function d(){return null}function e(L){c.isMaterialEditable(L)||console.assert(!1,"Can't access material, call ViewerApi.setMaterialEditable('"+L+"') before the scene is loaded.")}function f(){for(var L=[],ia=$jscomp.makeIterator(R.materials),Aa=ia.next();!Aa.done;Aa=ia.next())Aa=Aa.value,c.isMaterialEditable(Aa.name)&&L.push(Aa);return L}function g(){for(var L=[],ia=$jscomp.makeIterator(R.nodeConfigs),Aa=ia.next();!Aa.done;Aa=ia.next())Aa=Aa.value,c.isNodeTypeEditable(Aa.name)&&
L.push(Aa.name);return L}function k(L){e(L);for(var ia=$jscomp.makeIterator(R.materials),Aa=ia.next();!Aa.done;Aa=ia.next())if(Aa=Aa.value,Aa.name===L)return Aa;return null}function h(){pa.copy(S.cameraWorldPosition());return pa}function m(){ha.yaw=S.getYawAngle();ha.pitch=S.getPitchAngle();ha.roll=0;return ha}function l(){return R.boundingBox}function q(L){var ia=[];e(L);for(var Aa=$jscomp.makeIterator(R.gpuMeshes),Ia=Aa.next();!Ia.done;Ia=Aa.next())Ia=Ia.value,Ia.material.name===L&&ia.push(Ia);
return ia}function n(L){return(L=R.findNodeConfig(L))?L.nodes.slice(0):[]}function p(L,ia){ia.geometry.isUvs0Repeating&&L.ensureTexturesRepeatable&&L.ensureTexturesRepeatable(ja());ia.material=L;wa.requestFrame()}function r(L,ia){console.warn("setMaterialForNode() is deprecated, use setMaterialForMesh() instead");p(L,ia)}function x(L,ia,Aa){var Ia;(Ia="string"===typeof L?R.findViewByName(L):L)?(!0===ia?ia=0:!1===ia&&(ia=void 0),X.isRunning()&&(ia=0,X.stop()),Aa?(fa.activateSky(Ia),fa.updateHiddenMeshes(Ia)):
fa.switchToView(Ia,ia)):console.error("Unknown view: "+L)}function w(L){L=void 0===L?{}:L;var ia=L.isPanorama||!1,Aa=L.width||(ia?4E3:window.innerWidth),Ia=L.height||(ia?2E3:window.innerHeight);if(L.toDataUrl)return na.monoScreenToDataUrl(ia,Aa,Ia);na.monoScreenToLocalImage(ia,Aa,Ia)}function u(L){R.addAuxiliaryObject(L);L!==L.colliderMesh&&aa.uploadNewBuffers(L.colliderMesh);qa.addDynamicObstacle(L.colliderMesh)}function A(L,ia){for(var Aa=[],Ia=1;Ia<arguments.length;++Ia)Aa[Ia-1]=arguments[Ia];
try{return L.apply(null,$jscomp.arrayFromIterable(Aa))}catch(Ja){console.error(Ja)}return!1}function B(L,ia){for(var Aa=[],Ia=1;Ia<arguments.length;++Ia)Aa[Ia-1]=arguments[Ia];if(L){Ia=$jscomp.makeIterator(L);for(var Ja=Ia.next();!Ja.done;Ja=Ia.next())A.apply(null,[Ja.value].concat($jscomp.arrayFromIterable(Aa)))}}function I(){B(ka.nextPageInteraction);ka.nextPageInteraction.length=0}function F(L,ia){L=new WALK.Anchor(R,L);za.push(L);Ca&&u(L);ka.anchorClicked[L.colliderMesh.id]=ia;J=!0;wa.requestFrame();
return L}function E(L){delete ka.anchorClicked[L.colliderMesh.id];Ca&&(R.removeAuxiliaryObject(L),qa.removeDynamicObstacle(L.colliderMesh));WALK.removeFromArray(L,za);L.dispose();wa.requestFrame()}function K(L,ia){L=new WALK.Avatar(R,L,ia);Ea.push(L);R.addAuxiliaryObject(L,!0);ia=$jscomp.makeIterator(L.colliders);for(var Aa=ia.next();!Aa.done;Aa=ia.next())qa.addDynamicObstacle(Aa.value);B(ka.avatarListChanged);return L}function M(L){for(var ia=$jscomp.makeIterator(L.colliders),Aa=ia.next();!Aa.done;Aa=
ia.next())qa.removeDynamicObstacle(Aa.value);R.removeAuxiliaryObject(L);WALK.removeFromArray(L,Ea);L.dispose();B(ka.avatarListChanged)}function Z(L){return WALK.find(Ea,function(ia){return ia.uuid===L})}function C(){for(var L=$jscomp.makeIterator(R.getAnimatedMaterials()),ia=L.next();!ia.done;ia=L.next())ia.value.sleepAnimation()}function U(){for(var L=$jscomp.makeIterator(R.getAnimatedMaterials()),ia=L.next();!ia.done;ia=L.next())ia.value.wakeAnimation();wa.requestFrame()}function O(L,ia){return ta.getExtension(L,
ia)}function W(L,ia){var Aa=L[ia];if(Aa)return Aa;Aa=[];return L[ia]=Aa}var aa,R=null,S,fa,X,qa,na,xa,wa,ta,sa,Da,Q,J=!1,N=!1,V=null,ra=null,ka={nextPageInteraction:[],viewerConfigLoaded:[],sceneReadyToDisplay:[],sceneLoadComplete:[],anchorClicked:{},materialPickerClicked:{},materialPickerClosed:null,nodeTypeClicked:{},anyNodeTypeClicked:[],materialClicked:{},nodeTypeHoverChanged:{},materialHoverChanged:{},viewSwitchStarted:[],viewSwitchDone:[],vrChange:[],beforeRender:[],anchorsVisibilityChanged:[],
apiUserStateChanged:{},anyApiUserStateChanged:[],meetingJoined:[],avatarListChanged:[]},za=[],Ea=[],pa=new THREE.Vector3,ha=new WALK.Euler,ja=function(){var L=null;return function(){null===L&&(L=new WALK.TextureCropper(aa));return L}}();document.addEventListener("keydown",I);document.addEventListener("mousedown",I);WALK.DETECTOR.ios?document.addEventListener("touchstart",I):document.addEventListener("touchend",I);var Ca=!0;Object.defineProperty(this,"anchorsVisible",{get:function(){return Ca},set:function(L){L!==
Ca&&((Ca=L)?za.forEach(function(ia){return u(ia)}):za.forEach(function(ia){R.removeAuxiliaryObject(ia);qa.removeDynamicObstacle(ia.colliderMesh)}),this.requestFrame(),B(ka.anchorsVisibilityChanged,Ca))}});var Ta=function(){function L(Sa,db,eb){Aa.set(Sa.x,Sa.y,Ra.z).sub(Ra);Sa=Aa.length();Sa>db&&(Aa.normalize().multiplyScalar(Sa-db),eb.add(Aa))}var ia=new THREE.Vector3,Aa=new THREE.Vector3,Ia=new THREE.Vector3,Ja=new WALK.View,Va=new THREE.Sphere,Ra;return function(Sa){Ra=S.cameraWorldPosition();
var db=Ja.position;db.copy(Ra);Sa instanceof WALK.LightInstance&&"sun"===Sa.light.type?(WALK.sunRotationToPosition(R,Sa.rotation,ia),Sa=ia):Sa instanceof WALK.Node?(WALK.computeNodeBoundingSphere(Sa,Va),Sa=Va.center,L(Sa,1+Va.radius,db)):(Sa=Sa.position,L(Sa,1,db));Ia.copy(Sa).sub(db).normalize();Ja.rotation.setFromDirection(Ia);fa.switchToView(Ja)}}();this.openMaterialPicker=function(L,ia,Aa,Ia,Ja){console.assert(!V,"Only one material picker can be opened");V=new WALK.MaterialPicker(L,Ia,Ja,R,S,
xa,Da);V.meshes.forEach(function(Va){R.addAuxiliaryObject(Va);qa.addDynamicObstacle(Va);ka.materialPickerClicked[Va.id]=ia});ka.materialPickerClosed=Aa};this.closeMaterialPicker=function(){V&&(V.meshes.forEach(function(L){R.removeAuxiliaryObject(L);qa.removeDynamicObstacle(L);delete ka.materialPickerClicked[L.id]}),V.dispose(),V=null,ka.materialPickerClosed&&(ka.materialPickerClosed(),ka.materialPickerClosed=null))};this._vrChange=function(L){B(ka.vrChange,L)};this._update=function(L){B(ka.beforeRender,
L)};this._clickListener=function(L,ia,Aa){if(!J)return!1;if(V){var Ia=ka.materialPickerClicked[L.id];if(Ia)return A(Ia,L.material,V.meshes.indexOf(L)),!0;this.closeMaterialPicker();return!0}if(Ia=ka.anchorClicked[L.id])return A(Ia,L.anchor,ia,Aa),!0;Ia=function(Va,Ra){if(Va){Va=$jscomp.makeIterator(Va);for(var Sa=Va.next();!Sa.done;Sa=Va.next())if(A(Sa.value,Ra,ia,Aa))return!0}return!1};for(var Ja=L.node;Ja;Ja=Ja.parent)if(Ia(ka.nodeTypeClicked[Ja.type],L.node))return!0;return L.node&&Ia(ka.anyNodeTypeClicked,
L.node)?!0:L.material?Ia(ka.materialClicked[L.material.name],L.material):!1};this._createHoverListener=function(){var L=ka.nodeTypeHoverChanged,ia=ka.materialHoverChanged,Aa=[];return 0===Object.keys(L).length&&0===Object.keys(ia).length?null:function(Ia,Ja){for(var Va=Ia.node;Va;Va=Va.parent)for(var Ra=$jscomp.makeIterator(L[Va.type]||Aa),Sa=Ra.next();!Sa.done;Sa=Ra.next())if(A(Sa.value,Va,Ja))return!0;if(Ia.material)for(Va=$jscomp.makeIterator(ia[Ia.material.name]||Aa),Sa=Va.next();!Sa.done;Sa=
Va.next())if(A(Sa.value,Ia.material,Ja))return!0;return!1}};this._teleportStarted=function(L){L=L.view;null!==L&&B(ka.viewSwitchStarted,L.name,L)};this._teleportDone=function(L){L=L.view;null!==L&&B(ka.viewSwitchDone,L.name,L)};this._viewerConfigLoaded=function(L){sa=L;B(ka.viewerConfigLoaded,sa);ka.viewerConfigLoaded=[]};this._sceneReadyToDisplay=function(L,ia,Aa,Ia,Ja,Va,Ra,Sa,db,eb,gb,P){aa=L;R=ia;S=Aa;fa=Ia;X=Ja;qa=Va;na=Ra;xa=Sa;Da=db;Q=eb;wa=gb;ta=P;this.getEditableMaterials=f;this.getEditableNodeTypes=
g;this.findMaterial=k;this.findMeshesWithMaterial=q;this.findNodesOfType=n;this.getCameraPosition=h;this.getCameraRotation=m;this.getSceneBoundingBox=l;this.setMaterialForNode=r;this.setMaterialForMesh=p;this.switchToView=x;this.captureImage=w;this.addAnchor=F;this.removeAnchor=E;this.addAvatar=K;this.removeAvatar=M;this.findAvatar=Z;this.seeItem=Ta;this.sleepAnimatedMaterials=C;this.wakeAnimatedMaterials=U;this.getExtension=O;B(ka.sceneReadyToDisplay,R);ka.sceneReadyToDisplay=[];fa.addEventListener("teleportStarted",
this._teleportStarted.bind(this));fa.addEventListener("teleportDone",this._teleportDone.bind(this))};this._contextLost=function(){N=!1;sa=R=fa=X=qa=na=Q=wa=null;this.getExtension=this.wakeAnimatedMaterials=this.sleepAnimatedMaterials=this.findAvatar=this.removeAnchor=this.addAvatar=this.addAnchor=this.captureImage=this.switchToView=this.setMaterialForMesh=this.setMaterialForNode=this.findNodesOfType=this.findMeshesWithMaterial=this.findMaterial=this.getEditableNodeTypes=this.getEditableMaterials=
d};this._sceneLoadComplete=function(){B(ka.sceneLoadComplete);ka.sceneLoadComplete=[];N=!0;for(var L=$jscomp.makeIterator(za),ia=L.next();!ia.done;ia=L.next())ia.value.enableLightProbe()};this.openUrl=function(L,ia){ia||a?window.open(L):window.location.href=L};this.onNextPageInteraction=function(L){ka.nextPageInteraction.push(L)};this.onViewerConfigLoaded=function(L){sa?L(sa):ka.viewerConfigLoaded.push(L)};this.isSceneReadyToDisplay=function(){return null!==R};this.onSceneReadyToDisplay=function(L){R?
L(R):ka.sceneReadyToDisplay.push(L)};this.onSceneLoadComplete=function(L){N?L(R):ka.sceneLoadComplete.push(L)};this.requestFrame=function(){wa&&wa.requestFrame()};this.setNodeTypeEditable=function(L){console.assert(null===R,"setNodeTypeEditable must be called before the scene is loaded");c.setNodeTypeEditable(L)};this.setMaterialEditable=function(L){console.assert(null===R,"setMaterialEditable must be called before the scene is loaded");c.setMaterialEditable(L)};this.setAllMaterialsEditable=function(){console.assert(null===
R,"setAllMaterialsEditable must be called before the scene is loaded");c.setAllMaterialsEditable()};this.onNodeTypeClicked=function(L,ia){"function"===typeof L?ka.anyNodeTypeClicked.push(L):W(ka.nodeTypeClicked,L).push(ia);J=!0};this.removeOnNodeTypeClicked=function(L,ia){"function"===typeof L?WALK.removeFromArray(L,ka.anyNodeTypeClicked):WALK.removeFromArray(ia,ka.nodeTypeClicked[L])};this.onMaterialClicked=function(L,ia){this.setMaterialEditable(L);W(ka.materialClicked,L).push(ia);J=!0};this.onNodeTypeHoverChanged=
function(L,ia){this.setNodeTypeEditable(L);W(ka.nodeTypeHoverChanged,L).push(ia)};this.onMaterialHoverChanged=function(L,ia){this.setMaterialEditable(L);W(ka.materialHoverChanged,L).push(ia)};this.onViewSwitchStarted=function(L){ka.viewSwitchStarted.push(L)};this.onViewSwitchDone=function(L){ka.viewSwitchDone.push(L)};this.onVrChange=function(L){ka.vrChange.push(L)};this.onBeforeRender=function(L){ka.beforeRender.push(L)};this.createTextureFromHtmlImage=function(L,ia){function Aa(){Ja.needsUpdate=
!0;Ja.width=L.naturalWidth;Ja.height=L.naturalHeight;THREE.Math.isPowerOfTwo(Ja.width)&&THREE.Math.isPowerOfTwo(Ja.height)||(Ja.minFilter=GLC.LINEAR);Ja.notifyLoaded()}function Ia(){Aa();Va&&Va();L.onload=Va}ia=void 0===ia?!1:ia;var Ja=new WALK.Texture;Ja.image=L;Ja.wrapS=Ja.wrapT=GLC.REPEAT;Ja.minFilter=GLC.LINEAR_MIPMAP_LINEAR;Ja.anisotropy=WALK.DEFAULT_ANISOTROPY;Ja.format=ia?GLC.RGBA:GLC.RGB;Ja.hasAlpha=ia;var Va=null;L.complete&&0!==L.naturalHeight?Aa():(Va=L.onload,L.onload=Ia);return Ja};this.createTextureFromHtmlVideo=
function(L){var ia=new WALK.VideoTexture;ia.video=L;ia.minFilter=GLC.LINEAR;ia.anisotropy=WALK.DEFAULT_ANISOTROPY;ia.format=GLC.RGB;ia.generateMipmaps=!1;L.setAttribute("playsinline","");L.setAttribute("webkit-playsinline","");L.crossOrigin="anonymous";WALK.onVideoDataReady(L,function(Aa){ia.width=Aa.videoWidth;ia.height=Aa.videoHeight;THREE.Math.isPowerOfTwo(ia.width)&&THREE.Math.isPowerOfTwo(ia.height)?(ia.wrapS=GLC.REPEAT,ia.wrapT=GLC.REPEAT):(ia.wrapS=GLC.CLAMP_TO_EDGE,ia.wrapT=GLC.CLAMP_TO_EDGE);
ia.notifyLoaded()});return ia};this.createStreamTextureFromHtmlVideo=function(L){L=this.createTextureFromHtmlVideo(L);L._interruptible=!1;return L};this.addAnchor=function(){console.assert(!1,"Can't add anchors until the scene is ready to display")};this.removeAnchor=function(){console.assert(!1,"Can't remove anchors until the scene is ready to display")};this.addAvatar=function(){console.assert(!1,"Can't add avatars until the scene is ready to display")};this.removeAvatar=function(){console.assert(!1,
"Can't remove avatars until the scene is ready to display")};this.findAvatar=function(){console.assert(!1,"Can't find avatars until the scene is ready to display")};this.sleepAnimatedMaterials=function(){console.assert(!1,"Can't sleep animated materials until the scene is ready to display")};this.wakeAnimatedMaterials=function(){console.assert(!1,"Can't wake animated materials until the scene is ready to display")};this.getExtension=function(){console.assert(!1,"Can't get extension until the scene is ready to display")};
this.onAnchorsVisibilityChanged=function(L){ka.anchorsVisibilityChanged.push(L)};this.removeAnchorsVisibilityChangedListener=function(L){ka.anchorsVisibilityChanged=ka.anchorsVisibilityChanged.filter(function(ia){return ia!==L})};this.seeItem=this.captureImage=this.switchToView=this.setMaterialForNode=this.getSceneBoundingBox=this.getCameraRotation=this.getCameraPosition=this.findNodesOfType=this.findMeshesWithMaterial=this.findMaterial=this.getEditableNodeTypes=this.getEditableMaterials=d;this.getViewerAssetUrl=
function(L){return WALK.getViewerAssetUrl(L)};this.addMenuButton=function(L){return b.addExtraButton(L)};this.removeMenuButton=function(L){b.removeExtraButton(L)};this.getMenuButtonIcon=function(L){return b.getExtraButonIcon(L)};Object.defineProperty(this,"menuVisible",{get:function(){return b.visible},set:function(L){b.visible=L}});this.onMenuVisibilityChanged=function(L){b.addEventListener("visibilityChanged",function(){L()})};Object.defineProperty(this,"helpVisible",{get:function(){return b.helpVisible},
set:function(L){b.helpVisible=L}});this.play=function(){WALK.play()};var Pa={};this.apiUserChangeState=function(L,ia){WALK.deepEqual(Pa[L],ia)||(Pa[L]=WALK.readOnlyCopy(ia),ia=WALK.cloneObject(ia),B(ka.apiUserStateChanged[L],L,ia),B(ka.anyApiUserStateChanged,L,ia))};this.onApiUserStateChanged=function(L,ia){"function"===typeof L?ka.anyApiUserStateChanged.push(L):W(ka.apiUserStateChanged,L).push(ia)};this.removeOnApiUserStateChanged=function(L,ia){"function"===typeof L?WALK.removeFromArray(L,ka.anyApiUserStateChanged):
WALK.removeFromArray(ia,ka.apiUserStateChanged[L])};this.getApiUserState=function(L){if(void 0===L)return WALK.cloneObject(Pa);L=Pa[L];return void 0===L?void 0:WALK.cloneObject(L)};this._meetingJoined=function(L){console.assert(null===ra);ra=L;B(ka.meetingJoined,ra)};this._onMeetingJoined=function(L){ka.meetingJoined.push(L);null!==ra&&L(ra)};this._removeOnMeetingJoined=function(L){WALK.removeFromArray(L,ka.meetingJoined)};this._onAvatarListChanged=function(L){ka.avatarListChanged.push(L)};this._removeOnAvatarListChanged=
function(L){WALK.removeFromArray(L,ka.avatarListChanged)};this._createPointerEventHelper=function(L){return new WALK.PointerEventHelper(Q,L)};this._disableControls=function(){S.disable()};this._enableControls=function(){S.enable()};var Ga=new WALK.RayIntersection;this._findIntersectionAtPosition=function(L,ia){qa.findIntersectionAtPosition(L,ia,!0,Ga);return Ga};this.getWalkMaxSpeed=function(){console.assert(R,"getWalkMaxSpeed must be called after the scene is loaded");return R.camera.moveMaxSpeed};
this.setWalkMaxSpeed=function(L){console.assert(R,"setWalkMaxSpeed must be called after the scene is loaded");R.camera.moveMaxSpeed=L};this.openPopup=function(L,ia,Aa){ia=void 0===ia?{}:ia;return WALK.openPopup(L,ia,Aa)}}})();(function(){function a(d){for(var e=0,f=0;f<d.length;f+=1)d[f].id>=e&&(e=d[f].id+1);return e}function b(d,e){for(var f=0;f<d.length;f+=1)if(d[f].name===e)return!1;return!0}function c(d,e){for(var f=d,g=2;!b(e,f);g+=1)f=d+g.toString();return f}WALK.EditorHooks=function(d,e,f,g,k,h,m,l,q){function n(){WALK.USER_MSG.info("Failed to load texture")}var p={geometryFacesCnt:d.nodes.reduce(function(u,A){return u+A.facesInSubtree()},0)},r=new WALK.TextureLoader("./",WALK.DETECTOR,function(u){l.requestFrame()},
n,n,!0,!1),x=new WALK.SkyLoader(r),w=k.transformControls;this.getExtensionManager=function(){return h};this.getCameraPosition=function(){var u=f.cameraWorldPosition();return[u.x,u.y,u.z]};this.getCameraRotation=function(){return[THREE.Math.radToDeg(f.getYawAngle()),THREE.Math.radToDeg(f.getPitchAngle())]};this.getCamera=function(){return d.camera};this.getSceneStats=function(){return p};this.getMaterials=function(){return d.sortedMaterials()};this.getLights=function(){return d.lights};this.getLightProbes=
function(){return d.lightProbes};this.getCameraVolumes=function(){return d.cameraVolumes};this.getNodes=function(){return d.nodes};this.getMinimap=function(){return q};this.getMinimapConfig=function(){return d.minimapConfig};this.setLevelSelectedCallback=function(u){q.addEventListener("minimapLevelSelected",function(A){null!==A.level&&u(A.level)})};this.getBoundingBox=function(){return d.boundingBox};this.addLight=function(u,A,B){u=new WALK.Light({name:c(u,d.lights),type:A,doNotImport:!0});u.addInstance(B);
d.addLight(u)};this.removeLight=function(u){d.removeLight(u)};this.renameLight=function(u,A){A=A.trim()||"light";u.name="";u.name=c(A,d.lights)};this.addLightInstance=function(u,A,B){u.addInstance(A,B)};this.removeLightInstance=function(u,A){u.removeInstance(A)};this.addLightProbe=function(u){var A=a(d.lightProbes);u=new WALK.LightProbe({id:A,position:u});u.enableBoundingBox();d.addLightProbe(u);1===d.lightProbes.length&&d.enableLightProbesForMaterials()};this.removeLightProbe=function(u){d.removeLightProbe(u);
0===d.lightProbes.length&&d.disableLightProbesForMaterials()};this.getCameraVolumeTypes=function(){return WALK.CameraVolume.CameraVolumeTypes};this.addCameraVolume=function(u,A){var B=(new THREE.Vector3).fromArray(this.getCameraPosition()),I=this.getCameraRotation();I=(new THREE.Vector3(0,3,0)).applyEuler(new WALK.Euler(I[0]/180*Math.PI,I[1]/180*Math.PI,0));var F=a(d.cameraVolumes);d.addCameraVolume(new WALK.CameraVolume({id:F,name:A||u+F,type:u,position:B.add(I).toArray(),rotation:[0,0,0],scale:[1,
1,1],exposure:d.camera.defaultExposure,gamma:d.camera.defaultGamma}))};this.removeCameraVolume=function(u){d.removeCameraVolume(u)};this.shiftCameraVolume=function(u,A){d.shiftCameraVolume(u,A)};this.getViews=function(){return d.views.filter(function(u){return!u.internal})};this.markScreenshotArea=function(u){m.markArea(u)};this.unmarkScreenshotArea=function(){m.unmarkArea()};this.monoScreenToBuffer=function(u,A,B){return m.monoScreenToBuffer(u,A,B)};this.stereoPanoramaToBuffer=function(u,A,B,I){return m.stereoPanoramaToBuffer(u,
A,B,I)};this.addViewFromCamera=function(u,A){var B=[];console.assert("fps"===A||"top"===A||"orbit"===A);var I=f.cameraWorldPosition(),F=f.orbit;B[0]=THREE.Math.radToDeg(f.getYawAngle());B[1]=THREE.Math.radToDeg(f.getPitchAngle());u={id:a(d.views),name:c(u.trim()||"view",d.views),rotation:B};"fps"===A?(u.mode="fps",u.sky=WALK.EDITOR_CONTROLLED_SKY_NAME,u.position=I.toArray()):"top"===A?(u.mode="orbit",u.sky=WALK.DEFAULT_SKY_NAME,u.panPrimary=!0,u.noPitchRotate=!0,u.rotation[1]=-90,u.minUpAngle=0,u.maxUpAngle=
Math.PI/2,F.isEnabled()?(u.target=F.target.toArray(),u.distance=F.getCameraDistance()):(u.target=[I.x,I.y,d.boundingBox.min.z],u.distance=Math.max(I.z-d.boundingBox.min.z,1))):(u.mode="orbit",u.sky=WALK.DEFAULT_SKY_NAME,u.panPrimary=!1,u.noPitchRotate=!1,F.isEnabled()?(u.target=F.target.toArray(),u.distance=F.getCameraDistance(),u.minUpAngle=-F.getMaxPitchAngle(),u.maxUpAngle=-F.getMinPitchAngle()):(A=d.boundingBox.center(),u.target=A.toArray(),A.sub(I),u.distance=A.length(),A.normalize(),u.rotation=
[THREE.Math.radToDeg(Math.atan2(-A.x,A.y)),THREE.Math.radToDeg(Math.asin(A.z))],u.minUpAngle=0,u.maxUpAngle=Math.PI/2));I=new WALK.View(u);d.addView(I);return I};this.cloneView=function(u){var A=[THREE.Math.radToDeg(u.rotation.yaw),THREE.Math.radToDeg(u.rotation.pitch)],B=u.serialize();B.id=a(d.views);B.name=c(u.name.trim()||"view",d.views);B.rotation=A;"fps"===u.mode?B.position=u.position.toArray():B.target=u.target.toArray();u=new WALK.View(B);d.addView(u);return u};this.resetViewFromCamera=function(u){var A=
f.cameraWorldPosition();"fps"===u.mode?u.position.copy(A):(u.target.copy(f.orbit.target),u.distance=A.distanceTo(u.target));"fps"!==u.mode&&u.isTop()||(u.rotation.pitch=f.getPitchAngle());u.setYaw(f.getYawAngle())};this.removeView=function(u){d.removeView(u)};this.shiftView=function(u,A){d.shiftView(u,A)};this.activateSkyForView=function(u){g.activateSky(u)};this.switchToView=function(u){g.switchToView(u);WALK.focusWalkCanvas()};this.renameView=function(u,A){A=A.trim()||"view";u.name="";u.setName(c(A,
d.views))};this.updateHiddenMeshes=function(u){g.updateHiddenMeshes(u)};this.getSky=function(){return d.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME)};this.loadTexture=function(u){return r.load(WALK.LOAD_PRIORITY.CORE_RESOURCE,u,!0,!0,WALK.DEFAULT_ANISOTROPY)};this.materialTextureUpdated=function(u,A){var B=new Set,I="";u.textureNeedsUv0(A)&&d.visitMeshesWithMaterial(u,function(F){0===F.geometry.vertexCnt||F.uv0InBuffers()||B.has(F.node.type)||(B.add(F.node.type),5<B.size||(""!==I&&(I+=", "),I+="'"+
F.node.type+"'"))});return 0<B.size&&"Texture "+A+" won't be correctly mapped. The following objects lack base color UV mapping coming from the 3D modeling tool: "+I+(5<B.size?" (plus "+(B.size-5)+" more).":".")};this.changeSkyTexture=function(u){var A=d.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);A.isEquirect?x.loadSkyTexture(A,u):(d.removeSkyMesh(A),x.loadSingleSky({name:WALK.EDITOR_CONTROLLED_SKY_NAME,type:"equirect",texture:u},d));d.adjustSkiesAndCameraFarToSpanWholeScene()};this.removeSkyTexture=
function(){var u=d.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);u.isEquirect&&(d.removeSkyMesh(u),x.loadSingleSky({name:WALK.EDITOR_CONTROLLED_SKY_NAME,type:"procedural"},d));d.adjustSkiesAndCameraFarToSpanWholeScene()};this.getColorMapName=function(){return d.camera.colorMap?d.camera.colorMap.name:null};this.loadColorMap=function(u){u=r.load(WALK.LOAD_PRIORITY.CORE_RESOURCE,u,!1,!1,WALK.NO_ANISOTROPY);u.flipY=!1;return u};this.getSceneJson=function(){return d.serialize()};this.getCoverJson=function(){var u=
e.cover;u.extensions=h.getConfig();return u};this.disableSelection=function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.OFF)};this.enableMaterialSelection=function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.MATERIAL)};this.enableLightSelection=function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.LIGHT)};this.enableLightProbeSelection=function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE)};this.enableExtensionSelection=function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.EXTENSION)};
this.enablePositionSelection=function(u){k.setDistanceToObject(u);k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.POSITION)};this.enableNodeSelection=function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.NODE)};this.enableCameraVolumeSelection=function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME)};this.selectMaterial=function(u){k.selectMaterial(u)};this.replaceMaterial=function(u,A){u=d.replaceMaterial(u,A);u.isAnimated&&u.play();return u};this.selectLight=
function(u){k.selectLight(u)};this.selectLightInstance=function(u){k.selectLightInstance(u,!1)};this.selectLightProbe=function(u){k.selectLightProbe(u,!1)};this.selectCameraVolume=function(u){k.selectEditorCameraVolume(u)};this.selectExtension=function(u){k.selectExtension(u,!1)};this.selectNodes=function(u,A){k.selectNodes(u,A)};this.setMaterialClickedCallback=function(u){k.setMaterialClickedCallback(u)};this.setLightInstanceClickedCallback=function(u){k.setLightInstanceClickedCallback(u)};this.setLightProbeClickedCallback=
function(u){k.setLightProbeClickedCallback(u)};this.setNodeClickedCallback=function(u){k.setNodeClickedCallback(u)};this.setExtensionClickedCallback=function(u){k.setExtensionClickedCallback(u)};this.setPositionClickedCallback=function(u){k.setPositionClickedCallback(u)};this.setItemModifiedCallback=function(u){w.setItemModifiedCallback(u)};this.setViewSelectedCallback=function(u){g.addEventListener("teleportStarted",function(A){null!==A.view&&u(A.view)})};this.coverModified=function(u){e.updateCover(u)};
this.autoTourModified=function(){e.refresh()};this.hasLightMap=function(){return d.hasLightMap()};this.getAutoTour=function(){return d.autoTour};this.getDisableProgressiveLoader=function(){return d.disableProgressiveLoader};this.setDisableProgressiveLoader=function(u){d.disableProgressiveLoader=u};this.getSceneScaleHtmlWarning=function(){var u=d.boundingBox;return!u.empty()&&(u=u.size(),200<u.x||200<u.y||200<u.z)?"The scene has unusually large dimensions: <strong>"+Math.round(u.x)+"m x "+Math.round(u.y)+
"m x "+Math.round(u.z)+'m</strong>.</br></br>Shapespark assumes real-world scale, 1 meter in the scene should correspond to 1 meter in the real world. If the scale of the scene is invalid, either re-scale the model or change the scale in the import dialog, otherwise you can disable this message.</br></br>For more information consult <a href="/assets/help.html#importing-the-scene">Importing the scene</a> section of the help.':null};this.getTransformMode=function(){return w.mode};this.setTransformMode=
function(u){w.setTransformMode(u)};this.getSupportedTransformModes=function(){return w.supportedModes};this.seeItem=function(u){WALK.getViewer().seeItem(u)}};WALK.SceneLoadConfig=function(){this.onSceneLoaded=null;this.enableCollisions=!0;this.forcedInitialCameraRotation=this.forcedInitialCameraPosition=null}})();(function(){function a(){var c=new THREE.BufferGeometry,d=new Float32Array(288);c.addAttribute("position",new THREE.BufferAttribute(d,3));var e=0;[[[-1,-1,-1],[-1,-.6,-1],[-.6,-1,-1]],[[-1,-1,-1],[-1,-1,-.6],[-1,-.6,-1]],[[-1,-1,-1],[-.6,-1,-1],[-1,-1,-.6]],[[-.6,-1,-1],[-1,-.6,-1],[-1,-1,-.6]],[[-1,-1,1],[-.6,-1,1],[-1,-.6,1]],[[-1,-1,1],[-1,-.6,1],[-1,-1,.6]],[[-1,-1,1],[-1,-1,.6],[-.6,-1,1]],[[-.6,-1,1],[-1,-1,.6],[-1,-.6,1]],[[1,-1,-1],[.6,-1,-1],[1,-.6,-1]],[[1,-1,-1],[1,-.6,-1],[1,-1,-.6]],
[[1,-1,-1],[1,-1,-.6],[.6,-1,-1]],[[.6,-1,-1],[1,-1,-.6],[1,-.6,-1]],[[-1,1,-1],[-.6,1,-1],[-1,.6,-1]],[[-1,1,-1],[-1,.6,-1],[-1,1,-.6]],[[-1,1,-1],[-1,1,-.6],[-.6,1,-1]],[[-.6,1,-1],[-1,1,-.6],[-1,.6,-1]],[[1,1,1],[.6,1,1],[1,.6,1]],[[1,1,1],[1,.6,1],[1,1,.6]],[[1,1,1],[1,1,.6],[.6,1,1]],[[.6,1,1],[1,1,.6],[1,.6,1]],[[1,-1,1],[1,-.6,1],[.6,-1,1]],[[1,-1,1],[1,-1,.6],[1,-.6,1]],[[1,-1,1],[.6,-1,1],[1,-1,.6]],[[.6,-1,1],[1,-.6,1],[1,-1,.6]],[[1,1,-1],[1,.6,-1],[.6,1,-1]],[[1,1,-1],[1,1,-.6],[1,.6,
-1]],[[1,1,-1],[.6,1,-1],[1,1,-.6]],[[.6,1,-1],[1,.6,-1],[1,1,-.6]],[[-1,1,1],[-1,.6,1],[-.6,1,1]],[[-1,1,1],[-1,1,.6],[-1,.6,1]],[[-1,1,1],[-.6,1,1],[-1,1,.6]],[[-.6,1,1],[-1,.6,1],[-1,1,.6]]].forEach(function(f){for(var g=0;3>g;g+=1)for(var k=0;3>k;k+=1)d[e]=f[g][k],e+=1});c.computeVertexNormals();c.convertNormalsToSpherical();return c}function b(){var c=new WALK.StandardMaterial;c.disableLightProbe=!0;c.headLight=!0;c.baseColor=WALK.EDITOR_SELECTION_COLOR;c.setUniforms();return c}WALK.LightControls=
function(c,d){function e(E){if("spot"===E.type){var K=THREE.Math.degToRad(E.angle);E=1*Math.cos(K/2);K=new THREE.CylinderBufferGeometry(0,1*Math.sin(K/2),E,32,1);w.makeTranslation(0,-E/2,0);x.makeRotationZ(Math.PI);u.multiplyMatrices(x,w);K.applyMatrix(u);K.convertNormalsToSpherical()}else K="area"===E.type?B:A;return K}function f(E,K,M){var Z=new WALK.LightMaterial(E);M=new THREE.Mesh(M,Z);M.visibilityId=null;var C=new THREE.Mesh(I,F);M.add(C);if("sun"!==E.type){var U=K.rotation.toQuaternion().multiply(M.quaternion);
M.setRotationFromQuaternion(U);M.position.copy(K.position);"area"===E.type?(Z.side=THREE.DoubleSide,M.scale.set(E.width,1,E.height),Z=Math.max(E.width,E.height)/2,C.scale.set(Z/E.width,Z,Z/E.height)):M.scale.set(E.size,E.size,E.size)}else E=c.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME).radius,E=1*Math.PI*E*1.5/360,WALK.sunRotationToPosition(c,K.rotation,M.position),M.scale.set(E,E,E);M.userData.lightInstance=K;M.updateMatrixWorld();p.lightInstanceMeshes.push(M);r&&c.addAuxiliaryObject(M)}function g(E){var K=
e(E);E.forEachLightInstance(function(M){f(E,M,K)})}function k(E){for(var K=0;K<p.lightInstanceMeshes.length;K+=1){var M=p.lightInstanceMeshes[K];if(M.userData.lightInstance===E)return M}return null}function h(E){for(var K=[],M=0;M<p.lightInstanceMeshes.length;M+=1){var Z=p.lightInstanceMeshes[M];Z.userData.lightInstance.light===E?(r&&c.removeAuxiliaryObject(Z),Z.geometry!==A&&Z.geometry!==B&&Z.geometry.dispose(),Z.material.dispose()):K.push(Z)}p.lightInstanceMeshes=K}function m(E){E=E.target;h(E);
g(E)}function l(E){E=E.instance;var K=E.light;var M=K.instances[0]!==E?k(K.instances[0]).geometry:e(K);f(K,E,M);d.requestFrame()}function q(E){E=E.instance.light;h(E);g(E);d.requestFrame()}function n(E){g(E);E.addEventListener("updated",m);E.addEventListener("instanceAdded",l);E.addEventListener("instanceRemoved",q)}var p=this,r=!1,x=new THREE.Matrix4,w=new THREE.Matrix4,u=new THREE.Matrix4,A=new THREE.SphereBufferGeometry(1,32,16);A.convertNormalsToSpherical();var B=new THREE.PlaneBufferGeometry(1,
1);x.makeRotationX(-Math.PI/2);B.applyMatrix(x);B.convertNormalsToSpherical();var I=a(),F=b();this.lightInstanceMeshes=[];this.getLightInstanceMaterial=function(E){return k(E).material};this.showLights=function(){if(!r){r=!0;for(var E=0;E<this.lightInstanceMeshes.length;E+=1)c.addAuxiliaryObject(this.lightInstanceMeshes[E])}};this.showSelectionMesh=function(E){this.lightInstanceMeshes.forEach(function(K){K.children[0].visible=K.userData.lightInstance.light===E?!0:!1})};this.hideLights=function(){if(r){r=
!1;for(var E=0;E<this.lightInstanceMeshes.length;E+=1)c.removeAuxiliaryObject(this.lightInstanceMeshes[E])}};c.lights.forEach(n);c.addEventListener("lightAdded",function(E){n(E.light);d.requestFrame()});c.addEventListener("lightRemoved",function(E){h(E.light);d.requestFrame()})}})();(function(){WALK.LightProbeControls=function(a,b){function c(x,w){w.position.addVectors(x.boxMin,x.boxMax).multiplyScalar(.5).sub(x.position);w.scale.subVectors(x.boxMax,x.boxMin);w.scale.subScalar(.005)}function d(x){var w=new WALK.StandardMaterial;w.hideFromLightProbes=!0;w.disableLightProbe=!1;w.highlight=WALK.EDITOR_SELECTION_COLOR;w.metallic=1;w.roughness=0;w.setUniforms();w=new THREE.Mesh(n,w);w.visibilityId=null;w.lightProbe=x;w.position.copy(x.position);var u=new THREE.Mesh(r,p);u.visible=
!1;w.add(u);x.isBoundingBoxEnabled()&&c(x,u);w.updateMatrixWorld(!0);w.visible=l;m.lightProbeMeshes.push(w);a.addAuxiliaryObject(w)}function e(x){for(var w=0;w<m.lightProbeMeshes.length;w+=1)if(m.lightProbeMeshes[w].lightProbe===x)return w;console.assert(!1);return null}function f(x){x=x.target;var w=m.lightProbeMeshes[e(x)];w.position.copy(x.position);var u=w.children[0];x.isBoundingBoxEnabled()?(c(x,u),u.visible=!0):u.visible=!1;w.updateMatrixWorld()}function g(x){x=x.lightProbe;d(x);x.addEventListener("positionUpdated",
f);x.addEventListener("boundsUpdated",f)}function k(x){x=e(x.lightProbe);var w=m.lightProbeMeshes[x];a.removeAuxiliaryObject(w);w.material.dispose();m.lightProbeMeshes.splice(x,1)}function h(x){for(var w=0;w<m.lightProbeMeshes.length;w+=1){var u=m.lightProbeMeshes[w];if(u.lightProbe===x)return u}return null}var m=this,l=!1,q=null;this.lightProbeMeshes=[];var n=new THREE.SphereBufferGeometry(.2,32,16);n.convertNormalsToSpherical();var p=WALK.createBoundingBoxMaterial(),r=new THREE.BoxBufferGeometry(1,
1,1);r.addTriangleOrderAttribute();r.convertNormalsToSpherical();this.getLightProbeMaterial=function(x){return(x=h(x))?x.material:null};this.showLightProbeBoundingBox=function(x){q&&(q.visible=!1,q=null);x.isBoundingBoxEnabled()&&(q=h(x).children[0],q.visible=!0)};this.showLightProbes=function(){if(!l){l=!0;for(var x=0;x<this.lightProbeMeshes.length;x+=1)this.lightProbeMeshes[x].visible=!0}b.requestFrame()};this.hideLightProbes=function(){if(l){l=!1;for(var x=0;x<this.lightProbeMeshes.length;x+=1)this.lightProbeMeshes[x].visible=
!1}b.requestFrame()};(function(){for(var x=0;x<a.lightProbes.length;x+=1){var w=a.lightProbes[x];d(w);w.addEventListener("positionUpdated",f);w.addEventListener("boundsUpdated",f)}a.addEventListener("lightProbeAdded",g);a.addEventListener("lightProbeRemoved",k)})()}})();(function(){WALK.CameraVolumeControls=function(a,b){function c(k){function h(){l.position.copy(k.position);l.rotation.copy(k.rotation);l.scale.copy(k.scale);l.updateMatrixWorld()}var m=WALK.createBoundingBoxMaterial(),l=new THREE.Mesh(k.getVolumeGeometry(),m);l.visible=!1;l.visibilityId=null;f.add(l);e.set(k,l);h(k);k.addEventListener("updated",h)}var d=function(){},e=new Map,f=new THREE.Object3D;f.visible=!1;a.addAuxiliaryObject(f);this.setHighlightedCameraVolume=function(k){d();var h=e.get(k);h.visible=
!0;d=function(){return h.visible=!1};return h.material};this.setControlsVisible=function(k){f.visible=k;b.requestFrame()};a.addEventListener("cameraVolumeAdded",function(k){c(k.cameraVolume);b.requestFrame()});a.addEventListener("cameraVolumeRemoved",function(k){k=k.cameraVolume;var h=e.get(k);f.remove(h);h.material.dispose();e.delete(k);b.requestFrame()});for(var g=0;g<a.cameraVolumes.length;g+=1)c(a.cameraVolumes[g])}})();/*
 Copyright (C) 2019-present Shapespark
*/
(function(){WALK.sunRotationToPosition=function(a,b,c){a=a.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);c.set(0,-a.radius,0);c.applyEuler(b);c.add(a.position)};WALK.computeNodeBoundingSphere=function(a,b){b.radius=0;a.visitSubtree(function(c){c.mesh&&WALK.Math.spheresUnion(c.mesh.geometry.boundingSphere,b)})}})();(function(){WALK.PointerEventDispatcher=function(a,b){function c(w){if(void 0===w.button)return 0;switch(w.button){case 0:return 0;case 1:return 1;case 2:return 2}return-1}function d(w,u,A){if(!A)for(A=0;A<w.changedTouches.length;A++){var B=w.changedTouches[A];if(B.identifier===u)return B}for(A=0;A<w.touches.length;A++)if(B=w.touches[A],B.identifier===u)return B;return null}function e(w,u){if(0!==w.length){var A=void 0!==u.touches;!A&&(document.pointerLockElement||document.mozPointerLockElement||
document.webkitPointerLockElement)?(r.clipX=0,r.clipY=0):(A?(u=d(u,p),console.assert(null!==u),A=u.clientX,u=u.clientY):(A=u.clientX,u=u.clientY),r.clipX=A/window.innerWidth*2-1,r.clipY=2*-(u/window.innerHeight)+1);A=r;for(u=0;u<w.length;u++){var B=w[u].callback;if(B(A.clipX,A.clipY))break}}}function f(w){0!==c(w)||n||(n=!0,void 0!==w.touches&&(console.assert(0<w.changedTouches.length),p=w.changedTouches[0].identifier),e(m,w))}function g(w){if(0===c(w)){var u=void 0!==w.touches;u&&d(w,p,!0)||!n||
(n=!1,e(l,w),u&&(p=-1))}}function k(w){void 0!==w.touches&&-1===p||e(q,w)}function h(w,u,A){var B=w.filter(function(F){return F.callback===u});console.assert(0===B.length,"Do not add the same callback twice!");A={callback:u,priority:A};for(B=B=0;B<w.length;B+=1){var I=w[B];if(A.priority<=I.priority){if(A.priority===I.priority){console.error("Adding two listeners with the same priority is not allowed!");return}break}}w.splice(B,0,A)}var m=[],l=[],q=[],n=!1,p=-1,r={clipX:0,clipY:0};this.addPointerDownListener=
function(w,u){h(m,w,u)};this.removePointerDownListener=function(w){m=m.filter(function(u){return u.callback!==w})};this.addPointerUpListener=function(w,u){h(l,w,u)};this.removePointerUpListener=function(w){l=l.filter(function(u){return u.callback!==w})};this.addPointerMoveListener=function(w,u){h(q,w,u)};this.removePointerMoveListener=function(w){q=q.filter(function(u){return u.callback!==w})};var x=!1;this.isEnabled=function(){return x};this.enable=function(){x||(a.addEventListener("mousedown",f,
!1),a.addEventListener("touchstart",f,!1),a.addEventListener("mouseup",g,!1),a.addEventListener("touchend",g,!1),a.addEventListener("mousemove",k,!1),a.addEventListener("touchmove",k,!1),window.addEventListener("mouseup",g,!1),b&&window.top.addEventListener("mouseup",g,!1),x=!0)};this.disable=function(){x&&(a.removeEventListener("mousedown",f,!1),a.removeEventListener("touchstart",f,!1),a.removeEventListener("mouseup",g,!1),a.removeEventListener("touchend",g,!1),a.removeEventListener("mousemove",
k,!1),a.removeEventListener("touchmove",k,!1),window.removeEventListener("mouseup",g,!1),b&&window.top.removeEventListener("mouseup",g,!1),x=!1)};this.enable()}})();(function(){WALK.PointerEventHelper=function(a,b){function c(){return!1}function d(r,x){var w=g.callbacks.onPointerDown(r,x);k=!0;h=r;m=x;return w}function e(r,x){var w=g.callbacks.onPointerUp(r,x);if(k){var u=Date.now();w=null!==n&&.03>=Math.abs(l-h)&&.03>=Math.abs(q-m)&&500>=Math.abs(n-u)&&g.callbacks.onDoubleClick!==c?g.callbacks.onDoubleClick(r,x)||w:g.callbacks.onClick(r,x)||w;n=u;l=r;q=x}return w}function f(r,x){var w=g.callbacks.onPointerMove(r,x);!k||.03>=Math.abs(r-h)&&.03>=Math.abs(x-m)||
(k=!1,n=null);return w}var g=this,k=!1,h=null,m=null,l=null,q=null,n=null;this.callbacks={onClick:c,onDoubleClick:c,onPointerDown:c,onPointerUp:c,onPointerMove:c};var p=!1;this.isEnabled=function(){return p};this.enable=function(){p||(a.addPointerDownListener(d,b),a.addPointerUpListener(e,b),a.addPointerMoveListener(f,b),p=!0)};this.disable=function(){p&&(a.removePointerDownListener(d),a.removePointerUpListener(e),a.removePointerMoveListener(f),p=!1)};this.enable()}})();(function(){function a(B){var I=new THREE.Box3;B instanceof THREE.Object3D&&B.traverse(function(F){F instanceof THREE.Mesh&&(F.geometry.boundingBox||F.geometry.computeBoundingBox(),I.union(F.geometry.boundingBox))});return I}function b(B,I){var F=a(B);B=F.size();B=new THREE.BoxBufferGeometry(B.x,B.y,B.z);F=F.center();var E=new THREE.Matrix4;E.makeTranslation(F.x,F.y,F.z);B.applyMatrix(E);B.computeBoundingBox();I=new THREE.Mesh(B,I);I.visible=!1;I.visibilityId=null;return I}function c(B,I){var F=new WALK.StandardMaterial;
F.hideFromLightProbes=!0;F.baseColor.copy(B);F.opacity=I;F.specularOff=1;F.depthTest=!1;F.depthWrite=!1;return F}function d(B){for(var I=[],F=0;F<arguments.length;++F)I[F-0]=arguments[F];console.assert(0<I.length,"Part must have at least one element!");var E=new THREE.Object3D;I.forEach(function(K){return E.add(K)});I=b(E,c(f,.6));return new n(E,I,E.children[0].material)}function e(B,I,F){var E=B.material;E.opacity=I===B.collider?B.hoveredOpacity:F&&null!==I?B.notUsedOpacity:B.defaultOpacity;E.setUniforms()}
WALK.TRANSFORM_MODE={TRANSLATE:0,ROTATE:1,SCALE:2};var f=new THREE.Color(16777215),g=new THREE.Color(16711680),k=new THREE.Color(65280),h=new THREE.Color(255),m=new THREE.Vector3(0,0,1),l=new THREE.Vector3(1,0,0),q=new THREE.Vector3(0,1,0),n=function(B,I,F){THREE.Object3D.call(this);this.add(B);this.add(I);this.material=F;this.collider=I;this.defaultOpacity=F.opacity;this.hoveredOpacity=.99;this.notUsedOpacity=.3;this.usedAxes=0};n.prototype=Object.create(THREE.Object3D.prototype);n.prototype.constructor=
n;var p=function(){function B(C){C=c(C,.6);C.depthTest=!0;return new THREE.Mesh(I,C)}THREE.Object3D.call(this);var I=new THREE.CylinderBufferGeometry(.005,.005,1E3,4,1,!1),F=B(g);F.rotation.set(0,0,Math.PI/2);var E=B(k),K=B(h);K.rotation.set(Math.PI/2,0,0);this.add(F);this.add(E);this.add(K);var M=[!1,!1,!1];this.show=function(C){M[0]=1===(1&C);M[1]=2===(2&C);M[2]=4===(4&C);F.visible=M[0];E.visible=M[1];K.visible=M[2]};var Z=new THREE.Vector3;this.update=function(C){Z.copy(C);Z.sub(this.position);
Z.normalize();F.visible=M[0]&&.998>Math.abs(l.dot(Z));E.visible=M[1]&&.998>Math.abs(q.dot(Z));K.visible=M[2]&&.998>Math.abs(m.dot(Z))}};p.prototype=Object.create(THREE.Object3D.prototype);p.prototype.constructor=p;var r=function(){function B(){var M=c(f,.99);return new THREE.Mesh(I,M)}THREE.Object3D.call(this);var I=new THREE.SphereBufferGeometry(.012,10,10),F=B(),E=B(),K=B();this.add(F);this.add(E);this.add(K);this.show=function(M){F.visible=1===(1&M);E.visible=2===(2&M);K.visible=4===(4&M)};this.update=
function(M){F.position.set(M.x,0,0);F.updateMatrixWorld();E.position.set(0,M.y,0);E.updateMatrixWorld();K.position.set(0,0,M.z);K.updateMatrixWorld()}};r.prototype=Object.create(THREE.Object3D.prototype);r.prototype.constructor=r;var x=function(){function B(C){C=c(C,.2);C.depthTest=!0;C.side=THREE.DoubleSide;return d(new THREE.Mesh(I,C))}THREE.Object3D.call(this);var I=new THREE.PlaneBufferGeometry(1E3,1E3,1,1),F=B(f);this.add(F);var E=new THREE.Object3D;this.add(E);var K=B(h);K.rotation.set(0,0,
0);var M=B(k);M.rotation.set(Math.PI/2,0,0);var Z=B(g);Z.rotation.set(0,Math.PI/2,0);E.add(K);E.add(M);E.add(Z);this.setLocalRotation=function(C){C?E.rotation.copy(C):E.rotation.set(0,0,0)};this.update=function(C){F.rotation.setFromRotationMatrix(C.matrixWorld);F.updateMatrixWorld()};this.cameraPlane=F;this.findPlaneIntersectionPoint=function(){function C(W){switch(W){case 1:return Z;case 2:return M;case 4:return K;case 3:return K;case 5:return M;case 6:return Z;case 7:return F;default:throw"Impossible";
}}var U=new THREE.Vector3,O=new THREE.Vector3;return function(W,aa,R,S){var fa=C(W);fa.getWorldPosition(U).sub(aa);fa.getWorldDirection(O);if(1===W||2===W||4===W){W=O.dot(O);fa=O.dot(R);var X=R.dot(R),qa=O.dot(U),na=R.dot(U);X=W*X-fa*fa;W=1E-5>Math.abs(X)?Infinity:(W*na-fa*qa)/X}else W=O.dot(R),W=1E-5>Math.abs(W)?Infinity:O.dot(U)/W;if(Infinity===W)return!1;S.copy(R).multiplyScalar(W).add(aa);return!0}}();this.show=function(C){F.visible=7===C?!0:!1;K.visible=3===C;M.visible=5===C;Z.visible=6===C}};
x.prototype=Object.create(THREE.Object3D.prototype);x.prototype.constructor=x;var w=function(){function B(S){for(var fa=new Uint8Array(4096),X=Math.floor(255*S.r),qa=Math.floor(255*S.g),na=Math.floor(255*S.b),xa=0,wa=0;32>wa;wa++)for(var ta=0;32>ta;ta++)fa[xa]=X,fa[xa+1]=qa,fa[xa+2]=na,fa[xa+3]=0===wa||0===ta||31===wa||31===ta?220:150,xa+=4;fa=new WALK.DataTexture(fa,32,32,THREE.RGBAFormat);fa.hasAlpha=!0;fa.needsUpdate=!0;fa.loaded=!0;X=new WALK.StandardMaterial;X.hideFromLightProbes=!0;X.specularOff=
1;X.disableLightProbe=!0;X.depthTest=!1;X.depthWrite=!1;X.transparent=!0;X.baseColor=S;X.side=THREE.DoubleSide;X.baseColorTexture=fa;X.opacity=.6;X.configureTransparency();X.setUniforms();return d(new THREE.Mesh(E.squareGeometry,X))}function I(S){S=c(S,.6);return d(new THREE.Mesh(E.lineGeometry,S),new THREE.Mesh(E.arrowHeadGeometry,S))}var F=this;THREE.Object3D.call(this);var E=function(){var S=new THREE.Matrix4,fa=new THREE.SphereBufferGeometry(.1,16,16),X=new THREE.PlaneBufferGeometry(.23,.23,1,
1);S.makeTranslation(.45,.45,0);X.applyMatrix(S);X.addTriangleOrderAttribute();var qa=new THREE.CylinderBufferGeometry(.015,.015,1,4,1,!1);S.makeTranslation(0,.65,0);qa.applyMatrix(S);var na=new THREE.CylinderBufferGeometry(0,.05,.2,10,1,!1);S.makeTranslation(0,1.25,0);na.applyMatrix(S);return{pickerGeometry:fa,squareGeometry:X,lineGeometry:qa,arrowHeadGeometry:na}}(),K=function(){var S=c(f,.6);return d(new THREE.Mesh(E.pickerGeometry,S))}(),M=I(g);M.rotation.set(0,0,-Math.PI/2);var Z=I(k),C=I(h);
C.rotation.set(Math.PI/2,0,0);var U=B(h),O=B(k);O.rotation.set(Math.PI/2,0,0);var W=B(g);W.rotation.set(0,-Math.PI/2,0);K.usedAxes=7;M.usedAxes=1;Z.usedAxes=2;C.usedAxes=4;U.usedAxes=3;O.usedAxes=5;W.usedAxes=6;var aa=[K,M,Z,C,U,O,W];aa.forEach(function(S){return F.add(S)});var R=new Map(aa.map(function(S){return[S.collider,S]}));this.colliders=[].concat($jscomp.arrayFromIterable(R.keys()));this.highlight=function(S,fa){aa.forEach(function(X){return e(X,S,fa)})};this.usedAxes=function(S){return R.get(S).usedAxes}};
w.prototype=Object.create(THREE.Object3D.prototype);w.prototype.constructor=w;var u=function(){function B(aa){var R=new THREE.TorusBufferGeometry(aa,.012,6,64);aa=new THREE.TorusBufferGeometry(aa,.038,6,64);return{torusGeometry:R,colliderGeometry:aa}}function I(aa,R){aa=new WALK.RotateGizmoMaterial(aa,.6);var S=new THREE.Object3D;S.add(new THREE.Mesh(R.torusGeometry,aa));R=new THREE.Mesh(R.colliderGeometry,aa);R.visible=!1;R.visibilityId=null;return new n(S,R,aa)}var F=this;THREE.Object3D.call(this);
var E=B(.9),K=I(g,E);K.rotation.set(0,Math.PI/2,0);var M=I(k,E);M.rotation.set(Math.PI/2,0,0);E=I(h,E);var Z=B(1.12),C=I(f,Z),U=function(aa,R){aa=c(aa,0);var S=new THREE.SphereBufferGeometry(R,32,32);R=new THREE.Object3D;R.add(new THREE.Mesh(S,aa));S=new THREE.Mesh(S,aa);S.visible=!1;S.visibilityId=null;aa=new n(R,S,aa);aa.defaultOpacity=0;aa.hoveredOpacity=.2;aa.notUsedOpacity=0;return aa}(f,.848),O=[K,M,E,C,U];O.forEach(function(aa){return F.add(aa)});var W=new Map(O.map(function(aa){return[aa.collider,
aa]}));this.colliders=[].concat($jscomp.arrayFromIterable(W.keys()));this.update=function(aa){var R=this;O.filter(function(S){return S!==U}).forEach(function(S){S=S.material;S.gizmoPosition.copy(R.position);S.sphereRadius=.86*R.scale.x});C.rotation.setFromRotationMatrix(aa.matrixWorld);C.updateMatrixWorld()};K.usedAxes=1;M.usedAxes=2;E.usedAxes=4;C.usedAxes=7;U.usedAxes=0;this.highlight=function(aa,R){O.forEach(function(S){return e(S,aa,R)})};this.usedAxes=function(aa){return W.get(aa).usedAxes}};
u.prototype=Object.create(THREE.Object3D.prototype);u.prototype.constructor=u;var A=function(){function B(S){for(var fa=new Uint8Array(4096),X=Math.floor(255*S.r),qa=Math.floor(255*S.g),na=Math.floor(255*S.b),xa=0,wa=0;32>wa;wa++)for(var ta=0;32>ta;ta++)fa[xa]=X,fa[xa+1]=qa,fa[xa+2]=na,fa[xa+3]=0===wa||0===ta||31===wa||31===ta?220:150,xa+=4;fa=new WALK.DataTexture(fa,32,32,THREE.RGBAFormat);fa.hasAlpha=!0;fa.needsUpdate=!0;fa.loaded=!0;X=new WALK.StandardMaterial;X.hideFromLightProbes=!0;X.specularOff=
1;X.disableLightProbe=!0;X.depthTest=!1;X.depthWrite=!1;X.transparent=!0;X.baseColor=S;X.side=THREE.DoubleSide;X.baseColorTexture=fa;X.opacity=.6;X.configureTransparency();X.setUniforms();return d(new THREE.Mesh(E.squareGeometry,X))}function I(S){S=c(S,.6);return d(new THREE.Mesh(E.lineGeometry,S),new THREE.Mesh(E.cubeGeometry,S))}var F=this;THREE.Object3D.call(this);var E=function(){var S=new THREE.Matrix4,fa=new THREE.BoxBufferGeometry(.3,.3,.3),X=new THREE.PlaneBufferGeometry(.23,.23,1,1);S.makeTranslation(.45,
.45,0);X.applyMatrix(S);X.addTriangleOrderAttribute();var qa=new THREE.CylinderBufferGeometry(.015,.015,1,4,1,!1);S.makeTranslation(0,.65,0);qa.applyMatrix(S);var na=new THREE.BoxBufferGeometry(.1,.1,.1);S.makeTranslation(0,1.1,0);na.applyMatrix(S);return{pickerGeometry:fa,squareGeometry:X,lineGeometry:qa,cubeGeometry:na}}(),K=function(){var S=c(f,.6);return d(new THREE.Mesh(E.pickerGeometry,S))}(),M=I(g);M.rotation.set(0,0,-Math.PI/2);var Z=I(k),C=I(h);C.rotation.set(Math.PI/2,0,0);var U=B(h),O=
B(k);O.rotation.set(Math.PI/2,0,0);var W=B(g);W.rotation.set(0,-Math.PI/2,0);K.usedAxes=7;M.usedAxes=1;Z.usedAxes=2;C.usedAxes=4;U.usedAxes=3;O.usedAxes=5;W.usedAxes=6;var aa=[K,M,Z,C,U,O,W];aa.forEach(function(S){return F.add(S)});var R=new Map(aa.map(function(S){return[S.collider,S]}));this.colliders=[].concat($jscomp.arrayFromIterable(R.keys()));this.highlight=function(S,fa){aa.forEach(function(X){return e(X,S,fa)})};this.usedAxes=function(S){return R.get(S).usedAxes}};A.prototype=Object.create(THREE.Object3D.prototype);
A.prototype.constructor=A;WALK.TransformGizmo=function(B,I,F,E){function K(pa){C.oldPosition.copy(pa);C.newPosition.copy(pa);U.position.copy(pa);O.position.copy(pa);W.position.copy(pa);aa.position.copy(pa);R.position.copy(pa);S.position.copy(pa)}function M(pa){C.oldRotation.copy(pa);C.newRotation.copy(pa);xa===WALK.TRANSFORM_MODE.SCALE?(U.rotation.copy(pa),O.setLocalRotation(pa),S.rotation.copy(C.oldRotation)):(U.rotation.set(0,0,0),O.setLocalRotation(null))}function Z(){wa?xa===WALK.TRANSFORM_MODE.TRANSLATE?
(B.addAuxiliaryObject(U),B.addAuxiliaryObject(O),B.addAuxiliaryObject(W),B.addAuxiliaryObject(aa),B.removeAuxiliaryObject(R),B.removeAuxiliaryObject(S)):xa===WALK.TRANSFORM_MODE.ROTATE?(B.addAuxiliaryObject(U),B.removeAuxiliaryObject(aa),B.addAuxiliaryObject(R),B.removeAuxiliaryObject(S)):(B.addAuxiliaryObject(U),B.addAuxiliaryObject(O),B.removeAuxiliaryObject(aa),B.removeAuxiliaryObject(R),B.addAuxiliaryObject(S)):(B.removeAuxiliaryObject(U),B.removeAuxiliaryObject(O),B.removeAuxiliaryObject(W),
B.removeAuxiliaryObject(aa),B.removeAuxiliaryObject(R),B.removeAuxiliaryObject(S))}var C=this;this.target=null;var U=new p;U.show(7);var O=new x;O.show(0);var W=new r;W.show(0);var aa=new w,R=new u,S=new A,fa=!1;Object.defineProperty(this,"transforming",{get:function(){return fa}});var X=new THREE.Vector3(0,0,0),qa=0,na=new THREE.Vector3;this.oldPosition=new THREE.Vector3(0,0,0);this.newPosition=new THREE.Vector3(0,0,0);this.oldRotation=new THREE.Euler(0,0,0);this.newRotation=new THREE.Euler(0,0,
0);this.oldScale=new THREE.Vector3(1,1,1);this.newScale=new THREE.Vector3(1,1,1);Object.defineProperty(this,"position",{get:function(){return U.position}});Object.defineProperty(this,"rotation",{get:function(){return C.oldRotation}});var xa=!1;Object.defineProperty(this,"scale",{get:function(){return C.oldScale}});var wa=!1;Object.defineProperty(this,"mode",{get:function(){return xa},set:function(pa){xa!==pa&&(xa=pa,Z(),E.requestFrame())}});Object.defineProperty(this,"visible",{get:function(){return wa},
set:function(pa){wa!==pa&&(wa=pa,Z())}});this.mode=WALK.TRANSFORM_MODE.TRANSLATE;var ta=Infinity,sa=Infinity,Da=new THREE.Vector3(0,0,0),Q=null,J=!1,N=7,V=function(){var pa=new THREE.Vector3,ha=new THREE.Vector3,ja=new THREE.Quaternion;return function(Ca,Ta,Pa){pa.set(Ta,Pa,1).unproject(B.camera);pa.sub(F).normalize();if(!O.findPlaneIntersectionPoint(Ca,F,pa,ha))return null;ha.sub(U.position);ha.applyQuaternion(ja.setFromEuler(U.rotation).inverse());Ca&1||(ha.x=0);Ca&2||(ha.y=0);Ca&4||(ha.z=0);return ha}}(),
ra=function(){var pa=new THREE.Vector3,ha=new THREE.Vector3,ja=new THREE.Vector3;return function(Ca,Ta){var Pa=O.cameraPlane;pa.set(0,0,-1);pa.transformDirection(Pa.matrixWorld);ha.set(-1,0,0);ha.transformDirection(Pa.matrixWorld);Ca=V(7,Ca,Ta).normalize();ja.copy(ha).cross(Ca);return Math.sign(pa.dot(ja))*Math.acos(ha.dot(Ca))}}(),ka=new THREE.Vector3;this.rotationSpeed=5;var za=function(){var pa=new THREE.Vector2(0,0),ha=new THREE.Quaternion,ja=new THREE.Euler,Ca=new THREE.Quaternion,Ta=new THREE.Quaternion,
Pa=new THREE.Vector3,Ga=new THREE.Vector3,L=new THREE.Vector3;return function(ia,Aa){ha.setFromEuler(C.oldRotation);ha.normalize();pa.set(ta-ia,sa-Aa);pa.multiplyScalar(C.rotationSpeed);if(0===N)return ia=O.cameraPlane,Pa.copy(l),Pa.transformDirection(ia.matrixWorld),Ga.set(0,1,0),Ga.transformDirection(ia.matrixWorld),Ta.setFromAxisAngle(Pa,pa.y),Ca.setFromAxisAngle(Ga,-pa.x),Ca.multiply(Ta),Ca.multiply(ha),Ca.normalize(),ja.setFromQuaternion(Ca,"ZXY"),ja;if(7===N){var Ia=O.cameraPlane;L.set(0,0,
-1);L.transformDirection(Ia.matrixWorld);Ia=L;ia=ra(ia,Aa);ia-=qa}else{4!==N&&pa.multiplyScalar((1===N?-1:1)*Math.sign((1===N?q:l).dot(ka)));a:{switch(N){case 1:Ia=l;break a;case 2:Ia=q;break a;case 4:Ia=m;break a}console.error("Unable to get direction for this value!");Ia=void 0}ia=4===N?-pa.x:pa.y}Ca.setFromAxisAngle(Ia,ia);Ca.multiply(ha);Ca.normalize();ja.setFromQuaternion(Ca,"ZXY");return ja}}(),Ea=function(){var pa={hoveredCollider:null,hasAnythingChanged:!1};return function(ha,ja,Ca){var Ta=
xa===WALK.TRANSFORM_MODE.TRANSLATE?aa:xa===WALK.TRANSFORM_MODE.ROTATE?R:S;ha=I.findMeshFromListAtPosition(Ta.colliders,ha,ja,!0);ja=!1;if(ha!==Q||J!==Ca)Q=ha,Ta.highlight(ha,Ca),ja=!0;pa.hoveredCollider=ha;pa.hasAnythingChanged=ja;return pa}}();this.onCanvasPointerMove=function(pa,ha){if(this.transforming){if(this.mode===WALK.TRANSFORM_MODE.TRANSLATE){var ja=V(N,pa,ha);ja&&this.newPosition.copy(ja.sub(X).add(U.position));Da.copy(this.newPosition);Da.sub(U.position);Da.divide(U.scale);W.update(Da);
if(pa!==ta||ha!==sa)aa.visible=!1,W.show(N),U.show(N)}else if(this.mode===WALK.TRANSFORM_MODE.ROTATE){if(U.show(N),this.newRotation.copy(za(pa,ha)),pa!==ta||ha!==sa)R.visible=!1}else{U.show(N);if(ja=V(N,pa,ha))ja.addScalar(1).divide(na),this.newScale.copy(ja);if(pa!==ta||ha!==sa)S.visible=!1}E.requestFrame();return!0}Ea(pa,ha,J).hasAnythingChanged&&E.requestFrame();return!1};this.onCanvasPointerDown=function(pa,ha){var ja=Ea(pa,ha,!0);J=!0;if(null!==ja.hoveredCollider)return fa=!0,N=(xa===WALK.TRANSFORM_MODE.TRANSLATE?
aa:xa===WALK.TRANSFORM_MODE.ROTATE?R:S).usedAxes(ja.hoveredCollider),ta=pa,sa=ha,this.mode===WALK.TRANSFORM_MODE.TRANSLATE?(O.show(N),this.newPosition.copy(this.oldPosition),X.copy(V(N,pa,ha))):this.mode===WALK.TRANSFORM_MODE.ROTATE?7===N&&(this.newRotation.copy(this.oldRotation),qa=ra(pa,ha)):(O.show(7===N?0:N),this.newScale.copy(this.oldScale),pa=V(N,pa,ha),na.copy(pa).addScalar(1).divide(this.oldScale)),!0;N=7;fa=!1;ja.hasAnythingChanged&&E.requestFrame();return!1};this.onCanvasPointerUp=function(pa,
ha){if(this.transforming){K(this.newPosition);M(this.newRotation);var ja=this.newScale;C.oldScale.copy(ja);C.newScale.copy(ja);O.show(0);W.show(0);N=7;U.show(N);this.mode===WALK.TRANSFORM_MODE.TRANSLATE?aa.visible=!0:this.mode===WALK.TRANSFORM_MODE.ROTATE?R.visible=!0:S.visible=!0}ja=this.transforming;fa=!1;this.update();Ea(pa,ha,!1).hasAnythingChanged&&E.requestFrame();J=!1;return ja};this.update=function(){if(!this.transforming&&(void 0!==this.target.position&&K(this.target.position),void 0!==this.target.rotation&&
M(this.target.rotation),void 0!==this.target.scale)){var pa=this.target.scale;C.oldScale.copy(pa);C.newScale.copy(pa)}ka.copy(F);ka.sub(U.position);ka.normalize();pa=.18*U.position.distanceTo(F)*B.camera.fov/90;U.scale.set(pa,pa,pa);O.scale.set(pa,pa,pa);W.scale.set(pa,pa,pa);aa.scale.set(pa,pa,pa);R.scale.set(pa,pa,pa);S.scale.set(pa,pa,pa);R.update(B.camera);O.update(B.camera);U.update(F);U.updateMatrixWorld();O.updateMatrixWorld();W.updateMatrixWorld();aa.updateMatrixWorld();R.updateMatrixWorld();
S.updateMatrixWorld()}}})();(function(){WALK.TransformControls=function(a,b,c,d,e){function f(){}function g(p){e.isEnabled()!==p&&(p?e.enable():e.disable())}var k=this,h=!1,m=new WALK.TransformGizmo(c,d,e.cameraWorldPosition(),b);m.mode=WALK.TRANSFORM_MODE.TRANSLATE;var l={itemModified:f},q=[];Object.defineProperty(this,"supportedModes",{get:function(){return q}});Object.defineProperty(this,"mode",{get:function(){return m.mode}});this.setItemModifiedCallback=function(p){console.assert(l.itemModified===f);l.itemModified=p};var n=
new WALK.PointerEventHelper(a,WALK.POINTER_PRIORITY.TRANSFORM_CONTROLS);n.callbacks.onPointerDown=function(p,r){p=m.onCanvasPointerDown(p,r);g(!m.transforming);return p};n.callbacks.onPointerUp=function(p,r){p=m.onCanvasPointerUp(p,r);g(!m.transforming);return p};n.callbacks.onPointerMove=function(p,r){p=m.onCanvasPointerMove(p,r);m.transforming&&(m.mode===WALK.TRANSFORM_MODE.TRANSLATE?(r=m.newPosition,k.target.setPosition(r.x,r.y,r.z)):m.mode===WALK.TRANSFORM_MODE.ROTATE?(r=m.newRotation,k.target.setRotation(r.z,
r.x,r.y)):(r=m.newScale,k.target.setScale(r.x,r.y,r.z)),l.itemModified(k.target));return p};n.disable();Object.defineProperty(this,"target",{get:function(){return m.target}});this.setTransformMode=function(p){m.mode=p};this.update=function(){h&&m.update()};this.enable=function(p,r){h=!0;m.target=p;null!==p&&(m.update(),m.visible=!0);q=r;-1===r.indexOf(m.mode)&&(m.mode=r[0]);n.enable()};this.disable=function(){h=!1;q=[];m.visible=!1;n.disable()}}})();(function(){var a=function(b,c){this._nodesPrimary=b;this._nodesSecondary=c};a.prototype.constructor=a;Object.defineProperty(a.prototype,"highlightMix",{set:function(b){this._nodesPrimary.forEach(function(c){c.highlightMix=b});this._nodesSecondary.forEach(function(c){c.highlightMix=b})}});Object.defineProperty(a.prototype,"selected",{set:function(b){this._nodesPrimary.forEach(function(c){c.selected=b});this._nodesSecondary.forEach(function(c){c.selectedSecondary=b})}});WALK.EditorSelector=function(b,
c,d,e,f,g,k,h,m){function l(){}function q(){A.highlightMix=.8*Math.pow(B/u.selectionTimeSec,2)}function n(R){null!==A&&(A.highlightMix=0);null!==R&&(A=R,B=u.selectionTimeSec,q());h.requestFrame()}function p(R){var S=R.geometry;S&&void 0===S.getAttribute("order")&&R.visible&&(R.visible=!1,aa.push(R))}function r(){for(var R=$jscomp.makeIterator(aa),S=R.next();!S.done;S=R.next())S.value.visible=!0}function x(){Z.set(!0,!1,!1);C.set(U);c.gpuMeshes.forEach(function(R){R.geometry.addTriangleOrderAttribute();
R.highlightMix=0;R.selected=!1;d.uploadNewBuffers(R)});aa.length=0;c.threeScene.traverse(p);c.threeScene.overrideMaterial=O;c.skyMeshes.forEach(function(R){R.visible=!1})}function w(){Z.restore();C.restore();r();c.threeScene.overrideMaterial=null;c.gpuMeshes.forEach(function(R){R.highlightMix=null;R.selected=null;R.selectedSecondary=!1});I=null;c.skyMeshes.forEach(function(R){R.visible=!0})}var u=this,A=null,B=0,I=null,F=0,E=new WALK.RayIntersection,K=new WALK.TransformControls(b,h,c,e,m),M={materialClicked:l,
lightInstanceClicked:l,lightProbeClicked:l,nodeClicked:l,extensionClicked:l,positionClicked:l},Z=new WALK.AutoClearAlter(d),C=new WALK.ClearColorAlter(d),U=new THREE.Color(16777215),O=new WALK.WireframeMaterial(new THREE.Color(0));O.highlight=O.meshSelectedLineColor;var W;this.selectionTimeSec=1;this.selectMaterial=function(R){console.assert(W===WALK.EditorSelector.SELECTION_MODE.MATERIAL);n(R)};this.selectLight=function(R){console.assert(W===WALK.EditorSelector.SELECTION_MODE.LIGHT);f.showSelectionMesh(R);
h.requestFrame()};this.selectLightInstance=function(R){var S=null;console.assert(W===WALK.EditorSelector.SELECTION_MODE.LIGHT);if(R){S=f.getLightInstanceMaterial(R);var fa=R.light.type;K.enable(R,"point"===fa?[WALK.TRANSFORM_MODE.TRANSLATE]:"sun"===fa?[WALK.TRANSFORM_MODE.ROTATE]:[WALK.TRANSFORM_MODE.TRANSLATE,WALK.TRANSFORM_MODE.ROTATE])}else K.disable();n(S)};this.selectLightProbe=function(R){var S=null;console.assert(W===WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE);R?(g.showLightProbeBoundingBox(R),
S=g.getLightProbeMaterial(R),K.enable(R,[WALK.TRANSFORM_MODE.TRANSLATE])):K.disable();n(S)};this.selectEditorCameraVolume=function(R){console.assert(W===WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME);R?(n(k.setHighlightedCameraVolume(R)),K.enable(R,[WALK.TRANSFORM_MODE.TRANSLATE,WALK.TRANSFORM_MODE.ROTATE,WALK.TRANSFORM_MODE.SCALE])):(n(null),K.disable())};this.selectExtension=function(R){var S=null;console.assert(W===WALK.EditorSelector.SELECTION_MODE.EXTENSION);R&&0<R.triggers.length&&(R=R.triggers[0].mesh)&&
(S=R.material);n(S)};this.selectNodes=function(R,S){console.assert(W===WALK.EditorSelector.SELECTION_MODE.NODE);I&&(I.selected=!1);R.length||S.length?(I=new a(R,S),I.selected=!0):I=null;n(I)};this.update=function(R){K.update();null!==A&&(B-=R,0<B?q():(A.highlightMix=0,A=null),h.requestFrame())};var aa=[];this.setDistanceToObject=function(R){F=R};this.setSelectionMode=function(R){if(R!==W){W===WALK.EditorSelector.SELECTION_MODE.NODE&&w();W===WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME&&k.setControlsVisible(!1);
switch(R){case WALK.EditorSelector.SELECTION_MODE.OFF:case WALK.EditorSelector.SELECTION_MODE.MATERIAL:case WALK.EditorSelector.SELECTION_MODE.EXTENSION:case WALK.EditorSelector.SELECTION_MODE.POSITION:case WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME:f.hideLights();g.hideLightProbes();break;case WALK.EditorSelector.SELECTION_MODE.LIGHT:f.showLights();g.hideLightProbes();break;case WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE:f.hideLights();g.showLightProbes();break;case WALK.EditorSelector.SELECTION_MODE.NODE:f.hideLights(),
g.hideLightProbes(),x()}R===WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME&&k.setControlsVisible(!0);K.disable();if(R===WALK.EditorSelector.SELECTION_MODE.MATERIAL||R===WALK.EditorSelector.SELECTION_MODE.EXTENSION)for(var S=$jscomp.makeIterator(c.getAnimatedMaterials()),fa=S.next();!fa.done;fa=S.next())fa.value.play();else for(S=$jscomp.makeIterator(c.getAnimatedMaterials()),fa=S.next();!fa.done;fa=S.next())fa.value.pause();W=R}};this.setMaterialClickedCallback=function(R){console.assert(M.materialClicked===
l);M.materialClicked=R};this.setLightInstanceClickedCallback=function(R){console.assert(M.lightInstanceClicked===l);M.lightInstanceClicked=R};this.setLightProbeClickedCallback=function(R){console.assert(M.lightProbeClicked===l);M.lightProbeClicked=R};this.setNodeClickedCallback=function(R){console.assert(M.nodeClicked===l);M.nodeClicked=R};this.setExtensionClickedCallback=function(R){console.assert(M.extensionClicked===l);M.extensionClicked=R};this.setPositionClickedCallback=function(R){console.assert(M.positionClicked===
l);M.positionClicked=R};(function(){var R=new WALK.PointerEventHelper(b,WALK.POINTER_PRIORITY.EDITOR_SELECTOR);R.callbacks.onClick=function(S,fa){if(W===WALK.EditorSelector.SELECTION_MODE.OFF)return!1;var X=!1;switch(W){case WALK.EditorSelector.SELECTION_MODE.MATERIAL:S=e.findObstacleMeshAtPosition(S,fa,!1);S=null!==S?S.material:null;null!==S&&(X=M.materialClicked(S));break;case WALK.EditorSelector.SELECTION_MODE.LIGHT:S=e.findMeshFromListAtPosition(f.lightInstanceMeshes,S,fa);S=null!==S?S.userData.lightInstance:
null;null!==S&&(X=M.lightInstanceClicked(S));break;case WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE:S=e.findMeshFromListAtPosition(g.lightProbeMeshes,S,fa);S=null!==S?S.lightProbe:null;null!==S&&(X=M.lightProbeClicked(S));break;case WALK.EditorSelector.SELECTION_MODE.NODE:S=e.findObstacleMeshAtPosition(S,fa,!1);(S=null!==S?S.node:null)&&(X=M.nodeClicked(S));break;case WALK.EditorSelector.SELECTION_MODE.EXTENSION:S=e.findIntersectionAtPosition(S,fa,!1,E)?E.object.anchor||null:null;S&&S.extension&&
(X=M.extensionClicked(S.extension,S));break;case WALK.EditorSelector.SELECTION_MODE.POSITION:S=e.findIntersectionAtPosition(S,fa,!1,E)&&!E.object.anchor?e.movePointTowardsTheCamera(E.point,F):null,S&&(X=M.positionClicked(S))}return X};R.callbacks.onDoubleClick=function(S,fa){return!1}})();Object.defineProperty(this,"transformControls",{get:function(){return K}});this.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.OFF)};WALK.EditorSelector.SELECTION_MODE={OFF:0,MATERIAL:1,LIGHT:2,LIGHT_PROBE:3,
NODE:4,EXTENSION:6,POSITION:7,CAMERA_VOLUME:8}})();(function(){function a(){WALK.BaseMaterial.call(this,WALK.getShader("static_render_vertex.glsl"),WALK.getShader("static_render_fragment.glsl"));this.uniforms={staticRender:{type:"t",value:null},sizeInv:{type:"v2",value:new THREE.Vector2}}}function b(c){c=WALK.createRenderer(c,{antialias:!1});c.autoClear=!1;c.autoUpdateObjects=!1;c.sortObjects=!1;return c}a.prototype=Object.create(WALK.BaseMaterial.prototype);a.prototype.constructor=a;WALK.StaticRenderViewer=function(c){var d=b(c),e=new a,f=new THREE.OrthographicCamera(-1,
1,1,-1,0,1),g=new THREE.Scene;c=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),e);d.uploadNewBuffers(c);g.add(c);this.update=function(k){var h=new Float32Array(k,0,k.byteLength/4);k=h[0];var m=h[1];h=h.subarray(2);console.assert(k*m===h.length/3);h=new WALK.DataTexture(h,k,m,GLC.RGB,GLC.FLOAT);h.minFilter=GLC.NEAREST;h.magFilter=GLC.NEAREST;h.generateMipmaps=!1;h.flipY=!1;h.needsUpdate=!0;e.uniforms.staticRender.value=h;e.uniforms.sizeInv.value.set(1/k,1/m);d.setCanvasSize(k,m);d.render(g,f);h.dispose()}}})();(function(){WALK.VRManager=function(a,b,c,d,e,f,g){function k(){return WALK.DETECTOR.ios&&void 0!==DeviceMotionEvent&&"function"===typeof DeviceMotionEvent.requestPermission&&void 0!==DeviceOrientationEvent&&"function"===typeof DeviceOrientationEvent.requestPermission?new Promise(function(K,M){Promise.all([DeviceMotionEvent.requestPermission(),DeviceOrientationEvent.requestPermission()]).then(function(Z){"granted"===Z[0]&&"granted"===Z[1]?K():M()},function(){M()})}):Promise.resolve()}function h(){n=
null;I.dispose();r=p=w=I=null;b.removeAllXrGamepads();g(!1);if(B){var K=B;B=null;K()}}function m(K){for(var M=$jscomp.makeIterator(K.removed),Z=M.next();!Z.done;Z=M.next())Z=Z.value,Z.gamepad&&b.removeXrGamepad(Z.gamepad);K=$jscomp.makeIterator(K.added);for(Z=K.next();!Z.done;Z=K.next())M=Z.value,M.gamepad&&b.addXrGamepad(M.gamepad,M.handedness)}var l=navigator.xr,q=c?!c.nativeWebXR:!1,n,p,r,x=!1,w,u,A,B=null,I,F=new THREE.Matrix4,E=WALK.CAMERA_MIN_FAR;this.setCameraFar=function(K){E=K;n&&(w.depthFar=
E,n.updateRenderState(w))};this.render=function(K,M,Z){A.set(!1,!0,!1);u.matrixWorld=M;M=u.projectionMatrix;for(var C=r.views,U=0;U<C.length;++U){var O=C[U];F.fromArray(O.transform.inverse.matrix);M.fromArray(r.transform.matrix);F.multiply(M);M.fromArray(O.projectionMatrix);M.multiply(F);Z(u);a.enableScissorTest(!0);O=w.baseLayer.getViewport(O);a.setScissor(O.x,O.y,O.width,O.height);I.x=O.x;I.y=O.y;I.width=O.width;I.height=O.height;a.render(K,u,I);a.enableScissorTest(!1)}A.restore()};this.enableVr=
function(K){l?x?(f(!0),k().then(function(){return K.makeXRCompatible().then(function(){return navigator.xr.requestSession("immersive-vr",{requiredFeatures:["local-floor"]})}).then(function(M){n=M;return n.requestReferenceSpace("local-floor")}).then(function(M){p=M;M=new XRWebGLLayer(n,K);I=a.createFrameBufferRenderTarget(M.framebuffer);w={baseLayer:M};u||(u=new THREE.PerspectiveCamera,A=new WALK.AutoClearAlter(a));w.depthNear=WALK.CAMERA_WALK_NEAR;w.depthFar=E;n.updateRenderState(w);n.addEventListener("end",
h);q||n.addEventListener("inputsourceschange",m);f(!1);g(!0)}).catch(function(){f(!1);WALK.USER_MSG.info("Failed to enable VR mode")})}).catch(function(){f(!1);WALK.USER_MSG.info("Permissions necessary for VR mode not granted")})):WALK.USER_MSG.info("VR device not connected"):WALK.USER_MSG.info('You need a <a href="https://mozvr.com/#start" target="_blank">VR ready browser</a>.')};this.disableVr=function(){n.end().then(function(){WALK.USER_MSG.hideInfo()},function(){WALK.USER_MSG.info("Failed to exit VR mode")})};
this.vrEnabled=function(){return!!p};this.requestAnimationFrame=function(){function K(M,Z){r=Z.getViewerPose(p);B&&(Z=B,B=null,Z(M))}return function(M){B=M;n.requestAnimationFrame(K)}}();this.update=function(){var K=new WALK.Euler,M=new THREE.Vector3;return function(){if(r){var Z=r.transform;if(null!==Z.orientation){K.setFromQuaternion(Z.orientation,"YXZ");var C=K.y;K.y=-K.z;K.z=C;Z=Z.position;e(K,Z&&M.set(Z.x,-Z.z,Z.y,Z.w))}}}}();(WALK.DETECTOR.https||WALK.DETECTOR.localhost)&&l?(c=function(){navigator.xr.isSessionSupported("immersive-vr").then(function(K){x=
K;d(K)})},c(),navigator.xr.addEventListener("devicechange",c,!1)):d(!1)}})();(function(){WALK.RaycasterConfig=function(a,b,c){this.ray=new THREE.Ray(a,b);this.far=c||Infinity;this.ignoreVisibility=this.onlyGroundCollisions=this.respectColliderSettings=!1};WALK.RayIntersection=function(){this.distance=Infinity;this.point=new THREE.Vector3;this.object=null};WALK.GpuRaycaster=function(a,b){function c(q,n){if(!n.ignoreVisibility&&!q.visible)return!1;var p=q.node||l;if(p.disableCollisions&&n.respectColliderSettings||!p.ground&&n.onlyGroundCollisions)return!1;p=n.ray;if(q.matrixWorld)return!0;
var r=q.geometry.boundingSphere;if(r.distanceToPoint(p.origin)>n.far||!1===p.isIntersectionSphere(r))return!1;q=q.geometry.boundingBox;return q.distanceToPoint(p.origin)>n.far||!p.isIntersectionBox(q)?!1:!0}var d=a.createRenderTarget(1,1,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!0,generateMipmaps:!1}),e=new Uint8Array(4),f=new WALK.AutoClearAlter(a),g=new WALK.ClearColorAlter(a),k=new THREE.Color(16777215),h=new WALK.ObjectDistanceMaterial(!1),m=new THREE.PerspectiveCamera(1,
1,b.near,b.far),l={disableCollisions:!1,ground:!1};this.closestIntersection=function(q,n,p){for(var r=[],x=0;x<q.length;x+=1){var w=q[x];console.assert(null===w.visibilityId);c(w,n)&&(w.visibilityId=r.length,r.push(w))}if(0===r.length)return!1;m.position.set(0,0,0);m.lookAt(n.ray.direction);m.position.copy(n.ray.origin);m.updateMatrixWorld();f.set(!0,!0,!1);g.set(k);q=a.sortObjects;a.sortObjects=!1;a.renderMeshes(r,h,m,d,!1,n.ignoreVisibility);a.sortObjects=q;g.restore();f.restore();a.readPixels(1,
1,e);a.setRenderTarget(null);q=256*e[0]+e[1];x=e[2]+e[3]/255;for(w=0;w<r.length;w+=1)r[w].visibilityId=null;if(65535===q||x>n.far)return!1;console.assert(q<r.length);p.object=r[q];p.distance=x;p.point.copy(n.ray.direction).multiplyScalar(x).add(n.ray.origin);return!0}}})();(function(){WALK.movePointTowards=function(){var a=new THREE.Vector3;return function(b,c,d){a.copy(b);a.sub(c).normalize();a.multiplyScalar(d);return b.sub(a)}}();WALK.Collider=function(a,b,c){var d=this,e=new THREE.Octree({scene:null,depthMax:Infinity,objectsThreshold:8,overlapPct:.15}),f=c.cameraWorldPosition(),g=b.camera,k=[];this.addStaticObstacle=function(q,n,p){e.add(q,n,p)};this.addDynamicObstacle=function(q){k.push(q)};this.removeDynamicObstacle=function(q){WALK.removeFromArray(q,k)};var h=
function(){var q=new WALK.GpuRaycaster(a,g);return function(n,p){for(var r=e.search(n.ray.origin,n.far,n.ray.direction),x=0;x<k.length;x+=1)r.push(k[x]);return q.closestIntersection(r,n,p)?!0:!1}}(),m=function(){var q=new WALK.RayIntersection;return function(n){return h(n,q)?q.distance:Infinity}}(),l=function(){var q=new WALK.RaycasterConfig;q.ray.direction.set(0,0,-1);q.respectColliderSettings=!0;q.onlyGroundCollisions=g.autoClimb;return function(n,p){q.ray.origin.copy(n);q.far=p;n=m(q);return g.autoClimb||
1<=n?n:Infinity}}();this.distanceToGround=function(q){return l(f,q)};this.findIntersectionBelow=function(){var q=new WALK.RaycasterConfig;q.ray.direction.set(0,0,-1);q.respectColliderSettings=!1;return function(n,p,r){q.ray.origin.copy(n);q.far=p;return h(q,r)}}();this.distanceToCeiling=function(){var q=new WALK.RaycasterConfig(f);q.ray.direction.set(0,0,1);q.respectColliderSettings=!0;return function(n){q.far=n;return m(q)}}();this.distanceToCeilingFrom=function(){var q=new WALK.RaycasterConfig;
q.ray.direction.set(0,0,1);q.respectColliderSettings=!0;return function(n,p){q.ray.origin.copy(n);q.far=p;return m(q)}}();this.cameraHeightFromPoint=function(q){q=l(q,WALK.MAX_GROUND_SEARCH_DEPTH);return Infinity===q?null:q};this.adjustPointToMatchCameraHeight=function(q){var n=c.cameraHeight;if(null===n)return!1;var p=l(q,WALK.MAX_GROUND_SEARCH_DEPTH);if(Infinity===p)return!1;n-=p;if(.01>Math.abs(n)||0<n&&Infinity!==this.distanceToCeilingFrom(q,n+WALK.MIN_DISTANCE_TO_CEILING))return!1;q.z+=n;return!0};
this.findIntersectionAtPosition=function(){var q=new WALK.RaycasterConfig(f),n=q.ray.direction;return function(p,r,x,w){n.set(p,r,1).unproject(c.camera());n.sub(f).normalize();q.respectColliderSettings=x;return h(q,w)}}();this.findObstacleMeshAtPosition=function(){var q=new WALK.RayIntersection;return function(n,p,r){return this.findIntersectionAtPosition(n,p,r,q)?q.object:null}}();this.findMeshFromListAtPosition=function(){var q=new WALK.RaycasterConfig(f),n=new WALK.RayIntersection,p=new WALK.GpuRaycaster(a,
g),r=q.ray.direction;return function(x,w,u,A,B){q.ignoreVisibility=void 0===A?!1:A;A=void 0===B?n:B;r.set(w,u,1).unproject(g);r.sub(f).normalize();return p.closestIntersection(x,q,A)?A.object:null}}();this.clickedPointToMoveTarget=function(){function q(u){var A=p.x-w.x;var B=p.y-w.y;A=Math.sqrt(A*A+B*B);n.far=A+WALK.CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE;r.x=w.x-p.x;r.y=w.y-p.y;if(!(.01>Math.abs(r.x)&&.01>Math.abs(r.y)))if(r.z=0,r.normalize(),h(n,x)){if(B=x.distance-WALK.CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE,
0<B&&(u.x=p.x+r.x*B,u.y=p.y+r.y*B,u.z=p.z),B=Math.min(x.distance-.01,A),p.x+=r.x*B,p.y+=r.y*B,d.adjustPointToMatchCameraHeight(p))return q(u)}else u.x=w.x,u.y=w.y,u.z=p.z}var n=new WALK.RaycasterConfig;n.respectColliderSettings=!0;var p=n.ray.origin,r=n.ray.direction,x=new WALK.RayIntersection,w=new THREE.Vector3;return function(u){p.copy(f);w.copy(u);u.copy(f);q(u);d.adjustPointToMatchCameraHeight(u)}}();this.movePointTowardsTheCamera=function(q,n){return WALK.movePointTowards(q,f,n)};this.handleCollisions=
function(){function q(u){c.applyCameraYaw(p);p.normalize();var A=r.start.distanceTo(f),B=r.end.distanceTo(f);if(w-.02<A+B&&A+B<w+.02&&B>=u&&x.equals(p))return!1;A=m(n);Infinity===A&&(A=n.far);x.copy(p);r.start.copy(f);r.end.copy(p).multiplyScalar(A).add(f);w=r.distance();return A<u}var n=new WALK.RaycasterConfig(f),p=n.ray.direction,r=new THREE.Line3,x=new THREE.Vector3,w=0;n.respectColliderSettings=!0;n.far=5;console.assert(n.far>WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE);return function(u){u=c.maxFrameMoveLinearDistance(u)+
WALK.KEY_MOVE_MIN_DISTANCE_TO_OBSTACLE;c.movesForward()&&(p.set(0,1,0),q(u)&&c.stopForward());c.movesBackward()&&(p.set(0,-1,0),q(u)&&c.stopBackward());c.movesLeft()&&(p.set(-1,0,0),q(u)&&c.stopLeft());c.movesRight()&&(p.set(1,0,0),q(u)&&c.stopRight());c.movesDown()&&(p.set(0,0,-1),q(u)&&c.stopDown());c.movesUp()&&(p.set(0,0,1),q(u)&&c.stopUp())}}()}})();(function(){WALK.OrbitControls=function(a,b,c,d){function e(J,N){p.collider&&p.mouseZoomToPointer&&p.collider.findIntersectionAtPosition(J/window.innerWidth*2-1,2*-(N/window.innerHeight)+1,!0,x)?C.copy(x.point):C.copy(p.target)}function f(){var J=b.getYawAngle(),N=b.getPitchAngle(),V=b.cameraWorldPosition();p.autoRotate&&Da===sa.NONE&&p.rotateLeft(2*Math.PI/60/60*p.autoRotateSpeed);var ra=p.getMinYawAngle(),ka=p.getMaxYawAngle();Math.abs(ka-ra)>=2*Math.PI-1E-6?J+=aa:ra===ka?J=ra:(ra>ka&&(ka+=2*Math.PI,
J<ra&&(J+=2*Math.PI)),J=0>aa?Math.min(Math.max(J+aa,ra),ka):Math.max(Math.min(J+aa,ka),ra));N=THREE.Math.clamp(N+R,p.getMinPitchAngle(),p.getMaxPitchAngle());U.copy(p.target).sub(V);ka=U.length();ra=THREE.Math.clamp(ka*S,p.minDistance,p.maxDistance);ka=ra/ka;O.copy(C).sub(V);W.copy(C).sub(p.target).multiplyScalar(1-ka);p.target.add(W);p.target.add(fa);WALK.OrbitControls.computeCameraPosition(V,p.target,J,N,ra);b.cameraPositionUpdated();b.setYawAngle(J);b.setPitchAngle(N);J=WALK.OrbitControls.computeCameraNear(ra);
1E-6<Math.abs(J-a.near)&&(a.near=J,a.updateProjectionMatrix());R=aa=0;S=1;fa.set(0,0,0);d.requestFrame()}function g(){wa=ta=na=xa=qa=0;Q&&(Q(),Q=!1)}function k(J){if(!1!==r){J.preventDefault();var N=c===document?c.body:c;if(Da===sa.ROTATE){if(!0===p.noRotate)return;u.set(J.clientX,J.clientY);A.subVectors(u,w);p.rotateLeft(A.x/N.clientWidth*p.mouseRotateSpeed);!1===p.noPitchRotate&&p.rotateUp(A.y/N.clientHeight*p.mouseRotateSpeed);w.copy(u)}else if(Da===sa.DOLLY){if(!0===p.noZoom)return;M.set(J.clientX,
J.clientY);Z.subVectors(M,K);0<Z.y?p.dollyIn():0>Z.y&&p.dollyOut();K.copy(M)}else if(Da===sa.PAN){if(!0===p.noPan)return;I.set(J.clientX,J.clientY);F.subVectors(I,B);p.pan(F.x/N.clientHeight,F.y/N.clientWidth);B.copy(I)}Da!==sa.NONE&&f()}}function h(){!1!==r&&Q&&(Q(),Q=!1)}function m(J){if(!1!==r&&!0!==p.noZoom&&Da===sa.NONE){J.preventDefault();var N=0;void 0!==J.wheelDelta?N=J.wheelDelta:void 0!==J.detail&&(N=-J.detail);e(J.clientX,J.clientY);0<N?p.dollyOut():0>N&&p.dollyIn();f()}}function l(J,N,
V){return!0===V?N:J===N?0:J}function q(J,N){var V=!1,ra=J.keyCode;if(!1!==r){if(!0===X&&!1===p.noPan)if(38===ra||87===ra)ta=l(ta,1,N),V=!0;else if(40===ra||83===ra)ta=l(ta,-1,N),V=!0;else if(37===ra||65===ra)wa=l(wa,1,N),V=!0;else{if(39===ra||68===ra)wa=l(wa,-1,N),V=!0}else if(!1===X&&!1===p.noRotate)if((38===ra||87===ra)&&!1===p.noPitchRotate)xa=l(xa,1,N),V=!0;else if((40===ra||83===ra)&&!1===p.noPitchRotate)xa=l(xa,-1,N),V=!0;else if(37===ra||65===ra)na=l(na,1,N),V=!0;else if(39===ra||68===ra)na=
l(na,-1,N),V=!0;switch(ra){case p.dollyKeys.IN1:case p.dollyKeys.IN2:case p.dollyKeys.IN3:!1===p.noZoom&&(qa=l(qa,1,N),V=!0);break;case p.dollyKeys.OUT1:case p.dollyKeys.OUT2:case p.dollyKeys.OUT3:!1===p.noZoom&&(qa=l(qa,-1,N),V=!0)}V&&(J.preventDefault(),d.requestFrame())}}function n(J){return p.noPan?!1:X&&1===J.length?!0:X||2!==J.length?!1:Math.abs(J[0].clientY-J[1].clientY)<=WALK.MAX_TWO_POINTERS_IN_LINE_DIFF}this.collider=null;this.target=new THREE.Vector3;this.noZoom=!1;this.mouseZoomToPointer=
!0;this.mouseZoomSpeed=.97;this.keyZoomSpeed=.7;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.noPitchRotate=this.noRotate=!1;this.mouseRotateSpeed=2*Math.PI;this.keyYawRotateSpeed=WALK.CAMERA_ARROWS_TURN_SPEED;this.keyPitchRotateSpeed=WALK.CAMERA_ARROWS_TURN_SPEED/2;this.autoRotate=!1;this.autoRotateSpeed=2;this.getMinPitchAngle=function(){return-Math.PI/2};this.getMaxPitchAngle=function(){return Math.PI/2};this.getMinYawAngle=function(){return-Math.PI};this.getMaxYawAngle=
function(){return Math.PI};this.noPan=!1;this.keyPanSpeed=.25;this.dollyKeys={IN1:61,IN2:187,IN3:69,OUT1:173,OUT2:189,OUT3:81};this.primaryMouseButton=THREE.MOUSE.LEFT;this.secondaryMouseButton=THREE.MOUSE.RIGHT;this.mouseButtons={ROTATE:this.primaryMouseButton,ZOOM:THREE.MOUSE.MIDDLE,PAN:this.secondaryMouseButton};var p=this,r=!1,x=new WALK.RayIntersection,w=new THREE.Vector2,u=new THREE.Vector2,A=new THREE.Vector2,B=new THREE.Vector2,I=new THREE.Vector2,F=new THREE.Vector2,E=new THREE.Vector3,K=
new THREE.Vector2,M=new THREE.Vector2,Z=new THREE.Vector2,C=new THREE.Vector3,U=new THREE.Vector3,O=new THREE.Vector3,W=new THREE.Vector3,aa=0,R=0,S=1,fa=new THREE.Vector3,X=!1,qa=0,na=0,xa=0,wa=0,ta=0,sa={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},Da=sa.NONE,Q=!1;this.enable=function(){r=!0;f()};this.disable=function(){r=!1;g()};this.isEnabled=function(){return r};this.setPanPrimary=function(J){X=J;!0===X?(this.mouseButtons.PAN=this.primaryMouseButton,this.mouseButtons.ROTATE=
this.secondaryMouseButton):(this.mouseButtons.ROTATE=this.primaryMouseButton,this.mouseButtons.PAN=this.secondaryMouseButton)};this.getCameraDistance=function(){var J=new THREE.Vector3;return function(){J.copy(b.cameraWorldPosition()).sub(this.target);return J.length()}}();this.rotateLeft=function(J){void 0===J&&(J=2*Math.PI/60/60*p.autoRotateSpeed);aa-=J};this.rotateUp=function(J){void 0===J&&(J=2*Math.PI/60/60*p.autoRotateSpeed);R-=J};this.panLeft=function(J){var N=a.matrixWorld.elements;E.set(N[0],
N[1],N[2]);E.multiplyScalar(-J);fa.add(E)};this.panUp=function(J){var N=a.matrixWorld.elements;E.set(N[4],N[5],N[6]);E.multiplyScalar(J);fa.add(E)};this.pan=function(J,N){if(a instanceof THREE.PerspectiveCamera){var V=b.cameraWorldPosition().clone().sub(p.target).length();V*=Math.tan(a.fov/2*Math.PI/180);p.panLeft(2*J*V);p.panUp(2*N*V)}else a instanceof THREE.OrthographicCamera&&(p.panLeft(J*(a.right-a.left)),p.panUp(N*(a.top-a.bottom)))};this.dollyIn=function(J){void 0===J&&(J=this.mouseZoomSpeed);
a instanceof THREE.PerspectiveCamera?S/=J:a instanceof THREE.OrthographicCamera&&(a.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,a.zoom*J)),a.updateProjectionMatrix())};this.dollyOut=function(J){void 0===J&&(J=this.mouseZoomSpeed);a instanceof THREE.PerspectiveCamera?S*=J:a instanceof THREE.OrthographicCamera&&(a.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,a.zoom/J)),a.updateProjectionMatrix())};this.update=function(J){if(r&&J){var N=!1;0!==na&&(p.rotateLeft(na*p.keyYawRotateSpeed*J),N=!0);
0!==xa&&(p.rotateUp(xa*p.keyPitchRotateSpeed*J),N=!0);if(0!==wa||0!==ta)p.pan(wa*p.keyPanSpeed*J,ta*p.keyPanSpeed*J),N=!0;0!==qa&&(J=Math.pow(p.keyZoomSpeed,J),-1===qa?p.dollyIn(J):p.dollyOut(J),N=!0);N&&f()}};c.addEventListener("mousedown",function(J){if(!1!==r){c.focus();J.preventDefault();if(J.button===p.mouseButtons.ROTATE){if(!0===p.noRotate)return;Da=sa.ROTATE;w.set(J.clientX,J.clientY)}else if(J.button===p.mouseButtons.ZOOM){if(!0===p.noZoom)return;Da=sa.DOLLY;K.set(J.clientX,J.clientY);e(J.clientX,
J.clientY)}else if(J.button===p.mouseButtons.PAN){if(!0===p.noPan)return;Da=sa.PAN;B.set(J.clientX,J.clientY)}Da!==sa.NONE&&(document.addEventListener("mousemove",k,!1),document.addEventListener("mouseup",h,!1),Q=function(){document.removeEventListener("mousemove",k,!1);document.removeEventListener("mouseup",h,!1);Da=sa.NONE})}},!1);c.addEventListener("mousewheel",m,!1);c.addEventListener("DOMMouseScroll",m,!1);c.addEventListener("touchstart",function(J){if(!1!==r){var N=J.touches.length;J.preventDefault();
if(n(J.touches))Da=sa.TOUCH_PAN,B.set(J.touches[0].clientX,J.touches[0].clientY);else if(p.noRotate||X||1!==N)if(p.noZoom||2!==N)Da=sa.NONE;else{Da=sa.TOUCH_DOLLY;N=J.touches[0].clientX-J.touches[1].clientX;var V=J.touches[0].clientY-J.touches[1].clientY;K.set(0,Math.sqrt(N*N+V*V));e(J.touches[0].clientX-N/2,J.touches[0].clientY-V/2)}else Da=sa.TOUCH_ROTATE,w.set(J.touches[0].clientX,J.touches[0].clientY)}},!1);c.addEventListener("touchend",function(){!1!==r&&(Da=sa.NONE)},!1);c.addEventListener("touchmove",
function(J){if(!1!==r){var N=J.touches.length;J.preventDefault();var V=c===document?c.body:c;n(J.touches)&&Da===sa.TOUCH_PAN?(I.set(J.touches[0].clientX,J.touches[0].clientY),F.subVectors(I,B),p.pan(F.x/V.clientHeight,F.y/V.clientWidth),B.copy(I),f()):p.noRotate||X||1!==N||Da!==sa.TOUCH_ROTATE?p.noZoom||2!==N||Da!==sa.TOUCH_DOLLY?Da=sa.NONE:(N=J.touches[0].clientX-J.touches[1].clientX,J=J.touches[0].clientY-J.touches[1].clientY,M.set(0,Math.sqrt(N*N+J*J)),Z.subVectors(M,K),0<Z.y?p.dollyOut():0>Z.y&&
p.dollyIn(),K.copy(M),f()):(u.set(J.touches[0].clientX,J.touches[0].clientY),A.subVectors(u,w),p.rotateLeft(A.x/V.clientWidth*p.mouseRotateSpeed),p.rotateUp(A.y/V.clientHeight*p.mouseRotateSpeed),w.copy(u),f())}},!1);c.addEventListener("blur",function(J){g()},!1);c.addEventListener("keydown",function(J){WALK.isModifierPressed(J)||q(J,!0)},!1);c.addEventListener("keyup",function(J){q(J,!1)},!1);a instanceof THREE.PerspectiveCamera||a instanceof THREE.OrthographicCamera||console.warn("WARNING: OrbitControls.js requires perspective or orthographic camers")};
WALK.OrbitControls.prototype.constructor=WALK.OrbitControls;WALK.OrbitControls.computeCameraPosition=function(){var a=new THREE.Vector3;return function(b,c,d,e,f){d-=Math.PI/2;e+=Math.PI/2;a.x=f*Math.sin(e)*Math.cos(d);a.y=f*Math.sin(e)*Math.sin(d);a.z=f*Math.cos(e);b.copy(c).add(a)}}();WALK.OrbitControls.computeCameraNear=function(a){return a*WALK.CAMERA_ORBIT_NEAR_FROM_1M}})();(function(){WALK.Controls=function(a,b,c,d){function e(){sa.rotation.z=WALK.normalizeRotation(J.z+Q.z)}function f(){e();ta.rotation.x=WALK.normalizeRotation(J.x+Q.x);wa.rotation.y=J.y;sa.updateMatrixWorld(!0)}function g(N){return Math.abs(N[0].y-N[1].y)<=WALK.MAX_TWO_POINTERS_IN_LINE_DIFF}function k(N){U[0].copy(C[0]);U[1].copy(C[1]);N.touches?(C[0].set(N.touches[0].clientX,N.touches[0].clientY),2===N.touches.length?C[1].set(N.touches[1].clientX,N.touches[1].clientY):C[1].set(0,0)):(C[0].set(N.clientX,
N.clientY),C[1].set(0,0))}function h(N){if(r)if(N.preventDefault(),k(N),fa){if(fa!==S){if(fa===W){var V=X[0].distanceTo(X[1]);N=C[0].distanceTo(C[1]);10<=Math.abs(N-V)?(fa=aa,V=!0):g(C)&&g(X)&&10<=Math.abs(C[0].y-X[0].y)?(fa=R,V=!0):V=!1;if(!V)return}fa===aa?(V=U[1].distanceTo(U[0]),V=C[1].distanceTo(C[0])-V,0<Math.abs(V)&&(qa=Date.now(),K.activateDirectionFromSource(Math.sign(V),A)),d.requestFrame()):fa===R&&g(C)&&(V=C[0].y-U[0].y,0<Math.abs(V)&&(na=Date.now(),M.activateDirectionFromSource(Math.sign(V),
A)),d.requestFrame())}}else if(!p.mousePressLook||xa||!fa&&N.touches){V=N.movementX||N.mozMovementX||N.webkitMovementX;void 0===V&&(V=C[0].x-U[0].x);var ra=N.movementY||N.mozMovementY||N.webkitMovementY;void 0===ra&&(ra=C[0].y-U[0].y);N=p.flipMouseLook||!fa&&N.touches?1:-1;Q.z+=N*V*WALK.CAMERA_LOOK_SPEED;p.mouseControlsPitch&&(Q.x+=N*ra*WALK.CAMERA_LOOK_SPEED);p.restrictVerticalAngle&&(Q.x>p.verticalAngleMax?Q.x=p.verticalAngleMax:Q.x<p.verticalAngleMin&&(Q.x=p.verticalAngleMin));f();d.requestFrame()}}
function m(N){r&&(b.focus(),N.preventDefault(),k(N),xa=!0,d.requestFrame())}function l(N){r&&(N.preventDefault(),xa=!1)}function q(N){var V=0,ra;(ra=!r)||(ra=void 0!==document.hasFocus?document.hasFocus():document.activeElement===b,ra=!ra);ra||(N||(N=window.event),N.preventDefault(),N.wheelDelta?V=N.wheelDelta/120:N.detail&&(V=-N.detail/3),O+=V*WALK.CAMERA_SCROLL_SPEED,O=0<=O?Math.min(O,.5):Math.max(O,-.5),d.requestFrame())}function n(){p.stopForward();p.stopBackward();p.stopLeft();p.stopRight();
p.stopUp();p.stopDown();Z.stopInDirection(1);Z.stopInDirection(-1)}var p=this,r=!0,x=Math.PI/12,w=Symbol("MOVE_SOURCE_NONE"),u=Symbol("MOVE_SOURCE_KEY"),A=Symbol("MOVE_SOURCE_GESTURE"),B=Symbol("MOVE_SOURCE_GAMEPAD"),I=function(N){this.activeDirection=0;this.activeSource=w;this.speed=0;this.moves=function(){return this.activeDirection||this.speed};this.movesInDirection=function(V){return this.activeDirection===V||Math.sign(this.speed)===V};this.activateDirectionFromSource=function(V,ra){this.activeDirection=
V;this.activeSource=ra};this.deactivateDirectionFromSource=function(V,ra){this.activeDirection===V&&this.activeSource===ra&&(this.activeDirection=0,this.activeSource=ra)};this.deactivateSource=function(V){this.activeSource===V&&(this.activeDirection=0,this.activeSource=w)};this.stopInDirection=function(V){this.activeDirection===V&&(this.activeDirection=0,this.activeSource=w);Math.sign(this.speed)===V&&(this.speed=0)};this.update=function(V,ra){if(!this.moves())return 0;var ka=Math.sign(this.speed),
za=this.activeDirection||-ka;za=ra*za*(ka===za?V/WALK.CAMERA_FULL_ACCELERATION_TIME:V/WALK.CAMERA_FULL_DECELERATION_TIME);ra*=this.speed+za/2;this.speed=THREE.Math.clamp(this.speed+za,-V,V);this.activeDirection||Math.sign(this.speed)===ka||(this.speed=0);return THREE.Math.clamp(ra,-N,N)}},F=1,E=new I(WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE),K=new I(WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE),M=new I(WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE),Z=new I(x),C=[new THREE.Vector2(0,0),new THREE.Vector2(0,
0)],U=[new THREE.Vector2(0,0),new THREE.Vector2(0,0)],O=0,W=Symbol("GESTURE_RECOGNITION"),aa=Symbol("GESTURE_PINCH"),R=Symbol("GESTURE_TWO_POINTER_DRAG"),S=Symbol("GESTURE_IGNORE"),fa=null,X=[new THREE.Vector2(0,0),new THREE.Vector2(0,0)],qa=0,na=0,xa=!1,wa=new THREE.Object3D,ta=new THREE.Object3D,sa=new THREE.Object3D,Da=!1,Q=new THREE.Vector3(0,0,0),J=new THREE.Euler(0,0,0);wa.add(a);ta.add(wa);sa.add(ta);this.flipMouseLook=this.mousePressLook=!1;this.restrictVerticalAngle=this.mouseControlsPitch=
!0;this.verticalAngleMin=-Math.PI/2;this.verticalAngleMax=Math.PI/3;this.arrowsTurn=!0;this.orbit=new WALK.OrbitControls(a,this,b,d);this.cameraHeight=null;this.isFpsEnabled=function(){return r};this.isOrbitEnabled=function(){return this.orbit.isEnabled()};this.orbitModeEnable=function(){r=!1;this.orbit.enable()};this.camera=function(){return a};this.applyCameraYaw=function(N){N.applyEuler(sa.rotation)};this.cameraWorldPosition=function(){return sa.position};this.cameraPositionUpdated=function(){var N=
{type:"positionChanged",target:null},V=null,ra=null,ka=null;return function(){sa.updateMatrixWorld(!0);var za=sa.position;if(V!==za.x||ra!==za.y||ka!==za.z)V=za.x,ra=za.y,ka=za.z,a.dispatchEvent(N)}}();this.resetRollAngle=function(){0!==wa.rotation.y&&(J.y=0,f())};this.getPitchAngle=function(){return ta.rotation.x};this.setPitchAngle=function(N){N!==ta.rotation.x&&(Q.x=N,J.x=0,f())};this.resetPitchAngle=function(){this.setPitchAngle(0)};this.getYawAngle=function(){return sa.rotation.z};this.setYawAngle=
function(N){N!==sa.rotation.z&&(Q.z=N,J.z=0,f())};this.resetYawAngle=function(){this.setYawAngle(0)};this.isHandlingGesture=function(){return null!==fa};this.hmdReset=function(){Da=!0;this.resetPitchAngle()};this.onHmdUpdate=function(){var N=new THREE.Vector3,V=new THREE.Vector3,ra=new THREE.Vector3,ka=new THREE.Vector3,za=new THREE.Vector3;return function(Ea,pa){r&&(J.copy(Ea),Da?Q.z-=J.z:pa&&(ka.subVectors(pa,ra),N.set(Math.cos(Q.z),Math.sin(Q.z),0),V.set(-Math.sin(Q.z),Math.cos(Q.z),0),za.copy(N.multiplyScalar(ka.x)),
za.add(V.multiplyScalar(ka.y)),za.z=ka.z,sa.position.add(za)),pa&&ra.copy(pa),Da=!1,f())}}();this.maxFrameMoveLinearDistance=function(N){return Math.min(N*a.moveMaxSpeed*F,WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE)};this.movesForward=function(){return K.movesInDirection(1)||0<O};this.stopForward=function(){0<O&&(O=0);K.stopInDirection(1)};this.movesBackward=function(){return K.movesInDirection(-1)||0>O};this.stopBackward=function(){0>O&&(O=0);K.stopInDirection(-1)};this.movesLeft=function(){return E.movesInDirection(-1)};
this.stopLeft=function(){E.stopInDirection(-1)};this.movesRight=function(){return E.movesInDirection(1)};this.stopRight=function(){E.stopInDirection(1)};this.movesUp=function(){return M.movesInDirection(1)};this.stopUp=function(){M.stopInDirection(1)};this.movesDown=function(){return M.movesInDirection(-1)};this.stopDown=function(){M.stopInDirection(-1)};this.enable=function(){this.orbit.disable();r=!0;xa=0};this.disable=function(){this.orbit.disable();r=!1;n()};this.update=function(N){if(r){K.activeSource===
A&&100<Date.now()-qa&&K.deactivateSource(A);M.activeSource===A&&100<Date.now()-na&&M.deactivateSource(A);var V=E.update(a.moveMaxSpeed*F,N),ra=K.update(a.moveMaxSpeed*F,N),ka=M.update(a.moveMaxSpeed*F,N);var za=0;ra?O=0:(O&&(ra=p.maxFrameMoveLinearDistance(N),za=THREE.Math.clamp(O,-ra,ra),O-=za),ra=za);sa.translateX(V);sa.translateY(ra);sa.translateZ(ka);N=Z.update(WALK.CAMERA_ARROWS_TURN_SPEED,N);Q.z+=N;e();(E.moves()||K.moves()||M.moves()||Z.moves()||O)&&d.requestFrame();this.cameraPositionUpdated()}else this.orbit.update(N)};
a.rotation.set(0,0,0);a.up.set(0,0,1);a.lookAt(new THREE.Vector3(0,1,0));b.setAttribute("tabindex",-1);b.addEventListener("contextmenu",function(N){N.preventDefault()},!1);b.addEventListener("mousedown",m,!1);b.addEventListener("touchstart",function(N){r&&(N.preventDefault(),k(N),2===N.touches.length?(fa=W,X[0].copy(C[0]),X[1].copy(C[1])):2<N.touches.length&&(fa=S))},!1);b.addEventListener("mousemove",h,!1);b.addEventListener("touchmove",h,!1);b.addEventListener("mouseup",l,!1);b.addEventListener("touchend",
function(N){r&&(N.preventDefault(),fa=0===N.touches.length?null:S)},!1);b.addEventListener("keydown",function(N){var V=!0;if(r&&!WALK.isModifierPressed(N)){F=N.shiftKey?WALK.CAMERA_MOVE_MAX_SPEED_SHIFT_FACTOR:1;switch(N.keyCode){case 38:case 32:case 87:K.activateDirectionFromSource(1,u);break;case 37:p.arrowsTurn?Z.activateDirectionFromSource(1,u):E.activateDirectionFromSource(-1,u);break;case 65:E.activateDirectionFromSource(-1,u);break;case 40:case 83:K.activateDirectionFromSource(-1,u);break;case 39:p.arrowsTurn?
Z.activateDirectionFromSource(-1,u):E.activateDirectionFromSource(1,u);break;case 68:E.activateDirectionFromSource(1,u);break;case 33:case 69:M.activateDirectionFromSource(1,u);break;case 34:case 81:M.activateDirectionFromSource(-1,u);break;default:V=!1}V&&(N.preventDefault(),d.requestFrame())}},!1);b.addEventListener("keyup",function(N){var V=!0;if(r){F=N.shiftKey?WALK.CAMERA_MOVE_MAX_SPEED_SHIFT_FACTOR:1;switch(N.keyCode){case 38:case 32:case 87:K.deactivateDirectionFromSource(1,u);break;case 37:case 65:Z.deactivateDirectionFromSource(1,
u);E.deactivateDirectionFromSource(-1,u);break;case 40:case 83:K.deactivateDirectionFromSource(-1,u);break;case 39:case 68:Z.deactivateDirectionFromSource(-1,u);E.deactivateDirectionFromSource(1,u);break;case 33:case 69:M.deactivateDirectionFromSource(1,u);break;case 34:case 81:M.deactivateDirectionFromSource(-1,u);break;default:V=!1}V&&N.preventDefault()}},!1);b.addEventListener("mouseout",function(N){l(N)},!1);b.addEventListener("mouseenter",function(N){0<N.buttons&&m(N)},!1);b.addEventListener("DOMMouseScroll",
q,!1);b.addEventListener("mousewheel",q,!1);b.addEventListener("blur",function(N){n()},!1);c.addEventListener("actionActivated",function(N){if(r)switch(N.action){case WALK.GAMEPAD_ACTION.BACKWARD:K.activateDirectionFromSource(-1,B);break;case WALK.GAMEPAD_ACTION.FORWARD:K.activateDirectionFromSource(1,B);break;case WALK.GAMEPAD_ACTION.LEFT:p.arrowsTurn?Z.activateDirectionFromSource(1,B):E.activateDirectionFromSource(-1,B);break;case WALK.GAMEPAD_ACTION.RIGHT:p.arrowsTurn?Z.activateDirectionFromSource(-1,
B):E.activateDirectionFromSource(1,B);break;case WALK.GAMEPAD_ACTION.DOWN:M.activateDirectionFromSource(-1,B);break;case WALK.GAMEPAD_ACTION.UP:M.activateDirectionFromSource(1,B)}});c.addEventListener("actionDeactivated",function(N){if(r)switch(N.action){case WALK.GAMEPAD_ACTION.BACKWARD:K.deactivateDirectionFromSource(-1,B);break;case WALK.GAMEPAD_ACTION.FORWARD:K.deactivateDirectionFromSource(1,B);break;case WALK.GAMEPAD_ACTION.LEFT:E.deactivateDirectionFromSource(-1,B);Z.deactivateDirectionFromSource(1,
B);break;case WALK.GAMEPAD_ACTION.RIGHT:E.deactivateDirectionFromSource(1,B);Z.deactivateDirectionFromSource(-1,B);break;case WALK.GAMEPAD_ACTION.DOWN:M.deactivateDirectionFromSource(-1,B);break;case WALK.GAMEPAD_ACTION.UP:M.deactivateDirectionFromSource(1,B)}});this.isEnabled=function(){return r}}})();(function(){function a(){var d=new WALK.StandardMaterial;d.baseColor.setRGB(.298,.619,.851);d.highlight=(new THREE.Color).setRGB(.033,.125,.445);d.setUniforms();return d}function b(d){var e=new THREE.CylinderBufferGeometry(.05,.05,.011,32),f=new THREE.CylinderBufferGeometry(.05,.03,.011,32,1,!1),g=new THREE.CylinderBufferGeometry(0,.05,.2,32,1,!0),k=new THREE.Matrix4;k.makeRotationX(Math.PI/2);e.applyMatrix(k);e.convertNormalsToSpherical();e=new THREE.Mesh(e,d);e.position.z+=.0055;k.makeTranslation(0,
-(.1+.0055),0);f.applyMatrix(k);f.convertNormalsToSpherical();f=new THREE.Mesh(f,d);g.convertNormalsToSpherical();d=new THREE.Mesh(g,d);d.add(f);d.rotateX(-Math.PI/2);d.position.z=.158;g=new THREE.Object3D;g.add(e);g.add(d);return g}function c(d){var e=a(),f=b(e),g=f.children[0],k=!1,h=1;this.hide=function(){k&&(d.removeAuxiliaryObject(f),k=!1)};this.isVisible=function(){return k};this.showTargetAtPosition=function(m,l,q,n){k||(d.addAuxiliaryObject(f),k=!0);g.visible=n;f.position.set(m,l,q);f.updateMatrixWorld()};
this.update=function(m){e.highlightMix+=m*h;1<=e.highlightMix&&(e.highlightMix=1,h=-1);0>=e.highlightMix&&(e.highlightMix=0,h=1)}}WALK.ClickNavigator=function(d,e,f,g){function k(){g.teleportingToPoint&&g.cancelSwitchToPoint()}function h(){!f.mousePressLook&&g.teleportingToPoint&&g.cancelSwitchToPoint()}var m=new c(d),l=new WALK.RayIntersection;g.addEventListener("teleportDone",function(){m.hide()});this.onMeshClicked=function(q,n){if(!f.isOrbitEnabled()&&!f.isHandlingGesture()&&0!==f.camera().moveMaxSpeed){e.clickedPointToMoveTarget(n);
q=n.x;var p=n.y,r=n.z,x=!1;e.findIntersectionBelow(n,4,l)?(r=l.point.z,r>l.object.geometry.boundingBox.max.z-.01&&(x=!0)):r-=f.cameraHeight||1.6;WALK.CLICK_MOVE_SHOW_TARGET_INDICATOR&&m.showTargetAtPosition(q,p,r,x);g.switchToPoint(n)}};this.update=function(q){m.isVisible()&&m.update(q)};this.dispose=function(){document.removeEventListener("keydown",k,!1);document.removeEventListener("mousedown",k,!1);document.removeEventListener("mousemove",h,!1);document.removeEventListener("touchstart",k,!1);document.removeEventListener("DOMMouseScroll",
k,!1);document.removeEventListener("mousewheel",k,!1)};document.addEventListener("keydown",k,!1);document.addEventListener("mousedown",k,!1);document.addEventListener("mousemove",h,!1);document.addEventListener("touchstart",k,!1);document.addEventListener("DOMMouseScroll",k,!1);document.addEventListener("mousewheel",k,!1)}})();(function(){WALK.StepsClimber=function(a,b,c){var d,e,f=b.cameraWorldPosition(),g=new THREE.Vector3;this.updateCameraHeight=function(k){if(d){var h=f.z-g.z;null!==b.cameraHeight&&(b.cameraHeight+=h);f.x!==g.x||f.y!==g.y?e=a.distanceToGround(WALK.MAX_GROUND_SEARCH_DEPTH):Infinity!==e&&(e+=h);Infinity!==e&&(null===b.cameraHeight&&(b.cameraHeight=e),h=b.cameraHeight,e<h-.005||e>h+.005)&&(h=b.cameraHeight,k=Math.min(Math.max(Math.sqrt(Math.pow(f.x-g.x,2)+Math.pow(f.y-g.y,2))/k*1.5,WALK.CAMERA_DEFAULT_MOVE_MAX_SPEED)*
k,Math.abs(e-h)),e>h&&(k=-k),0>k||Infinity===a.distanceToCeiling(k+WALK.MIN_DISTANCE_TO_CEILING))&&(f.z+=k,e+=k,c.requestFrame());g.copy(f)}};this.enable=function(){d=!0;e=a.distanceToGround(WALK.MAX_GROUND_SEARCH_DEPTH);b.cameraHeight=Infinity!==e?e:null;g.copy(f)};this.disable=function(){d=!1};this.isEnabled=function(){return d};this.enable()}})();(function(){WALK.VRHeightController=function(a,b){var c=a.cameraWorldPosition(),d,e,f;this.onHmdPositionUpdate=function(g){d&&!f&&1<g.z&&(a.cameraHeight=g.z,b.adjustPointToMatchCameraHeight(c),a.cameraPositionUpdated(),e=c.z,f=!0)};this.onTeleportDone=function(){d&&(e=c.z)};this.updateCameraHeight=function(){d&&(a.cameraHeight+=c.z-e,e=c.z)};this.enable=function(){d=!0;a.cameraHeight=b.cameraHeightFromPoint(c);null===a.cameraHeight&&(a.cameraHeight=WALK.FALLBACK_CAMERA_HEIGHT);e=c.z;f=!1};this.disable=
function(){d=!1;a.cameraHeight=null}}})();(function(){function a(d){var e=null;this.activateSky=function(f){if(e){if(e.name===f)return;d.removeAuxiliaryObject(e)}var g=d.findSkyMesh(f);(f=g.material.map)&&!f.loaded?(this.activateSky(WALK.DEFAULT_SKY_NAME),e=g,f.addLoadedListener(function(){e===g&&(d.addAuxiliaryObject(g),g.updateMatrixWorld(!0))})):(d.addAuxiliaryObject(g),g.updateMatrixWorld(!0),e=g)};this.activeSkyName=function(){return e.name}}function b(d,e,f){this.position=d||new THREE.Vector3;this.rotation=e||new THREE.Vector2;this.fov=
f||0}var c=1/180;b.prototype={length:function(){return Math.sqrt(this.position.lengthSq()+this.rotation.lengthSq()+this.fov*this.fov)},multiplyScalar:function(d){this.position.multiplyScalar(d);this.rotation.multiplyScalar(d);this.fov*=d;return this},divideScalar:function(d){this.position.divideScalar(d);this.rotation.divideScalar(d);this.fov/=d;return this},normalize:function(){return this.divideScalar(this.length())},normalizeRotation:function(){this.rotation.x=WALK.normalizeRotation(this.rotation.x);
this.rotation.y=WALK.normalizeRotation(this.rotation.y);return this},distanceTo:function(d){var e=this.position.x-d.position.x,f=this.position.y-d.position.y,g=this.position.z-d.position.z,k=WALK.normalizeRotation(this.rotation.x-d.rotation.x),h=WALK.normalizeRotation(this.rotation.y-d.rotation.y);d=this.fov-d.fov;return Math.sqrt(e*e+f*f+g*g+k*k+h*h+d*d)},subVectors:function(d,e){this.position.subVectors(d.position,e.position);this.rotation.subVectors(d.rotation,e.rotation);this.fov=d.fov-e.fov;
return this.normalizeRotation()},copy:function(d){this.position.copy(d.position);this.rotation.copy(d.rotation);this.fov=d.fov;return this}};WALK.Teleport=function(d,e,f,g){function k(){w=[];for(var X=0;X<d.views.length;X+=1)w[d.views[X].id]=[];for(X=0;X<d.gpuMeshes.length;X+=1){var qa=d.gpuMeshes[X],na=qa.hideInViews;if(na)for(var xa=0;xa<na.length;xa+=1)w[na[xa]]?w[na[xa]].push(qa):console.warn("Invalid view id in hideInViews list: '"+na[X]+"'")}}function h(X){for(var qa=0;qa<X.length;qa+=1){var na=
X[qa];na.visible=!1;u.push(na)}}function m(){for(var X=0;X<u.length;X+=1)u[X].visible=!0;u.length=0}function l(X){m();h(X)}function q(){x.fov=A.fov;r.copy(A.position);e.setYawAngle(A.rotation.x);e.setPitchAngle(A.rotation.y);e.cameraPositionUpdated()}var n=this,p=new a(d),r=e.cameraWorldPosition(),x=d.camera,w,u=[],A=new b,B=new b,I=new THREE.Vector3,F=0,E=0,K=0,M,Z,C,U=!1,O={type:"teleportStarted",target:this,view:null},W={type:"teleportDone",target:this,view:null},aa=null;this.lastDestinationView=
null;var R=this.teleportingToPoint=this.teleportingToView=!1,S=!1,fa=function(){var X=new b(e.cameraWorldPosition());return function(){X.rotation.set(e.getYawAngle(),e.getPitchAngle());X.normalizeRotation();X.fov=x.fov;return X}}();this.update=function(){function X(na,xa){var wa=0;E*E/(2*K)>=xa?(wa=E/K,wa=2*(E*wa-xa)/(wa*wa)*-na):E<F&&(wa=na*K);qa.copy(B);E=THREE.Math.clamp(E+.5*wa,0,F);qa.multiplyScalar(E*na);E=THREE.Math.clamp(E+.5*wa,0,F);qa.fov&&(x.fov+=qa.fov,x.updateProjectionMatrix());r.add(qa.position);
e.setYawAngle(e.getYawAngle()+qa.rotation.x);e.setPitchAngle(e.getPitchAngle()+qa.rotation.y)}var qa=new b;return function(na){if(n.teleportingToView||n.teleportingToPoint){na=Math.min(na,.067);na=Math.max(na,c);var xa=fa().distanceTo(A);this.teleportingToPoint&&(A.position.z=r.z);var wa=!0;0!==xa&&(X(na,xa),fa().distanceTo(A)>xa||0===E?q():wa=!1,e.cameraPositionUpdated());wa&&(this.teleportingToView&&("orbit"!==C.mode||U?(na=e.camera(),na.near=WALK.CAMERA_WALK_NEAR,na.updateProjectionMatrix(),e.enable()):
(e.orbit.minDistance=M,e.orbit.maxDistance=Z,e.orbit.setPanPrimary(C.panPrimary||!1),e.orbit.noPan=C.noPan||!1,e.orbit.noRotate=C.noRotate||!1,e.orbit.noPitchRotate=C.noPitchRotate||!1,e.orbit.getMinPitchAngle=function(){return-C.maxUpAngle},e.orbit.getMaxPitchAngle=function(){return-C.minUpAngle},e.orbit.getMinYawAngle=function(){return C.minSideAngle},e.orbit.getMaxYawAngle=function(){return C.maxSideAngle},e.orbit.target.copy(I),e.orbitModeEnable()),p.activateSky(C.sky),l(w[C.id]||[])),this.teleportingToView=
this.teleportingToPoint=!1,W.view=C,this.dispatchEvent(W));g.requestFrame()}}}();this.cancelSwitchToPoint=function(){console.assert(this.teleportingToPoint);this.teleportingToPoint=!1;W.view=null;this.dispatchEvent(W)};this.switchToPoint=function(X){if(X.x!==r.x||X.y!==r.y)if(C=null,this.teleportingToPoint=!0,this.teleportingToView=!1,O.view=null,this.dispatchEvent(O),R?A.position.set(X.x,X.y,X.z):A.position.set(X.x,X.y,r.z),X=WALK.yawRotationToPoint(r,X),X=WALK.normalizeRotation(X),A.rotation.set(X,
0),A.fov=x.defaultFov,R)q(),this.update(c);else{B.subVectors(A,fa());X=B.length();F=2*WALK.CAMERA_DEFAULT_MOVE_MAX_SPEED;K=F/WALK.CAMERA_FULL_ACCELERATION_TIME;var qa=WALK.TELEPORT_TO_POINT_MAX_TIME;X>(qa-WALK.CAMERA_FULL_ACCELERATION_TIME)*F&&(F=WALK.Math.anyPositiveRootOfQuadraticEquation(1,-K*qa,K*X),null===F&&(qa/=2,K=X/(qa*qa),F=K*qa));B.normalize();E=0;g.requestFrame()}};this.switchToView=function(X,qa){void 0===qa&&(qa=WALK.TELEPORT_TO_VIEW_MAX_TIME);X.hideFromMenu||(aa=X);this.lastDestinationView=
C=X;this.teleportingToView=!0;this.teleportingToPoint=!1;O.view=C;this.dispatchEvent(O);e.disable();e.resetRollAngle();h(w[C.id]||[]);void 0!==C.rotation?A.rotation.set(C.rotation.yaw,C.rotation.pitch):A.rotation.set(0,0);A.fov=C.fov||x.defaultFov;"orbit"===C.mode?(void 0!==C.target?I.set(C.target.x,C.target.y,C.target.z):I.set(0,0,0),M=C.minDistance||0,Z=C.maxDistance||100,X=THREE.Math.clamp(C.distance||10,M,Z),WALK.OrbitControls.computeCameraPosition(A.position,I,A.rotation.x,A.rotation.y,X),x.near=
WALK.OrbitControls.computeCameraNear(X),x.updateProjectionMatrix()):void 0!==C.position?(A.position.set(C.position.x,C.position.y,C.position.z),S&&f.adjustPointToMatchCameraHeight(A.position)):A.position.set(0,0,0);if(0===qa||R)q(),this.update(c);else{C.sky!==p.activeSkyName()&&p.activateSky(WALK.DEFAULT_SKY_NAME);B.subVectors(A,fa());X=B.length();K=WALK.TELEPORT_TO_VIEW_ACCELERATION;var na=Math.sqrt(X/K);na>qa/2&&(na=qa/2,K=X/(na*na));F=K*na;B.normalize();E=0}g.requestFrame()};this._switchToAdjacentVisibleView=
function(X,qa){var na=d.visibleViews();if(0!==na.length)if(null===aa)this.switchToView(na[0],qa);else{var xa=na.indexOf(aa);-1===xa&&this.switchToView(na[0],qa);this.switchToView(na[(xa+na.length+X)%na.length],qa)}};this.switchToPreviousVisibleView=function(X){this._switchToAdjacentVisibleView(-1,X)};this.switchToNextVisibleView=function(X){this._switchToAdjacentVisibleView(1,X)};this.updateHiddenMeshes=function(X){k();X?l(w[X.id]||[]):m();g.requestFrame()};this.activateSky=function(X){p.activateSky(X.sky);
g.requestFrame()};this.executeWithViewVisibilitySettings=function(X,qa){var na=u.slice();l(w[X.id]||[]);p.activateSky(X.sky);qa();p.activateSky(this.lastDestinationView.sky);l(na)};this.onVrChange=function(X){S=R=U=X;this.lastDestinationView&&"orbit"===this.lastDestinationView.mode&&this.switchToView(this.lastDestinationView,0)};k();d.addEventListener("viewAdded",k);d.addEventListener("viewRemoved",k);d.addEventListener("skyMeshAdded",function(X){p.activateSky(X.skyMesh.name);g.requestFrame()});d.addEventListener("skyMeshRemoved",
function(X){p.activeSkyName()===X.skyMesh.name&&(p.activateSky(WALK.DEFAULT_SKY_NAME),g.requestFrame())})};THREE.EventDispatcher.prototype.apply(WALK.Teleport.prototype)})();(function(){WALK.AutoTour=function(a,b){function c(){d&&b.switchToNextVisibleView(4)}var d=!1,e={type:"tourStarted"},f={type:"tourStopped"};b.addEventListener("teleportDone",function(){d&&setTimeout(c,WALK.AUTO_TOUR_IN_VIEW_STILL_TIME_MS)});this.isRunning=function(){return d};this.start=function(){console.assert(!d);d=!0;this.dispatchEvent(e);c()};this.stop=function(){console.assert(d);d=!1;b.switchToView(b.lastDestinationView,0);this.dispatchEvent(f)}};THREE.EventDispatcher.prototype.apply(WALK.AutoTour.prototype)})();(function(){function a(g){return-.7>=g?0:.7<=g?1:-1}function b(g,k){if("xr-standard"===g.mapping)return"left"===(g.hand?g.hand:k)?d:e;k=$jscomp.makeIterator(c);for(var h=k.next();!h.done;h=k.next()){h=h.value;var m=g;var l=h;m=l.gamepadIdPattern.test(m.id)?void 0!==l.gamepadLayoutMappingId?m.mapping===l.gamepadLayoutMappingId:!0:!1;if(m)return h}console.error("No matching action mapping for gamepad found",g.id);return null}WALK.GAMEPAD_ACTION={TRIGGER:0,BACKWARD:1,FORWARD:2,LEFT:3,RIGHT:4,DOWN:5,
UP:6,PREVIOUS:7,NEXT:8};var c=[{gamepadIdPattern:/^Spatial Controller \(Spatial Interaction Source\).*$/,axisMapping:new Map([[2,[WALK.GAMEPAD_ACTION.PREVIOUS,WALK.GAMEPAD_ACTION.NEXT]],[3,[WALK.GAMEPAD_ACTION.UP,WALK.GAMEPAD_ACTION.DOWN]],[0,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER]])},{gamepadIdPattern:/Oculus Touch \(Left\)/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.LEFT,
WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER],[3,WALK.GAMEPAD_ACTION.DOWN],[4,WALK.GAMEPAD_ACTION.UP]])},{gamepadIdPattern:/Oculus Touch \(Right\)/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER],[3,WALK.GAMEPAD_ACTION.NEXT],[4,WALK.GAMEPAD_ACTION.PREVIOUS]])},
{gamepadIdPattern:/OpenVR (Gamepad|Controller)/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.PREVIOUS,WALK.GAMEPAD_ACTION.NEXT]],[1,[WALK.GAMEPAD_ACTION.DOWN,WALK.GAMEPAD_ACTION.UP]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER]])},{gamepadIdPattern:/.*/,gamepadLayoutMappingId:"standard",axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]],[2,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[3,
[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.DOWN],[1,WALK.GAMEPAD_ACTION.NEXT],[2,WALK.GAMEPAD_ACTION.PREVIOUS],[3,WALK.GAMEPAD_ACTION.UP],[4,WALK.GAMEPAD_ACTION.TRIGGER],[5,WALK.GAMEPAD_ACTION.TRIGGER]])},{gamepadIdPattern:/.*/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.PREVIOUS,WALK.GAMEPAD_ACTION.NEXT]],[1,[WALK.GAMEPAD_ACTION.UP,WALK.GAMEPAD_ACTION.DOWN]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.TRIGGER],[1,WALK.GAMEPAD_ACTION.TRIGGER],
[2,WALK.GAMEPAD_ACTION.TRIGGER],[3,WALK.GAMEPAD_ACTION.TRIGGER]])}],d={axisMapping:new Map([[2,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[3,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.TRIGGER],[4,WALK.GAMEPAD_ACTION.DOWN],[5,WALK.GAMEPAD_ACTION.UP]])},e={axisMapping:new Map([[2,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[3,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.TRIGGER],
[4,WALK.GAMEPAD_ACTION.NEXT],[5,WALK.GAMEPAD_ACTION.PREVIOUS]])},f=function(g,k){k=b(g,k);this.axisMapping=k.axisMapping;this.buttonMapping=k.buttonMapping;this.axisPosition=g.axes.map(a);this.buttonPressed=g.buttons.map(function(h){return h.pressed})};WALK.GamepadManager=function(){function g(r){var x=r.gamepad;r=new f(r.gamepad);h.set(x.index,r)}function k(r){h.delete(r.gamepad.index)}var h=new Map,m=new Map,l=new Set,q=new Set,n={type:"actionActivated",action:null},p={type:"actionDeactivated",
action:null};this.hasGamepads=function(){return 0<h.size||0<m.size};this.update=function(){function r(A,B){for(var I=0;I<B.axes.length;++I){var F=a(B.axes[I]),E=A.axisPosition[I];if(F!==E){var K=A.axisMapping.get(I);void 0!==K&&(-1!==E&&q.add(K[E]),-1!==F&&l.add(K[F]))}A.axisPosition[I]=F}for(I=0;I<B.buttons.length;++I)F=B.buttons[I].pressed,E=A.buttonPressed[I],F!==E&&(K=A.buttonMapping.get(I),void 0!==K&&(E?q.add(K):l.add(K))),A.buttonPressed[I]=F}if(this.hasGamepads()){l.clear();q.clear();var x=
navigator.getGamepads?navigator.getGamepads():[];x=$jscomp.makeIterator(x);for(var w=x.next();!w.done;w=x.next())if(w=w.value){var u=h.get(w.index);r(u,w)}x=$jscomp.makeIterator(m);for(w=x.next();!w.done;w=x.next())u=$jscomp.makeIterator(w.value),w=u.next().value,u=u.next().value,r(u,w);w=$jscomp.makeIterator(q);for(x=w.next();!x.done;x=w.next())p.action=x.value,this.dispatchEvent(p);w=$jscomp.makeIterator(l);for(x=w.next();!x.done;x=w.next())n.action=x.value,this.dispatchEvent(n)}};this.addXrGamepad=
function(r,x){x=new f(r,x);m.set(r,x)};this.removeXrGamepad=function(r){m.delete(r)};this.removeAllXrGamepads=function(){m.clear()};(function(){if(navigator.getGamepads){window.addEventListener("gamepadconnected",g);window.addEventListener("gamepaddisconnected",k);for(var r=$jscomp.makeIterator(navigator.getGamepads()),x=r.next();!x.done;x=r.next())if(x=x.value){var w=new f(x);h.set(x.index,w)}}})()};THREE.EventDispatcher.prototype.apply(WALK.GamepadManager.prototype)})();/*
 Copyright (C) 2020-present Shapespark
*/
(function(){WALK.GazeModeObserver=function(){var a=this,b=!1,c={type:"modeDisabled"},d={type:"modeEnabled"};this.enableMode=function(){b=!0;a.dispatchEvent(d)};this.disableMode=function(){b=!1;a.dispatchEvent(c)};this.modeIsEnabled=function(){return b}};THREE.EventDispatcher.prototype.apply(WALK.GazeModeObserver.prototype)})();(function(){function a(){var c=new THREE.BufferGeometry,d=new Float32Array(18);c.addAttribute("position",new THREE.BufferAttribute(d,3));d[0]=.05;d[1]=-.05;d[2]=-2;d[3]=.05;d[4]=.05;d[5]=-2;d[6]=-.05;d[7]=-.05;d[8]=-2;d[9]=.05;d[10]=.05;d[11]=-2;d[12]=-.05;d[13]=.05;d[14]=-2;d[15]=-.05;d[16]=-.05;d[17]=-2;c.computeBoundingSphere();return c}console.assert(WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S<=WALK.GAZE_POINTER_ACTIVATE_AFTER_S);var b=Math.PI/60;WALK.GazePointer=function(c,d,e,f){function g(){h=m=
null;l=0;q=!1;n&&n.setCircleSpan(0)}var k=f.modeIsEnabled(),h,m,l,q,n=null,p=null,r=null;this.setGazeHandlers=function(w,u){p=w;r=u};var x=function(){if(!k)g();else if(!n){var w=new WALK.GazePointerMaterial,u=new THREE.Mesh(a(),w);c.addAuxiliaryObject(u);u.frustumCulled=!1;u.matrixWorld=d.camera().matrixWorld;n={setVisible:function(A){u.visible=A;e()},setCircleSpan:function(A){w.circleSpan=A;e()}};g()}n&&n.setVisible(k)};f.addEventListener("modeDisabled",function(){k=!1;x()});f.addEventListener("modeEnabled",
function(){k=!0;x()});this.reset=function(){null!==h&&g()};this.update=function(w){if(k){var u=d.getPitchAngle(),A=d.getYawAngle();null===h?(h=u,m=A):Math.abs(h-u)>b||Math.abs(m-A)>b?g():(l+=w,l>=WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S&&(q?(n.setCircleSpan(Math.min((l-WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S)/(WALK.GAZE_POINTER_ACTIVATE_AFTER_S-WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S),1)),l>=WALK.GAZE_POINTER_ACTIVATE_AFTER_S&&(r&&r(),g())):p&&p()?q=!0:g()))}};x()}})();/*
 Copyright (C) 2018-present Shapespark
*/
(function(){WALK.HashChangeTeleport=function(a,b){function c(){var d=WALK.urlHashGetArgument("view");d&&(d=a.findViewByName(d))&&(b.switchToView(d),window.location.hash=WALK.urlHashRemoveArgument("view"))}window.addEventListener("hashchange",c,!1);this.dispose=function(){window.removeEventListener("hashchange",c,!1)}}})();(function(){WALK.AutoClearAlter=function(a){var b,c,d,e;this.set=function(f,g,k){console.assert(void 0===b&&void 0===c&&void 0===d&&void 0===e);b=a.autoClear;c=a.autoClearColor;d=a.autoClearDepth;e=a.autoClearStencil;a.autoClear=f||g||k;a.autoClearColor=f;a.autoClearDepth=g;a.autoClearStencil=k};this.restore=function(){console.assert(void 0!==b&&void 0!==c&&void 0!==d&&void 0!==e);a.autoClear=b;a.autoClearColor=c;a.autoClearDepth=d;a.autoClearStencil=e;e=d=c=b=void 0}}})();(function(){WALK.ClearColorAlter=function(a){var b=new THREE.Color,c=null,d=!1;this.set=function(e,f){console.assert(!d);d=!0;b.copy(a.getClearColor());c=a.getClearAlpha();a.setClearColor(e,f)};this.restore=function(){console.assert(d);d=!1;a.setClearColor(b,c)}}})();(function(){var a=WALK.getShader("standard_material_vertex.glsl"),b=WALK.getShader("standard_material_fragment.glsl"),c=new WALK.InlineShader("vec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\n                     inout float opacity) {\n  return addSpecular(baseColor, totalIntensity, opacity);\n}"),d=new THREE.Color,e=new THREE.Vector3(0,0,0),f=new THREE.Vector4(0,0,1,1);WALK.ParallaxModes={basic:"USE_BASIC_PARALLAX",steep:"USE_STEEP_PARALLAX",occlusion:"USE_OCLUSION_PARALLAX",relief:"USE_RELIEF_PARALLAX"};
WALK.StandardMaterial=function(){var g=this;WALK.BaseMaterial.call(this,a,b,this.fragmentShaderHooks());this.type="standard";this.merged=!1;this._opacity=1;Object.defineProperty(this,"opacity",{get:function(){return this._opacity},set:function(h){this._opacity=.99<h?1:h;this.configureTransparency();this.setUniforms();this._updated()}});this.baseColor=new THREE.Color(16777215);this._baseColorTexture=null;this._baseColorTextureCorrection=this.planarReflector=!1;this._baseColorTextureContrast=0;this.baseColorTextureHslOffset=
{h:0,s:0,l:0};this._baseColorCorrectionUniform=new THREE.Vector4;this._emissive=this.lightMapped=!1;this._roughness=this._emissionStrength=1;this._metallic=0;this._lastUsedLightProbeId=this.cubeCameraIndex=null;this._haveTextureLod=WALK.DETECTOR.gl.textureLod;this._mipLevel1=this._mipLevel0=null;this.disableLightProbeTmp=this.disableLightProbe=!1;this._envMapProject=!0;this._hdrOutput=!1;this._bumpScale=.001;this.parallaxCorrection=!1;this.parallaxMode="basic";this.parallaxScale=-.03;this.parallaxMinLayers=
10;this.parallaxMaxLayers=15;this.colorMap=null;this.cameraExposure=0;this.cameraGamma=1;this.headLight=!1;this._uvOffsetScale=null;this.highlight=WALK.EDIT_MODE?WALK.EDITOR_SELECTION_COLOR:null;this._specularOff=this._highlightMix=0;this.doNotImport={baseColor:!1,opacity:!1};var k={type:"updated",target:this};this._updated=function(){return g.dispatchEvent(k)};this._alphaInLowerHalf=!1;this._chromaKeyEnabled=void 0;this.chromaKeyColor=(new THREE.Color).setRGB(0,.94,0);this._chromaKeyDelta=new THREE.Vector3(.1,
.1,.1);this._chromaKeyDeltaCoeff=new THREE.Vector3};WALK.StandardMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.StandardMaterial.prototype.constructor=WALK.StandardMaterial;WALK.StandardMaterial.prototype.addTextureProperty=function(g){var k="_"+g;Object.defineProperty(this,g,{get:function(){return this[k]||null},set:function(h){var m=this;(this[k]=h)?h.addLoadedListener(function(){m.setUniforms();m._updated();m=h=null}):(m.setUniforms(),m._updated())}})};WALK.StandardMaterial.prototype.addTextureProperty("roughnessTexture");
WALK.StandardMaterial.prototype.addTextureProperty("metallicTexture");WALK.StandardMaterial.prototype.addTextureProperty("bumpTexture");WALK.StandardMaterial.prototype.fragmentShaderHooks=function(){return c};WALK.StandardMaterial.prototype._useChromaKey=function(){return!(!this.isAnimated||!this.chromaKeyEnabled)};WALK.StandardMaterial.prototype._useAlphaInLowerHalf=function(){return!(!this.isAnimated||!this.alphaInLowerHalf)};WALK.StandardMaterial.prototype._useBaseColorTextureAsCutout=function(){var g=
this._baseColorTexture;return 1===this.opacity&&(g&&g.isCutout||this._useAlphaInLowerHalf()||this._useChromaKey())};WALK.StandardMaterial.prototype.configureTransparency=function(){var g=this._baseColorTexture;g=g&&(g.hasAlpha||this._useAlphaInLowerHalf()||this._useChromaKey());this.transparent=1>this.opacity||g;g=this._useBaseColorTextureAsCutout();this.transparent?(this.blending=THREE.NormalBlending,this.transparentRenderOrder=g?0:1):this.blending=THREE.NoBlending;this.depthWrite=!this.transparent||
g};Object.defineProperty(WALK.StandardMaterial.prototype,"alphaInLowerHalf",{get:function(){return this._alphaInLowerHalf},set:function(g){this._alphaInLowerHalf=g;this.configureTransparency();this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"chromaKeyEnabled",{get:function(){return!!this._chromaKeyEnabled},set:function(g){this._chromaKeyEnabled=!!g;this.configureTransparency();this.setUniforms();this._updated()}});WALK.StandardMaterial.prototype.setChromaKeyColorRGB=
function(g,k,h){this.chromaKeyColor.setRGB(g,k,h);this.setUniforms();this._updated()};WALK.StandardMaterial.prototype.getChromaKeyDeltaComponent=function(g){return this._chromaKeyDelta.getComponent(g)};WALK.StandardMaterial.prototype.setChromaKeyDeltaComponent=function(g,k){this._chromaKeyDelta.setComponent(g,k);this.setUniforms();this._updated()};Object.defineProperty(WALK.StandardMaterial.prototype,"isAnimated",{get:function(){var g=this.baseColorTexture;return g&&g.isAnimated}});Object.defineProperty(WALK.StandardMaterial.prototype,
"isPlaying",{get:function(){var g=this.baseColorTexture;return g&&g.isAnimated&&g.isPlaying}});WALK.StandardMaterial.prototype.play=function(){console.assert(this.isAnimated);var g=this.baseColorTexture.isPlaying;this.baseColorTexture.play();this.baseColorTexture.isPlaying!==g&&this._updated()};WALK.StandardMaterial.prototype.pause=function(){console.assert(this.isAnimated);var g=this.baseColorTexture.isPlaying;this.baseColorTexture.pause();this.baseColorTexture.isPlaying!==g&&this._updated()};WALK.StandardMaterial.prototype.sleepAnimation=
function(){console.assert(this.isAnimated);this.baseColorTexture.sleepAnimation()};WALK.StandardMaterial.prototype.wakeAnimation=function(){console.assert(this.isAnimated);this.baseColorTexture.wakeAnimation()};Object.defineProperty(WALK.StandardMaterial.prototype,"doubleSided",{get:function(){return this.side===THREE.DoubleSide},set:function(g){this.side=g?THREE.DoubleSide:THREE.FrontSide;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"envMapMirror",{get:function(){return 0===
this.roughness&&!this.roughnessTexture}});Object.defineProperty(WALK.StandardMaterial.prototype,"hdrOutput",{get:function(){return this._hdrOutput},set:function(g){g!==this._hdrOutput&&(this._hdrOutput=g,this.setUniforms())}});Object.defineProperty(WALK.StandardMaterial.prototype,"specularOff",{get:function(){return this._specularOff},set:function(g){g!==this._specularOff&&(this._specularOff=g,this.setUniforms())}});Object.defineProperty(WALK.StandardMaterial.prototype,"highlightMix",{get:function(){return this._highlightMix},
set:function(g){g!==this._highlightMix&&(this._highlightMix=g,this.uniforms.highlightMix.value=g)}});Object.defineProperty(WALK.StandardMaterial.prototype,"cameraExposure",{get:function(){return this._cameraExposure},set:function(g){this._cameraExposure=g;this.setUniform("exposure","f",Math.pow(2,g))}});Object.defineProperty(WALK.StandardMaterial.prototype,"cameraGamma",{get:function(){return this.uniforms.cameraGamma.value},set:function(g){this.setUniform("cameraGamma","f",g)}});Object.defineProperty(WALK.StandardMaterial.prototype,
"baseColorTexture",{get:function(){return this._baseColorTexture},set:function(g){var k=this;(this._baseColorTexture=g)?g.addLoadedListener(function(){k.configureTransparency();k.setUniforms();k._updated();k=g=null}):(k.setUniforms(),k._updated())}});Object.defineProperty(WALK.StandardMaterial.prototype,"baseColorTextureCorrection",{get:function(){return this._baseColorTextureCorrection},set:function(g){this._baseColorTextureCorrection=g;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,
"baseColorTextureContrast",{get:function(){return this._baseColorTextureContrast},set:function(g){this._baseColorTextureContrast=g;this.setUniforms();this._updated()}});WALK.StandardMaterial.prototype.setBaseColorTextureHslOffset=function(g,k,h){this.baseColorTextureHslOffset.h=g;this.baseColorTextureHslOffset.s=k;this.baseColorTextureHslOffset.l=h;this.setUniforms();this._updated()};Object.defineProperty(WALK.StandardMaterial.prototype,"emissive",{get:function(){return this._emissive},set:function(g){this._emissive=
g;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"emissionStrength",{get:function(){return this._emissionStrength},set:function(g){this._emissionStrength=g;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"roughness",{get:function(){return this._roughness},set:function(g){this._roughness=g;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"metallic",{get:function(){return this._metallic},
set:function(g){this._metallic=g;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"envMapProject",{get:function(){return this._envMapProject},set:function(g){this._envMapProject=g;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"bumpScale",{get:function(){return this._bumpScale},set:function(g){this._bumpScale=g;this.setUniforms();this._updated()}});WALK.StandardMaterial.prototype.setDoNotImport=function(g,k){this.doNotImport[g]=
k;this.setUniforms();this._updated()};WALK.StandardMaterial.prototype.isLightProbeDisabled=function(){return this.disableLightProbe||this.disableLightProbeTmp||this.specularOff||1===this.roughness&&!this._roughnessTexture||this.transparent&&this.doubleSided};WALK.StandardMaterial.prototype._setLightProbeUniforms=function(){this.setUniform("envMap","t",null);if(!this.condDefine(this._haveTextureLod,"HAVE_TEXTURE_LOD")){var g=WALK.LIGHT_PROBE_MIPS_COUNT-1;this._mipLevel0=Math.floor(this.roughness*g);
this._mipLevel1=Math.min(this._mipLevel0+1,g);this.setUniform("envMap2","t",null)}this.envMapMirror?this.setUniform("envMipsCount","f",1):this.setUniform("envMipsCount","f",0);this.condDefine(this.envMapProject,"USE_ENVMAP_PROJECT")&&(this.setUniform("envMapPosW","v3",e),this.setUniform("envBoxMin","v3",e),this.setUniform("envBoxMax","v3",e));this._lastUsedLightProbeId=null};WALK.StandardMaterial.prototype.getUvOffsetAndScale=function(g){return g.copy(this._uvOffsetScale||f)};WALK.StandardMaterial.prototype.setUvOffsetAndScale=
function(g,k,h,m){this.uvOffsetScale||(this._uvOffsetScale=new THREE.Vector4);console.assert(!this.baseColorTexture||!this.baseColorTexture.parentTexture,"Can't set uv offset and scale if baseColor texture is in atlas");g instanceof THREE.Vector4?this._uvOffsetScale.copy(g):this._uvOffsetScale.set(g,k,h,m)};WALK.StandardMaterial.prototype.ensureTexturesRepeatable=function(g){var k=this.baseColorTexture;k&&k.parentTexture&&(this._haveTextureLod&&WALK.DETECTOR.gl.standardDerivatives?(this.enableStandardDerivativesExtension(),
this.enableTextureLodExtension(),this.addDefine("USE_BASE_COLOR_TEXTURE_ATLAS_REPEAT")):this._baseColorTexture.extractedTexture||(this._baseColorTexture.extractedTexture=g.cropTextureToPoTTarget(k.parentTexture,k.uvOffsetScale),this.setUniforms()))};WALK.StandardMaterial.prototype.setUniforms=function(){this.setUniform("opacity","f",this.opacity);var g=!this.isLightProbeDisabled(),k=!1,h=this.roughnessTexture;this.condDefine(h&&h.loaded&&g,"USE_ROUGHNESS_TEXTURE")?(this.setUniform("roughnessTexture",
"t",h),k=!0):this.setUniform("roughness","f",this.roughness);h=this.metallicTexture;this.condDefine(h&&h.loaded&&g,"USE_METALLIC_TEXTURE")?(this.setUniform("metallicTexture","t",h),k=!0):this.setUniform("metallic","f",this.metallic);this.setUniform("emissionStrength","f",this.emissive?this.emissionStrength:0);this._baseColorTexture&&this.baseColorTextureCorrection?(d.set(this.baseColor),d.offsetHSL(this.baseColorTextureHslOffset.h,this.baseColorTextureHslOffset.s,this.baseColorTextureHslOffset.l),
h=Math.max(1+this.baseColorTextureContrast,0),this._baseColorCorrectionUniform.set(h*(d.r-this.baseColor.r-.5)+.5,h*(d.g-this.baseColor.g-.5)+.5,h*(d.b-this.baseColor.b-.5)+.5,h)):this._baseColorCorrectionUniform.set(0,0,0,1);this.setUniform("baseColorCorrection","v4",this._baseColorCorrectionUniform);h=null;if(this._baseColorTexture)if(this._baseColorTexture.parentTexture&&!this._baseColorTexture.extractedTexture){h=this._baseColorTexture.parentTexture;var m=this._baseColorTexture.uvOffsetScale}else h=
this._baseColorTexture.extractedTexture||this._baseColorTexture,m=f;this.condDefine(h&&h.loaded,"USE_BASE_COLOR_TEXTURE")?(this.setUniform("baseColorTexture","t",h),k=!0,this.setUniform("baseColorAtlasUvMod","v4",m),this._useBaseColorTextureAsCutout()?this.setUniform("alphaDiscardThreshold","f",.25):this.setUniform("alphaDiscardThreshold","f",0)):this.setUniform("baseColor","c",this.baseColor);this.condDefine(this._useAlphaInLowerHalf(),"USE_ALPHA_IN_LOWER_HALF");this.condDefine(this._useChromaKey(),
"USE_CHROMA_KEY")&&(this.setUniform("chromaKeyColor","c",this.chromaKeyColor),m=this._chromaKeyDelta,this._chromaKeyDeltaCoeff.x=1/(1.22*m.x),this._chromaKeyDeltaCoeff.y=1/(1.22*m.y),this._chromaKeyDeltaCoeff.z=1/(1.22*m.z),this.setUniform("chromaKeyDeltaCoeff","v3",this._chromaKeyDeltaCoeff));h=this.bumpTexture;this.condDefine(h&&h.loaded&&g,"USE_BUMP_TEXTURE")&&(this.enableStandardDerivativesExtension(),this.setUniform("bumpTexture","t",h),k=!0,this.setUniform("bumpScale","f",this.bumpScale),this.condDefine(this.parallaxCorrection,
"USE_PARALLAX_CORRECTION")&&(this.addDefine(WALK.ParallaxModes[this.parallaxMode]),this.setUniform("parallaxScale","f",this.parallaxScale),this.setUniform("parallaxMinLayers","f",this.parallaxMinLayers),this.setUniform("parallaxMaxLayers","f",this.parallaxMaxLayers)));k&&this.setUniform("uvMod","v4",this._uvOffsetScale||f);this.condDefine(this.lightMapped,"USE_LIGHTMAP")&&this.setUniform("lightMap","t",null);this.condDefine(g,"USE_ENVMAP")&&(this._haveTextureLod&&this.enableTextureLodExtension(),
this._setLightProbeUniforms());this.condDefine(this.highlight,"USE_HIGHLIGTH")&&(this.setUniform("highlight","c",this.highlight),this.setUniform("highlightMix","f",this.highlightMix));this.condDefine(this.hdrOutput,"HDR_OUTPUT");this.condDefine(!this.hdrOutput&&this.colorMap,"USE_COLORMAP")&&this.setUniform("colorMap","t",this.colorMap);this.condDefine((this.headLight||!this.lightMapped)&&!this.specularOff,"USE_HEADLIGHT")};WALK.StandardMaterial.prototype.forceObjectUniformsRefresh=function(){this._lastUsedLightProbeId=
null};WALK.StandardMaterial.prototype.textureNeedsUv0=function(g){return!0};WALK.StandardMaterial.prototype.hash=function(){return this.baseColorTexture?"standard"+this.baseColorTexture.name:"standard#"+this.baseColor.r+":"+this.baseColor.g+":"+this.baseColor.b};WALK.StandardMaterial.prototype.canMerge=function(g){if(this.type!==g.type||this.opacity!==g.opacity)return!1;if(this._baseColorTexture||g._baseColorTexture){if(this._baseColorTexture!==g._baseColorTexture||this.baseColorTextureCorrection!==
g.baseColorTextureCorrection||this.baseColorTextureContrast!==g.baseColorTextureContrast||this.baseColorTextureHslOffset.h!==g.baseColorTextureHslOffset.h||this.baseColorTextureHslOffset.s!==g.baseColorTextureHslOffset.s||this.baseColorTextureHslOffset.l!==g.baseColorTextureHslOffset.l||this._useAlphaInLowerHalf()!==g._useAlphaInLowerHalf()||(this._useChromaKey()?!(g._useChromaKey()&&this.chromaKeyColor.equals(g.chromaKeyColor)&&this._chromaKeyDelta.equals(g._chromaKeyDelta)):g._useChromaKey()))return!1}else if(!this.baseColor.equals(g.baseColor))return!1;
if(this.emissive||g.emissive)if(this.emissive!==g.emissive||this.emissionStrength!==g.emissionStrength)return!1;if(this.roughnessTexture||g.roughnessTexture){if(this.roughnessTexture!==g.roughnessTexture)return!1}else if(this.roughness!==g.roughness)return!1;if(this.metallicTexture||g.metallicTexture){if(this.metallicTexture!==g.metallicTexture)return!1}else if(this.metallic!==g.metallic)return!1;return(this.bumpTexture||g.bumpTexture)&&(this.bumpTexture!==g.bumpTexture||this.bumpScale!==g.bumpScale)||
this.envMapProject!==g.envMapProject||this.doubleSided!==g.doubleSided||this.parallaxCorrection||g.parallaxCorrection?!1:!0};WALK.StandardMaterial.prototype.refreshPerObjectUniforms=function(g,k){var h=!1;if(!this.isLightProbeDisabled()){var m=g.lightProbe;if(this._lastUsedLightProbeId!==m.id){h=!0;this._lastUsedLightProbeId=m.id;var l=this.envMapMirror?m.getMirrorTexture():this._haveTextureLod?m.getFilteredTexture():m.getFilteredTextureNoLod(this._mipLevel0);k.envMap.value=l;this._haveTextureLod||
(k.envMap2.value=m.getFilteredTextureNoLod(this._mipLevel1));this.envMapMirror||(k.envMipsCount.value=WALK.LIGHT_PROBE_MIPS_COUNT);this.envMapProject&&(m.isBoundingBoxEnabled()?(k.envMapPosW.value=m.position,k.envBoxMin.value=m.boxMin,k.envBoxMax.value=m.boxMax):(k.envBoxMin.value=e,k.envBoxMax.value=e))}}g=g.lightMap;this.lightMapped&&k.lightMap.value!==g&&(h=!0,k.lightMap.value=g);return h};WALK.StandardMaterial.prototype.setBaseColorRGB=function(g,k,h){this.baseColor.setRGB(g,k,h);this.setUniforms();
this._updated()};WALK.StandardMaterial.prototype.setTexture=function(g,k){if(k){var h=this.baseColorTexture;h&&(k.wrapS=h.wrapS,k.wrapT=h.wrapT,k.anisotropy=h.anisotropy)}this[g]=k||null;"baseColorTexture"===g?(this._baseColorTextureCorrection=!1,this._baseColorTextureContrast=0,this.baseColorTextureHslOffset.h=0,this.baseColorTextureHslOffset.s=0,this.baseColorTextureHslOffset.l=0):"bumpTexture"===g&&(this._bumpScale=.001)};WALK.StandardMaterial.prototype.serialize=function(){var g=this,k=null;console.assert(!this.merged);
this.baseColorTextureCorrection&&(k={contrast:this.baseColorTextureContrast,hslOffset:[this.baseColorTextureHslOffset.h,this.baseColorTextureHslOffset.s,this.baseColorTextureHslOffset.l]});var h={name:this.name,type:this.type,baseColor:this.baseColor.roundChannels().toArray(),baseColorTextureCorrection:k,alphaInLowerHalf:this.alphaInLowerHalf,opacity:this.opacity,emissive:this.emissive,emissionStrength:this.emissionStrength,roughness:this.roughness,metallic:this.metallic,envMapProject:this.envMapProject,
bumpScale:this.bumpScale,doubleSided:this.doubleSided,doNotImport:this.doNotImport};void 0!==this._chromaKeyEnabled&&(h.chromaKeyEnabled=this.chromaKeyEnabled,h.chromaKeyColor=this.chromaKeyColor.roundChannels().toArray(),h.chromaKeyDelta=this._chromaKeyDelta.toArray());k=function(m){var l=g[m];h[m]=l?l.serialize():null};k("baseColorTexture");k("roughnessTexture");k("metallicTexture");k("bumpTexture");return h}})();(function(){WALK.StandardMaterialWater=function(){WALK.StandardMaterial.call(this);this.type="water";this._isPlaying=!0;this._isSleeping=!1;this.setUniform("time","f",0);this._roughness=0;this.baseColor=new THREE.Color(0);this._wavesScale=this._wavesSpeed=1;this._refractionFactor=0;this.opacity=.2;this.doNotImport={baseColor:!0,baseColorTexture:!0,opacity:!0}};WALK.StandardMaterialWater.prototype=Object.create(WALK.StandardMaterial.prototype);WALK.StandardMaterialWater.prototype.constructor=WALK.StandardMaterialWater;
WALK.StandardMaterialWater.prototype.addTextureProperty("normalTexture");WALK.StandardMaterialWater.prototype.textureNeedsUv0=function(a){return!1};WALK.StandardMaterialWater.prototype.hash=function(a){return"water"};WALK.StandardMaterialWater.prototype.canMerge=function(a){return this.type===a.type&&this.opacity===a.opacity&&this.baseColor.equals(a.baseColor)&&this.normalTexture===a.normalTexture&&this.wavesSpeed===a.wavesSpeed&&this.wavesScale===a.wavesScale&&this.refractionFactor===a.refractionFactor};
WALK.StandardMaterialWater.prototype.setUniforms=function(){WALK.StandardMaterial.prototype.setUniforms.call(this);var a=this.normalTexture;this.condDefine(a&&a.loaded&&!this.isLightProbeDisabled(),"USE_NORMAL_TEXTURE")&&(this.setUniform("normalTexture","t",a),this.setUniform("wavesScale","f",this.wavesScale),1!==this.opacity?this.setUniform("refractionFactor","f",this.refractionFactor):this.setUniform("refractionFactor","f",0))};WALK.StandardMaterialWater.prototype.fragmentShaderHooks=function(){return WALK.getShader("water.glsl")};
Object.defineProperty(WALK.StandardMaterialWater.prototype,"refractionFactor",{get:function(){return this._refractionFactor},set:function(a){this._refractionFactor=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"wavesSpeed",{get:function(){return this._wavesSpeed},set:function(a){this._wavesSpeed=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"wavesScale",{get:function(){return this._wavesScale},
set:function(a){this._wavesScale=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"hideFromLightProbes",{get:function(){return 1!==this.opacity&&0!==this.refractionFactor}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"isAnimated",{get:function(){return!0}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"isPlaying",{get:function(){return!this._isSleeping&&this._isPlaying&&0<this.wavesSpeed}});WALK.StandardMaterialWater.prototype.play=
function(){this._isPlaying=!0};WALK.StandardMaterialWater.prototype.pause=function(){this._isPlaying=!1};WALK.StandardMaterialWater.prototype.sleepAnimation=function(){this._isSleeping=!0};WALK.StandardMaterialWater.prototype.wakeAnimation=function(){this._isSleeping=!1};WALK.StandardMaterialWater.prototype.update=function(a){this.uniforms.time.value+=a*this.wavesSpeed*.1};WALK.StandardMaterialWater.prototype.serialize=function(){return{name:this.name,type:this.type,baseColor:this.baseColor.roundChannels().toArray(),
baseColorTexture:null,opacity:this.opacity,normalTexture:this.normalTexture?this.normalTexture.serialize():null,wavesSpeed:this.wavesSpeed,wavesScale:this.wavesScale,refractionFactor:this.refractionFactor,doNotImport:this.doNotImport}}})();(function(){var a=WALK.getShader("standard_material_vertex.glsl"),b=WALK.getShader("luma_fragment.glsl"),c=new THREE.Color(16777215);WALK.LumaMaterial=function(d){WALK.BaseMaterial.call(this,a,b);this.computeIncidentLuma=d;this.setUniform("lightMap","t",null);this.color=new THREE.Color(c);this.setUniform("color","c",this.color);this.addDefine("USE_LIGHTMAP")};WALK.LumaMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.LumaMaterial.prototype.constructor=WALK.LumaMaterial;WALK.LumaMaterial.prototype.refreshPerObjectUniforms=
function(d,e){var f=d.lightMap,g=!1;e.lightMap.value!==f&&(e.lightMap.value=f,g=!0);d=this.computeIncidentLuma?c:d.material.baseColor;d.equals(this.color)||(this.color.copy(d),g=!0);return g}})();(function(){WALK.DebugMaterial=function(){WALK.StandardMaterial.call(this);this.noSharedBuffers=new THREE.Color(16777215);this.sharedBuffersMaster=new THREE.Color(255);this.sharedBuffersCopy=new THREE.Color(65280);this.headLight=!0;this.setUniforms();this.defaultAttributeValues=Object.assign({},this.defaultAttributeValues);this.defaultAttributeValues.sphericalNormal=[0,0]};WALK.DebugMaterial.prototype=Object.create(WALK.StandardMaterial.prototype);WALK.DebugMaterial.prototype.refreshPerObjectUniforms=
function(a,b){b.baseColor.value=0===a.sharedBuffersDebug?this.noSharedBuffers:1===a.sharedBuffersDebug?this.sharedBuffersMaster:this.sharedBuffersCopy;return!0}})();(function(){var a=WALK.getShader("equirect_sky_vertex.glsl"),b=WALK.getShader("equirect_sky_fragment.glsl");WALK.EquirectSkyMaterial=function(){WALK.BaseMaterial.call(this,a,b);this.depthWrite=!1;this.side=THREE.FrontSide;this.uniforms={map:{type:"t",value:null},colorMap:{type:"t",value:null},exposure:{type:"f",value:1},cameraGamma:{type:"f",value:1}}};WALK.EquirectSkyMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.EquirectSkyMaterial.prototype.constructor=WALK.EquirectSkyMaterial;
Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"map",{get:function(){return this.uniforms.map.value},set:function(c){this.uniforms.map.value=c;this.condDefine(this.map.isRgbm,"USE_RGBM_MAP")}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"hdrOutput",{get:function(){return this.hasDefine("HDR_OUTPUT")},set:function(c){this.condDefine(c,"HDR_OUTPUT")}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"colorMap",{get:function(){return this.uniforms.colorMap.value},set:function(c){this.uniforms.colorMap.value=
c;this.condDefine(c,"USE_COLORMAP")}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"cameraExposure",{get:function(){return Math.log2(this.uniforms.exposure.value)},set:function(c){this.uniforms.exposure.value=Math.pow(2,c)}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"cameraGamma",{get:function(){return this.uniforms.cameraGamma.value},set:function(c){this.uniforms.cameraGamma.value=c}})})();(function(){WALK.ProceduralSkyMaterial=function(){WALK.BaseMaterial.call(this,WALK.getShader("procedural_sky_vertex.glsl"),WALK.getShader("procedural_sky_fragment.glsl"));this.depthWrite=!1;this.side=THREE.BackSide;this.uniforms={topColor:{type:"c",value:new THREE.Color(15135487)},bottomColor:{type:"c",value:new THREE.Color(16777215)},sinBottomAngle:{type:"f",value:Math.sin(THREE.Math.degToRad(-30))},exponent:{type:"f",value:.9},colorMap:{type:"t",value:null}}};WALK.ProceduralSkyMaterial.prototype=
Object.create(WALK.BaseMaterial.prototype);WALK.ProceduralSkyMaterial.prototype.constructor=WALK.ProceduralSkyMaterial;Object.defineProperty(WALK.ProceduralSkyMaterial.prototype,"hdrOutput",{get:function(){return this.hasDefine("HDR_OUTPUT")},set:function(a){this.condDefine(a,"HDR_OUTPUT")}});Object.defineProperty(WALK.ProceduralSkyMaterial.prototype,"colorMap",{get:function(){return this.uniforms.colorMap.value},set:function(a){this.uniforms.colorMap.value=a;this.condDefine(a,"USE_COLORMAP")}})})();(function(){var a=WALK.getShader("object_distance_vertex.glsl"),b=WALK.getShader("object_id_fragment.glsl"),c=WALK.getShader("object_id_distance_fragment.glsl");WALK.ObjectDistanceMaterial=function(d){WALK.BaseMaterial.call(this,a,d?b:c);this.doNotOverrideSide=!0;this.uniforms={objectId:{type:"i",value:null}}};WALK.ObjectDistanceMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.ObjectDistanceMaterial.prototype.constructor=WALK.ObjectDistanceMaterial;WALK.ObjectDistanceMaterial.prototype.refreshPerObjectUniforms=
function(d,e){e.objectId.value=d.visibilityId;return!0}})();(function(){var a=WALK.getShader("wireframe_vertex.glsl"),b=WALK.getShader("wireframe_fragment.glsl");WALK.WireframeMaterial=function(c){WALK.BaseMaterial.call(this,a,b);this.lineColor=c;this.setUniform("lineColor","c",c);this.setUniform("lineMaxAlpha","f",.65);this.setUniform("highlight","c",WALK.EDITOR_SELECTION_COLOR);this.setUniform("highlightMix","f",0);this.customLightmapResolutionLineColor=new THREE.Color(170);this.autoLightmapResolutionLineColor=new THREE.Color(43690);this.meshSelectedLineColor=
new THREE.Color(47872);this.meshSelectedSecondaryLineColor=new THREE.Color(13404160);this.transparent=!0;this.blending=THREE.NormalBlending;this.depthWrite=this.depthTest=!1;this.attributes=this.attributes.concat(["order"]);this.enableStandardDerivativesExtension()};WALK.WireframeMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.WireframeMaterial.prototype.constructor=WALK.WireframeMaterial;WALK.WireframeMaterial.prototype.propertyFromUniform("lineMaxAlpha");WALK.WireframeMaterial.prototype.propertyFromUniform("highlight");
WALK.WireframeMaterial.prototype.propertyFromUniform("highlightMix");WALK.WireframeMaterial.prototype.refreshPerObjectUniforms=function(c,d){var e=!1;null!==c.highlightMix&&void 0!==c.highlightMix&&c.highlightMix!==d.highlightMix.value&&(d.highlightMix.value=c.highlightMix,e=!0);return null!==c.selected&&void 0!==c.selected&&(c=!0===c.selected?this.meshSelectedLineColor:!0===c.selectedSecondary?this.meshSelectedSecondaryLineColor:null!==c.node.lightmapResolution?this.customLightmapResolutionLineColor:
0<=c.autoLightmapResolution?this.autoLightmapResolutionLineColor:this.lineColor,d.lineColor.value!==c)?(d.lineColor.value=c,!0):e}})();(function(){var a=new WALK.InlineShader("attr vec3 envLookup;\nvarOut vec3 vEnvLookup;\nvoid main() {\nvEnvLookup = envLookup;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"),b=new WALK.InlineShader("uniform samplerCube envMap;\nvarIn vec3 vEnvLookup;\nvoid main() {\nint objectId = int(textureCube(envMap, vEnvLookup).x);\nint x = objectId / (256 * 256);\nint y = (objectId - 256 * 256 * x) / 256;\nint z = (objectId - 256 * 256 * x - 256 * y);\nfragColor = vec4(float(x) / 255.0, float(y) / 255.0,\nfloat(z) / 255.0, 1.0);\n}");
WALK.ObjectDistanceReader=function(c,d){var e=[],f=[],g=3*d,k=2*d;this.readCubeMapToBuffer=function(r){p.uniforms.envMap.value=r;n.set(!0,!1,!1);c.render(m,h,l);c.readPixels(g,k,q);n.restore();return q};this.dispose=function(){for(var r=0;6>r;r+=1)e[r].geometry.dispose();p.dispose();l.dispose();q=null};var h=new THREE.OrthographicCamera(-1,1,1,-1,0,1);var m=new THREE.Scene;var l=c.createRenderTarget(g,k,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1});
var q=new Uint8Array(4*g*k);var n=new WALK.AutoClearAlter(c);var p=new WALK.BaseMaterial(a,b);p.uniforms={envMap:{type:"t",value:null}};p.attributes={envLookup:{type:"v3",value:null}};(function(){for(var r=[[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1]],[[-1,1,-1],[-1,1,1],[-1,-1,-1],[-1,-1,1]],[[-1,1,-1],[1,1,-1],[-1,1,1],[1,1,1]],[[-1,-1,1],[1,-1,1],[-1,-1,-1],[1,-1,-1]],[[-1,1,1],[1,1,1],[-1,-1,1],[1,-1,1]],[[1,1,-1],[-1,1,-1],[1,-1,-1],[-1,-1,-1]]],x=0;6>x;x+=1){var w=new THREE.PlaneBufferGeometry(d,d),
u=new Float32Array(12);w.addAttribute("envLookup",new THREE.BufferAttribute(u,3));for(var A=0;4>A;A+=1){var B=A,I=r[x][A];u[3*B]=I[0];u[3*B+1]=I[1];u[3*B+2]=I[2]}e[x]=new THREE.Mesh(w,p);m.add(e[x])}f[0]=[0,0];f[1]=[d,0];f[2]=[2*d,0];f[3]=[0,d];f[4]=[d,d];f[5]=[2*d,d]})();(function(r,x){r/=2;var w=x/2;h.left=-r;h.right=r;h.top=w;h.bottom=-w;h.updateProjectionMatrix();x=-r+d/2;r=w-d/2;for(w=0;w<e.length;w+=1)e[w].position.set(x+f[w][0],r-f[w][1],0)})(g,k)}})();(function(){WALK.ObjectVisibilityQuery=function(a,b,c){var d=new WALK.ObjectDistanceMaterial(!0),e=new WALK.CubeCamera(WALK.CAMERA_WALK_NEAR,c),f=WALK.OBJECT_VISIBILITY_TARGET_SIZE,g=a.createRenderTarget(f,f,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,depthBuffer:!0,stencilBuffer:!1,generateMipmaps:!1}),k=new Uint8Array(4*f*f),h=new WALK.AutoClearAlter(a),m=new WALK.ClearColorAlter(a),l=new THREE.Color(16777215);this.findVisibleObjects=function(q){var n=new Set,p=[];e.position.copy(q);
e.updateMatrixWorld();for(q=0;q<b.length;q+=1){var r=b[q];console.assert(!r.visibilityId);r.visibilityId=q;p.push(r)}h.set(!0,!0,!1);m.set(l);for(q=0;6>q;q+=1){a.renderMeshes(p,d,e.sideCameras[q],g);a.readPixels(f,f,k);r=k;for(var x=r.length,w=0;w<x;w+=4){var u=Math.round(65536*r[w]+256*r[w+1]+r[w+2]);16777215!==u&&n.add(u)}}m.restore();h.restore();p=[];n=$jscomp.makeIterator(n);for(q=n.next();!q.done;q=n.next())p.push(b[q.value]);for(n=0;n<b.length;n+=1)b[n].visibilityId=null;return p};this.dispose=
function(){d.dispose();g.dispose();k=g=null}};WALK.ObjectVisibilityQuery.prototype.constructor=WALK.ObjectDistanceQuery})();(function(){var a=WALK.getShader("aabb_query_vertex.glsl"),b=WALK.getShader("aabb_query_fragment.glsl");WALK.AabbQueryMaterial=function(){WALK.BaseMaterial.call(this,a,b);this.side=THREE.DoubleSide;this.uniforms={axis:{type:"i",value:0}}};WALK.AabbQueryMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.AabbQueryMaterial.prototype.constructor=WALK.AabbQueryMaterial;Object.defineProperty(WALK.AabbQueryMaterial.prototype,"axis",{get:function(){return this.uniforms.axis.value},set:function(c){console.assert(0===
c||1===c||2===c);this.uniforms.axis.value=c}})})();(function(){var a=WALK.getShader("gaze_pointer_vertex.glsl"),b=WALK.getShader("gaze_pointer_fragment.glsl");WALK.GazePointerMaterial=function(){WALK.BaseMaterial.call(this,a,b);this.blending=THREE.NormalBlending;this.transparent=!0;this.transparentRenderOrder=2;this.setUniform("circleSpan","f",0)};WALK.GazePointerMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.GazePointerMaterial.prototype.constructor=WALK.GazePointerMaterial;Object.defineProperty(WALK.GazePointerMaterial.prototype,
"circleSpan",{set:function(c){console.assert(1>=c);this.uniforms.circleSpan.value=2*Math.PI*c-Math.PI}})})();(function(){var a=WALK.getShader("editor_light_vertex.glsl"),b=WALK.getShader("editor_light_fragment.glsl");WALK.LightMaterial=function(c){WALK.BaseMaterial.call(this,a,b);this.setUniform("color","c",c.color);this.setUniform("highlight","c",WALK.EDITOR_SELECTION_COLOR);this.setUniform("highlightMix","f",0)};WALK.LightMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.LightMaterial.prototype.propertyFromUniform("highlightMix")})();(function(){WALK.MirrorMaterial=function(a,b){WALK.BaseMaterial.call(this,WALK.getShader("mirror_vertex.glsl"),WALK.getShader("mirror_fragment.glsl"));this.hideFromLightProbes=!0;this.uniforms={mirrorColor:{type:"c",value:a},mirrorSampler:{type:"t",value:null},textureMatrix:{type:"m4",value:b}}};WALK.MirrorMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.MirrorMaterial.prototype.constructor=WALK.MirrorMaterial;Object.defineProperty(WALK.MirrorMaterial.prototype,"hdrOutput",{get:function(){return this.hasDefine("HDR_OUTPUT")},
set:function(a){this.condDefine(a,"HDR_OUTPUT")}});Object.defineProperty(WALK.MirrorMaterial.prototype,"mirrorSampler",{get:function(){return this.uniforms.mirrorSampler.value},set:function(a){this.uniforms.mirrorSampler.value=a}})})();(function(){var a=WALK.getShader("cap_vertex.glsl"),b=WALK.getShader("cap_fragment.glsl");WALK.CapMaterial=function(c){WALK.BaseMaterial.call(this,a,b);this.side=THREE.DoubleSide;this.uniforms={color:{type:"c",value:c}}};WALK.CapMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.CapMaterial.prototype.constructor=WALK.CapMaterial})();(function(){var a=WALK.getShader("outline_vertex.glsl"),b=WALK.getShader("outline_fragment.glsl");WALK.OutlineMaterial=function(c,d){WALK.BaseMaterial.call(this,a,b);this.side=THREE.DoubleSide;this.uniforms={color:{type:"c",value:c},thickness:{type:"f",value:d}}};WALK.OutlineMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.OutlineMaterial.prototype.constructor=WALK.OutlineMaterial})();(function(){WALK.createBoundingBoxMaterial=function(){var a=new WALK.WireframeMaterial(WALK.EDITOR_SELECTION_COLOR);a.depthTest=!0;a.depthWrite=!1;a.side=THREE.DoubleSide;a.hideFromLightProbes=!0;return a}})();(function(){var a=WALK.getShader("anchor_vertex.glsl");WALK.AnchorMaterial=function(){WALK.StandardMaterial.call(this);this._vertexShaderBody=a;this._metallic=.1;this._roughness=.5;this._bumpScale=.01;this.hideFromLightProbes=!0};WALK.AnchorMaterial.prototype=Object.create(WALK.StandardMaterial.prototype);var b=WALK.getShader("anchor_sprite_vertex.glsl");WALK.AnchorSpriteMaterial=function(){WALK.StandardMaterial.call(this);this._vertexShaderBody=b;this.hideFromLightProbes=!0};WALK.AnchorSpriteMaterial.prototype=
Object.create(WALK.StandardMaterial.prototype)})();(function(){var a=WALK.getShader("rotate_gizmo_material_vertex.glsl"),b=WALK.getShader("rotate_gizmo_material_fragment.glsl");WALK.RotateGizmoMaterial=function(c,d){WALK.BaseMaterial.call(this,a,b);this.blending=THREE.NormalBlending;this.depthWrite=this.depthTest=!1;this.transparent=!0;this.transparentRenderOrder=1E3;this.hideFromLightProbes=!0;this.uniforms={opacity:{type:"f",value:1},color:{type:"c",value:c},gizmoPosition:{type:"v3",value:new THREE.Vector3(0,0,0)},sphereRadius:{type:"f",value:1}};
Object.defineProperty(this,"color",{get:function(){return this.uniforms.color.value}});Object.defineProperty(this,"opacity",{get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}});Object.defineProperty(this,"gizmoPosition",{get:function(){return this.uniforms.gizmoPosition.value}});Object.defineProperty(this,"sphereRadius",{get:function(){return this.uniforms.sphereRadius.value},set:function(e){this.uniforms.sphereRadius.value=e}});this.opacity=d;this.setUniforms=
function(){}};WALK.RotateGizmoMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.RotateGizmoMaterial.prototype.constructor=WALK.RotatoGizmoMaterial})();(function(){WALK.Camera=function(){var a=this;THREE.PerspectiveCamera.call(this,WALK.CAMERA_DEFAULT_FOV,1,WALK.CAMERA_WALK_NEAR,WALK.CAMERA_MIN_FAR);this._defaultFov=this.fov;this._exposure=this._defaultExposure=0;this._gamma=this._defaultGamma=1;this._autoExposure=!1;this._autoExposureDarkness=.3;this._moveMaxSpeed=WALK.CAMERA_DEFAULT_MOVE_MAX_SPEED;this._autoClimb=!1;this._colorMap=null;this._exposureUpdatedEvent={type:"exposureUpdated",target:null};this._gammaUpdatedEvent={type:"gammaUpdated",
target:null};this._colorMapUpdated={type:"colorMapUpdated",target:null};var b={type:"updated",target:this};this._updated=function(){return a.dispatchEvent(b)}};WALK.Camera.prototype=Object.create(THREE.PerspectiveCamera.prototype);WALK.Camera.prototype.constructor=WALK.Camera;Object.defineProperty(WALK.Camera.prototype,"defaultFov",{get:function(){return this._defaultFov},set:function(a){this.fov=this._defaultFov=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"colorMap",{get:function(){return this._colorMap},
set:function(a){var b=this;this._colorMap&&this._colorMap.dispose();(this._colorMap=a)?a.addLoadedListener(function(){return b.dispatchEvent(b._colorMapUpdated)}):this.dispatchEvent(this._colorMapUpdated)}});WALK.Camera.prototype.colorMapReady=function(){return this._colorMap&&this._colorMap.loaded};Object.defineProperty(WALK.Camera.prototype,"defaultExposure",{get:function(){return this._defaultExposure},set:function(a){this._defaultExposure=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,
"exposure",{get:function(){return this._exposure},set:function(a){a!==this._exposure&&(this._exposure=a,this.dispatchEvent(this._exposureUpdatedEvent))}});WALK.Camera.prototype.setExposureController=function(a){this.exposureController=a};WALK.Camera.prototype.setExposure=function(a){this.exposureController?this.exposureController.setTargetExposure(a):this.exposure=a};Object.defineProperty(WALK.Camera.prototype,"defaultGamma",{get:function(){return this._defaultGamma},set:function(a){this._defaultGamma=
a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"gamma",{get:function(){return this._gamma},set:function(a){a!==this._gamma&&(this._gamma=a,this.dispatchEvent(this._gammaUpdatedEvent))}});WALK.Camera.prototype.setGamma=function(a){this.gamma=a};Object.defineProperty(WALK.Camera.prototype,"autoExposure",{get:function(){return this._autoExposure},set:function(a){a!==this._autoExposure&&(this._autoExposure=a,this._exposure=this._defaultExposure,this._updated())}});WALK.Camera.prototype.setFar=
function(a){this.far=a;this.updateProjectionMatrix();this._updated()};Object.defineProperty(WALK.Camera.prototype,"moveMaxSpeed",{get:function(){return this._moveMaxSpeed},set:function(a){this._moveMaxSpeed=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"autoClimb",{get:function(){return this._autoClimb},set:function(a){this._autoClimb=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"autoExposureDarkness",{get:function(){return this._autoExposureDarkness},set:function(a){this._autoExposureDarkness=
a;this._updated()}});WALK.Camera.prototype.serialize=function(){return{fov:this.defaultFov,exposure:this.defaultExposure,gamma:this.defaultGamma,lutTexture:this.colorMap?this.colorMap.serialize():null,autoClimb:this.autoClimb,moveMaxSpeed:this.moveMaxSpeed}};THREE.EventDispatcher.prototype.apply(WALK.Camera.prototype)})();(function(){WALK.LightInstance=function(b,c,d){this.light=b;this.position=c;this.rotation=d;this._directionW=new THREE.Vector3};WALK.LightInstance.prototype={constructor:WALK.LightInstance,directionW:function(){this._directionW.set(0,1,0);this._directionW.applyEuler(this.rotation);return this._directionW},get index(){var b=this.light.instances.indexOf(this);console.assert(-1!==b,"Light instance not found");return b},setPosition:function(b,c,d){this.position.set(b,c,d);this.light._updated()},setRotation:function(b,
c,d){this.rotation.yaw=WALK.normalizeRotation(b);this.rotation.pitch=WALK.normalizeRotation(c);this.rotation.roll=WALK.normalizeRotation(d);this.light._updated()},setRotationDeg:function(b,c,d){b=THREE.Math.degToRad(b);c=THREE.Math.degToRad(c);d=void 0===d?this.rotation.roll:THREE.Math.degToRad(d);this.setRotation(b,c,d)},serialize:function(){return{position:this.position.toArray(),rotation:this.rotation.toDegTriple()}}};var a="angle color height photometricProfile strength size type width".split(" ");
WALK.Light=function(b){this._name=b.name;this._type=b.type||"spot";if(void 0!==b.strength)var c=b.strength;else a:{switch(this._type){case "point":case "spot":case "area":c=25;break a;case "sun":c=8;break a;default:console.assert(!1)}c=void 0}this._strength=c;if(void 0!==b.color)c=(new THREE.Color).fromArray(b.color);else a:{switch(this._type){case "point":case "spot":case "area":c=new THREE.Color(1,.88,.799);break a;case "sun":c=new THREE.Color(1,.8,.638);break a;default:console.assert(!1)}c=void 0}this._color=
c;if(void 0!==b.size)c=b.size;else a:{switch(this._type){case "point":case "spot":case "area":c=.1;break a;case "sun":c=.02;break a;default:console.assert(!1)}c=void 0}this._size=c;this._width=void 0!==b.width?b.width:.2;this._height=void 0!==b.height?b.height:.2;this._angle=void 0!==b.angle?b.angle:140;this._photometricProfile=void 0!==b.photometricProfile?b.photometricProfile:null;!0===b.doNotImport?this.doNotImport=!0:(this.doNotImport={},b.doNotImport&&WALK.copyProperties(b.doNotImport,a,this.doNotImport));
this.instances=[]};WALK.Light.prototype={constructor:WALK.Light,forEachLightInstance:function(b){for(var c=0;c<this.instances.length;c+=1)b(this.instances[c])},get name(){return this._name},set name(b){this._name=b;this._updated()},get type(){return this._type},set type(b){this._type=b;this._updated()},get size(){return this._size},set size(b){this._size=b;this._updated()},get width(){return this._width},set width(b){this._width=b;this._updated()},get height(){return this._height},set height(b){this._height=
b;this._updated()},get angle(){return this._angle},set angle(b){this._angle=b;this._updated()},get color(){return this._color},setColorRGB:function(b,c,d){this._color.setRGB(b,c,d);this._updated()},get strength(){return this._strength},set strength(b){this._strength=b;this._updated()},get photometricProfile(){return this._photometricProfile},set photometricProfile(b){this._photometricProfile=b;this._updated()},setDoNotImport:function(b,c){this.doNotImport[b]=c;this._updated()},addInstance:function(b,
c){c=void 0===c?[0,-90,0]:c;b=(new THREE.Vector3).fromArray(b);c=(new WALK.Euler).setFromDegTriple(c);c=new WALK.LightInstance(this,b,c);this.instances.push(c);this.dispatchEvent({type:"instanceAdded",instance:c,target:this})},removeInstance:function(b){WALK.removeFromArray(b,this.instances);this.dispatchEvent({type:"instanceRemoved",instance:b,target:this})},serialize:function(){return{name:this.name,type:this.type,angle:this.angle,strength:this.strength,photometricProfile:this.photometricProfile,
size:this.size,width:this.width,height:this.height,color:this.color.roundChannels().toArray(),doNotImport:this.doNotImport,instances:this.instances.map(function(b){return b.serialize()})}},_updated:function(){this.dispatchEvent({type:"updated",target:this})}};THREE.EventDispatcher.prototype.apply(WALK.Light.prototype);WALK.Light.iterateLightInstances=function(b,c){for(var d=1,e=0;e<b.length;e+=1)for(var f=b[e],g=0;g<f.instances.length;g+=1,d+=1)c(f,f.instances[g],d)}})();(function(){WALK.LightProbe=function(a){this.id=a.id;this.position=new THREE.Vector3;a.position&&this.position.fromArray(a.position);this._filteredCubeTexture=null;this._filteredCubeTextureNoLod={};this._mirrorCubeTexture=null;this._boxEnabled=a.box?!("enabled"in a.box)||a.box.enabled:!1;this.boxMin=new THREE.Vector3;this.boxMax=new THREE.Vector3;a.box&&(this.boxMin.fromArray(a.box.min),this._setClampedBoxMax(a.box.max[0],a.box.max[1],a.box.max[2]))};WALK.LightProbe.prototype={constructor:WALK.LightProbe,
setFilteredTexture:function(a){this._filteredCubeTexture&&this._filteredCubeTexture.dispose();this._filteredCubeTexture=a},setFilteredTextureNoLod:function(a,b){this._filteredCubeTextureNoLod[b]&&this._filteredCubeTextureNoLod[b].dispose();this._filteredCubeTextureNoLod[b]=a},isBoundingBoxInitialized:function(){return!this.boxMin.equals(this.boxMax)},resetBoundingBox:function(){this.boxMin.set(0,0,0);this.boxMax.set(0,0,0)},isBoundingBoxEnabled:function(){return this._boxEnabled},disableBoundingBox:function(){this._boxEnabled=
!1;this.dispatchEvent({type:"boundsUpdated",target:this})},enableBoundingBox:function(){this._boxEnabled=!0;this.isBoundingBoxInitialized()||this.dispatchEvent({type:"boundsInit",target:this});this.dispatchEvent({type:"boundsUpdated",target:this})},getFilteredTexture:function(){return this._filteredCubeTexture},getFilteredTextureNoLod:function(a){return this._filteredCubeTextureNoLod[a]},setMirrorTexture:function(a){this._mirrorCubeTexture&&this._mirrorCubeTexture.dispose();this._mirrorCubeTexture=
a},setPosition:function(a,b,c){this.position.set(a,b,c);this.dispatchEvent({type:"positionUpdated",target:this})},texturesReady:function(){return this._mirrorCubeTexture||this._filteredCubeTexture||this._filteredCubeTextureNoLod[0]},getMirrorTexture:function(){return this._mirrorCubeTexture||this._filteredCubeTexture||this._filteredCubeTextureNoLod[0]},_setClampedBoxMin:function(a,b,c){a>this.boxMax.x-.1&&(a=this.boxMax.x-.1);b>this.boxMax.y-.1&&(b=this.boxMax.y-.1);c>this.boxMax.z-.1&&(c=this.boxMax.z-
.1);this.boxMin.set(a,b,c)},setBoxMin:function(a,b,c){this._setClampedBoxMin(a,b,c);this.dispatchEvent({type:"boundsUpdated",target:this})},_setClampedBoxMax:function(a,b,c){a<this.boxMin.x+.1&&(a=this.boxMin.x+.1);b<this.boxMin.y+.1&&(b=this.boxMin.y+.1);c<this.boxMin.z+.1&&(c=this.boxMin.z+.1);this.boxMax.set(a,b,c)},setBoxMax:function(a,b,c){this._setClampedBoxMax(a,b,c);this.dispatchEvent({type:"boundsUpdated",target:this})},serialize:function(){var a={id:this.id,position:this.position.toArray()};
this.isBoundingBoxInitialized()&&(a.box={enabled:this._boxEnabled,min:this.boxMin.toArray(),max:this.boxMax.toArray()});return a},dispose:function(){this._filteredCubeTexture&&(this._filteredCubeTexture.dispose(),this._filteredCubeTexture=null);for(var a in this._filteredCubeTextureNoLod)this._filteredCubeTextureNoLod.hasOwnProperty(a)&&this._filteredCubeTextureNoLod[a].dispose();this._filteredCubeTextureNoLod={};this._mirrorCubeTexture&&(this._mirrorCubeTexture.dispose(),this._mirrorCubeTexture=
null)}};THREE.EventDispatcher.prototype.apply(WALK.LightProbe.prototype)})();(function(){function a(e){return null!==e&&void 0!==e}function b(e){e.configure()}function c(e){e.visitSubtree(b)}function d(e){function f(){h=new THREE.Vector3;var q=new THREE.Box3;e.visitSubtree(function(n){(n=n.mesh)&&q.union(n.geometry.boundingBox)});q.center(h);k.elements[12]=-h.x;k.elements[13]=-h.y;k.elements[14]=-h.z}var g=new THREE.Matrix4,k=new THREE.Matrix4,h,m=new THREE.Vector3,l=new WALK.Euler;return function(q,n){h||f();if(e.config.faceCamera)return m.copy(n).sub(h).normalize(),l.setFromDirection(m),
"yaw"===e.config.faceCamera&&(l.pitch=0),g.makeRotationFromEuler(l),e.animationMatrix.identity().setPosition(h).multiply(g).multiply(k),!1;console.assert(e.config.rotate);l.yaw=WALK.normalizeRotation(l.yaw+2*Math.PI*e.config.rotationSpeed*q);g.makeRotationFromEuler(l);e.animationMatrix.identity().setPosition(h).multiply(g).multiply(k);return!0}}WALK.NodeConfig=function(e){var f=this;this.name=e.name;this._editable=e.editable||!1;this._setsDisableCollisions=a(e.disableCollisions);this._disableCollisions=
e.disableCollisions||!1;this._setsHideInViews=a(e.hideInViews);this.hideInViews=null;e.hideInViews&&(this.hideInViews=e.hideInViews,this.hideInViews.sort());this._lightmapResolution=(this._setsLightmapResolution=a(e.lightmapResolution))?e.lightmapResolution:null;this._ground=a(e.ground)?e.ground:!1;this._faceCamera=e.faceCamera||null;this._rotate=e.rotate||!1;this._rotationSpeed=e.rotationSpeed||.1;this._isolateShadows=a(e.isolateShadows)?e.isolateShadows:!1;this.nodes=[];var g={type:"updated",target:this};
this._updated=function(){return f.dispatchEvent(g)}};WALK.NodeConfig.prototype.constructor=WALK.NodeConfig;THREE.EventDispatcher.prototype.apply(WALK.NodeConfig.prototype);WALK.NodeConfig.prototype._configUpdated=function(){this.nodes.forEach(c);this._updated()};WALK.NodeConfig.prototype.addNode=function(e){this.nodes.push(e)};WALK.NodeConfig.prototype.isOnHideInViews=function(e){return-1!==this.hideInViews.indexOf(e)};WALK.NodeConfig.prototype.addToHideInViews=function(e){for(var f=[],g=0;g<arguments.length;++g)f[g-
0]=arguments[g];console.assert(this.setsHideInViews);f=$jscomp.makeIterator(f);for(g=f.next();!g.done;g=f.next())g=g.value,console.assert(!this.isOnHideInViews(g)),this.hideInViews.push(g);this._updated()};WALK.NodeConfig.prototype.removeFromHideInViews=function(e){if(this.hideInViews)for(var f=0;f<this.hideInViews.length;)this.hideInViews[f]===e?this.hideInViews.splice(f,1):f+=1;this._updated()};WALK.NodeConfig.prototype.serialize=function(){return{name:this.name,disableCollisions:this.setsDisableCollisions?
this.disableCollisions:null,hideInViews:this.setsHideInViews?this.hideInViews:null,lightmapResolution:this.setsLightmapResolution?this.lightmapResolution:null,ground:this.ground?!0:null,faceCamera:this.faceCamera,rotate:this.rotate?!0:null,rotationSpeed:this.rotate?this.rotationSpeed:null,isolateShadows:this.isolateShadows?!0:null}};Object.defineProperty(WALK.NodeConfig.prototype,"setsDisableCollisions",{get:function(){return this._setsDisableCollisions},set:function(e){this._setsDisableCollisions=
e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"disableCollisions",{get:function(){return this._disableCollisions},set:function(e){console.assert(this._setsDisableCollisions);this._disableCollisions=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"editable",{get:function(){return this._editable||this.faceCamera||this.rotate},set:function(e){this._editable=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"ground",{get:function(){return this._ground},
set:function(e){this._ground=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"faceCamera",{get:function(){return this._faceCamera},set:function(e){this._faceCamera=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"rotate",{get:function(){return this._rotate},set:function(e){this._rotate=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"rotationSpeed",{get:function(){return this._rotationSpeed},set:function(e){0===e&&(e=
.01);this._rotationSpeed=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"setsLightmapResolution",{get:function(){return this._setsLightmapResolution},set:function(e){this._setsLightmapResolution=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"lightmapResolution",{get:function(){return this._lightmapResolution},set:function(e){console.assert(this._setsLightmapResolution);this._lightmapResolution=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,
"isolateShadows",{get:function(){return this._isolateShadows},set:function(e){this._isolateShadows=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"setsHideInViews",{get:function(){return this._setsHideInViews},set:function(e){this._setsHideInViews=e;null===this.hideInViews&&(this.hideInViews=[]);this._configUpdated()}});WALK.Node=function(e,f,g){this.id=g.id;this.initialLightProbeId=void 0===g.lightProbeId?null:g.lightProbeId;this.parent=e;this.config=f;this.children=[];
this.shadowsIsolatedWithin=this.lightmapResolution=this.hideInViews=this.animationMatrix=this.ground=this.disableCollisions=this._facesCnt=this.mesh=null;this.editable=!1;f.addNode(this);this.configure()};WALK.Node.prototype.constructor=WALK.Node;WALK.Node.prototype.configure=function(){this.ground=(this.disableCollisions=this.config.setsDisableCollisions?this.config.disableCollisions:this.parent?this.parent.disableCollisions:!1)?!1:this.config.ground;this.isAnimatedRoot?(this.animationMatrix=new THREE.Matrix4,
this.update=d(this)):this.animationMatrix=this.parent?this.parent.animationMatrix:null;this.hideInViews=this.config.setsHideInViews?this.config.hideInViews:this.parent?this.parent.hideInViews:null;this.lightmapResolution=this.config.setsLightmapResolution?this.config.lightmapResolution:this.parent?this.parent.lightmapResolution:null;this.shadowsIsolatedWithin=this.config.isolateShadows?this.config.name:this.parent&&this.parent.shadowsIsolatedWithin?this.parent.shadowsIsolatedWithin:null;this.editable=
this.config.editable;this.parent&&(this.editable=this.editable||this.parent.editable)};WALK.Node.prototype.visitSubtree=function(e){e(this);var f=this.children;if(f)for(var g=0;g<f.length;g+=1)f[g].visitSubtree(e)};WALK.Node.prototype.facesInSubtree=function(){var e=this;null===e._facesCnt&&(e._facesCnt=0,e.visitSubtree(function(f){f.mesh&&(e._facesCnt+=f.mesh.geometry.vertexCnt/3)}));return e._facesCnt};WALK.Node.prototype.hide=function(){this.visitSubtree(function(e){e.mesh&&(e.mesh.visible=!1)})};
WALK.Node.prototype.show=function(){this.visitSubtree(function(e){e.mesh&&(e.mesh.visible=!0)})};Object.defineProperty(WALK.Node.prototype,"isAnimatedRoot",{get:function(){return this.config.faceCamera||this.config.rotate}});WALK.Node.prototype.serialize=function(){var e={id:this.id,children:this.children.map(function(g){return g.serialize()})},f=this.mesh;f&&(e.lightProbeId=f.lightProbe?f.lightProbe.id:null,e.mesh=!0);return e};Object.defineProperty(WALK.Node.prototype,"type",{get:function(){return this.config.name}});
Object.defineProperty(WALK.Node.prototype,"highlightMix",{set:function(e){this.visitSubtree(function(f){f.mesh&&(f.mesh.highlightMix=e)})}});Object.defineProperty(WALK.Node.prototype,"selected",{set:function(e){this.visitSubtree(function(f){f.mesh&&(f.mesh.selected=e)})}});Object.defineProperty(WALK.Node.prototype,"selectedSecondary",{set:function(e){this.visitSubtree(function(f){f.mesh&&(f.mesh.selectedSecondary=e)})}})})();(function(){WALK.Mesh=function(a,b,c){this._visible=!0;THREE.Mesh.call(this,b,c);this.node=a;this.useFaces16=!1;this.quantUv0Max=this.quantUv0Range=this.quantVertexMax=this.quantVertexRange=this.transformByteOffset=this.uv1CoordVOffset=this.uv1CoordUOffset=this.uv1CoordVScale=this.uv1CoordUScale=this.lightMapIdx=this.uv1ByteOffset=this.uv0ByteOffset=this.normalByteOffset=this.vertexCnt=this.vertexByteOffset=this.faceCnt=this.faceByteOffset=0;this.lightMap=null;this.autoLightmapResolution=-1;this.lightProbe=
null;this.matrixAutoUpdate=this.rotationAutoUpdate=!1;this.selected=this.highlightMix=null;this.selectedSecondary=!1;this.visibilityId=null;this.cameraDistance=0;var d=this.matrix=this.matrixWorld=null;Object.defineProperty(this,"matrixWorld",{get:function(){return d||this.node.animationMatrix},set:function(e){d=e}});this.sharedBuffersDebug=0;this._mergedMesh=null};WALK.Mesh.prototype=Object.create(THREE.Mesh.prototype);WALK.Mesh.prototype.constructor=WALK.Mesh;WALK.Mesh.prototype.clone=void 0;WALK.Mesh.prototype.updateMatrixWorld=
function(){};WALK.Mesh.prototype.uv0InBuffers=function(){return-1!==this.uv0ByteOffset};WALK.Mesh.prototype.uv1InBuffers=function(){return-1!==this.uv1ByteOffset};WALK.Mesh.prototype.quantVertexFactor=function(){return this.quantVertexRange/this.quantVertexMax};WALK.Mesh.prototype.quantUv0Disabled=function(){return 0===this.quantUv0Max};WALK.Mesh.prototype.quantUv0Factor=function(){return this.quantUv0Range/this.quantUv0Max};Object.defineProperty(WALK.Mesh.prototype,"hideInViews",{get:function(){return this.node.hideInViews},
set:function(a){console.assert(!1)}});Object.defineProperty(WALK.Mesh.prototype,"visible",{get:function(){return this._visible},set:function(a){a!==this._visible&&(this._visible=a,this._mergedMesh&&!WALK.EDIT_MODE&&(this._mergedMesh.visible=a))}});WALK.MergedMesh=function(a,b){this._visible=!0;THREE.Mesh.call(this,a,b);this.anyLogicalMeshHasUvs=!1;this.lightProbe=this.lightMap=null;this.matrixAutoUpdate=this.rotationAutoUpdate=!1;this.hideInViews=null;this.matrixAutoUpdate=this.rotationAutoUpdate=
!1;this.center=null;this.cameraDistance=0;this.matrix=this.matrixWorld=null;this.logicalMeshes=[]};WALK.MergedMesh.prototype=Object.create(THREE.Mesh.prototype);WALK.MergedMesh.prototype.constructor=WALK.MergedMesh;WALK.MergedMesh.prototype.clone=void 0;WALK.MergedMesh.prototype.updateMatrixWorld=function(){};WALK.MergedMesh.prototype.addLogicalMesh=function(a){this.logicalMeshes.push(a);a._mergedMesh=this};Object.defineProperty(WALK.MergedMesh.prototype,"visible",{get:function(){return this._visible},
set:function(a){if(a!==this._visible){this._visible=a;for(var b=0;b<this.logicalMeshes.length;b+=1)this.logicalMeshes[b]._visible=a}}})})();(function(){WALK.SkyMesh=function(a,b,c,d){var e=this;THREE.Mesh.call(this,b,c);d&&this.position.fromArray(d);this.autoPosition=!d;this.name=a;var f={type:"updated",target:this};this._updated=function(){return e.dispatchEvent(f)}};WALK.SkyMesh.prototype=Object.create(THREE.Mesh.prototype);WALK.SkyMesh.prototype.constructor=WALK.SkyMesh;WALK.SkyMesh.prototype.clone=void 0;WALK.SkyMesh.prototype.serialize=function(){var a={name:this.name};this.autoPosition||(a.center=this.position.toArray());this.isEquirect?
(a.type="equirect",a.yawRotation=this.yawRotationDeg,a.texture=this.material.map?this.material.map.serialize():null):a.type="procedural";return a};Object.defineProperty(WALK.SkyMesh.prototype,"yawRotationDeg",{get:function(){return THREE.Math.radToDeg(this.rotation.y)},set:function(a){a=THREE.Math.degToRad(a);this.rotation.y=a;this.updateMatrixWorld();this._updated()}});Object.defineProperty(WALK.SkyMesh.prototype,"isEquirect",{get:function(){return this.material instanceof WALK.EquirectSkyMaterial}});
Object.defineProperty(WALK.SkyMesh.prototype,"radius",{get:function(){return this.scale.x},set:function(a){this.scale.set(a,a,a);this.updateMatrixWorld(!0);this._updated()}})})();(function(){var a=1E3,b={internal:!1,position:[0,0,0],rotation:[0,0],hideFromMenu:!0,sky:WALK.EDITOR_CONTROLLED_SKY_NAME};WALK.View=function(c){var d=this;void 0===c&&(c=b);this.id=void 0!==c.id?c.id:a++;this.name=c.name||"view"+this.id;this.internal=c.internal||!1;c.position&&(this.position=new THREE.Vector3(c.position[0],c.position[1],c.position[2]));this.rotation=new WALK.Euler(WALK.normalizeRotation(THREE.Math.degToRad(c.rotation[0])),WALK.normalizeRotation(THREE.Math.degToRad(c.rotation[1])),
0);this.hideFromMenu=c.hideFromMenu||!1;this.sky=c.sky||WALK.EDITOR_CONTROLLED_SKY_NAME;this.mode=c.mode||"fps";this.distance=c.distance;this.minDistance=c.minDistance;this.maxDistance=c.maxDistance;this.panPrimary=c.panPrimary;this.noPan=c.noPan;this.noRotate=c.noRotate;this.noPitchRotate=c.noPitchRotate;this.minUpAngle=void 0===c.minUpAngle?-Math.PI/2:c.minUpAngle;this.maxUpAngle=void 0===c.maxUpAngle?Math.PI/2:c.maxUpAngle;this.minSideAngle=void 0===c.minSideAngle?-Math.PI:c.minSideAngle;this.maxSideAngle=
void 0===c.maxSideAngle?Math.PI:c.maxSideAngle;c.target&&(this.target=new THREE.Vector3(c.target[0],c.target[1],c.target[2]));this.fov=c.fov;var e={type:"updated",target:this};this._updated=function(){return d.dispatchEvent(e)}};WALK.View.prototype={constructor:WALK.View,isTop:function(){return"orbit"===this.mode&&this.panPrimary&&this.noPitchRotate},isOrbit:function(){return"orbit"===this.mode&&!this.isTop()},usesDefaultSky:function(){return this.sky===WALK.DEFAULT_SKY_NAME},switchSky:function(){this.usesDefaultSky()?
this.sky=WALK.EDITOR_CONTROLLED_SKY_NAME:this.sky=WALK.DEFAULT_SKY_NAME;this._updated()},setName:function(c){this.name=c;this._updated()},setYaw:function(c){this.rotation.yaw=c;this._updated()},setMinUpAngle:function(c){c!==this.minUpAngle&&(this.minUpAngle=c,this._updated())},setMaxUpAngle:function(c){c!==this.maxUpAngle&&(this.maxUpAngle=c,this._updated())},setMinSideAngle:function(c){c!==this.minSideAngle&&(this.minSideAngle=c,this._updated())},setMaxSideAngle:function(c){c!==this.maxSideAngle&&
(this.maxSideAngle=c,this._updated())},setHideFromMenu:function(c){c!==this.hideFromMenu&&(this.hideFromMenu=c,this._updated())},serialize:function(){var c=this,d={id:this.id,name:this.name,mode:this.mode,rotation:this.rotation.toDegTriple().slice(0,2),hideFromMenu:this.hideFromMenu||!1,sky:this.sky};this.position&&(d.position=this.position.toArray());this.target&&(d.target=this.target.toArray());-Infinity!==this.minSideAngle&&(d.minSideAngle=this.minSideAngle);Infinity!==this.maxSideAngle&&(d.maxSideAngle=
this.maxSideAngle);"distance minDistance maxDistance panPrimary noPan noRotate noPitchRotate minUpAngle maxUpAngle fov".split(" ").forEach(function(e){void 0!==c[e]&&(d[e]=c[e])});return d}};THREE.EventDispatcher.prototype.apply(WALK.View.prototype)})();(function(){WALK.Mirror=function(a,b,c){THREE.Object3D.call(this);this.name="mirror_"+this.id;this.scene=a;this.mirrorCamera=b.clone();this.renderTargetParams={minFilter:GLC.LINEAR,magFilter:GLC.LINEAR,format:GLC.RGBA,stencilBuffer:!1,generateMipmaps:!0};this.texture=null;c=c||{};this.matrixNeedsUpdate=!0;this.clipBias=void 0!==c.clipBias?c.clipBias:0;a=void 0!==c.color?new THREE.Color(c.color):new THREE.Color(8355711);this.textureMatrix=new THREE.Matrix4;this.mirrorWorldPosition=new THREE.Vector3;
this.mirrorRotationMatrix=new THREE.Matrix4;this.mirrorNormal=new THREE.Vector3;this.cameraWorldPosition=new THREE.Vector3;this.cameraRotationMatrix=new THREE.Matrix4;this.mirrorToCamera=new THREE.Vector3;this.cameraFrustum=null;this.material=new WALK.MirrorMaterial(a,this.textureMatrix)};WALK.Mirror.prototype=Object.create(THREE.Object3D.prototype);WALK.Mirror.prototype.renderWithMirror=function(a){this.updateTextureMatrix();this.matrixNeedsUpdate=!1;var b=a.camera;a.camera=this.mirrorCamera;a.renderTemp();
a.material.uniforms.mirrorSampler.value=a.tempTexture;this.render();this.matrixNeedsUpdate=!0;a.material.uniforms.mirrorSampler.value=a.texture;a.camera=b;a.updateTextureMatrix()};WALK.Mirror.prototype.updateMatrixWorld=function(a){THREE.Object3D.prototype.updateMatrixWorld.call(this,a);this.mirrorWorldPosition.setFromMatrixPosition(this.matrixWorld);this.mirrorRotationMatrix.extractRotation(this.matrixWorld);this.mirrorNormal.set(0,0,1);this.mirrorNormal.applyMatrix4(this.mirrorRotationMatrix)};
WALK.Mirror.prototype.updateCameraPosition=function(a,b){this.cameraWorldPosition.setFromMatrixPosition(a.matrixWorld);this.cameraRotationMatrix.extractRotation(a.matrixWorld);this.matrixNeedsUpdate=!0;this.cameraFrustum=b};WALK.Mirror.prototype.inFrustum=function(){this.mirrorToCamera.subVectors(this.cameraWorldPosition,this.mirrorWorldPosition);return this.mirrorToCamera.angleTo(this.mirrorNormal)<Math.PI/2&&this.cameraFrustum.intersectsBox(this.parent.geometry.boundingBox)};WALK.Mirror.prototype.updateTextureMatrix=
function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector4,e=new THREE.Plane,f=new THREE.Vector4;return function(){a.copy(this.mirrorWorldPosition).sub(this.cameraWorldPosition).reflect(this.mirrorNormal).negate().add(this.mirrorWorldPosition);c.set(0,0,-1);c.applyMatrix4(this.cameraRotationMatrix);c.add(this.cameraWorldPosition);b.copy(this.mirrorWorldPosition).sub(c).reflect(this.mirrorNormal).negate().add(this.mirrorWorldPosition);this.up.set(0,-1,0);this.up.applyMatrix4(this.cameraRotationMatrix);
this.up.reflect(this.mirrorNormal).negate();this.mirrorCamera.position.copy(a);this.mirrorCamera.up=this.up;this.mirrorCamera.lookAt(b);this.mirrorCamera.updateProjectionMatrix();this.mirrorCamera.updateMatrixWorld();this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld);this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix);this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse);e.setFromNormalAndCoplanarPoint(this.mirrorNormal,
this.mirrorWorldPosition);e.applyMatrix4(this.mirrorCamera.matrixWorldInverse);d.set(e.normal.x,e.normal.y,e.normal.z,e.constant);var g=this.mirrorCamera.projectionMatrix;f.x=(Math.sign(d.x)+g.elements[8])/g.elements[0];f.y=(Math.sign(d.y)+g.elements[9])/g.elements[5];f.z=-1;f.w=(1+g.elements[10])/g.elements[14];d.multiplyScalar(2/d.dot(f));g.elements[2]=d.x;g.elements[6]=d.y;g.elements[10]=d.z+1-this.clipBias;g.elements[14]=d.w}}();WALK.Mirror.prototype.configure=function(a,b,c,d){this.mirrorCamera.aspect=
c;this.mirrorCamera.fov=d;this.mirrorCamera.updateProjectionMatrix();null!==this.texture&&this.texture.dispose();this.material.mirrorSampler=this.texture};WALK.Mirror.prototype.render=function(a){this.material.visible&&(this.matrixNeedsUpdate&&(this.updateTextureMatrix(),this.matrixNeedsUpdate=!1),this.material.visible=!1,a.render(this.scene,this.mirrorCamera,this.texture,!0),this.material.visible=!0)};WALK.Mirror.prototype.renderTemp=function(a){this.matrixNeedsUpdate&&this.updateTextureMatrix();
a.render(this.scene,this.mirrorCamera,this.tempTexture,!0)}})();(function(){function a(e,f,g){g=g||"id";for(var k=0;k<e.length;k+=1)if(e[k].hasOwnProperty(g)&&e[k][g]===f)return!1;return!0}function b(e,f,g){g=g||"id";for(var k=0;k<e.length;k+=1)if(e[k][g]===f)return e[k];return null}function c(e,f){e=e.name.toUpperCase();f=f.name.toUpperCase();return e<f?-1:e>f?1:0}var d=0;WALK.Scene=function(e){function f(){m.dispatchEvent(l)}function g(){m.dispatchEvent(q);f()}function k(n){n=n.target;var p=m._mainAnimatedMaterials.has(n);n.isAnimated&&!p?m._mainAnimatedMaterials.add(n):
!n.isAnimated&&p&&m._mainAnimatedMaterials.delete(n);f()}function h(){m._animatedRootNodes.length=0;m.visitAllNodes(function(n){n.isAnimatedRoot&&m._animatedRootNodes.push(n)});f()}var m=this,l={type:"updated",target:this},q={type:"anyViewUpdated",target:this};this.id=d++;this._headLight=!1;this.threeScene=new THREE.Scene;this.autoAddLightProbes=!0;this.autoTour={disabled:!1,startOnLoad:!1};this.canStartAutoTour=function(){return!this.autoTour.disabled&&1<this.visibleViews().length};this.startAutoTourOnLoad=
function(){return this.canStartAutoTour()&&this.autoTour.startOnLoad};this.disableProgressiveLoader=!1;this.camera=e;this._colorMap=null;this.materials=[];this._mainAnimatedMaterials=new Set;this._disabledMaterials=[];this._sortedMaterials=null;this.nodeConfigs=[];this._nodeConfigsLookup={};this.nodes=[];this._animatedRootNodes=[];this._nodeLookup={};this.gpuMeshes=[];this.mirrors=[];this._animatableAuxiliaryObjects=new Set;this.boundingBox=new THREE.Box3;this._sumLogicalMeshCenter=new THREE.Vector3;
this._logicalNonemptyMeshCount=0;this._center=new THREE.Vector3;this.skyMeshes=[];this.hideViewsMenu=!1;this.views=[];this.lights=[];this.lightProbes=[];this.cameraVolumes=[];this.minimapConfig=null;this.serialize=function(){return{disableProgressiveLoader:this.disableProgressiveLoader,autoTour:this.autoTour,camera:this.camera.serialize(),materials:this.materials.map(function(n){return n.serialize()}),nodeConfigs:this.nodeConfigs.map(function(n){return n.serialize()}),nodes:this.nodes.map(function(n){return n.serialize()}),
lights:this.lights.map(function(n){return n.serialize()}),lightProbes:this.lightProbes.map(function(n){return n.serialize()}),cameraVolumes:this.cameraVolumes.map(function(n){return n.serialize()}),autoAddLightProbes:!1,views:this.views.filter(function(n){return!n.internal}).map(function(n){return n.serialize()}),skies:this.skyMeshes.filter(function(n){return n.name!==WALK.DEFAULT_SKY_NAME}).map(function(n){return n.serialize()}),minimap:this.minimapConfig.serialize()}};this.addMaterial=function(n){this.materials.push(n);
n.addEventListener("updated",k);n.isAnimated&&this._mainAnimatedMaterials.add(n);this.camera.colorMapReady()&&void 0!==n.colorMap&&(n.colorMap=this.camera.colorMap);void 0!==n.cameraExposure&&(n.cameraExposure=this.camera.exposure);void 0!==n.cameraGamma&&(n.cameraGamma=this.camera.gamma);void 0!==n.headLight&&(n.headLight=this.headLight)};this.replaceMaterial=function(n,p){var r=this.materials.indexOf(n);void 0===this._disabledMaterials[r]&&(this._disabledMaterials[r]=new Map);this._disabledMaterials[r].set(n.type,
n);var x=this._disabledMaterials[r].get(p);x||(x=WALK.createMaterialOfType(p),x.addEventListener("updated",k),x.name=n.name,0===this.lightProbes.length&&(x.disableLightProbeTmp=!0));this.materials[r]=x;f();for(p=0;p<this.gpuMeshes.length;p+=1)this.gpuMeshes[p].material===n&&(this.gpuMeshes[p].material=x);n.isAnimated&&this._mainAnimatedMaterials.delete(n);x.isAnimated&&this._mainAnimatedMaterials.add(x);this._sortedMaterials=null;x.setUniforms();return x};this.addNodeConfig=function(n){this.nodeConfigs.push(n);
this._nodeConfigsLookup[n.name]=n;n.addEventListener("updated",h)};this.findNodeConfig=function(n){return this._nodeConfigsLookup.hasOwnProperty(n)?this._nodeConfigsLookup[n]:null};this.addNode=function(n){var p=this;this.nodes.push(n);n.visitSubtree(function(r){p._nodeLookup[r.id]=r;r.isAnimatedRoot&&p._animatedRootNodes.push(r)})};this.findNode=function(n){return this._nodeLookup[n]};this.visitAllNodes=function(n){for(var p=0;p<this.nodes.length;p+=1)this.nodes[p].visitSubtree(n)};this.visitMeshesWithMaterial=
function(n,p){this.visitAllNodes(function(r){(r=r.mesh)&&r.material===n&&p(r)})};this.sortedMaterials=function(){null===this._sortedMaterials&&(this._sortedMaterials=this.materials.slice(0).sort(c));return this._sortedMaterials};this._updateSceneCenterWithGpuMesh=function(){var n=new THREE.Vector3;return function(p){if(p.logicalMeshes)for(var r=0;r<p.logicalMeshes.length;r+=1){var x=p.logicalMeshes[r].geometry.boundingBox;x.empty()||(x.center(n),this._sumLogicalMeshCenter.add(n),++this._logicalNonemptyMeshCount)}else p=
p.geometry.boundingBox,p.empty()||(p.center(n),this._sumLogicalMeshCenter.add(n),++this._logicalNonemptyMeshCount);this._logicalNonemptyMeshCount&&this._center.copy(this._sumLogicalMeshCenter).divideScalar(this._logicalNonemptyMeshCount)}}();this.addGpuMesh=function(n){if(n.material.planarReflector){var p=new WALK.Mirror(this.threeScene,this.camera,{clipBias:0,color:8355711,debugMode:!1});p.material.name=n.material.name;var r=n.geometry;console.assert(r.boundingBox);var x=r.boundingBox,w=Math.sqrt(Math.pow(x.max.x-
x.min.x,2)+Math.pow(x.max.z-x.min.z,2)),u=x.max.y-x.min.y;w&&u?(w=new THREE.Mesh(new THREE.PlaneBufferGeometry(w,u),p.material),w.rotation.y=Math.atan2(r.normals[0],r.normals[2]),x.center(w.position),w.geometry.boundingBox=x,w.add(p),p=w):(WALK.log("mirror with 0 dimension"),p=null);this.mirrors.push(p.children[0]);this.addAuxiliaryObject(p)}else this.addAuxiliaryObject(n);this.gpuMeshes.push(n);this.boundingBox.union(n.geometry.boundingBox);this._updateSceneCenterWithGpuMesh(n)};this.addAuxiliaryObject=
function(n,p){p=void 0===p?!1:p;this.threeScene.add(n);p&&this._animatableAuxiliaryObjects.add(n);f()};this.removeAuxiliaryObject=function(n){this.threeScene.remove(n);this._animatableAuxiliaryObjects.delete(n);f()};this.addSkyMesh=function(n){var p=n.material;this.skyMeshes.push(n);this.camera.colorMapReady()&&(p.colorMap=this.camera.colorMap);void 0!==p.cameraExposure&&(p.cameraExposure=this.camera.exposure);void 0!==p.cameraGamma&&(p.cameraGamma=this.camera.gamma);n.addEventListener("updated",
f);this.dispatchEvent({type:"skyMeshAdded",skyMesh:n,target:this})};this.removeSkyMesh=function(n){WALK.removeFromArray(n,this.skyMeshes);this.dispatchEvent({type:"skyMeshRemoved",skyMesh:n,target:this});n.geometry.dispose();n.material.map&&n.material.map.dispose();n.material.dispose()};this.findSkyMesh=function(n){return b(this.skyMeshes,n,"name")};this.addLight=function(n){console.assert(a(this.lights,n.name,"name"));this.lights.push(n);n.addEventListener("updated",f);n.addEventListener("instanceAdded",
f);n.addEventListener("instanceRemoved",f);f();this.dispatchEvent({type:"lightAdded",light:n,target:this})};this.removeLight=function(n){WALK.removeFromArray(n,this.lights);f();this.dispatchEvent({type:"lightRemoved",light:n,target:this})};this.addLightProbe=function(n){console.assert(a(this.lightProbes,n.id));this.lightProbes.push(n);n.addEventListener("positionUpdated",f);n.addEventListener("boundsUpdated",f);f();this.dispatchEvent({type:"lightProbeAdded",lightProbe:n,target:this})};this.removeLightProbe=
function(n){WALK.removeFromArray(n,this.lightProbes);for(var p=0;p<this.gpuMeshes.length;p+=1)this.gpuMeshes[p].lightProbe===n&&(this.gpuMeshes[p].lightProbe=null);f();this.dispatchEvent({type:"lightProbeRemoved",lightProbe:n,target:this});n.dispose()};this.findLightProbe=function(n){return b(this.lightProbes,n)};this.closestLightProbe=function(n){for(var p=null,r=Infinity,x=$jscomp.makeIterator(this.lightProbes),w=x.next();!w.done;w=x.next()){w=w.value;var u=n.distanceTo(w.position);u<r&&(r=u,p=
w)}return p};this.addCameraVolume=function(n){console.assert(a(this.cameraVolumes,n.id));this.cameraVolumes.push(n);n.addEventListener("updated",f);f();this.dispatchEvent({type:"cameraVolumeAdded",cameraVolume:n,target:this})};this.removeCameraVolume=function(n){WALK.removeFromArray(n,this.cameraVolumes);f();this.dispatchEvent({type:"cameraVolumeRemoved",cameraVolume:n,target:this});n.dispose()};this.findCameraVolume=function(n){return b(this.cameraVolumes,n)};this.shiftCameraVolume=function(n,p){WALK.shiftItem(this.cameraVolumes,
n,p);this.dispatchEvent({type:"cameraVolumeShifted",cameraVolume:n,target:this})};this.findView=function(n){return b(this.views,n)};this.findViewByName=function(n){return b(this.views,n,"name")};this.visibleViews=function(){return WALK.filter(this.views,function(n){return!n.hideFromMenu})};this.addView=function(n){console.assert(a(this.views,n.id));this.views.push(n);n.addEventListener("updated",g);f();this.dispatchEvent({type:"viewAdded",view:n,target:this})};this.removeView=function(n){WALK.removeFromArray(n,
this.views);this.nodeConfigs.forEach(function(p){p.removeFromHideInViews(n.id)});f();this.dispatchEvent({type:"viewRemoved",view:n,target:this})};this.shiftView=function(n,p){WALK.shiftItem(this.views,n,p);this.dispatchEvent({type:"viewShifted",view:n,target:this})};this.hasLightMap=function(){return void 0!==WALK.find(this.materials,function(n){return n.lightMapped})};this.adjustSkiesAndCameraFarToSpanWholeScene=function(){for(var n=function(B,I){var F=Math.max(Math.abs(B.min.x-I.x),Math.abs(B.max.x-
I.x)),E=Math.max(Math.abs(B.min.y-I.y),Math.abs(B.max.y-I.y));B=Math.max(Math.abs(B.min.z-I.z),Math.abs(B.max.z-I.z));return Math.sqrt(F*F+E*E+B*B)},p=function(B,I){var F=0;B.forEach(function(E){if("orbit"===E.mode){var K=void 0===E.maxDistance?E.distance:E.maxDistance;K=E.target&&K?E.target.distanceTo(I)+K:void 0}else"fps"===E.mode&&(K=E.position?E.position.distanceTo(I):void 0);K&&K>F&&(F=K)});return F},r=0,x=0;x<this.skyMeshes.length;x+=1){var w=this.skyMeshes[x];w.autoPosition&&w.position.copy(this.center);
var u=void 0;if(this.boundingBox.empty())u=0;else{u=n(this.boundingBox,w.position);var A=p(this.views,w.position);u=Math.max(u,A)}u+=WALK.SKY_DISTANCE_TO_SCENE;w.radius=u;r=Math.max(r,u)}this.camera.setFar(Math.max(this.camera.far,2*r));WALK.log("Camera far set to "+this.camera.far)};e.addEventListener("colorMapUpdated",function(){var n=e.colorMap;m.materials.forEach(function(p){void 0!==p.colorMap&&(p.colorMap=n);p.setUniforms()});m.skyMeshes.forEach(function(p){p.material.colorMap=n});f()});e.addEventListener("updated",
f);this.disableLightProbesForMaterials=function(){for(var n=0;n<this.materials.length;n+=1)this.materials[n].disableLightProbeTmp=!0,this.materials[n].setUniforms()};this.enableLightProbesForMaterials=function(){for(var n=0;n<this.materials.length;n+=1)this.materials[n].disableLightProbeTmp=!1,this.materials[n].setUniforms()};this.getAnimatedMaterials=function(){var n=!1,p=new Map;return function(){function r(B){B instanceof THREE.Mesh&&B.material.isAnimated&&p.set(B.material,x)}for(var x=!n,w=$jscomp.makeIterator(m._mainAnimatedMaterials),
u=w.next();!u.done;u=w.next())p.set(u.value,x);w=$jscomp.makeIterator(m._animatableAuxiliaryObjects);for(u=w.next();!u.done;u=w.next())u.value.traverse(r);w=$jscomp.makeIterator(p);for(u=w.next();!u.done;u=w.next()){u=$jscomp.makeIterator(u.value);var A=u.next().value;u.next().value===n&&p.delete(A)}n=x;return p.keys()}}();this.getAnimatedRootNodes=function(){return this._animatedRootNodes};e.addEventListener("exposureUpdated",function(n){var p=e.exposure;m.materials.forEach(function(r){void 0!==
r.cameraExposure&&(r.cameraExposure=p)});m.skyMeshes.forEach(function(r){r=r.material;void 0!==r.cameraExposure&&(r.cameraExposure=p)})});e.addEventListener("gammaUpdated",function(n){var p=e.gamma;m.materials.forEach(function(r){void 0!==r.cameraGamma&&(r.cameraGamma=p)});m.skyMeshes.forEach(function(r){r=r.material;void 0!==r.cameraGamma&&(r.cameraGamma=p)})})};WALK.Scene.prototype={constructor:WALK.Scene,get center(){return this._center},get headLight(){return this._headLight},set headLight(e){e!==
this._headLight&&(this._headLight=e,this.materials.forEach(function(f){f.headLight=e;f.setUniforms()}))}};THREE.EventDispatcher.prototype.apply(WALK.Scene.prototype);WALK.createMaterialOfType=function(e){return"water"===e?new WALK.StandardMaterialWater:new WALK.StandardMaterial}})();(function(){WALK.BufferAttribute=function(a,b,c){THREE.BufferAttribute.call(this,a,b);this._length=a.length;this.releaseOnLoadedToGpu=!0;this.divisor=c||0;this.glType=this.buffer=null};WALK.BufferAttribute.prototype={constructor:WALK.BufferAttribute,get length(){return this._length}}})();(function(){function a(b,c,d,e,f){d=new WALK.BufferAttribute(d,e,f||0);b.addAttribute(c,d)}THREE.BufferGeometry.prototype.addTriangleOrderAttribute=function(){if(void 0===this.getAttribute("order")){for(var b=this.getAttribute("position").length/3,c=new Float32Array(b),d=0;d<b;d+=1)c[d]=d%3;this.addAttribute("order",new WALK.BufferAttribute(c,1))}};THREE.BufferGeometry.prototype.convertNormalsToSpherical=function(){console.assert(void 0===this.getAttribute("sphericalNormal"));var b=this.getAttribute("normal");
console.assert(!b.buffer);b=b.array;for(var c=b.length/3,d=WALK.DETECTOR.ios?new Int16Array(2*c):new Int8Array(2*c),e=0;e<c;e+=1){var f=3*e,g=2*e,k=Math.atan2(b[f+1],b[f])/Math.PI;d[g]=WALK.Math.toSnorm8(2*(Math.acos(b[f+2])/Math.PI-.5));d[g+1]=WALK.Math.toSnorm8(k)}delete this.attributes.normal;this.addAttribute("sphericalNormal",new WALK.BufferAttribute(d,2))};THREE.BufferGeometry.prototype.changePosition=function(b){var c=this.getAttribute("position"),d=c.length/3;c=c.array;for(var e=0;e<3*d;e+=
3)c[e]+=b.x,c[e+1]+=b.y,c[e+2]+=b.z};THREE.BufferGeometry.prototype.clone=function(){console.error("WALK.BufferGeometry cloning not supported")};WALK.Geometry=function(){THREE.BufferGeometry.call(this);this.isInstanced=!1;this.instanceCount=0;this.index=null;this.indexUint=!0;this.uvs0=this.normals=this.vertices=null;this.isUvs0Repeating=!1;this.uvs1=null;this.vertexOffset=this.vertexCnt=this.indexOffset=this.indexCnt=0;this.boundingBox=new THREE.Box3;this.boundingSphere=new THREE.Sphere;this.gpuSize=
0};WALK.Geometry.prototype=Object.create(THREE.BufferGeometry.prototype);WALK.Geometry.prototype.constructor=WALK.Geometry;WALK.Geometry.prototype.allocateCoreBuffers=function(b){console.assert(!this.vertices);b&&(65536>=this.vertexCnt?(this.indexUint=!1,this.index=new Uint16Array(this.indexCnt),this.gpuSize+=2*this.indexCnt):(this.indexUint=!0,this.index=new Uint32Array(this.indexCnt),this.gpuSize+=4*this.indexCnt));this.vertices=new Float32Array(3*this.vertexCnt);this.gpuSize+=12*this.vertexCnt;
this.normals=WALK.DETECTOR.ios?new Int16Array(2*this.vertexCnt):new Int8Array(2*this.vertexCnt);this.gpuSize+=2*this.vertexCnt};WALK.Geometry.prototype.addCoreAttributes=function(){this.index&&(a(this,"index",this.index,1),this.index=null);a(this,"position",this.vertices,3);this.vertices=null;a(this,"sphericalNormal",this.normals,2);this.normals=null};WALK.Geometry.prototype.allocateUv0=function(){console.assert(!this.uvs0);this.uvs0=new Float32Array(2*this.vertexCnt);this.gpuSize+=8*this.vertexCnt};
WALK.Geometry.prototype.addUv0Attribute=function(){a(this,"uv",this.uvs0,2);this.uvs0=null};WALK.Geometry.prototype.allocateUv1=function(){console.assert(!this.uvs1);this.uvs1=new Uint16Array(2*this.vertexCnt);this.gpuSize+=4*this.vertexCnt};WALK.Geometry.prototype.addUv1Attribute=function(){a(this,"uv2",this.uvs1,2);this.uvs1=null};WALK.Geometry.prototype.computeBoundingBox=void 0;WALK.Geometry.prototype.computeBoundingSphere=void 0;WALK.InstancedGeometry=function(b,c){THREE.BufferGeometry.call(this);
this.parent=b;this.ownsGpuBuffers=c;this.isInstanced=!0;this.instanceCount=0;this.transforms2=this.transforms1=this.transforms0=this.uvs1Mod=null;this.vertexOffset=this.indexOffset=0;this.boundingBox=new THREE.Box3;this.boundingSphere=new THREE.Sphere;this._gpuSize=0};WALK.InstancedGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);WALK.InstancedGeometry.prototype.constructor=WALK.InstancedGeometry;WALK.InstancedGeometry.prototype.allocateCoreBuffers=function(b){console.assert(!this.transforms0);
this.parent.vertices||this.parent.allocateCoreBuffers(b);b=4*this.instanceCount;this.transforms0=new Float32Array(b);this.transforms1=new Float32Array(b);this.transforms2=new Float32Array(b);this._gpuSize+=12*b};WALK.InstancedGeometry.prototype.addCoreAttributes=function(){this.parent.attributes.position||this.parent.addCoreAttributes();for(var b=$jscomp.makeIterator(Object.keys(this.parent.attributes)),c=b.next();!c.done;c=b.next())c=c.value,this.addAttribute(c,this.parent.attributes[c]);a(this,
"t0",this.transforms0,4,1);a(this,"t1",this.transforms1,4,1);a(this,"t2",this.transforms2,4,1);this.transforms2=this.transforms1=this.transforms0=null};WALK.InstancedGeometry.prototype.allocateUv0=function(){this.parent.uvs0||this.parent.allocateUv0()};WALK.InstancedGeometry.prototype.addUv0Attribute=function(){this.parent.attributes.uv||this.parent.addUv0Attribute();this.addAttribute("uv",this.parent.attributes.uv)};WALK.InstancedGeometry.prototype.allocateUv1=function(){console.assert(!this.uvs1Mod);
this.parent.uvs1||this.parent.allocateUv1();this.uvs1Mod=new Float32Array(4*this.instanceCount);this._gpuSize+=16*this.instanceCount};WALK.InstancedGeometry.prototype.addUv1Attribute=function(){this.parent.attributes.uv2||this.parent.addUv1Attribute();this.addAttribute("uv2",this.parent.attributes.uv2);a(this,"uv2Mod",this.uvs1Mod,4,1);this.uvs1Mod=null};WALK.InstancedGeometry.prototype.computeBoundingBox=void 0;WALK.InstancedGeometry.prototype.computeBoundingSphere=void 0;Object.defineProperty(WALK.InstancedGeometry.prototype,
"index",{get:function(){return this.parent.index}});Object.defineProperty(WALK.InstancedGeometry.prototype,"vertices",{get:function(){return this.parent.vertices}});Object.defineProperty(WALK.InstancedGeometry.prototype,"normals",{get:function(){return this.parent.normals}});Object.defineProperty(WALK.InstancedGeometry.prototype,"uvs0",{get:function(){return this.parent.uvs0}});Object.defineProperty(WALK.InstancedGeometry.prototype,"uvs1",{get:function(){return this.parent.uvs1}});Object.defineProperty(WALK.InstancedGeometry.prototype,
"indexUint",{get:function(){return this.parent.indexUint}});Object.defineProperty(WALK.InstancedGeometry.prototype,"vertexCnt",{get:function(){return this.parent.vertexCnt},set:function(b){this.parent.vertexCnt=b}});Object.defineProperty(WALK.InstancedGeometry.prototype,"indexCnt",{get:function(){return this.parent.indexCnt},set:function(b){this.parent.indexCnt=b}});Object.defineProperty(WALK.InstancedGeometry.prototype,"gpuSize",{get:function(){return this.ownsGpuBuffers?this._gpuSize+this.parent.gpuSize:
this._gpuSize}});WALK.SubGeometry=function(b,c,d,e,f,g,k){THREE.BufferGeometry.call(this);this.indexCnt=b;this.vertexCnt=c;this.parent=d;this.vertexOffset=f;this.indexOffset=e;this.boundingBox=g;this.boundingSphere=k;this.isInstanced=d.isInstanced;this.instanceId=0;this.instanceCount=1};WALK.SubGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);WALK.SubGeometry.prototype.constructor=WALK.SubGeometry;Object.defineProperty(WALK.SubGeometry.prototype,"attributes",{get:function(){return this.parent.attributes}});
Object.defineProperty(WALK.SubGeometry.prototype,"attributesKeys",{get:function(){return this.parent.attributesKeys}});Object.defineProperty(WALK.SubGeometry.prototype,"indexUint",{get:function(){return this.parent.indexUint}});WALK.SubGeometry.prototype.computeBoundingBox=void 0;WALK.SubGeometry.prototype.computeBoundingSphere=void 0;WALK.SubGeometry.prototype.addTriangleOrderAttribute=function(){this.parent.addTriangleOrderAttribute()}})();(function(){function a(f){f.dispatchEvent({type:"updated",target:f})}var b=null,c=null,d=new THREE.Vector3,e=new THREE.Quaternion;WALK.CameraVolume=function(f){this.id=f.id;this.name=f.name;this._type=f.type;console.assert(0<=WALK.CameraVolume.CameraVolumeTypes.indexOf(this._type));this.position=(new THREE.Vector3).fromArray(f.position);this.rotation=(new WALK.Euler).setFromDegTriple(f.rotation);this.scale=(new THREE.Vector3).fromArray(f.scale);this.exposure=f.exposure;this.gamma=f.gamma;this._inverse=
new THREE.Matrix4;this._inverseDirty=!0};WALK.CameraVolume.CameraVolumeTypes=["cube","sphere"];WALK.CameraVolume.prototype={constructor:WALK.CameraVolume,getVolumeGeometry:function(){b||(b=new THREE.BoxBufferGeometry(2,2,2),b.addTriangleOrderAttribute(),b.convertNormalsToSpherical(),c=new THREE.IcosahedronBufferGeometry(1,2),c.addTriangleOrderAttribute(),c.convertNormalsToSpherical());return"sphere"===this._type?c:b},setName:function(f){this.name=f;a(this)},setPosition:function(f,g,k){this.position.set(f,
g,k);this._inverseDirty=!0;a(this)},setRotation:function(f,g,k){this.rotation.yaw=WALK.normalizeRotation(f);this.rotation.pitch=WALK.normalizeRotation(g);this.rotation.roll=WALK.normalizeRotation(k);this._inverseDirty=!0;a(this)},setRotationDeg:function(f,g,k){f=THREE.Math.degToRad(f);g=THREE.Math.degToRad(g);k=THREE.Math.degToRad(k);this.setRotation(f,g,k)},setScale:function(f,g,k){this.scale.set(f,g,k);this._inverseDirty=!0;a(this)},setExposure:function(f){this.exposure=f;a(this)},setGamma:function(f){this.gamma=
f;a(this)},worldCoordinatesInside:function(f){this._inverseDirty&&(this._inverseDirty=!1,this._inverse.compose(this.position,e.setFromEuler(this.rotation),this.scale),this._inverse.getInverse(this._inverse));d.copy(f).applyMatrix4(this._inverse);return"sphere"===this._type?1>=d.lengthSq():1>=Math.abs(d.x)&&1>=Math.abs(d.y)&&1>=Math.abs(d.z)},serialize:function(){return{id:this.id,name:this.name,type:this._type,position:this.position.toArray(),rotation:this.rotation.toDegTriple(),scale:this.scale.toArray(),
exposure:this.exposure,gamma:this.gamma}},dispose:function(){}};THREE.EventDispatcher.prototype.apply(WALK.CameraVolume.prototype)})();(function(){function a(l){d&&g===l.id||(d=new THREE.SphereBufferGeometry(1,32,16),d.convertNormalsToSpherical(),e=new THREE.PlaneBufferGeometry(1,1),e.convertNormalsToSpherical(),f=new THREE.CylinderBufferGeometry(.5,.5,1,16,1),k||(k=new THREE.Matrix4,k.makeRotationX(Math.PI/2)),f.applyMatrix(k),f.convertNormalsToSpherical(),g=l.id)}function b(l){var q=l.icon&&WALK.ICONS[l.icon],n=q?q.value:l.text,p=q?q.fontFamily:"Open Sans";var r=l.color||"#4c9ed9";var x=l.opacity;void 0===x||1<=x||(h.setStyle(r),
r="rgba("+(255*h.r|0)+","+(255*h.g|0)+","+(255*h.b|0)+","+x+")");var w=r;x=l.textColor||"#ffffff";r=void 0!==l.opacity&&1>l.opacity;var u="sphere"===l.type,A=u||void 0===l.textMargin?20:l.textMargin;q=[q||"",n,p,w,x,u,A,l.borderRadius||0,r].join("_");var B=m.get(q);if(B)return B.usedTimes++,[q,B.texture];B=document.getElementById("anchor-canvas");B||(B=document.createElement("canvas"),B.id="anchor-canvas");if(u)A=B,u=n,A.width=512,A.height=512,A=A.getContext("2d"),A.font="700 128px "+p,u=A.measureText(u).width,
u=Math.floor(c/u*128),u=Math.min(u,c),A.font="700 "+u+"px "+p,p=A;else{u=$jscomp;var I=u.makeIterator,F=B,E=WALK.SPRITE_ANCHOR_FONT_SIZE,K=F.getContext("2d");K.font="700 "+E+"px "+p;for(var M=n,Z=n.length-1,C;;){C=K.measureText(M).width;C+=2*A;if(2048>=C)break;M=n.substring(0,Z)+"...";--Z}F.width=C;F.height=1.5*E;K=F.getContext("2d");K.font="700 "+E+"px "+p;n=I.call(u,[K,M]);p=n.next().value;n=n.next().value}p.fillStyle=w;l.borderRadius?(w=p,A=B.width,u=B.height,l=.5*l.borderRadius*Math.min(A,u),
w.beginPath(),w.moveTo(0+l,0),w.lineTo(0+A-l,0),w.quadraticCurveTo(0+A,0,0+A,0+l),w.lineTo(0+A,0+u-l),w.quadraticCurveTo(0+A,0+u,0+A-l,0+u),w.lineTo(0+l,0+u),w.quadraticCurveTo(0,0+u,0,0+u-l),w.lineTo(0,0+l),w.quadraticCurveTo(0,0,0+l,0),w.closePath(),w.fill()):p.fillRect(0,0,B.width,B.height);p.fillStyle=x;p.textAlign="center";p.textBaseline="middle";p.shadowColor="black";p.shadowBlur=16;p.fillText(n,B.width/2,B.height/2);l=new WALK.Texture(B);l.width=B.width;l.height=B.height;l.hasAlpha=r;l.minFilter=
GLC.LINEAR;l.loaded=!0;l.needsUpdate=!0;m.set(q,{usedTimes:1,texture:l});return[q,l]}var c=512-2*Math.floor(512*(.5-.5*Math.sin(70/180*Math.PI/2))),d=null,e,f,g=null,k,h=new THREE.Color,m=new Map;WALK.Anchor=function(l,q){a(l);var n=new THREE.Vector3;n.fromArray(q.position);var p=new THREE.Color;p.setStyle(q.color);p.convertGammaToLinear();Object.defineProperty(this,"color",{get:function(){return p}});var r=$jscomp.makeIterator(b(q)),x=r.next().value;r=r.next().value;this._textureSignature=x;if("sphere"===
q.type){x=d;var w=new WALK.AnchorMaterial;var u=l.closestLightProbe(n);w.bumpTexture=r;w.disableLightProbe=null===u||!u.texturesReady();w.headLight=!0;l=[q.radius,q.radius,q.radius]}else{x=e;w=new WALK.AnchorSpriteMaterial;u=null;w.disableLightProbe=!0;w.headLight=!1;w.specularOff=1;l=[r.width/r.height*q.height,q.height,1];var A=new THREE.Mesh(f,null)}w.baseColorTexture=r;w.configureTransparency();w.setUniforms();THREE.Mesh.call(this,x,w);this.position.copy(n);this.scale.fromArray(l);this.updateMatrixWorld(!0);
this.lightProbe=u;A?(A.position.copy(n),n=Math.max(l[0],l[1]),A.scale.fromArray([n,n,q.height]),A.updateMatrixWorld(!0),this.colliderMesh=A):this.colliderMesh=this;this.colliderMesh.visibilityId=null;this.colliderMesh.anchor=this;this.extension=null};WALK.Anchor.prototype=Object.create(THREE.Mesh.prototype);WALK.Anchor.prototype.dispose=function(){var l=this.material;l.dispose();var q=this._textureSignature,n=m.get(q),p=n.texture;console.assert(l.baseColorTexture===p);n.usedTimes--;0===n.usedTimes&&
(p.dispose(),m.delete(q))};WALK.Anchor.prototype.enableLightProbe=function(){if(this.lightProbe){console.assert(this.lightProbe.texturesReady());var l=this.material;l.disableLightProbe=!1;l.setUniforms()}}})();(function(){function a(d){return(d.boundingBox.max.z-d.boundingBox.min.z)/2}var b=null,c={sphere:null,head:null,torso:null,displayPortrait:null,displayLandscape:null,cylinder:null};WALK.setAvatarGeometries=function(d){for(var e=$jscomp.makeIterator(["head","torso","displayPortrait","displayLandscape"]),f=e.next();!f.done;f=e.next())f=f.value,d.has(f)||console.assert(!1,'Avatar "'+f+'" geometry is missing'),c[f]=d.get(f)};WALK.Avatar=function(d,e,f){THREE.Object3D.call(this);this.uuid=e;this.displayName=
f.displayName;this._scene=d;this._lastLightProbeCheckPosition=new THREE.Vector3(0,0,0);this.colliders=[];c.plane&&b===d.id||(c.sphere=new THREE.SphereBufferGeometry(.08,32,16),c.sphere.convertNormalsToSpherical(),c.cylinder=new THREE.CylinderBufferGeometry(.005,.005,1,3),c.cylinder.convertNormalsToSpherical(),b=d.id);this._haveLightProbe=0<this._scene.lightProbes.length;var g=f.color,k=this._haveLightProbe;e=new WALK.StandardMaterial;e.baseColor.setStyle(g).convertGammaToLinear();e.roughness=.7;e.metallic=
1;e.highlight=new THREE.Color(16777215);e.highlightMix=0;k||(e.disableLightProbe=!0,e.headLight=!0);e.setUniforms();this._body=new THREE.Object3D;this._head=new THREE.Mesh(c.head,e);this._head.rotation.order="ZXY";this._torso=new THREE.Mesh(c.torso,e);this._torso.position.z=-(c.torso.boundingBox.max.z+a(c.head)+.05);g=f.displayName;k=f.color;this._displayNameAnchor=new WALK.Anchor(d,{type:"sprite",position:[0,0,.1+a(c.head)],height:.1,text:g,textColor:k,opacity:0});d=this._haveLightProbe;g=new WALK.StandardMaterial;
g.headLight=!1;g.baseColor.setRGB(0,0,0);g.roughness=.001;g.metallic=0;d||(g.disableLightProbe=!0);g.setUniforms();this._displayMaterial=g;this._displayLandscape=new THREE.Mesh(c.displayLandscape,this._displayMaterial);this._displayPortrait=new THREE.Mesh(c.displayPortrait,this._displayMaterial);e=new THREE.Mesh(c.sphere,e);e.scale.set(.4,.4,.4);e.visible=!1;this._pointer=e;this._pointerLeaderStartOffset=new THREE.Vector3(0,.3,-.35);e=f.color;d=new WALK.StandardMaterial;d.headLight=!1;d.baseColor.setStyle(e).convertGammaToLinear();
d.transparent=!0;d.opacity=.5;d.emissive=!0;d.disableLightProbe=!0;d.setUniforms();e=new THREE.Mesh(c.cylinder,d);e.visible=!1;this._pointerLeader=e;this._body.add(this._torso);this._head.add(this._displayLandscape);this._head.add(this._displayPortrait);this._body.add(this._head);this.add(this._body);this.add(this._displayNameAnchor);this.add(this._pointerLeader);this.add(this._pointer);e=$jscomp.makeIterator([this._torso,this._displayLandscape,this._displayPortrait,this._head]);for(d=e.next();!d.done;d=
e.next())d=d.value,d.visibilityId=null,this.colliders.push(d);f.position&&this.position.fromArray(f.position);this.updateMatrixWorld(!0);this._setClosestLightProbe();this._videoTexture1=this._videoTexture0=null;this._landscape=!0;this._displayLandscape.visible=!0;this._displayPortrait.visible=!1;this._soundThreshold=140;this._maxHighlight=.5;this._highlightStepDown=.05};WALK.Avatar.prototype=Object.create(THREE.Object3D.prototype);WALK.Avatar.prototype.constructor=WALK.Avatar;WALK.Avatar.prototype.switchToPortrait=
function(){this._landscape&&(this._landscape=!1,this._displayLandscape.visible=!1,this._displayPortrait.visible=!0,this._head.rotation.y=Math.PI/2,this._torso.position.z-=.05)};WALK.Avatar.prototype.switchToLandscape=function(){this._landscape||(this._landscape=!0,this._displayLandscape.visible=!0,this._displayPortrait.visible=!1,this._head.rotation.y=0,this._torso.position.z+=.05)};WALK.Avatar.prototype.hideBody=function(){this._head.visible=!1;this._torso.visible=!1;this._displayNameAnchor.visible=
!1};WALK.Avatar.prototype._updated=function(){this.dispatchEvent({type:"avatarUpdated",target:this})};WALK.Avatar.prototype.rotate=function(d,e){this._body.rotation.z=d;this._head.rotation.x=e};WALK.Avatar.prototype.setOrientation=function(){this._videoTexture0.width<this._videoTexture0.height?this.switchToPortrait():this.switchToLandscape()};WALK.Avatar.prototype.setVideoTexture0=function(d){var e=this;this._videoTexture0&&(this._videoTexture0.dispose(),this._videoTexture0=null);this._haveLightProbe&&
(this._displayMaterial.disableLightProbe=!1);this._displayMaterial.baseColorTexture=null;this._updated();d?d.addLoadedListener(function(){e._videoTexture0=d;e.setOrientation();e._displayMaterial.disableLightProbe=!0;e._displayMaterial.baseColorTexture=d;d.addResizedListener(function(){e.setOrientation();e._updated()});e._updated()}):(this.switchToLandscape(),this._updated())};WALK.Avatar.prototype.getVideoTexture0=function(){return this._videoTexture0};WALK.Avatar.prototype.setVideoTexture1=function(d){var e=
this;this._videoTexture1&&(this._videoTexture1.dispose(),this._videoTexture1=null,this._updated());d&&d.addLoadedListener(function(){e._videoTexture1=d;e._updated()})};WALK.Avatar.prototype.getVideoTexture1=function(){return this._videoTexture1};WALK.Avatar.prototype.getMainMaterial=function(){return this._head.material};WALK.Avatar.prototype._setClosestLightProbe=function(){var d=this._scene.closestLightProbe(this.position);d!==this._head.lightProbe&&(this._head.lightProbe=d,this._torso.lightProbe=
d,this._displayLandscape.lightProbe=d,this._displayPortrait.lightProbe=d,this._pointer.lightProbe=d,this._pointerLeader.lightProbe=d)};WALK.Avatar.prototype.setPositionFromArray=function(d){this.position.fromArray(d);.5<this._lastLightProbeCheckPosition.distanceTo(this.position)&&(this._lastLightProbeCheckPosition.copy(this.position),this._setClosestLightProbe(this.position))};WALK.Avatar.prototype.placePointer=function(d,e,f){var g=new THREE.Matrix4,k=new THREE.Vector3,h=new THREE.Vector3,m=new THREE.Vector3,
l=new THREE.Vector3,q=new THREE.Matrix4,n=new THREE.Matrix4;n.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1);var p=new THREE.Matrix4;return function(r,x,w){this._pointer.position.set(r-this.position.x,x-this.position.y,w-this.position.z);this._pointer.visible=!0;g.makeRotationZ(this._body.rotation.z);k.set(this._pointerLeaderStartOffset.x,this._pointerLeaderStartOffset.y,this._pointerLeaderStartOffset.z);k.applyMatrix4(g);h.set(this.position.x,this.position.y,this.position.z).add(k);m.set(r,x,w);l.set(r,x,
w).sub(h);p.makeScale(1,l.length(),1);q.lookAt(h,m,THREE.Object3D.DefaultUp);q.multiply(n);p.multiplyMatrices(q,p);l.divideScalar(2).add(k);p.setPosition(l);this._pointerLeader.matrix.identity();this._pointerLeader.applyMatrix(p);this._pointerLeader.visible=!0}}();WALK.Avatar.prototype.hidePointer=function(){this._pointerLeader.visible=!1;this._pointer.visible=!1};WALK.Avatar.prototype.onSoundVolumeUpdated=function(d){null!==d&&(d=this._computeHighlighMix(d),this.getMainMaterial().highlightMix!==
d&&(this.getMainMaterial().highlightMix=d,WALK.getViewer().requestFrame()))};WALK.Avatar.prototype.onSoundSwitchedOff=function(){0<this.getMainMaterial().highlightMix&&(this.getMainMaterial().highlightMix=0,WALK.getViewer().requestFrame())};WALK.Avatar.prototype._computeHighlighMix=function(d){var e=this.getMainMaterial().highlightMix;if(d<this._soundThreshold)return 0<e?Math.max(0,e-this._highlightStepDown):0;d=(d-this._soundThreshold)/(255-this._soundThreshold)*this._maxHighlight;return d>e?d:Math.max(d,
e-this._highlightStepDown)};WALK.Avatar.prototype.dispose=function(){this._head.material.dispose();this._displayMaterial.dispose();this._videoTexture0&&this._videoTexture0.dispose();this._videoTexture1&&this._videoTexture1.dispose();this._displayNameAnchor.dispose();this.dispatchEvent({type:"dispose"})}})();(function(){function a(h,m,l,q,n){l=new THREE.SphereBufferGeometry(l,32,16);l.changePosition(q);l.computeBoundingSphere();l.convertNormalsToSpherical();q=new WALK.Mesh(null,l,m);m.lightMapped&&(q.lightMap=n);h.camera.getWorldPosition(f);q.lightProbe=h.closestLightProbe(f);q.frustumCulled=!1;q.userData.hideFromLightProbes=!0;return q}function b(h){c.setRGB(h,h,h);h=WALK.ColorUtils.hdrEncode(c,d);var m=new Uint8Array(4);m[0]=Math.round(255*d.r);m[1]=Math.round(255*d.g);m[2]=Math.round(255*d.b);m[3]=
Math.round(255*h);h=new WALK.DataTexture(m,1,1);h.magFilter=GLC.NEAREST;h.minFilter=GLC.NEAREST;h.anisotropy=WALK.NO_ANISOTROPY;h.hasAlpha=!0;h.isRgbm=!0;h.loaded=!0;h.needsUpdate=!0;return h}var c,d,e,f,g=new THREE.Matrix4,k=new THREE.Vector2;WALK.MaterialPicker=function(h,m,l,q,n,p,r){function x(O){u.forEach(function(W){return W(O)})}var w=this;this.lightMap=null;this.meshes=[];var u=[],A=Math.max(2*q.camera.near,.1);c||(c=new THREE.Color,d=new THREE.Color,f=new THREE.Vector3,e=new THREE.Vector3,
f=new THREE.Vector3);var B=q.camera.aspect,I=Math.tan(THREE.Math.degToRad(q.camera.fov/2))*A,F=-I;B=Math.abs(B*I-B*F);I=Math.abs(I-F);var E=.01*B,K=(B-h.length*E-E)/(2*h.length);K=Math.min(K,WALK.MATERIAL_PICKER_BALL_MAX_SIZE/2*B);var M=h.length/2*-(2*K+E)+K+E;F=document.getElementById("menu-bar").getBoundingClientRect().top;var Z=-I/2+(window.innerHeight-F)/window.innerHeight*I+K+E;h.some(function(O){return O.lightMapped})&&(p=p.measureIncidentLuma(),0>p&&(p=1),this.lightMap=b(p));h.forEach(function(O,
W){if(O){e.set(M,Z,-A);var aa=a(q,O,K,e,w.lightMap);M+=2*K+E;var R=null;if(m){R=new THREE.Matrix4;R.multiply(g.makeTranslation(m.x,m.y,m.z));O=n.cameraWorldPosition();k.x=O.x-m.x;k.y=O.y-m.y;O=R;var S=O.multiply,fa=g.makeRotationZ;var X=Math.abs(k.y)>Math.abs(k.x)?0<k.x?0:-Math.PI:0<k.y?Math.PI/2:-Math.PI/2;S.call(O,fa.call(g,X));R.multiply(g.makeRotationX(-Math.PI/2));R.multiply(g.makeScale(l,l,l));R.multiply(g.makeTranslation(2.1*(W+1),0,0));R.multiply(g.makeScale(1/K,1/K,1/K));R.multiply(g.makeTranslation(-e.x,
-e.y,-e.z))}w.meshes.push(aa);u.push(function(qa){qa&&R?(aa.matrix=R,aa.matrixWorld=R):(aa.matrix=q.camera.matrix,aa.matrixWorld=q.camera.matrixWorld)})}});var C=function(){return x(!0)},U=function(){return x(!1)};r.addEventListener("modeEnabled",C);r.addEventListener("modeDisabled",U);this.dispose=function(){u.length=0;r.removeEventListener("modeEnabled",C);r.removeEventListener("modeDisabled",U);this.meshes.forEach(function(O){return O.geometry.dispose()});this.meshes=null;this.lightMap&&(this.lightMap.dispose(),
this.lightMap=null)};x(r.modeIsEnabled())}})();(function(){var a=function(b,c,d){function e(){l.set({x:c.min.x,y:c.min.y},{x:c.max.x,y:c.max.y})}function f(){var n=Math.abs(c.min.x-c.max.x),p=Math.abs(c.min.y-c.max.y);n=Math.min(l.size().x/n,1);p=Math.min(l.size().y/p,1);n>p?q.set(1,p/n):q.set(n/p,1)}var g=b.name||"level",k=b.slicePlaneHeight,h=b.farPlaneHeight,m=!!b.cropRange,l=b.cropRange?new THREE.Box2((new THREE.Vector2).fromArray(b.cropRange.min),(new THREE.Vector2).fromArray(b.cropRange.max)):new THREE.Box2,q=new THREE.Vector2(1,1);m&&f();
this.setRange=function(n,p,r){n<l.max[r]&&(l.min[r]=n);p>l.min[r]&&(l.max[r]=p);f();d()};this.serialize=function(){var n=m?{min:l.min.toArray(),max:l.max.toArray()}:null;return{name:g,slicePlaneHeight:k,farPlaneHeight:h,cropRange:n}};Object.defineProperty(this,"name",{get:function(){return g},set:function(n){g=n?n.trim()||"level":"level";d()}});Object.defineProperty(this,"slicePlaneHeight",{get:function(){return k},set:function(n){n>=h&&(k=n,d())}});Object.defineProperty(this,"farPlaneHeight",{get:function(){return h},
set:function(n){n<=k&&(h=n,d())}});Object.defineProperty(this,"crop",{get:function(){return m},set:function(n){(m=n)||e();f();d()}});Object.defineProperty(this,"cropRange",{get:function(){l.empty()&&e();return l}});Object.defineProperty(this,"ratio",{get:function(){0!==q.x&&0!==q.y&&isNaN(q.x)&&isNaN(q.y)||f();return q}})};WALK.MinimapConfig=function(b,c,d){function e(){return new a({name:"level0",slicePlaneHeight:d?d:c.min.z+WALK.FALLBACK_CAMERA_HEIGHT,farPlaneHeight:c.min.z},c,h)}function f(){return p.map(function(r){return r.serialize()})}
var g=this;b=void 0!==b?b:{enabled:!1,outlineColor:[0,0,0],outlineThickness:1,fillEnabled:!0,levels:[]};var k={type:"updated",target:this},h=function(){return g.dispatchEvent(k)},m=b.enabled,l=(new THREE.Color).fromArray(b.outlineColor),q=b.outlineThickness,n=b.fillEnabled,p=b.levels.map(function(r){return new a(r,c,h)});this.addLevel=function(r){var x=p.length;if(0===x)p.push(e());else{var w=p,u=w.push;var A="level"+x;var B=p[x-1];x=B.slicePlaneHeight+(c.max.z-B.slicePlaneHeight)/2;B=B.farPlaneHeight;
r=r.crop?{min:r.cropRange.min.toArray(),max:r.cropRange.max.toArray()}:null;A=new a({name:A,slicePlaneHeight:x,farPlaneHeight:B,cropRange:r},c,h);u.call(w,A)}h()};this.removeLevel=function(r){WALK.removeFromArray(r,p);0===p.length&&p.push(e());h()};this.shiftLevel=function(r,x){WALK.shiftItem(p,r,x);h()};this.setOutlineColorRGB=function(r,x,w){l.setRGB(r,x,w);h()};this.serialize=function(){if(WALK.ENABLE_MINIMAP)return{enabled:this.enabled,outlineColor:this.outlineColor.toArray(),outlineThickness:this.outlineThickness,
fillEnabled:this.fillEnabled,levels:f()}};Object.defineProperty(this,"enabled",{get:function(){return m},set:function(r){r&&0===p.length&&this.addLevel();m=r;h()}});Object.defineProperty(this,"outlineColor",{get:function(){return l}});Object.defineProperty(this,"outlineThickness",{get:function(){return q},set:function(r){q=r;h()}});Object.defineProperty(this,"fillEnabled",{get:function(){return n},set:function(r){n=r;h()}});Object.defineProperty(this,"levels",{get:function(){return p}})};THREE.EventDispatcher.prototype.apply(WALK.MinimapConfig.prototype)})();(function(){function a(){var b=new Set,c=[];this.add=function(d){d instanceof RegExp?c.push(d):b.add(d)};this.matchesAny=function(d){return b.has(d)?!0:c.some(function(e){return e.test(d)})}}WALK.MergeConfig=function(){this._editableNodeTypes=new a;this._editableMaterialNames=new a;this._allMaterialsEditable=!1;this.setNodeTypeEditable=function(b){this._editableNodeTypes.add(b)};this.setMaterialEditable=function(b){this._editableMaterialNames.add(b)};this.setAllMaterialsEditable=function(){this._allMaterialsEditable=
!0};this.isMaterialEditable=function(b){return this._allMaterialsEditable||this._editableMaterialNames.matchesAny(b)};this.isNodeTypeEditable=function(b){return this._editableNodeTypes.matchesAny(b)}}})();(function(){function a(){function c(l,q,n){return(0<=l?l-1:l+q/n)*n}var d=this,e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3,k=new THREE.Vector3,h=new THREE.Vector3;this.objects=[];var m=null;this.vertices=[];this.normals=[];this.uvs=[];this.startObject=function(l){m={name:l||"",vertices:[],normals:[],uvs:[],hasUvs:!1};this.objects.push(m)};this.addFace=function(l,q,n,p,r,x,w,u,A){var B=this.vertices.length;l=c(l,B,3);q=c(q,B,3);n=c(n,B,3);B=d.vertices;var I=m.vertices;I.push(B[l+0],
B[l+1],B[l+2]);I.push(B[q+0],B[q+1],B[q+2]);I.push(B[n+0],B[n+1],B[n+2]);void 0!==w?(l=this.normals.length,w=c(w,l,3),u=c(u,l,3),A=c(A,l,3),l=d.normals,q=m.normals,q.push(l[w+0],l[w+1],l[w+2]),q.push(l[u+0],l[u+1],l[u+2]),q.push(l[A+0],l[A+1],l[A+2])):(A=d.vertices,u=m.normals,e.fromArray(A,l),f.fromArray(A,q),g.fromArray(A,n),h.subVectors(g,f),k.subVectors(e,f),h.cross(k),h.normalize(),u.push(h.x,h.y,h.z),u.push(h.x,h.y,h.z),u.push(h.x,h.y,h.z));void 0!==p?(A=this.uvs.length,p=c(p,A,2),r=c(r,A,2),
x=c(x,A,2),A=d.uvs,u=m.uvs,u.push(A[p+0],A[p+1]),u.push(A[r+0],A[r+1]),u.push(A[x+0],A[x+1]),m.hasUvs=!0):(x=m.uvs,x.push(0,0),x.push(0,0),x.push(0,0))}}function b(c){if(void 0!==c&&""!==c)return parseInt(c,10)}WALK.loadGeometriesFromObj=function(c,d,e){WALK.ajaxGet(c,!1,function(f){var g=f,k=/^[og]\s*(.+)?/,h=/^mtllib /,m=/^usemtl /,l=/^usemap /;f=new a;-1!==g.indexOf("\r\n")&&(g=g.replace(/\r\n/g,"\n"));-1!==g.indexOf("\\\n")&&(g=g.replace(/\\\n/g,""));g=g.split("\n");var q;g=$jscomp.makeIterator(g);
for(q=g.next();!q.done;q=g.next()){var n=q.value;if(0!==n.length&&"\x00"!==n){var p=n.charAt(0);if("#"!==p)if("v"===p)switch(q=n.split(/\s+/),q[0]){case "v":f.vertices.push(parseFloat(q[1]),parseFloat(q[2]),parseFloat(q[3]));7<=q.length&&console.assert(!1,"obj with vertex colors is not supported");break;case "vn":f.normals.push(parseFloat(q[1]),parseFloat(q[2]),parseFloat(q[3]));break;case "vt":f.uvs.push(parseFloat(q[1]),parseFloat(q[2]))}else if("f"===p){n=n.substr(1).trim().split(/\s+/);q=[];n=
$jscomp.makeIterator(n);for(p=n.next();!p.done;p=n.next())p=p.value,0<p.length&&(p=p.split("/"),q.push(p));n=q[0];p=1;for(var r=q.length-1;p<r;p++){var x=q[p],w=q[p+1];f.addFace(b(n[0]),b(x[0]),b(w[0]),b(n[1]),b(x[1]),b(w[1]),b(n[2]),b(x[2]),b(w[2]))}}else"l"===p?console.assert(!1,"line geometry is not supported"):"p"===p?console.assert(!1,"obj point geometry not supported"):null!==(q=k.exec(n))?(q=(" "+q[0].substr(1).trim()).substr(1),f.startObject(q)):m.test(n)||h.test(n)||l.test(n)||"s"!==p&&console.warn('OBJLoader: Unexpected line: "'+
n+'"')}}k=new Map;f=$jscomp.makeIterator(f.objects);for(h=f.next();!h.done;h=f.next())h=h.value,0!==h.vertices.length&&(m=new THREE.BufferGeometry,m.addAttribute("position",new WALK.BufferAttribute(new Float32Array(h.vertices),3)),0<h.normals.length&&m.addAttribute("normal",new WALK.BufferAttribute(new Float32Array(h.normals),3)),!0===h.hasUvs&&m.addAttribute("uv",new WALK.BufferAttribute(new Float32Array(h.uvs),2)),m.convertNormalsToSpherical(),m.computeBoundingBox(),m.computeBoundingSphere(),k.set(h.name,
m));return d(k)},e)}})();(function(){WALK.KTXLoader=function(){this._parser=WALK.KTXLoader.parse};WALK.KTXLoader.prototype=Object.create(WALK.CompressedTextureLoader.prototype);WALK.KTXLoader.parse=function(a){var b=[],c=new Int32Array(a,0,16);67305985===c[3]&&console.assert("Big endian machines not supported");console.assert(0===c[4]);console.assert(1===c[5]);console.assert(0===c[6]);if(35842===c[7]){console.assert(6408===c[8]);var d=GLC.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG}else 36196===c[7]?(console.assert(6407===c[8]),d=GLC.COMPRESSED_RGB_ETC1_WEBGL):
33776===c[7]?(console.assert(6407===c[8]),d=GLC.COMPRESSED_RGB_S3TC_DXT1_EXT):33779===c[7]?(console.assert(6408===c[8]),d=GLC.COMPRESSED_RGBA_S3TC_DXT5_EXT):console.error("Unknown KTX glInternalFormat: "+c[7]);var e=c[9],f=c[10];console.assert(0===(e&e-1));console.assert(0===(f&f-1));console.assert(0===c[11]);console.assert(0===c[12]);console.assert(1===c[13]);var g=c[14];c=c[15];console.assert(0===c%4);c=64+c;for(var k=new DataView(a,0),h=e,m=f,l=0;l<g;++l){var q=k.getUint32(c,!0);c+=4;var n=new Uint8Array(a,
c,q);b.push({data:n,width:h,height:m});c+=q+(3-(q+3)%4);h=Math.max(h/2,1);m=Math.max(m/2,1)}console.assert(c===a.byteLength);return{format:d,width:e,height:f,mipmapCount:g,mipmaps:b}}})();(function(){function a(f,g,k,h,m){f({wasmBinary:g}).then(function(l){function q(n,p,r){var x=0===Math.log2(p)%1&&0===Math.log2(r)%1;return h.dxtTextures?n?k.BC3:k.BC1:h.pvrtcTextures&&p===r&&x?n?k.PVRTC1_4_RGBA:k.PVRTC1_4_RGB:h.etc1Textures&&!n?k.ETC1:h.astcTextures?k.ASTC_4x4:k.RGBA32}l.initializeBasis();m(function(n){var p=new l.BasisFile(new self.Uint8Array(n));n=function(K){p.close();p.delete();throw K;};var r=p.getHasAlpha(),x=p.getNumImages(),w=p.getNumLevels(0),u=p.getImageWidth(0,0),A=p.getImageHeight(0,
0);0!==u&&0!==A&&0!==x&&0!==w||n("Invalid .basis file");1<x&&n("Missing multiple images handling");x=q(r,u,A);u=x.formatIdx;p.startTranscoding()||n("startTranscoding failed");A=[];for(var B=0;B<w;++B){var I=p.getImageWidth(0,B),F=p.getImageHeight(0,B),E=p.getImageTranscodedSizeInBytes(0,B,u);E=new self.Uint8Array(new self.ArrayBuffer(E));p.transcodeImage(E,0,B,u,0,r)||n(".transcodeImage failed");A.push({data:E,width:I,height:F})}p.close();p.delete();return{gpuFormat:x.gpuFormat,mipmaps:A}})})}function b(f,
g,k,h){var m=new window.Worker(f),l=null,q={processItem:function(r){console.assert(!l);l=r;m.postMessage(r.texBuffer,[r.texBuffer])},terminate:function(){console.assert(!l);m.terminate()}},n=function(r){throw"Worker error @L"+r.lineno+": "+r.message;};m.addEventListener("error",n);var p=function(){m.removeEventListener("error",n);m.removeEventListener("message",p);m.addEventListener("error",function(r){r="Worker error @L"+r.lineno+": "+r.message;l&&(l.onError(r),l=null)});m.addEventListener("message",
function(r){console.assert(l);l.onSuccess(r.data);l=null;h(q)});k();h(q)};m.addEventListener("message",p);m.postMessage(g)}function c(f,g,k,h){function m(){x.deferRun();0!==r.length&&(0<p.length?(p.pop().processItem(r.pop()),m()):n<h&&!q&&(n++,q=!0,b(l,k,function(){q=!1},function(w){p.push(w);m()})))}f="\nself.importScripts("+JSON.stringify(f)+");\nconst initBasis = "+a.toString()+";\nconst basisFormats = "+JSON.stringify(e)+";\nconst glDetector = "+JSON.stringify({astcTextures:g.gl.astcTextures,
dxtTextures:g.gl.dxtTextures,etc1Textures:g.gl.etc1Textures,pvrtcTextures:g.gl.pvrtcTextures})+";\n\nfunction initHandler(evt) {\n  self.removeEventListener('message', initHandler);\n\n  const wasmBinary = evt.data;\n  initBasis(BASIS, wasmBinary, basisFormats, glDetector,\n            decodeTexBuffer => {\n    self.addEventListener('message', function(evt) {\n        const texBuffer = evt.data;\n        const texDatas = decodeTexBuffer(texBuffer);\n        // second argument to transfer ownership to the main thread\n        self.postMessage(texDatas, texDatas.mipmaps.map(t => t.data.buffer));\n    });\n    self.postMessage({}); // communicate end of init\n  });\n}\n\nself.addEventListener('message', initHandler);\n";
var l=window.URL.createObjectURL(new window.Blob([f])),q=!1,n=0,p=[],r=[],x=new WALK.DeferringExecutorOnce(function(){for(var w=$jscomp.makeIterator(p),u=w.next();!u.done;u=w.next())u.value.terminate();n-=p.length;p.length=0},5E3);return function(w,u,A){r.push({texBuffer:w,onSuccess:u,onError:A});m()}}function d(f,g){WALK.ajaxGet(WALK.getViewerAssetUrl("lib/basis/basis_transcoder.wasm"),!0,function(k){var h=WALK.getViewerAssetUrl("lib/basis/basis_transcoder.js"),m=f.BASIS_DECODE_WORKERS;if(0>=m){var l=
window.document.createElement("script");l.addEventListener("load",function n(){l.removeEventListener("load",n);a(window.BASIS,k,e,f.gl,function(p){g(function(r,x,w){try{x(p(r))}catch(u){w(u)}})})});l.src=h;window.document.head.appendChild(l)}else g(c(h,f,k,m))},function(k){throw k;})}var e=function(){function f(g,k){return{formatIdx:g,gpuFormat:k}}return{ETC1:f(0,GLC.COMPRESSED_RGB_ETC1_WEBGL),BC1:f(2,GLC.COMPRESSED_RGB_S3TC_DXT1_EXT),BC3:f(3,GLC.COMPRESSED_RGBA_S3TC_DXT5_EXT),PVRTC1_4_RGB:f(8,GLC.COMPRESSED_RGB_PVRTC_4BPPV1_IMG),
PVRTC1_4_RGBA:f(9,GLC.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG),ASTC_4x4:f(10,GLC.COMPRESSED_RGBA_ASTC_4x4_KHR),RGBA32:f(13,GLC.RGBA)}}();WALK.createBasisLoader=function(f){function g(l){h=l;k.forEach(function(q){return h.apply(null,$jscomp.arrayFromIterable(q))});k.length=0}if(!window.WebAssembly||!(f.gl.pvrtcTextures||f.gl.etc1Textures||f.gl.dxtTextures||f.gl.astcTextures))return null;var k=[],h=function(l){for(var q=[],n=0;n<arguments.length;++n)q[n-0]=arguments[n];k.push(q)},m=!1;return{load:function(l,
q,n){var p=new WALK.CompressedTexture;m||(m=!0,d(f,g));l(function(r){h(r,function(x){p.format=x.gpuFormat;x=x.mipmaps;p.mipmaps=x;p.width=x[0].width;p.height=x[0].height;p.generateMipmaps=!1;p.minFilter=1===x.length?GLC.LINEAR:GLC.LINEAR_MIPMAP_LINEAR;p.flipY=!1;p.needsUpdate=!0;q(p)},n)},n);return p}}}})();(function(){function a(){var k={};this.cacheKey=function(h,m,l,q,n){return h+"@"+m+"@"+l+"@"+q+"@"+n};this.get=function(h){return k[h]};this.insert=function(h,m){k[h]=m}}function b(k,h){return function(m,l){WALK.queueAjaxGet(k,h,!0,m,l)}}function c(k,h,m){return function(l,q){b(k,h)(function(n){WALK.decrypt(n,m,l,q)},q)}}function d(k,h,m,l,q,n){function p(x){r.image=x;r.width=x.width;r.height=x.height;q(r)}var r=new WALK.Texture;r.format=m;m=g?function(x){createImageBitmap(x,{premultiplyAlpha:"none",
imageOrientation:r.flipY?"flipY":"none"}).then(p).catch(n)}:p;void 0!==l?c(k,h,l)(function(x){x=new Uint8Array(x);var w=h.endsWith("png")?"image/png":"image/jpeg";x=new Blob([x],{type:w});x=(window.URL||window.webkitURL).createObjectURL(x);var u=new Image;u.onload=function(){p(u)};u.src=x},n):WALK.queueImageGet(k,h,m,n);return r}function e(k,h,m,l,q,n){var p=new WALK.VideoTexture;p.format=m;WALK.queueVideoGet(k,h,function(r){p.video=r;p.width=r.videoWidth;p.height=r.videoHeight;THREE.Math.isPowerOfTwo(p.width)&&
THREE.Math.isPowerOfTwo(p.height)||(p.wrapS=GLC.CLAMP_TO_EDGE,p.wrapT=GLC.CLAMP_TO_EDGE);q(p);l&&p.pause()},n);return p}function f(k,h){!1===k.importGpuCompress&&(h.importGpuCompress=!1);!1===k.importAutoScale&&(h.importAutoScale=!1)}var g=!1;WALK.TextureLoader=function(k,h,m,l,q,n,p){function r(K){var M=K.id,Z=K.webFormats;console.assert(Z&&0<Z.length,"No web format for texture: "+K.id+"."+K.rawExt);if(K.video)return k+"video/"+Z[0]+"/"+M+"."+K.stdExt;var C=k+"img/",U=h.ios&&K.rgbm;if(E&&!U){if(!h.mobile&&
-1<Z.indexOf("large/basis"))return C+"large/basis/"+M+".basis";if(-1<Z.indexOf("small/basis"))return C+"small/basis/"+M+".basis"}if(h.gl.pvrtcTextures&&!U&&-1<Z.indexOf("small/pvr"))return C+"small/pvr/"+M+".ktx";if(h.gl.etc1Textures&&-1<Z.indexOf("small/etc1"))return C+"small/etc1/"+M+".ktx";if(h.gl.dxtTextures&&-1<Z.indexOf("large/dxt"))return C+"large/dxt/"+M+".ktx";U=-1<Z.indexOf("small/std");return!(-1<Z.indexOf("large/std"))||h.mobile&&U?C+"small/std/"+M+"."+K.stdExt:C+"large/std/"+M+"."+K.stdExt}
function x(K){--B.texturesToLoad;K.needsUpdate=!0;m(K);K.notifyLoaded()}function w(){--B.texturesToLoad;l()}function u(){--B.texturesToLoad;q()}function A(K,M,Z,C,U){var O=new WALK.DataTexture;WALK.queueAjaxGet(K,M,!0,function(W){W=new Uint8Array(W,0,W.byteLength);var aa=W[1];O.image.width=Math.pow(2,W[0]);O.image.height=Math.pow(2,aa);O.format=Z;O.type=GLC.UNSIGNED_BYTE;O.image.data=W.subarray(2);C&&C(O);O=null},U);return O}var B=this,I=new a,F=new WALK.KTXLoader,E=!WALK.urlHashContains("nobasis")&&
WALK.createBasisLoader(h);n&&(I.insert=function(){});this.texturesToLoad=0;this.clearCache=function(){I=null};this.load=function(K,M,Z,C,U){var O=M.alpha?GLC.RGBA:GLC.RGB,W=r(M),aa=/\.basis$/.test(W),R=/\.ktx$/.test(W),S=/\.buf$/.test(W),fa=M.video,X=!(R||S||fa),qa=M.passphrase,na=I.cacheKey(W,Z,C,U,O),xa=I.get(na);if(xa)return f(M,xa),xa;B.texturesToLoad+=1;S?xa=A(K,W,O,x,w):aa?(K=void 0===qa?b(K,W):c(K,W,qa),xa=E.load(K,x,w)):R?xa=F.load(K,W,x,w):X?xa=d(K,W,O,qa,x,w):(console.assert(fa),xa=e(WALK.LOAD_PRIORITY.VIDEO,
W,O,p,x,u));xa.hasAlpha=!!M.alpha;xa.isRgbm=!!M.rgbm;Z&&(xa.wrapS=GLC.REPEAT,xa.wrapT=GLC.REPEAT);C&&!fa?(xa.minFilter=GLC.LINEAR_MIPMAP_LINEAR,xa.generateMipmaps=!R):(xa.minFilter=GLC.LINEAR,xa.generateMipmaps=!1);U&&(xa.anisotropy=U);I.insert(na,xa);xa.id=M.id;xa.name=M.name;xa.webFormats=M.webFormats;f(M,xa);M.rawExt&&(xa.rawExt=M.rawExt);xa.stdExt=M.stdExt;return xa}}})();(function(){function a(e,f,g){for(var k=0;k<f.length;k+=1){var h=f[k],m=e[h];void 0!==m&&(g["_"+h]=m)}}var b="doubleSided name opacity parallaxCorrection parallaxMode parallaxScale parallaxMinLayers parallaxMaxLayers planarReflector".split(" "),c="bumpScale emissive emissionStrength envMapProject metallic roughness alphaInLowerHalf chromaKeyEnabled".split(" "),d="baseColor bumpScale bumpTexture doubleSided emissive metallic opacity roughness".split(" ");WALK.MaterialLoader=function(e,f,g){var k=WALK.DETECTOR;
this.load=function(h,m){for(var l=new Map,q=0,n=0;n<h.length;n+=1){var p;var r=h[n];var x=WALK.createMaterialOfType(r.type);if("water"===x.type)x.name=r.name,r.normalTexture&&(x.normalTexture=e.load(WALK.LOAD_PRIORITY.SPECULARITY,r.normalTexture,!0,!1,WALK.DEFAULT_ANISOTROPY)),r.baseColor&&x.baseColor.fromArray(r.baseColor),void 0!==r.opacity&&(x.opacity=r.opacity),a(r,["wavesSpeed","wavesScale","refractionFactor"],x),x.setUniforms();else{WALK.copyProperties(r,b,x);a(r,c,x);r.baseColor&&(x.baseColor.fromArray(r.baseColor),
x.baseColor.roundChannels());if(p=r.baseColorTextureCorrection)x._baseColorTextureCorrection=!0,void 0!==p.contrast&&(x._baseColorTextureContrast=p.contrast),x.baseColorTextureHslOffset.h=p.hslOffset[0],x.baseColorTextureHslOffset.s=p.hslOffset[1],x.baseColorTextureHslOffset.l=p.hslOffset[2];if(p=r.baseColorTexture){if(p.atlasId){var w=f[p.atlasId].getAtlasEntry(p.id,p.name,p.atlasOffset[0],p.atlasOffset[1],p.atlasScale[0],p.atlasScale[1]);null!==w.rawExt&&w.rawExt!==p.rawExt&&console.warn("Atlas entries with not matching rawExt "+
p.name);w.rawExt=p.rawExt;null!==w.stdExt&&w.stdExt!==p.stdExt&&console.warn("Atlas entries with not matching stdExt "+p.name);w.stdExt=p.stdExt;!1===p.importGpuCompress&&(w.importGpuCompress=!1);!1===p.importAutoScale&&(w.importAutoScale=!1);p=w}else p=e.load(WALK.LOAD_PRIORITY.DIFFUSE,p,!0,!0,WALK.DEFAULT_ANISOTROPY);p.isCutout=null;x.baseColorTexture=p}r.roughnessTexture&&(x.roughnessTexture=e.load(WALK.LOAD_PRIORITY.SPECULARITY,r.roughnessTexture,!0,!0,WALK.DEFAULT_ANISOTROPY));r.metallicTexture&&
(x.metallicTexture=e.load(WALK.LOAD_PRIORITY.SPECULARITY,r.metallicTexture,!0,!0,WALK.DEFAULT_ANISOTROPY));r.bumpTexture&&k.gl.standardDerivatives&&(x.bumpTexture=e.load(WALK.LOAD_PRIORITY.SPECULARITY,r.bumpTexture,!0,!0,WALK.DEFAULT_ANISOTROPY));r.doNotImport&&WALK.copyProperties(r.doNotImport,d,x.doNotImport);r.chromaKeyColor&&(x.chromaKeyColor.fromArray(r.chromaKeyColor),x.chromaKeyColor.roundChannels());r.chromaKeyDelta&&x._chromaKeyDelta.fromArray(r.chromaKeyDelta)}r=x;if(!g.isMaterialEditable(r.name)){x=
r.hash();p=l.get(x)||[];w=$jscomp.makeIterator(p);for(var u=w.next();!u.done;u=w.next())if(u=u.value,u.canMerge(r)){q+=1;u.merged=!0;r=u;break}r.merged||(p.push(r),l.set(x,p))}m.addMaterial(r);r.merged||r.setUniforms()}WALK.log("Have "+h.length+" materials and "+(h.length-q)+" merged materials.")}}})();(function(){WALK.SkyLoader=function(a){function b(d,e,f){var g=new THREE.SphereBufferGeometry(1,64,64);return new WALK.SkyMesh(d,g,e,f)}function c(d){var e=new WALK.ProceduralSkyMaterial;return b(d.name,e,d.center)}this.loadSkyTexture=function(d,e){d.material.map&&d.material.map.dispose();d.material.map=a.load(WALK.LOAD_PRIORITY.SKY,e,!1,!1,WALK.NO_ANISOTROPY);d.yawRotationDeg=0};this.loadSingleSky=function(d,e){if("procedural"===d.type||void 0===d.type)d=c(d);else if("equirect"===d.type){var f=new WALK.EquirectSkyMaterial;
f.map=a.load(WALK.LOAD_PRIORITY.SKY,d.texture,!1,!1,WALK.NO_ANISOTROPY);f=b(d.name,f,d.center);f.geometry.applyMatrix((new THREE.Matrix4).makeScale(1,1,-1));f.rotation.x=Math.PI/2;f.yawRotationDeg=d.yawRotation||0;d=f}else console.warn("Unknown sky type: ",d.type),d=c(d);e.addSkyMesh(d)};this.load=function(d,e){this.loadSingleSky({name:WALK.DEFAULT_SKY_NAME,type:"procedural"},e);for(var f=0;f<d.length;f+=1)this.loadSingleSky(d[f],e)}}})();(function(){WALK.LightmapLoader=function(a,b,c){function d(){--f;if(0===f)e.onComplete()}var e=this,f=b;this.lightmaps=[];this.onComplete=null;this.load=function(){var g;if(g=WALK.DETECTOR.webp)g=void 0!==c&&void 0!==c.formats?0<=c.formats.indexOf("webp"):!1;g={id:null,name:null,stdExt:g?"webp":"png",webFormats:["large/std"],alpha:!0,rgbm:!0};for(var k=0;k<b;k+=1){g.id=g.name="lightmap-rgbm"+k;var h=a.load(WALK.LOAD_PRIORITY.LIGHTMAP,g,!1,!1,WALK.NO_ANISOTROPY);h.addLoadedListener(d);this.lightmaps.push(h)}}}})();(function(){WALK.TextureAtlasLoader=function(a){this.atlases={};this.load=function(b){for(var c=0;c<b.length;++c){var d=a.load(WALK.LOAD_PRIORITY.DIFFUSE,b[c],!1,!0,WALK.DEFAULT_ANISOTROPY);d.flipY=!1;d.enableAtlas();this.atlases[b[c].id]=d}}}})();(function(){WALK.BufferLoader=function(a,b){var c={};this.onHaveBuffer=this.onFailure=this.onProgress=null;this._buffersDone={};this.buffers={meshes:null,transforms:null,bounds:null,faces16:null,faces:null,vertices:null,normals:null,uvs0:null,uvs1:null};this.haveAllBuffers=function(){for(var d in this.buffers)if(this.buffers.hasOwnProperty(d)&&null===this.buffers[d])return!1;return!0};this.haveCoreBuffers=function(){var d=this.buffers;return d.faces16&&d.faces&&d.vertices&&d.normals&&d.transforms};
this.releaseCoreBuffers=function(){var d=this.buffers;d.faces16=d.faces=d.vertices=d.normals=null};this.load=function(){function d(h){return function(m){f.buffers[h]=m;f.onHaveBuffer()}}function e(h){return function(m){c[h]=m.loaded;f.onProgress()}}var f=this,g=WALK.LOAD_PRIORITY.CORE_RESOURCE,k={meshes:g,transforms:g,bounds:g,faces16:g,faces:g,vertices:g,normals:g,uvs0:b?g:WALK.LOAD_PRIORITY.UV0,uvs1:b?g:WALK.LOAD_PRIORITY.LIGHTMAP};(function(){for(var h in f.buffers)if(f.buffers.hasOwnProperty(h)){var m=
k[h];console.assert(void 0!==m);WALK.queueAjaxGet(m,a+h+".buf",!0,d(h),f.onFailure,e(h),!0)}})()};this.totalDone=function(){var d=0,e;for(e in c)c.hasOwnProperty(e)&&(d+=c[e]);return d}}})();(function(){function a(c,d,e){var f=new Int32Array(c);c=new Float32Array(c);var g=new Float32Array(d),k={},h=f[0],m=f[1],l=2;for(d=0;l<f.length;){var q={nodeId:f[l],materialIdx:f[l+1],useFaces16:1===f[l+2],faceByteOffset:f[l+3],faceCnt:f[l+4],vertexByteOffset:f[l+5],vertexCnt:f[l+6],normalByteOffset:f[l+7],uv0ByteOffset:f[l+8],uv1ByteOffset:f[l+9],lightMapIdx:f[l+10],uv1CoordUScale:c[l+11],uv1CoordVScale:c[l+12],uv1CoordUOffset:f[l+13],uv1CoordVOffset:f[l+14],transformByteOffset:f[l+15],boundsByteOffset:f[l+
16],quantVertexRange:c[l+17],quantVertexMax:f[l+18],quantUv0Range:c[l+19],quantUv0Max:f[l+20],autoLightmapResolution:2<=h?f[l+21]:-1,useInstances:!1,hasCopies:!1,isMasterCopy:!1};q.boundingBox=new THREE.Box3;q.boundingSphere=new THREE.Sphere;a:{for(var n=q.boundingBox,p=q.boundingSphere,r=q.boundsByteOffset/4,x=0;6>x;++x)if(!isFinite(g[r+x]))break a;n.max.x=g[r];n.max.y=g[r+1];n.max.z=g[r+2];n.min.x=g[r+3];n.min.y=g[r+4];n.min.z=g[r+5];n.center(p.center);p.radius=g[r+6]}d=Math.max(d,q.lightMapIdx+
1);WALK.DETECTOR.gl.instances&&(n=q.vertexByteOffset,k.hasOwnProperty(n)?(n=k[n],p=n[0],p.isMasterCopy=!0,p.hasCopies=!0,q.hasCopies=!0,n.push(q)):k[n]=[q]);e.push(q);l+=m}e=$jscomp.makeIterator(Object.values(k));for(f=e.next();!f.done;f=e.next())if(f=f.value,c=f.length,1<c&&500<c*f[0].faceCnt)for(f=$jscomp.makeIterator(f),c=f.next();!c.done;c=f.next())c.value.useInstances=!0;return d}var b=function(c,d,e,f,g){this.meshPropsSet=new Set;this.meshPropsSet.add(c);this.material=d;this.lightMap=e;this.lightProbe=
f;this.hideInViews=g;this.anyLogicalMeshHasUvs=-1!==c.uv0ByteOffset;this.sharedGeometryId=c.useInstances?c.vertexByteOffset:null};b.prototype.canUseLightMap=function(c){return null===this.lightMap||null===c||this.lightMap===c};WALK.MeshMaker=function(c,d,e,f){function g(p){var r=[],x=new Map;h.forEach(function(w){var u=c.findNode(w.nodeId),A=c.materials[w.materialIdx],B=null;null!==u.initialLightProbeId&&(B=c.findLightProbe(u.initialLightProbeId));var I=null;-1!==w.lightMapIdx&&(I=p[w.lightMapIdx]);
var F=u.hideInViews||[];if(u.editable||1!==A.opacity)r.push(new b(w,A,I,B,F));else{var E=w.useInstances?w.vertexByteOffset:null;u=x.get(A)||[];for(var K=$jscomp.makeIterator(u),M=K.next();!M.done;M=K.next()){M=M.value;var Z;if(Z=M.lightProbe===B&&M.canUseLightMap(I)&&M.sharedGeometryId===E)a:if(Z=M.hideInViews,Z.length!==F.length)Z=!1;else{for(var C=0;C<Z.length;C+=1)if(Z[C]!==F[C]){Z=!1;break a}Z=!0}if(Z){null!==I&&(M.lightMap=I);M.anyLogicalMeshHasUvs=M.anyLogicalMeshHasUvs||-1!==w.uv0ByteOffset;
M.meshPropsSet.add(w);return}}w=new b(w,A,I,B,F);u.push(w);x.set(A,u);r.push(w)}});return r}var k=this,h=[],m=d.byteLength,l=0,q=0,n=0;this.mergedMeshes=[];this.lightmapCount=this.geometryDownloadSize=this.coreGeometryDownloadSize=0;this.createMeshes=function(p){var r=p?p[0]:null,x=g(p);p={};x=$jscomp.makeIterator(x);for(var w=x.next();!w.done;w=x.next()){var u=w.value;w=u.sharedGeometryId;if(null!==w){var A=p[w],B=!1;A||(A=new WALK.Geometry,B=!0,p[w]=A);w=new WALK.InstancedGeometry(A,B)}else w=new WALK.Geometry;
A=new WALK.MergedMesh(w,u.material);A.lightProbe=u.lightProbe;A.lightMap=u.lightMap||r;A.hideInViews=u.hideInViews;A.anyLogicalMeshHasUvs=u.anyLogicalMeshHasUvs;this.mergedMeshes.push(A);u=$jscomp.makeIterator(u.meshPropsSet);for(B=u.next();!B.done;B=u.next()){B=B.value;var I,F=w;if(f){var E=3*B.faceCnt;var K=B.vertexCnt}else E=0,K=3*B.faceCnt;if(F.isInstanced)var M=I=0;else I=F.indexCnt,M=F.vertexCnt;M=new WALK.SubGeometry(E,K,F,I,M,B.boundingBox,B.boundingSphere);F.boundingBox.union(B.boundingBox);
WALK.Math.spheresUnion(B.boundingSphere,F.boundingSphere);F.isInstanced?(M.instanceId=F.instanceCount,F.instanceCount+=1,F.indexCnt=E,F.vertexCnt=K):(F.indexCnt+=E,F.vertexCnt+=K);E=M;K=c.findNode(B.nodeId);E=new WALK.Mesh(K,E,A.material);E.lightMap=A.lightMap;E.lightProbe=A.lightProbe;E.autoLightmapResolution=B.autoLightmapResolution;E.useFaces16=B.useFaces16;E.faceByteOffset=B.faceByteOffset;E.faceCnt=B.faceCnt;E.vertexByteOffset=B.vertexByteOffset;E.vertexCnt=B.vertexCnt;E.normalByteOffset=B.normalByteOffset;
E.uv0ByteOffset=B.uv0ByteOffset;E.uv1ByteOffset=B.uv1ByteOffset;E.lightMapIdx=B.lightMapIdx;E.uv1CoordUScale=B.uv1CoordUScale;E.uv1CoordVScale=B.uv1CoordVScale;E.uv1CoordUOffset=B.uv1CoordUOffset;E.uv1CoordVOffset=B.uv1CoordVOffset;E.transformByteOffset=B.transformByteOffset;E.quantVertexRange=B.quantVertexRange;E.quantVertexMax=B.quantVertexMax;E.quantUv0Range=B.quantUv0Range;E.quantUv0Max=B.quantUv0Max;B.hasCopies&&(E.sharedBuffersDebug=B.isMasterCopy?1:2);l+=1;A.addLogicalMesh(E);K.mesh=E}}WALK.log("Have "+
l+" meshes and "+this.mergedMeshes.length+" merged meshes.")};this.lightmapCount=a(d,e,h);d=e=null;(function(){for(var p=0,r=0,x=0,w=0,u=0,A=0,B=0,I=$jscomp.makeIterator(h),F=I.next();!F.done;F=I.next()){F=F.value;var E=F.vertexCnt;q+=E;n+=F.faceCnt;p=Math.max(p,F.faceByteOffset+3*F.faceCnt*(F.useFaces16?2:4));r=Math.max(r,F.vertexByteOffset+3*E*WALK.Math.minBytesToHold(F.quantVertexMax)+3&-4);x=Math.max(x,F.normalByteOffset+2*E);w=Math.max(w,F.transformByteOffset+64);u=Math.max(u,F.boundsByteOffset+
28);-1!==F.uv0ByteOffset&&(A=Math.max(A,F.uv0ByteOffset+2*E*WALK.Math.minBytesToHold(F.quantVertexMax)+3&-4));-1!==F.uv1ByteOffset&&(B=Math.max(B,F.uv1ByteOffset+4*E))}k.coreGeometryDownloadSize=m+p+r+x+w+u;k.geometryDownloadSize+=k.coreGeometryDownloadSize+A+B})();WALK.log("Have "+q+" vertices, "+n+" faces and "+this.lightmapCount+" lightmaps.")}})();(function(){function a(r,x,w,u,A,B,I){var F=0;for(w*=3;F<w;F+=3){var E=r[F+x]*A,K=r[F+x+1]*A,M=r[F+x+2]*A;B[I+F]=u[0]*E+u[1]*K+u[2]*M+u[3];B[I+F+1]=u[4]*E+u[5]*K+u[6]*M+u[7];B[I+F+2]=u[8]*E+u[9]*K+u[10]*M+u[11]}}function b(r,x,w,u,A,B){var I=0;for(w*=2;I<w;I+=2){var F=(r[I+x]/254+.5)*Math.PI,E=Math.PI/127*r[I+x+1],K=Math.sin(F),M=K*Math.cos(E);E=K*Math.sin(E);F=Math.cos(F);K=u[0]*M+u[1]*E+u[2]*F;var Z=u[4]*M+u[5]*E+u[6]*F;F=2*(Math.acos(u[8]*M+u[9]*E+u[10]*F)/Math.PI-.5);E=Math.atan2(Z,K)/Math.PI;
A[B+I]=WALK.Math.toSnorm8(F);A[B+I+1]=WALK.Math.toSnorm8(E)}}function c(r){return 0!==r.instanceId||!1===r.parent.ownsGpuBuffers}function d(r,x,w,u,A,B){var I=!1,F=0;for(w*=2;F<w;F+=1){var E=r[F+x]*u;A[B+F]=E;if(0>E||1<E)I=!0}return I}function e(r,x,w,u,A){var B=!1,I=0;for(w*=2;I<w;I+=1){var F=r[I+x];u[A+I]=F;if(0>F||1<F)B=!0}return B}function f(r,x,w,u,A,B,I,F,E){var K=0;for(w*=2;K<w;K+=2){var M=r[K+x],Z=r[K+x+1];0!==M||0!==Z?(F[E+K]=Math.round(M*u)+B,F[E+K+1]=Math.round(Z*A)+I):(F[E+K]=0,F[E+K+
1]=0)}}function g(r,x,w,u,A){function B(){for(;F<r.length;){var K=r[F];if(0!==E||x(K)){for(;E<K.logicalMeshes.length;){var M=K.logicalMeshes[E];w(M);E+=1;if(I.shouldInterrupt(M.vertexCnt)){setTimeout(B,0);return}}u(K);F+=1;E=0}else F+=1}A()}var I=new p(5E4),F=0,E=0;B()}function k(r,x){x.geometry.allocateCoreBuffers(r);return!0}function h(r,x){r?r=x.anyLogicalMeshHasUvs:(r=x.material,r=x.anyLogicalMeshHasUvs&&(r.baseColorTexture||r.bumpTexture||r.roughnessTexture||r.metallicTexture));return r?(x.geometry.allocateUv0(),
!0):!1}function m(r){return r.lightMap?(r.geometry.allocateUv1(),!0):!1}function l(r,x,w,u,A){var B=4*A.instanceId;A=A.parent.uvs1Mod;A[B]=w/65535;A[B+1]=u/65535;A[B+2]=r/65535;A[B+3]=x/65535}function q(r,x){var w=x.parent;x=4*x.instanceId;var u=w.transforms0;u[x]=r[0];u[x+1]=r[1];u[x+2]=r[2];u[x+3]=r[3];u=w.transforms1;u[x]=r[4];u[x+1]=r[5];u[x+2]=r[6];u[x+3]=r[7];w=w.transforms2;w[x]=r[8];w[x+1]=r[9];w[x+2]=r[10];w[x+3]=r[11]}var n=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0]),p=function(r){this.minVerticesUntilTimeCall=
r;this.verticesCount=0;this.timer=new WALK.Timer};p.prototype.shouldInterrupt=function(r){this.verticesCount+=r;return this.verticesCount>this.minVerticesUntilTimeCall&&10<this.timer.elapsedMSec()?(this.verticesCount=0,this.timer.reset(),!0):!1};WALK.asyncFillIndexedUv0=function(r,x,w,u,A){var B=new Uint16Array(r),I=new Float32Array(r);g(x,h.bind(null,w),function(F){if(F.uv0InBuffers()){var E=F.geometry;if(!c(E)){var K=E.vertexOffset;E=E.parent;if(F.quantUv0Disabled()?e(I,F.uv0ByteOffset/4,F.vertexCnt,
E.uvs0,2*K):d(B,F.uv0ByteOffset/2,F.vertexCnt,F.quantUv0Factor(),E.uvs0,2*K))E.isUvs0Repeating=!0}}},u,A)};WALK.asyncFillIndexedUv1=function(r,x,w,u){var A=new Uint16Array(r);g(x,m,function(B){if(B.uv1InBuffers()){var I=B.uv1CoordUScale,F=B.uv1CoordVScale,E=B.uv1CoordUOffset,K=B.uv1CoordVOffset,M=B.geometry;if(M.isInstanced){l(I,F,E,K,M);if(c(M))return;I=F=1;E=K=0}f(A,B.uv1ByteOffset/2,B.vertexCnt,I,F,E,K,M.parent.uvs1,2*M.vertexOffset)}},w,u)};WALK.asyncFillIndexedCoreGeometry=function(r,x,w,u){var A=
r.faces16?new Uint16Array(r.faces16):null,B=r.faces?new Uint32Array(r.faces):null,I=new Int8Array(r.vertices),F=new Int16Array(r.vertices),E=new Int32Array(r.vertices),K=new Int8Array(r.normals);g(x,k.bind(null,!0),function(M){var Z=M.geometry,C=Z.parent,U=new Float32Array(r.transforms,M.transformByteOffset,16);if(Z.isInstanced){q(U,Z);if(c(Z))return;U=n}switch(WALK.Math.minBytesToHold(M.quantVertexMax)){case 1:var O=I;var W=M.vertexByteOffset;break;case 2:O=F;W=M.vertexByteOffset/2;break;case 4:O=
E,W=M.vertexByteOffset/4}var aa=Z.vertexOffset;a(O,W,M.vertexCnt,U,M.quantVertexFactor(),C.vertices,3*aa);b(K,M.normalByteOffset,M.vertexCnt,U,C.normals,2*aa);C=C.index;Z=Z.indexOffset;M.useFaces16?(W=M.faceByteOffset/2,U=A):(W=M.faceByteOffset/4,U=B);O=W;for(M=W+3*M.faceCnt;O<M;O+=1,Z+=1)C[Z]=U[O]+aa},w,u)};WALK.asyncFillNotIndexedGeometry=function(r,x,w,u,A){var B=r.faces16?new Uint16Array(r.faces16):null,I=r.faces?new Uint32Array(r.faces):null,F=new Int8Array(r.vertices),E=new Int16Array(r.vertices),
K=new Int32Array(r.vertices),M=new Int8Array(r.normals),Z=new Uint16Array(r.uvs0),C=new Float32Array(r.uvs0),U=r.uvs1?new Uint16Array(r.uvs1):null;g(x,function(O){k(!1,O);h(w,O);m(O);return!0},function(O){var W=O.geometry,aa=O.geometry.parent,R=new Float32Array(r.transforms,O.transformByteOffset,16);if(O.uv0InBuffers()&&aa.uvs0)var S=aa.uvs0;if(O.uv1InBuffers()&&aa.uvs1){var fa=aa.uvs1;var X=O.uv1CoordUScale;var qa=O.uv1CoordVScale;var na=O.uv1CoordUOffset;var xa=O.uv1CoordVOffset}if(W.isInstanced){q(R,
W);fa&&l(X,qa,na,xa,W);if(c(W))return;R=n;X=qa=1;na=xa=0}if(O.useFaces16){W=B;var wa=O.faceByteOffset/2}else W=I,wa=O.faceByteOffset/4;switch(WALK.Math.minBytesToHold(O.quantVertexMax)){case 1:var ta=F;var sa=O.vertexByteOffset;break;case 2:ta=E;sa=O.vertexByteOffset/2;break;case 4:ta=K,sa=O.vertexByteOffset/4}var Da=O.quantUv0Disabled();if(Da)var Q=O.uv0ByteOffset/4;else{var J=O.quantUv0Factor();Q=O.uv0ByteOffset/2}var N=3*O.geometry.vertexOffset,V=2*O.geometry.vertexOffset,ra=O.quantVertexFactor(),
ka=aa.vertices,za=aa.normals,Ea=O.normalByteOffset,pa=O.uv1ByteOffset/2,ha=wa;for(O=wa+3*O.faceCnt;ha<O;ha+=1,N+=3,V+=2){wa=W[ha];a(ta,sa+3*wa,1,R,ra,ka,N);b(M,Ea+2*wa,1,R,za,V);if(S){var ja=Q+2*wa;if(Da?e(C,ja,1,S,V):d(Z,ja,1,J,S,V))aa.isUvs0Repeating=!0}fa&&f(U,pa+2*wa,1,X,qa,na,xa,fa,V)}},u,A)}})();(function(){function a(h,m){h.forEach(function(l){m.addView(new WALK.View(l))})}function b(h){if(0!==h.length&&h[0].position)return h[0].position[2]}function c(h,m,l){h.forEach(function(q){l.isNodeTypeEditable(q.name)&&(q.editable=!0);m.addNodeConfig(new WALK.NodeConfig(q))})}function d(h,m){h.forEach(function(l){var q=new WALK.Light(l);l=l.instances;for(var n=0;n<l.length;n+=1){var p=l[n];q.addInstance(p.position,p.rotation)}m.addLight(q)})}function e(h,m){h.forEach(function(l){m.addLightProbe(new WALK.LightProbe(l))})}
function f(h,m,l){l=l.camera;h&&(h.fov&&(l.defaultFov=h.fov),h.exposure&&(l.defaultExposure=h.exposure),h.gamma&&(l.defaultGamma=h.gamma),h.lutTexture&&(m=m.load(WALK.LOAD_PRIORITY.COLORMAP,h.lutTexture,!1,!1,WALK.NO_ANISOTROPY),m.flipY=!1,l.colorMap=m),l.autoClimb=!!h.autoClimb,l.autoExposure=!!h.autoExposure,void 0!==h.autoExposureDarkness&&(l.autoExposureDarkness=h.autoExposureDarkness),h.moveMaxSpeed&&(l.moveMaxSpeed=h.moveMaxSpeed),l.updateProjectionMatrix())}function g(h,m){function l(q,n){var p=
m.findNodeConfig(n.config),r=new WALK.Node(q,p,n);void 0!==n.children&&(r.children=n.children.map(function(x){return l(r,x)}));return r}h.forEach(function(q){m.addNode(l(null,q))})}function k(){var h=null;WALK.DETECTOR.whatsApp?h="WhatsApp":WALK.DETECTOR.facebookApp&&(h="Facebook app");null===h?WALK.USER_MSG.error("Scene failed to load. Reload the page to retry."):WALK.USER_MSG.error("Scene failed to load. Open the scene outside of "+h+' by copying the link to the native web browser: <div class="message-scrollable-line"><a href="'+
(window.location+'" taget="_blank">'+window.location+"</a></div>"))}WALK.SceneLoader=function(h,m,l,q){var n=!l&&WALK.DETECTOR.gl.indexUint,p=!l&&!WALK.DEBUG_SHARED_BUFFERS,r=new WALK.Timer;this.onComplete=this.onReadyToDisplay=this.onTextureLoaded=this.onMeshBuffersLoaded=this.onProgress=null;this.panoramas=[];this.load=function(){function x(){if(void 0!==Da.total)aa.onProgress(Da)}function w(){qa||(qa=!0,aa.onReadyToDisplay(h))}function u(J){0===J.name.indexOf("lightmap-rgbm")?Da.texturesDone+=
12582912:Da.texturesDone+=524288;x();aa.onTextureLoaded(J);Q()}function A(){console.warn("Failed to load video texture");Q()}function B(){if(0===R.texturesToLoad&&xa){R.clearCache();for(var J=0,N=$jscomp.makeIterator(fa.mergedMeshes),V=N.next();!V.done;V=N.next())J+=V.value.geometry.gpuSize;WALK.log("Total GPU geometry buffers size "+J+" bytes");R=S=fa=null;WALK.defer(function(){w();aa.onComplete(h)})}}function I(){wa&&na&&X&&(Q=B,sa&&h.materials.forEach(function(J){J.lightMapped||(J.lightMapped=
!0,J.setUniforms())}),Q())}function F(J){J.geometry.addUv1Attribute();aa.onMeshBuffersLoaded(J)}function E(){S.buffers.uvs1&&(Q=I,WALK.asyncFillIndexedUv1(S.buffers.uvs1,fa.mergedMeshes,F,function(){S.buffers.uvs1=null;wa=!0;Q()}))}function K(J){J.geometry.addUv0Attribute();aa.onMeshBuffersLoaded(J)}function M(){S.buffers.uvs0&&(Q=E,WALK.asyncFillIndexedUv0(S.buffers.uvs0,fa.mergedMeshes,l,K,function(){S.buffers.uvs0=null;xa=!0;Q()}))}function Z(){X=!0;0===h.views.length&&h.addView(new WALK.View({id:0,
name:"Start place",hideFromMenu:!0,position:h.center.toArray(),rotation:[0,0],internal:!0,sky:WALK.EDITOR_CONTROLLED_SKY_NAME}));if(!l&&!h.disableProgressiveLoader){var J=1E3*WALK.PROGRESSIVE_LOADER_AFTER_SEC-r.elapsedMSec();0>=J?w():setTimeout(w,J)}Q()}function C(J){h.addGpuMesh(J)}function U(J){J.geometry.addCoreAttributes();var N=J.logicalMeshes;console.assert(!N[0].node.editable||1===N.length);N[0].node.editable||!p?N.forEach(C):C(J);aa.onMeshBuffersLoaded(J)}function O(J){J.geometry.uvs0&&J.geometry.addUv0Attribute();
J.geometry.uvs1&&J.geometry.addUv1Attribute();U(J)}function W(){if(n){if(!S.haveCoreBuffers())return;WALK.log("Using indexed geometry");Q=M;WALK.asyncFillIndexedCoreGeometry(S.buffers,fa.mergedMeshes,U,Z)}else{if(!S.haveAllBuffers())return;Q=I;WALK.asyncFillNotIndexedGeometry(S.buffers,fa.mergedMeshes,l,O,function(){wa=xa=!0;Z()})}S&&S.releaseCoreBuffers()}var aa=this,R=null,S=null,fa=null,X=!1,qa=!1,na=!1,xa=!1,wa=!1,ta=null,sa=!1,Da={total:void 0,texturesDone:0,totalDone:function(){return this.texturesDone+
S.totalDone()}};r.reset();var Q=function(){if(ta&&S.buffers.meshes&&S.buffers.bounds){Q=W;void 0!==ta.autoAddLightProbes&&(h.autoAddLightProbes=ta.autoAddLightProbes);h.disableProgressiveLoader=ta.disableProgressiveLoader||!1;void 0!==ta.autoTour&&(h.autoTour.disabled=ta.autoTour.disabled||!1,h.autoTour.startOnLoad=ta.autoTour.startOnLoad||!1);d(ta.lights,h);e(ta.lightProbes||[],h);ta.cameraVolumes&&ta.cameraVolumes.forEach(function(V){return h.addCameraVolume(new WALK.CameraVolume(V))});R=new WALK.TextureLoader(m,
WALK.DETECTOR,u,k,A,!1,!0);f(ta.camera,R,h);var J=new WALK.TextureAtlasLoader(R);J.load(ta.atlases||[]);(new WALK.MaterialLoader(R,J.atlases,q)).load(ta.materials||[],h);(new WALK.SkyLoader(R)).load(ta.skies||[],h);null===h.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME)&&console.error("A sky with name "+WALK.EDITOR_CONTROLLED_SKY_NAME+" is missing.");a(ta.views||[],h);ta.hideViewsMenu&&(h.hideViewsMenu=!0);c(ta.nodeConfigs,h,q);g(ta.nodes,h);fa=new WALK.MeshMaker(h,S.buffers.meshes,S.buffers.bounds,
n);J=null;if(0!==fa.lightmapCount){sa=!0;var N=new WALK.LightmapLoader(R,fa.lightmapCount,ta.lightmap);N.onComplete=function(){na=!0;Q()};N.load();J=N.lightmaps;N=null}else na=!0;fa.createMeshes(J);Da.total=fa.geometryDownloadSize+524288*(R.texturesToLoad-fa.lightmapCount)+12582912*fa.lightmapCount;ta.panoramas&&(aa.panoramas=ta.panoramas);h.minimapConfig=new WALK.MinimapConfig(ta.minimap,h.boundingBox,b(ta.views||[]));ta=null;Q()}};WALK.queueAjaxGet(WALK.LOAD_PRIORITY.CORE_RESOURCE,m+"scene.json",
!1,function(J){ta=J;Q()},k);S=new WALK.BufferLoader(m,!n);S.onProgress=x;S.onFailure=k;S.onHaveBuffer=function(){Q()};S.load()};this.elapsedLoadTimeSec=function(){return r.elapsedSec()}}})();(function(){var a=!1;WALK.decrypt=function(b,c,d,e){function f(){a=!0;var g=CryptoJS.lib.WordArray.create(b),k=g.clone();k.sigBytes=16;k.clamp();g.words.splice(0,4);g.sigBytes-=16;var h=CryptoJS.enc.Base64.parse(c);k=CryptoJS.AES.decrypt({ciphertext:g},h,{iv:k,mode:CryptoJS.mode.CFB});g=k.sigBytes;k=k.words;h=new Uint8Array(g);for(var m=0,l=0;m!==g;){var q=k[l++];h[m++]=(q&4278190080)>>>24;if(m===g)break;h[m++]=(q&16711680)>>>16;if(m===g)break;h[m++]=(q&65280)>>>8;if(m===g)break;h[m++]=q&255}d(h.buffer)}
a?f():WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/crypto-js.min.js"),f,function(){return WALK.USER_MSG.error("Cannot load required library")})}})();(function(){function a(c,d,e,f){for(var g=[],k=0;6>k;k+=1){var h=f?new THREE.OrthographicCamera(-1,1,1,-1,c,d):new THREE.PerspectiveCamera(90,1,c,d);e.add(h);g.push(h)}g[0].up.set(0,-1,0);b.set(1,0,0);g[0].lookAt(b);g[1].up.set(0,-1,0);b.set(-1,0,0);g[1].lookAt(b);g[2].up.set(0,0,1);b.set(0,1,0);g[2].lookAt(b);g[3].up.set(0,0,-1);b.set(0,-1,0);g[3].lookAt(b);g[4].up.set(0,-1,0);b.set(0,0,1);g[4].lookAt(b);g[5].up.set(0,-1,0);b.set(0,0,-1);g[5].lookAt(b);return g}var b=new THREE.Vector3;WALK.CubeCamera=
function(c,d){THREE.Object3D.call(this);this.sideCameras=a(c,d,this,!1)};WALK.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);WALK.CubeCamera.prototype.constructor=WALK.CubeCamera;WALK.OrthoCubeCamera=function(c,d){THREE.Object3D.call(this);this.sideCameras=a(c,d,this,!0)};WALK.OrthoCubeCamera.prototype=Object.create(THREE.Object3D.prototype);WALK.OrthoCubeCamera.prototype.constructor=WALK.OrthoCubeCamera})();(function(){WALK.CubeMapFilterShader={uniforms:{gloss:{type:"f",value:.9},face:{type:"f",value:0},mipSize:{type:"f",value:128},envMap:{type:"t",value:null}},vertexShader:WALK.getShader("cubemap_filter_vertex.glsl"),fragmentShader:WALK.getShader("cubemap_filter_fragment.glsl")}})();(function(){function a(m,l,q){for(var n=!0;n;){m.readPixels(l,l,q);for(var p=0;p<l*l*4;p+=4)if(0!==q[p]||0!==q[p+1]||0!==q[p+2]){n=!1;break}if(n){console.warn("Cube face has all pixels black.");break}}}function b(m,l){var q=new Set;m.traverse(function(n){if(n instanceof THREE.Mesh&&n.visible){var p=n.material;n.userData.hideFromLightProbes||p.hideFromLightProbes?(l.add(n),n.visible=!1):q.has(p)||(q.add(p),p.configureTransparency&&(p.transparent=!1,p.blending=THREE.NoBlending,p.depthWrite=!0),void 0!==
p.hdrOutput&&(p.hdrOutput=!0),void 0!==p.specularOff&&(p.specularOff+=1))}});q=null}function c(m,l){var q=new Set;m.traverse(function(n){if(n instanceof THREE.Mesh){var p=n.material;p.forceObjectUniformsRefresh&&p.forceObjectUniformsRefresh();n.visible?q.has(p)||(q.add(p),void 0!==p.hdrOutput&&(p.hdrOutput=!1),p.configureTransparency&&p.configureTransparency(),void 0!==p.specularOff&&--p.specularOff):l.has(n)&&(n.visible=!0)}});q=null}function d(m,l){var q={format:GLC.RGBA,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR,
stencilBuffer:!1,generateMipmaps:!1};this.renderer=m;this.scene=l;this.threeScene=l.threeScene;this.aabbQueryMaterial=new WALK.AabbQueryMaterial;this.filterPass=new THREE.ShaderPass(WALK.CubeMapFilterShader,"envMap");l=WALK.LIGHT_PROBE_MAX_MIP_SIZE;this.pixelBuf=new Uint8Array(l*l*4);this.targetCubeRaw=m.createRenderTargetCube(l,l,q);q.depthBuffer=!1;this.targetFiltered=m.createRenderTarget(l,l,q);this.autoClearAlter=new WALK.AutoClearAlter(m);this.dispose=function(){this.targetCubeRaw.dispose();
this.targetFiltered.dispose();this.aabbQueryMaterial.dispose();this.filterPass.material.dispose();this.pixelBuf=null}}function e(m,l){var q=l.geometry.boundingSphere.center;if(null===l.lightProbe||q.distanceTo(m.position)<q.distanceTo(l.lightProbe.position))l.lightProbe=m}function f(m,l){for(var q=0;q<l.length;q+=1)e(m,l[q])}function g(m,l){WALK.log("No visible light probe found for "+l.length+" objects. Assigning the closest ones.");for(var q=0;q<l.length;q+=1)for(var n=0;n<m.length;n+=1)e(m[n],
l[q])}var k=function(){var m=null;return function(l,q){var n=null,p=0;q*=q;console.assert(q<Math.pow(2,16));null===m&&(m=new Uint16Array(65536));for(var r=0;r<4*q;r+=4)m[256*l[r]+l[r+1]]+=1;m[0]>.7*q&&(p=m[0]);m[0]=0;for(l=1;l<m.length;l+=1)m[l]>p&&(p=m[l],n=Math.floor(l/256)+l%256/255),m[l]=0;return n}}(),h=function(){var m=null;return function(l,q,n){var p=l.renderer,r=l.aabbQueryMaterial,x=l.pixelBuf,w=l.targetCubeRaw;null===m&&(m=new WALK.OrthoCubeCamera(.01,255));m.position.copy(q.position);
m.updateMatrixWorld();var u;for(u=0;6>u;u+=1){w.activeCubeFace=u;r.axis=Math.floor(u/2);p.renderMeshes(l.scene.gpuMeshes,r,m.sideCameras[u],w);a(p,w.width,x);var A=k(x,w.width);if(null===A){WALK.log("failed to find light probe bound");break}switch(u){case 0:n.boxMax.x=q.position.x+A;break;case 1:n.boxMin.x=q.position.x-A;break;case 2:n.boxMax.y=q.position.y+A;break;case 3:n.boxMin.y=q.position.y-A;break;case 4:n.boxMax.z=q.position.z+A;break;case 5:n.boxMin.z=q.position.z-A}}6!==u&&(WALK.log("Light probe bounds: X["+
n.boxMin.x.toFixed(2)+":"+n.boxMax.x.toFixed(2)+"] Y["+n.boxMin.y.toFixed(2)+":"+n.boxMax.y.toFixed(2)+"] Z["+n.boxMin.z.toFixed(2)+":"+n.boxMax.z.toFixed(2)+"]"),n.resetBoundingBox())}}();d.prototype.constructor=d;WALK.LightProbeMaker=function(m,l,q,n,p){function r(I,F){B.position.copy(I.position);B.updateMatrixWorld();var E;if((E=n)&&!(E=p))a:{E=m.gpuMeshes;for(var K=0;K<E.length;K+=1){var M=E[K];if(M.lightProbe===I&&M.material.envMapMirror){E=!0;break a}}E=!1}(K=E)&&WALK.log("Mirror texture needed for the light probe.");
A.reset();E=u.renderer;u.autoClearAlter.set(!0,!0,!1);if(K){var Z=u.renderer;K=WALK.LIGHT_PROBE_MIRROR_SIZE;K=Z.createRenderTargetCube(K,K,{format:GLC.RGBA,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR,stencilBuffer:!1,generateMipmaps:!1});for(M=0;6>M;M+=1)K.activeCubeFace=M,Z.render(u.threeScene,B.sideCameras[M],K);Z.deallocateRenderTargetRenderingBuffers(K);Z=K;I.setMirrorTexture(Z)}F&&h(u,B,I);F=u.renderer;K=u.targetCubeRaw;for(M=0;6>M;M+=1)K.activeCubeFace=M,F.render(u.threeScene,B.sideCameras[M],
K);u.autoClearAlter.restore();E.enableScissorTest(!0);u.autoClearAlter.set(!1,!1,!1);q&&(Z=E.createCubeTexture(u.targetFiltered.width,!0),I.setFilteredTexture(Z));for(F=0;F<WALK.LIGHT_PROBE_MIPS_COUNT;F+=1){K=F;K=Math.pow(2,WALK.log2(u.targetFiltered.width)-K);E.setScissor(0,0,K,K);u.filterPass.uniforms.mipSize.value=K;u.filterPass.uniforms.gloss.value=WALK.LIGHT_PROBE_GLOSS_FOR_MIP[F];q||(Z=E.createCubeTexture(K,!1),I.setFilteredTextureNoLod(Z,F));M=u.filterPass;var C=u.targetCubeRaw,U=u.targetFiltered,
O=u.pixelBuf,W=q?F:0,aa=Z;if(WALK.DEBUG_LIGHT_PROBE_MIPS)for(var R=O,S=255*W/WALK.LIGHT_PROBE_MIPS_COUNT,fa=0;fa<4*K*K;fa+=4)R[fa]=S,R[fa+1]=S,R[fa+2]=S,R[fa+3]=31.875;for(R=0;6>R;R+=1)WALK.DEBUG_LIGHT_PROBE_MIPS||(M.uniforms.face.value=R,M.render(E,U,C),a(E,K,O)),E.copyBufferToCubeFaceMip(W,K,R,O,aa)}E.enableScissorTest(!1);u.autoClearAlter.restore();WALK.log("Cube generation time "+A.elapsedSec())}var x,w=m.threeScene,u=new d(l,m),A=new WALK.Timer,B=new WALK.CubeCamera(.15,m.camera.far);this.assignLightProbesToObjects=
function(){A.reset();void 0===x&&(x=new WALK.ObjectVisibilityQuery(l,m.gpuMeshes,m.camera.far));for(var I=0;I<m.gpuMeshes.length;I+=1)m.gpuMeshes[I].lightProbe=null;for(I=0;I<m.lightProbes.length;I+=1){var F=m.lightProbes[I],E=x.findVisibleObjects(F.position);WALK.log("Have visible objects "+E.length);f(F,E)}WALK.log("Light probe assigment time "+A.elapsedSec());g(m.lightProbes,WALK.filter(m.gpuMeshes,function(K){return null===K.lightProbe}))};this.findBounds=function(I){B.position.copy(I.position);
B.updateMatrixWorld();u.autoClearAlter.set(!0,!0,!1);h(u,B,I);u.autoClearAlter.restore()};this.createLightProbeTexture=function(I,F){var E=new Set;b(w,E);r(I,F);c(w,E)};this.createAllLightProbeTextures=function(){var I=new Set;b(w,I);for(var F=0;F<m.lightProbes.length;F+=1)r(m.lightProbes[F],!1);c(w,I)};this.dispose=function(){u.dispose();x&&x.dispose()}}})();(function(){function a(e){if(e.empty())return 0;e.size(d);return d.x*d.y*d.z}function b(e){if(e.empty())return 0;e.size(d);e=d.x*d.y;return 1>d.x||1>d.y||1.9>d.z||1.5>e?0:e*d.z}function c(e){var f=[],g=[];f.push(e);this.addFilledBox=function(h){g.push(h)};this.findBestFilledBoxes=function(){function h(r){return r[1]}function m(r){r=r[0];r=r.max.x<p.min.x+.2||r.min.x>p.max.x-.2||r.max.y<p.min.y+.2||r.min.y>p.max.y-.2||r.max.z<p.min.z+.2||r.min.z>p.max.z-.2?!1:!0;return!r}var l=[],q=[];for(g.forEach(function(r){q.push([r,
a(r)])});0<q.length&&10>l.length;){var n=WALK.indexOfMax(q,h);var p=q[n][0];l.push(p);q=q.filter(m)}return l};this.isEnclosedInFilledBox=function(h){return WALK.any(g,function(m){m=m.min.x-.1<=h.min.x&&h.max.x<=m.max.x+.1&&m.min.y-.1<=h.min.y&&h.max.y<=m.max.y+.1&&m.min.z-.1<=h.min.z&&h.max.z<=m.max.z+.1?!0:!1;return m})};this.findLargestEmptyBox=function(){var h=WALK.indexOfMax(f,a);return null!==h?f[h]:null};var k=function(){var h=[];h[0]=new THREE.Box3;h[1]=new THREE.Box3;h[2]=new THREE.Box3;h[3]=
new THREE.Box3;h[4]=new THREE.Box3;h[5]=new THREE.Box3;return function(m,l,q){h[0].max.copy(m.max);h[0].min.copy(m.min);h[0].min.z=l.max.z;h[1].max.copy(m.max);h[1].max.z=l.min.z;h[1].min.copy(m.min);h[2].max.copy(m.max);h[2].min.copy(m.min);h[2].min.x=l.max.x;h[3].max.copy(m.max);h[3].max.x=l.min.x;h[3].min.copy(m.min);h[4].max.copy(m.max);h[4].min.copy(m.min);h[4].min.y=l.max.y;h[5].max.copy(m.max);h[5].max.y=l.min.y;h[5].min.copy(m.min);var n=WALK.indexOfMax(h,b);0!==b(h[n])&&(q.push(h[n].clone()),
0===n?m.max.z=l.max.z:1===n?m.min.z=l.min.z:2===n?m.max.x=l.max.x:3===n?m.min.x=l.min.x:4===n?m.max.y=l.max.y:5===n&&(m.min.y=l.min.y),k(m,l,q))}}();this.split=function(h){for(var m=[],l=0;l<f.length;l+=1){var q=f[l];q.isIntersectionBox(h)?k(q,h,m):m.push(q)}f=m}}var d;WALK.arrangeLightProbes=function(e,f,g){function k(B){var I=new WALK.LightProbe({id:e.lightProbes.length});B.center(I.position);I.position.z=B.min.z+1.3;I.enableBoundingBox();I.boxMin.copy(B.min);I.boxMax.copy(B.max);e.lightProbes.push(I)}
var h=new c(e.boundingBox.clone()),m=new THREE.Box3,l=new THREE.Box3,q=new THREE.Vector3,n=new WALK.Timer;d=new THREE.Vector3;for(var p=new WALK.LightProbe({id:0}),r=0;200>r;r+=1){var x=h.findLargestEmptyBox();if(null===x)break;x.center(p.position);p.position.z=x.min.z+1.3;p.enableBoundingBox();l.makeEmpty();for(var w=0;5>w;w+=1){f.findBounds(p);if(!p.isBoundingBoxInitialized())break;m.set(p.boxMin,p.boxMax);var u=b(m);if(0===u)break;if(h.isEnclosedInFilledBox(m))break;m.center(q);q.z=m.min.z+1.3;
var A=p.position.distanceToSquared(q);a(l)<u&&.25>A&&l.set(m.min,m.max);if(.04>A)break;p.position.copy(q)}l.empty()?(x.center(m.min),x.center(m.max),h.split(m)):(h.addFilledBox(l.clone()),h.split(l))}WALK.log("Light probes arrangement time "+n.elapsedSec());f=h.findBestFilledBoxes();(f.reduce(function(B,I){return B+a(I)},0)>.2*a(e.boundingBox)||g)&&f.forEach(k);0===e.lightProbes.length&&g&&k(e.boundingBox)}})();/*
 Copyright (C) 2015-present Shapespark
*/
(function(){function a(m){return document.getElementById(m)}function b(m,l){m=document.getElementsByClassName(m);for(var q=0;q<m.length;q+=1)l(m[q])}function c(m){var l=[];b(m,function(n){l.push(n)});for(var q=0;q<l.length;q+=1)l[q].classList.remove(m)}function d(m,l){m.style.display=l?"":"none"}function e(m,l){d(a(m),l)}function f(m,l){b(m,function(q){d(q,l)})}function g(m){d(m,!0);m.style.opacity=0;WALK.defer(function(){m.style.opacity=1})}function k(){var m=document.getElementById("qr-code-canvas");
m?m.remove():(m=document.createElement("canvas"),m.setAttribute("id","qr-code-canvas"),document.body.appendChild(m),QRCode.toCanvas(m,window.location.toString()))}function h(m){m.style.opacity=0;var l=window.getComputedStyle(m).transitionDuration;if(l){var q=parseFloat(l);-1===l.indexOf("ms")&&(q*=1E3);setTimeout(function(){d(m,!1);m.style.opacity=1},q)}else d(m,!1),m.style.opacity=1}WALK.focusWalkCanvas=function(){WALK.DETECTOR.ios||a("walk-canvas").focus()};WALK.Menu=function(m,l,q,n,p){function r(ha){return function(ja){ja.stopPropagation();
ha();WALK.focusWalkCanvas()}}function x(ha,ja){ha.addEventListener("click",r(ja))}function w(ha,ja){x(a(ha),ja)}function u(ha){if(ha){var ja=null===wa?[]:wa.visibleViews(),Ca;for(Ca=0;Ca<ja.length&&ja[Ca]!==ha;Ca+=1);ha=a("view-list-items").children;if(Ca<ha.length)return ha[Ca]}return null}function A(ha){return function(){ha.classList.remove("active-view");ha.classList.remove("next-active-view")}}function B(){for(var ha=a("view-list-items").children,ja=0;ja<ha.length;ja+=1)ha[ja].classList.remove("active-view"),
ha[ja].classList.remove("next-active-view")}function I(){a("tour-button").classList.add("tour-on")}function F(){a("tour-button").classList.remove("tour-on");B()}function E(){sa.isRunning()?sa.stop():sa.start()}function K(){return sa.isRunning()?(sa.stop(),!0):!1}function M(ha){B();(ha=u(ha.view))&&ha.classList.add("next-active-view")}function Z(ha){if(ha=u(ha.view))ha.classList.remove("next-active-view"),ha.classList.add("active-view"),setTimeout(A(ha),WALK.AUTO_TOUR_IN_VIEW_STILL_TIME_MS)}function C(ha){return r(function(){var ja=
K();ta.switchToView(ha,ja?0:void 0)})}function U(){var ha=a("info-bar"),ja=a("info-bar-slide"),Ca=a("view-list"),Ta=a("view-list-slide"),Pa=a("menu-bar"),Ga=a("menu-bar-slide"),L=a("menu-bar-folder");d(L,wa&&!V);if(na.visible){ha.style.pointerEvents=null;ja.style.left=0;Ca.style.pointerEvents=null;Ta.style.top=0;Pa.style.pointerEvents=null;Ga.style.right=0;L.style.pointerEvents=null;L.children[0].style.transform="";if(null!==na.cover){Pa=na.cover.title;Ta=na.cover.author;Ga=na.cover.authorHref;Ca=
na.cover.engineLogoOn;ha=na.cover.engineLogoText;ja=na.cover.engineLogoUrl;L=na.cover.authorLogoUrl;na.cover.authorLogo&&(L=WALK.getExtraAssetUrl(na.cover.authorLogo.path));var ia=a("author-logo"),Aa=ia.firstElementChild;L?(Ga&&(ia.href=Ga),Aa.src=L):(d(ia,!1),Aa.removeAttribute("src"));L=null===wa||null!==pa;e("info-text",L&&(Pa||Ta));L&&(WALK.setTextContent(a("info-title"),Pa),WALK.setTextContent(a("info-author"),Ta),Ga&&(a("info-author").href=Ga));Pa=Pa?Pa:"3D scene";Ta&&(Pa+=" by "+Ta);document.title=
Pa;Ta=a("engine-logo");d(Ta,Ca);Ca&&(ha&&(Ca=a("engine-logo-text"),d(Ca,!0),WALK.setTextContent(Ca,ha)),ja&&(Ta.href=ja))}ha=null===wa?[]:wa.visibleViews();ja=a("view-list-items");e("view-list",0<ha.length&&!V);if(0<ha.length){Ca=ja.children[0];for(A(Ca)();1!==ja.children.length;)ja.removeChild(ja.children[ja.children.length-1]);for(Ta=0;Ta<ha.length;Ta+=1)Pa=ha[Ta],Pa.hideFromMenu||(WALK.setTextContent(Ca,Pa.name),Ca.onclick=C(Pa),ja.appendChild(Ca),Ca=Ca.cloneNode(!0))}e("menu-buttons",wa&&!V);
wa&&wa.canStartAutoTour()&&!ra?e("tour-button",!0):(sa&&sa.isRunning()&&sa.stop(),e("tour-button",!1))}else ia=a("menu-bar-content"),ha.style.pointerEvents="none",ja.style.left=-ja.offsetWidth+"px",Ca.style.pointerEvents="none",Ta.style.top=-Ta.offsetHeight+"px",Pa.style.pointerEvents="none",L.style.pointerEvents="auto",Ga.style.right=-ia.offsetWidth+"px",L.children[0].style.transform="rotate(180deg)";ha=na.helpVisible;WALK.DETECTOR.mobile?e("mobile-help",ha):(e("desktop-help",ha),ha&&(ha=a("desktop-help-switch"),
ja=a("desktop-help-content"),Ca=Ea?1:0,ha.children[Ca].classList.add("selected"),d(ja.children[Ca],!0),ha.children[1-Ca].classList.remove("selected"),d(ja.children[1-Ca],!1)))}function O(){na.visible=!ka}function W(){na.helpVisible=!za}function aa(){Ea=!1;U()}function R(){Ea=!0;U()}function S(){var ha=K();ta.switchToPreviousVisibleView(ha?0:void 0)}function fa(){var ha=K();ta.switchToNextVisibleView(ha?0:void 0)}function X(ha){if(!(ha.ctrlKey||ha.altKey||ha.metaKey)){var ja=ha.target||ha.srcElement;
ja=ja.nodeType===Node.ELEMENT_NODE?ja.nodeName.toUpperCase():"";if(!/INPUT|SELECT|TEXTAREA/.test(ja))if(67===ha.keyCode&&WALK.DEBUG)ha.shiftKey?WALK.DETECTOR.gl.extension("WEBGL_lose_context").restoreContext():WALK.DETECTOR.gl.extension("WEBGL_lose_context").loseContext();else if(null!==wa){switch(ha.keyCode){case 27:K();break;case 70:J&&n();break;case 76:N&&p();break;case 72:W();break;case 77:O();break;case 86:Q&&q();break;case 80:m||(ha.shiftKey?Da.monoScreenToLocalImage(!0,4E3,2E3):Da.monoScreenToLocalImage(!1,
window.innerWidth,window.innerHeight));break;case 85:WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/qrcode.js"),k);break;case 219:S();break;case 221:fa()}ja=ha.keyCode-48;if(1<=ja&&9>=ja){--ja;var Ca=null===wa?[]:wa.visibleViews();ja=Ca.length>ja?Ca[ja]:null;null!==ja&&C(ja)(ha)}}}}function qa(ha){switch(ha.action){case WALK.GAMEPAD_ACTION.PREVIOUS:S();break;case WALK.GAMEPAD_ACTION.NEXT:fa()}}var na=this,xa={type:"visibilityChanged"},wa=null,ta=null,sa=null,Da=null,Q=!1,J=!1,N=!1,V=!1,ra=
!1,ka=!0,za=!1,Ea=!1,pa=null;this.cover=null;Object.defineProperty(this,"visible",{get:function(){var ha=ra&&WALK.DETECTOR.mobile;return ka&&!ha},set:function(ha){var ja=this.visible;ka=ha;ja!==this.visible&&this.dispatchEvent(xa);U()}});Object.defineProperty(this,"helpVisible",{get:function(){var ha=ra&&WALK.DETECTOR.mobile;return za&&!ha&&!V},set:function(ha){za=ha;U()}});this.updateCover=function(ha){this.cover=ha;null!==pa&&clearTimeout(pa);pa=setTimeout(function(){pa=null;U()},5E3);U()};this.refresh=
function(){U()};this.onFullScreenChange=function(ha){};this.onPointerLockChange=function(ha){V=ha;U()};this.onVrChange=function(ha){var ja=this.visible;ra=ha;ja!==this.visible&&this.dispatchEvent(xa);U()};this.onResize=function(){if(!this.visible){var ha=a("info-bar-slide"),ja=a("menu-bar-slide"),Ca=a("view-list-slide");ha.style.transition="none";ja.style.transition="none";Ca.style.transition="none";U();ha.style.transition="";ja.style.transition="";Ca.style.transition=""}};this.enablePlayButton=function(ha){var ja=
a("play-button");ja.addEventListener("click",ha);d(ja,!0)};this.setVrSupported=function(ha){Q=ha;f("vr-specific",ha)};this.setFullScreenSupported=function(){(J=!m)&&f("fullscreen-specific",!0)};this.setPointerLockSupported=function(){N=!m};this.addExtraButton=function(ha){var ja=a("tour-button"),Ca=document.createElement("img");Ca.src=ha;ha=document.createElement("div");ha.className="menu-button menu-item ui-hoverable ui-panel";ha.appendChild(Ca);ja.parentNode.insertBefore(ha,ja);return ha};this.removeExtraButton=
function(ha){ha.remove()};this.getExtraButonIcon=function(ha){return ha.firstElementChild};this.sceneLoadStarted=function(){e("play-button",!1);e("primary-progress",!0)};this.loadProgress=function(ha){ha=ha.totalDone()/ha.total;if(null===wa){var ja=Math.max(314.159*(1-ha),0);a("primary-progress-done").style.strokeDashoffset=ja}ha=Math.floor(100*ha);a("secondary-progress-done").style.width=ha+"%"};this.sceneReadyToDisplay=function(ha,ja,Ca,Ta){wa=ha;ta=ja;ta.addEventListener("teleportStarted",M);ta.addEventListener("teleportDone",
Z);sa=Ca;sa.addEventListener("tourStarted",I);sa.addEventListener("tourStopped",F);Da=Ta;h(a("cover-image"));h(a("primary-progress"));g(a("secondary-progress"));wa.addEventListener("viewAdded",U);wa.addEventListener("viewRemoved",U);wa.addEventListener("viewShifted",U);document.body.style.backgroundImage="none";document.body.style.backgroundColor="#000";U()};this.sceneLoadComplete=function(){e("secondary-progress",!1)};this.init=function(){m&&(f("viewer-specific",!1),f("editor-specific",!0));b("ui-panel",
function(Ca){x(Ca,function(){})});WALK.DETECTOR.mobile&&c("ui-hoverable");var ha=a("author-logo"),ja=ha.firstElementChild;ja.onload=function(){d(ha,!0)};ja.onerror=function(){d(ha,!1)};document.addEventListener("keydown",X,!1);w("help-button",W);w("fullscreen-button",n);w("vr-button",q);w("tour-button",E);w("menu-bar-folder",O);w("view-list-folder",O);w("basic-desktop-help-option",aa);w("advanced-desktop-help-option",R);w("close-desktop-help-button",W);w("close-mobile-help-button",W);l.addEventListener("actionActivated",
qa);U()};this.contextLost=function(){wa=ta=sa=Da;U()}};THREE.EventDispatcher.prototype.apply(WALK.Menu.prototype)})();(function(){var a=null;WALK.Popup=function(b,c,d){var e=!1,f=document.getElementById("ext-html-label"),g=f.querySelector("#ext-html-label-content");this.close=function(k){e?(f.classList.add("ui-out"),WALK.focusWalkCanvas(),window.setTimeout(function(){f.classList.remove("ext-html-label-topleft");f.classList.remove("ext-html-label-horizontal-center");f.classList.remove("ext-html-label-vertical-center");f.classList.remove("ext-html-label-center");f.classList.remove("ui-out");g.innerHTML="";f.style.display=
"none";d&&d();k&&k();e=!1},400)):k()};this.open=function(){var k=this;if(!e){if(b instanceof Node)g.appendChild(b);else{var h=WALK.getExtraAssetUrl("").slice(0,-1);h=b.replace(/\$EXTRA_ASSETS/g,h);g.innerHTML=h}g.style.padding=c.padding||void 0===c.padding?"":0;f.style.display="";c.centerVertically?c.centerHorizontally?f.classList.add("ext-html-label-center"):f.classList.add("ext-html-label-vertical-center"):c.centerHorizontally?f.classList.add("ext-html-label-horizontal-center"):f.classList.add("ext-html-label-topleft");
f.classList.add("ui-out");f.classList.remove("ext-html-label-animated");WALK.preventClosureCompilerDeadCodeRemoval(f.offsetHeight);f.classList.add("ext-html-label-animated");f.classList.remove("ui-out");f.querySelector("#ext-html-label-close").onclick=function(){k.close()};e=!0}}};WALK.openPopup=function(b,c,d){var e=new WALK.Popup(b,c,d);null!==a?a.close(function(){return e.open()}):e.open();return a=e}})();(function(){WALK.USER_MSG=new function(){this.hideInfo=function(){document.getElementById("info-message").style.display="none"};this.info=function(a,b){var c=document.getElementById("info-message");c.innerHTML=a;c.style.display="";setTimeout(this.hideInfo,b||15E3);console.info(a)};this.error=function(a){var b=document.getElementById("error-message");b.innerHTML=a;b.style.display="";console.error(a)}}})();(function(){function a(k,h,m){return THREE.Math.mapLinear(k,h.min,h.max,m.min,m.max)}function b(k,h){return Math.abs(k.x-h.x)<Number.EPSILON&&Math.abs(k.y-h.y)<Number.EPSILON&&Math.abs(k.z-h.z)<Number.EPSILON}function c(k,h){k.addEventListener("click",function(m){m.stopPropagation();h();WALK.focusWalkCanvas()})}function d(k){var h=document.createElement("canvas");h.width=k;h.height=k;var m=60*Math.PI/180,l=-m/2-Math.PI/2;m=m/2-Math.PI/2;var q=h.getContext("2d");q.beginPath();q.arc(k/2,k/2,4,0,2*Math.PI);
q.fillStyle="rgb(0, 220, 255)";q.fill();q.moveTo(k/2,k/2);q.arc(k/2,k/2,12,l,m,!0);q.lineTo(k/2,k/2);q.arc(k/2,k/2,90,l,m);q.lineTo(k/2,k/2);q.fillStyle="rgba(0, 220, 255, 0.5)";q.fill();return h}function e(k,h){function m(){q=!0;var x=l.width,w=l.height;p!==x||r!==w?(p=x,r=w,h(),window.requestAnimationFrame(m)):0<n?(--n,window.requestAnimationFrame(m)):q=!1}if("ResizeObserver"in window)(new ResizeObserver(h)).observe(k);else{var l=window.getComputedStyle(k),q,n,p,r;(new MutationObserver(function(){n=
60;q||m()})).observe(k,{attributes:!0});window.addEventListener("resize",function(){n=60;q||m()})}}var f=function(k,h){var m=document.createElement("div"),l=d(200);m.style.width="200px";m.style.height="200px";m.style.position="absolute";m.style.pointerEvents="none";m.style.zIndex="2";m.style.opacity="1";m.style.transition="opacity 0.5s";m.id="minimap-camera";m.appendChild(l);this.update=function(q,n){m.style.left=q.x/k*100+"%";m.style.top=q.y/h*100+"%";m.style.transform="translate(-100px, -100px) rotate("+
n+"rad)"};this.show=function(){m.style.opacity="1"};this.hide=function(){m.style.opacity="0"};this.getContainer=function(){return m}},g=function(k,h,m,l){function q(){x.style.transform="translate("+p.x+","+p.y+")"}function n(){x.style.width=w.width;x.style.height=w.height}var p={x:0,y:0},r=document.createElement("canvas");r.width=3*k;r.height=3*h;r.style.position="absolute";r.style.maxWidth="100%";r.style.maxHeight="100%";var x=document.createElement("div");x.classList.add("minimap-content-controller");
var w=window.getComputedStyle(r);l.appendChild(r);l.appendChild(x);e(m,n);this.add=function(u){x.appendChild(u)};this.clear=function(){x.innerHTML=""};this.updateOffset=function(u){p.x=50-u.x/k*100+"%";p.y=50-u.y/h*100+"%";q()};this.addOffset=function(){q()};this.removeOffset=function(){x.style.transform=""};this.updateRatio=function(u){window.requestAnimationFrame(function(){r.width=3*k*u.ratio.x;r.height=3*h*u.ratio.y;n()})}};WALK.Minimap=function(k,h,m,l){function q(){na=h.minimapConfig.levels.map(function(Ga){return{level:Ga,
canvas:null,tab:null}})}function n(){na.forEach(function(Ga){Ga.tab=document.createElement("div");Ga.tab.classList.add("minimap-tab");Ga.tab.innerText=Ga.level.name;Ga.tab.addEventListener("click",function(){W.selectLevel(Ga.level);WALK.focusWalkCanvas()});pa.appendChild(Ga.tab)})}function p(Ga){qa=Ga;fa.show();na.forEach(function(L){L.level===Ga?L.tab.classList.add("minimap-tab-current"):L.tab.classList.remove("minimap-tab-current")})}function r(Ga){na.forEach(function(L){L.canvas&&(L.canvas.style.opacity=
L.level===Ga?"1":"0",L.canvas.style.zIndex=L.level===Ga?"1":"0");L.level===Ga?L.tab.classList.add("minimap-tab-active"):L.tab.classList.remove("minimap-tab-active")})}function x(){var Ga=na.find(function(L){return L.level===qa})?qa:na[na.length-1].level;W.selectLevel(Ga,!0)}function w(Ga){var L=na.filter(function(Aa){return Aa.level.slicePlaneHeight<Ga.slicePlaneHeight}).sort(function(Aa,Ia){return Ia.level.slicePlaneHeight-Aa.level.slicePlaneHeight})[0],ia=na.filter(function(Aa){return Aa.level.slicePlaneHeight>
Ga.slicePlaneHeight}).sort(function(Aa,Ia){return Aa.level.slicePlaneHeight-Ia.level.slicePlaneHeight})[0];wa=L?Ga.slicePlaneHeight-(Ga.slicePlaneHeight-L.level.slicePlaneHeight)/2:-Infinity;ta=ia?Ga.slicePlaneHeight-(Ga.slicePlaneHeight-ia.level.slicePlaneHeight)/2:Infinity}function u(Ga){return na.reduce(function(L,ia){return Math.abs(ia.level.slicePlaneHeight-Ga.z)<Math.abs(L.level.slicePlaneHeight-Ga.z)?ia:L}).level}function A(Ga,L){if(qa){Ga||L||(Ga=l.getCameraPosition(),L=l.getCameraRotation());
L=-1*L.z;var ia={min:qa.cropRange.max.y,max:qa.cropRange.min.y};Ga={x:a(Ga.x,{min:qa.cropRange.min.x,max:qa.cropRange.max.x},Ca),y:a(Ga.y,ia,Ta)};fa.update(Ga,L);S&&X.updateOffset(Ga)}}function B(){S=!0;ka.classList.add("minimap-container-minimized");za.classList.add("minimap-wrapper-minimized");X.addOffset();A()}function I(){S=!1;ka.classList.remove("minimap-container-minimized");za.classList.remove("minimap-wrapper-minimized");X.removeOffset()}function F(){aa=!0;za.style.transform="translate(-101%, 0)"}
function E(){l.menuVisible?S&&(640>window.innerWidth||640>window.innerHeight)?(I(),aa=!1,za.style.transform=""):aa?(aa=!1,za.style.transform=""):F():F()}function K(Ga,L,ia){var Aa={min:0,max:1},Ia={min:ia.cropRange.min.x,max:ia.cropRange.max.x},Ja={min:ia.cropRange.max.y,max:ia.cropRange.min.y};L.addEventListener("click",function(Va){var Ra=L.getBoundingClientRect(),Sa=(Va.clientX-Ra.left)/Ra.width;Va=(Va.clientY-Ra.top)/Ra.height;0!==Ga.data[4*(Math.round(Sa*Da)+Math.round(Va*Q)*Da)+3]&&(Sa={x:a(Sa,
Aa,Ia),y:a(Va,Aa,Ja),z:ia.slicePlaneHeight},Va=l.getCameraPosition(),Va=WALK.yawRotationToPoint(Va,Sa),Va=WALK.normalizeRotation(Va),Va=THREE.Math.radToDeg(Va),Sa=new WALK.View({position:[Sa.x,Sa.y,Sa.z],rotation:[Va,0,0]}),m.switchToView(Sa),ia!==qa&&p(ia));WALK.focusWalkCanvas()})}function M(){X.add(fa.getContainer());ra.style.display="";ka.style.display="";1<na.length&&(pa.style.display="",za.classList.add("minimap-wrapper-tabs"))}function Z(){X.clear();pa.innerHTML="";pa.style.display="none";
ka.style.display="none";ra.style.display="none";za.classList.remove("minimap-wrapper-tabs")}function C(Ga){var L=document.createElement("canvas");L.width=Da;L.height=Q;L.style.transition="opacity 0.5s";var ia=k.createMinimapImageDataComponents(h.minimapConfig,Ga),Aa=ia.minimapImageData;ia=ia.walkableImageData;L.getContext("2d").putImageData(Aa,0,0);K(ia,L,Ga);X.add(L);return L}function U(){if(!(J&&N&&V&&ra&&ka&&za&&Ea))return!0}function O(){U()||(X=new g(Da,Q,za,Ea),fa=new f(Da,Q),640>window.innerWidth||
640>window.innerHeight?F():B(),c(J,B),c(N,I),c(V,F),c(ra,E),l.onMenuVisibilityChanged(E),R=!0,q(),n(),x(),M())}var W=this,aa=!1,R=!1,S=!1,fa=null,X=null,qa=null,na=[],xa=!1,wa=-Infinity,ta=Infinity;l.onViewSwitchStarted(function(){return xa=!0});l.onViewSwitchDone(function(){return xa=!1});var sa=k.getMinimapSize(),Da=sa.width,Q=sa.height,J=document.getElementById("minimap-button-minimize"),N=document.getElementById("minimap-button-maximize"),V=document.getElementById("minimap-button-close"),ra=document.getElementById("minimap-button-toggle"),
ka=document.getElementById("minimap-container"),za=document.getElementById("minimap-wrapper"),Ea=document.getElementById("minimap-content"),pa=document.getElementById("minimap-tabs"),ha=new THREE.Vector3(0,0,0),ja=new THREE.Vector3(0,0,0),Ca={min:0,max:Da},Ta={min:0,max:Q},Pa={type:"minimapLevelSelected",target:this,level:null};THREE.EventDispatcher.prototype.apply(WALK.Minimap.prototype);this.selectLevel=function(Ga,L){L=void 0===L?!1:L;var ia=na.filter(function(Aa){return Aa.level===Ga})[0];L&&
p(Ga);ia.canvas||(ia.canvas=C(Ga));Ga===qa?fa.show():fa.hide();r(Ga);w(Ga);A();X.updateRatio(Ga);Pa.level=Ga;this.dispatchEvent(Pa)};this.update=function(){if(!U()){var Ga=l.getCameraPosition(),L=l.getCameraRotation();if(!1===b(ha,Ga)||!1===b(ja,L)){A(Ga,L);if(!xa&&(Ga.z>ta||Ga.z<wa)){var ia=u(Ga);w(ia);W.selectLevel(ia,!0)}ha.set(Ga.x,Ga.y,Ga.z);ja.set(L.x,L.y,L.z)}}};h.minimapConfig.enabled&&O();h.minimapConfig.addEventListener("updated",function(){R?h.minimapConfig.enabled?(Z(),q(),n(),x(),M()):
Z():O()});l._onMeetingJoined(F)}})();(function(){WALK.Timer=function(){this.clock=performance||Date;this.reset()};WALK.Timer.prototype={constructor:WALK.Timer,reset:function(){this.startMS=this.clock.now()},elapsedMSec:function(){return this.clock.now()-this.startMS},elapsedSec:function(){return.001*this.elapsedMSec()}};WALK.Perf=function(){var a=new WALK.Timer,b=[];this.begin=function(){a.reset()};this.end=function(){b.push(a.elapsedSec());0===b.length%100&&(b.sort(),console.log("Best "+b[0]+" Median "+b[Math.floor(.5*b.length)]+" 95 "+
b[Math.floor(.95*b.length)]))}};WALK.DeferringExecutorOnce=function(a,b){function c(){d=null;a()}var d=null;this.deferRun=function(){null!==d&&clearTimeout(d);d=setTimeout(c,b)}};WALK.DeferringExecutorInterval=function(a,b){function c(){a()}var d=null;this.deferRun=function(){null!==d&&clearInterval(d);d=setInterval(c,b)}}})();(function(){WALK.AnimationController=function(a,b,c){function d(){p(a.vrEnabled())}function e(){p(!1)}var f=this,g=new THREE.Clock,k=!1,h=!1,m=!1,l=0,q=!1,n=function(){h||(k||g.getDelta(),h=!0,a.vrEnabled()?a.requestAnimationFrame(d):requestAnimationFrame(e))};var p=function(r){q&&(h=!1,m?(console.assert(!r),c(g.getDelta(),l)?(l+=1,n()):m=!1):(k=!0,b(g.getDelta(),r),WALK.ALWAYS_RENDER&&f.requestFrame(),k=!1,h||(m=!0,l=0,n())))};this.requestFrame=function(){q&&(m=!1,n())};this.disable=function(){q=
!1};this.enable=function(){q=!0;h=!1;this.requestFrame()};this.isEnabled=function(){return q}}})();(function(){WALK.ExposureController=function(a,b,c){var d=a.camera,e=!1,f=0,g,k,h,m=new WALK.Timer,l=function(p){h=p;f=p-d.exposure;k=Math.sign(f);f=Math.abs(f);g=f/1};this.adaptExposure=function(){if(e&&d.autoExposure){m.reset();var p=c.measureReflectedLuma();0>p?f=0:(l(Math.log2(d.autoExposureDarkness/p)),.3>f&&(f=0))}};this.exposureNeedsUpdate=function(){return 0<f};var q=new THREE.Vector3(Infinity,Infinity,Infinity),n=function(){return function(){if(!e||!d.autoExposure){for(var p=a.cameraVolumes.length-
1;0<=p;--p){var r=a.cameraVolumes[p];if(r.worldCoordinatesInside(q)){l(r.exposure);d.setGamma(r.gamma);return}}l(d.defaultExposure);d.setGamma(d.defaultGamma)}}}();a.addEventListener("cameraVolumeAdded",function(p){p.cameraVolume.addEventListener("updated",n);n()});a.addEventListener("cameraVolumeShifted",n);a.addEventListener("cameraVolumeRemoved",function(p){p.cameraVolume.removeEventListener("cameraVolumeUpdated",n);n()});d.addEventListener("updated",n);this.update=function(p){var r=b.cameraWorldPosition();
q.equals(r)||(q.copy(r),n());this.exposureNeedsUpdate()&&(p=Math.min(g*p,f),f-=p,1E-5>f?(f=0,d.exposure=h):d.exposure+=p*k)};this.updateWithoutDelay=function(){this.update(1)};this.enableAutoExposure=function(){e=!0;f=0};this.disableAutoExposure=function(){e=!1;n()}}})();(function(){function a(b,c){for(var d=0,e=0,f=0;65536>f;++f){var g=4*f;g=b[g]+255*b[g+1];0!==g&&(e+=1,c[g]+=1,d=Math.max(d,g))}if(256>e)return-1;f=b=0;for(g=1;g<=d;++g)if(c[g]+b<.3*e)b+=c[g],c[g]=0;else break;for(g=d;0<=g;--g)if(c[g]+f<.1*e)f+=c[g],c[g]=0;else break;g=0;for(var k=1;k<=d;++k)g+=c[k]*Math.log(k/255),c[k]=0;return Math.exp(g/(e-b-f))}WALK.LumaMeter=function(b,c){function d(q){f||(console.assert(!f),f=b.createRenderTarget(256,256,{minFilter:GLC.NEAREST,magFilter:GLC.NEAREST,format:GLC.RGBA,
stencilBuffer:!1,generateMipmaps:!1}),g=new WALK.AutoClearAlter(b),k=new Uint8Array(262144),h=new Uint32Array(65280),m=new WALK.LumaMaterial(!0),l=new WALK.LumaMaterial(!1));q=q?m:l;g.set(!0,!0,!1);var n=c.gpuMeshes.filter(function(p){return!p.material.transparent});b.renderMeshes(n,q,e,f);b.readPixels(256,256,k);b.setRenderTarget(null);g.restore();return a(k,h)}var e=c.camera,f,g,k,h,m,l;this.measureIncidentLuma=function(){return d(!0)};this.measureReflectedLuma=function(){return d(!1)}}})();(function(){WALK.AccumulatePass=function(){var a={uniforms:{inputBuffer:{type:"t",value:null},weight:{type:"f",value:1}},vertexShader:WALK.getShader("accumulate_vertex.glsl"),fragmentShader:WALK.getShader("accumulate_fragment.glsl")};THREE.ShaderPass.call(this,a,"inputBuffer");this.material.depthTest=!1;this.material.depthWrite=!1;this.material.blending=THREE.CustomBlending;this.material.blendEquation=GLC.FUNC_ADD;this.material.blendDst=GLC.ONE_MINUS_SRC_ALPHA;this.material.blendSrc=GLC.SRC_ALPHA};
WALK.AccumulatePass.prototype=Object.create(THREE.ShaderPass.prototype);WALK.AccumulatePass.prototype.constructor=WALK.AccumulatePass})();(function(){function a(){var b={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:WALK.getShader("copy_opaque_vertex.glsl"),fragmentShader:WALK.getShader("copy_opaque_fragment.glsl")};b=new THREE.ShaderPass(b);b.renderToScreen=!0;return b}WALK.SsaaRenderer=function(b,c){var d,e,f=0,g=[[.375,.4375],[.625,.0625],[.875,.1875],[.125,.0625],[.375,.6875],[.875,.4375],[.625,.5625],[.375,.9375],[.625,.3125],[.125,.5625],[.125,.8125],[.375,.1875],[.875,.9375],[.875,.6875],[.125,.3125],[.625,.8125]],k=
new THREE.RenderPass(c.threeScene,c.camera),h=new WALK.AccumulatePass,m=a(),l=new WALK.AutoClearAlter(b);this.reset=function(){f=0};this.renderSample=function(){console.assert(f<g.length);l.set(!0,!0,!1);var q=e.width,n=e.height,p=g[f][0]-.5,r=g[f][1]-.5,x=c.camera,w=q/n,u=Math.tan(.5*THREE.Math.degToRad(x.fov));u=x.near*u/x.zoom;var A=-u,B=A*w;w*=u;q=(w-B)/q;n=(u-A)/n;x.projectionMatrix.makeFrustum(B-p*q,w-p*q,A-r*n,u-r*n,x.near,x.far);k.render(b,d);l.restore();l.set(!1,!1,!1);h.uniforms.weight.value=
1/(f+1);h.render(b,e,d);l.restore();c.camera.updateProjectionMatrix();f+=1};this.renderedSamplesCount=function(){return f};this.allSamplesRendered=function(){return f===g.length};this.renderAccumulatedSamplesToScreen=function(){l.set(!0,!0,!1);m.render(b,void 0,e);l.restore()};this.copyAccumulatedSamplesToBuffer=function(){var q=e.width,n=e.height,p=new Uint8Array(q*n*4);b.readPixels(q,n,p);return p};this.setTargets=function(q,n){console.assert(q.width===n.width&&q.height===n.height);d=q;e=n};this.dispose=
function(){h.material.dispose()}}})();(function(){function a(b){return b.split("\n").map(function(c,d){return d+1+": "+c}).join("\n")}WALK.createWebGLShader=function(b,c,d){c=b.createShader(c);b.shaderSource(c,d);b.compileShader(c);var e=!1===b.getShaderParameter(c,b.COMPILE_STATUS);e&&console.error("Shader failed to compile.");if(e||WALK.LOG_INFO)b=b.getShaderInfoLog(c),""!==b&&console.warn("Shader info log: ",b,a(d));return c}})();(function(){WALK.WebGLState=function(a){var b=Array(16).fill(0),c=Array(16).fill(null),d=b.map(function(){return 0}),e=null,f=null,g=null,k=null,h=null,m=null,l=null,q=null,n=null,p=null,r=null,x=null,w=null,u=null,A=null,B=null;this.resetAttributeStates=function(){for(var I=0,F=b.length;I<F;I++)b[I]=0};this.disableAttributeStates=function(){for(var I=0,F=b.length;I<F;I++)a.disableVertexAttribArray(I),b[I]=0};this.enableAttributeArray=function(I){2!==b[I]&&(a.enableVertexAttribArray(I),b[I]=2)};this.disableAttributeArray=
function(I,F){1!==b[I]&&(a.disableVertexAttribArray(I),b[I]=1);c[I]!==F&&(2===F.length?a.vertexAttrib2fv(I,F):3===F.length?a.vertexAttrib3fv(I,F):4===F.length&&a.vertexAttrib4fv(I,F),c[I]=F)};this.resetAttributeDivisors=function(){for(var I=0,F=d.length;I<F;I++)d[I]&&(a.vertexAttribDivisor(I,0),d[I]=0)};this.setAttributeDivisor=function(I,F){a.vertexAttribDivisor(I,F);d[I]=F};this.setBlending=function(I){var F=I.blending;F!==e&&(F===THREE.NoBlending?a.disable(a.BLEND):F===THREE.AdditiveBlending?(a.enable(a.BLEND),
a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):F===THREE.SubtractiveBlending?(a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):F===THREE.MultiplyBlending?(a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):F===THREE.CustomBlending?a.enable(a.BLEND):(a.enable(a.BLEND),a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),e=F);if(F===THREE.CustomBlending){F=
I.blendEquation;var E=I.blendEquationAlpha||F,K=I.blendSrc,M=I.blendDst,Z=I.blendSrcAlpha||K;I=I.blendDstAlpha||M;if(F!==f||E!==h)a.blendEquationSeparate(F,E),f=F,h=E;if(K!==g||M!==k||Z!==m||I!==l)a.blendFuncSeparate(K,M,Z,I),g=K,k=M,m=Z,l=I}else l=m=h=k=g=f=null};this.setDepthTest=function(I){q!==I&&(I?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),q=I)};this.setDepthWrite=function(I){n!==I&&(a.depthMask(I),n=I)};this.setColorWrite=function(I){p!==I&&(a.colorMask(I,I,I,I),p=I)};this.setDoubleSided=
function(I){r!==I&&(I?a.disable(a.CULL_FACE):a.enable(a.CULL_FACE),r=I)};this.setFlipSided=function(I){x!==I&&(I?a.frontFace(a.CW):a.frontFace(a.CCW),x=I)};this.setViewport=function(I,F,E,K){if(w!==I||u!==F||A!==E||B!==K)a.viewport(I,F,E,K),w=I,u=F,A=E,B=K}}})();(function(){function a(d,e){var f=e.index0AttributeName,g=d.createProgram(),k=WALK.createWebGLShader(d,d.VERTEX_SHADER,e.generateVertexShader()),h=WALK.createWebGLShader(d,d.FRAGMENT_SHADER,e.generateFragmentShader());d.attachShader(g,k);d.attachShader(g,h);void 0!==f&&d.bindAttribLocation(g,0,f);d.linkProgram(g);f=d.getProgramInfoLog(g).trim();!1===d.getProgramParameter(g,d.LINK_STATUS)&&console.error("Shader link error: "+d.getError(),"validate status: ",d.getProgramParameter(g,d.VALIDATE_STATUS));
""!==f&&"\x00"!==f&&console.warn("program info log: "+f);d.deleteShader(k);d.deleteShader(h);k={};h=0;for(f=b.length;h<f;h++){var m=b[h];k[m]=d.getUniformLocation(g,m)}this.transformUniformCache=k;k=e.uniforms;h={i:[],f:[],v2:[],v3:[],c:[],v4:[],m4:[],t:[]};var l;for(q in k)k.hasOwnProperty(q)&&(f=d.getUniformLocation(g,q))&&(m=k[q].type,console.assert(h.hasOwnProperty(m)),"i"===m||"f"===m||"t"===m?l=null:"v2"===m?l=[null,null]:"v3"===m||"c"===m?l=[null,null,null]:"v4"===m?l=[null,null,null,null]:
"m4"===m?l=null:console.assert(!1),h[m].push({id:q,value:l,location:f}));this.materialUniformCache=h;e=e.attributes;l={};var q=0;for(k=e.length;q<k;q++)h=e[q],l[h]=d.getAttribLocation(g,h);this.attributes=l;this.attributesKeys=Object.keys(this.attributes);this.id=c++;this.usedTimes=1;this.program=g;return this}var b="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition".split(" "),c=0;WALK.WebGLProgramStore=function(d){var e=new Map;this.assignProgramToMaterial=function(f){console.assert(f instanceof
WALK.BaseMaterial);var g=f.generateProgramId(),k=e[g];k?k.usedTimes++:(k=new a(d,f),e[g]=k);f.program&&this.resetProgramAssignment(f);f.program=k};this.resetProgramAssignment=function(f){var g=f.program;f.program=null;--g.usedTimes;if(0===g.usedTimes){for(var k in e)if(e.hasOwnProperty(k)&&e[k]===g){delete e[k];break}d.deleteProgram(g.program)}}}})();(function(){function a(){this.texture=null;this.locked=!1;this.usedCount=0}function b(c){for(var d=[],e=0;e<c;e+=1)d[e]=new a;return d}WALK.WebGLTextureSlotter=function(c){var d=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS),e=b(d);this.setSlot=function(f,g){var k=f.__webglSlot;if(null!==k){var h=e[k];h.usedCount+=1;h.locked=h.locked||g;return!1}for(var m=Infinity,l=0;l<d;l+=1)h=e[l],!h.locked&&h.usedCount<m&&(m=h.usedCount,k=l);null===k&&(console.warn("Not enough texture units"),k=0);h=e[k];h.texture&&
(h.texture.__webglSlot=null);h.texture=f;h.usedCount=1;h.locked=g;f.__webglSlot=k;return!0};this.unlockAllSlots=function(){for(var f=0;f<d;f+=1)e[f].locked=!1};this.freeSlot=function(f){if(null!==f.__webglSlot){var g=e[f.__webglSlot];f.__webglSlot=null;g.texture=null;g.locked=!1;g.usedCount=0}}};WALK.WebGLTextureSlotterSequential=function(c){var d=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS),e=0;this.setSlot=function(f,g){e===d&&(console.warn("Not enough texture units"),e=0);f.__webglSlot=e;g&&(e+=1);
return!0};this.unlockAllSlots=function(){e=0};this.freeSlot=function(f){f.__webglSlot=null}}})();(function(){function a(d,e){d.drawArraysInstanced=function(f){for(var g=[],k=0;k<arguments.length;++k)g[k-0]=arguments[k];return e.drawArraysInstancedANGLE.apply(e,$jscomp.arrayFromIterable(g))};d.drawElementsInstanced=function(f){for(var g=[],k=0;k<arguments.length;++k)g[k-0]=arguments[k];return e.drawElementsInstancedANGLE.apply(e,$jscomp.arrayFromIterable(g))};d.vertexAttribDivisor=function(f){for(var g=[],k=0;k<arguments.length;++k)g[k-0]=arguments[k];return e.vertexAttribDivisorANGLE.apply(e,
$jscomp.arrayFromIterable(g))}}function b(d,e){for(var f={HALF_FLOAT_OES:"OES_texture_half_float",COMPRESSED_RGB_S3TC_DXT1_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT1_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT3_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT5_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGB_PVRTC_4BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGB_PVRTC_2BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",
COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGB_ETC1_WEBGL:"WEBGL_compressed_texture_etc1",COMPRESSED_RGBA_ASTC_4x4_KHR:"WEBGL_compressed_texture_astc"},g=$jscomp.makeIterator(Object.entries(GLC)),k=g.next();!k.done;k=g.next()){var h=$jscomp.makeIterator(k.value);k=h.next().value;h=h.next().value;var m=f[k];void 0!==m?(m=e.gl.extension(m))&&console.assert(m[k]===h):console.assert(d[k]===h)}}function c(d){return WALK.DETECTOR.gl.disableTextureSlotReuse?new WALK.WebGLTextureSlotterSequential(d):
new WALK.WebGLTextureSlotter(d)}WALK.WebGLRenderer=function(d,e){function f(Q,J){if(!WALK.DETECTOR.gl.webgl2)return Q;if(J===GLC.FLOAT){if(Q===GLC.RGB)return e.RGB32F;console.assert("Missing mapping")}return Q}function g(){S=!!WALK.DETECTOR.gl.instances;O=U=null;W=-1;R=aa=null;!WALK.DETECTOR.gl.webgl2&&S&&a(e,WALK.DETECTOR.gl.instances);fa=new WALK.WebGLState(e);X=new WALK.WebGLProgramStore(e);e.clearColor(0,0,0,1);e.clearDepth(1);e.clearStencil(0);e.enable(e.DEPTH_TEST);e.depthFunc(e.LEQUAL);e.frontFace(e.CCW);
e.cullFace(e.BACK);e.enable(e.CULL_FACE);e.enable(e.BLEND);e.blendEquation(e.FUNC_ADD);e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);fa.setViewport(0,0,d.width,d.height);e.clearColor(E.r,E.g,E.b,K);WALK.DETECTOR.ie||e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE)}function k(Q){Q=Q.target;Q.removeEventListener("dispose",k);delete Q.__webglInit;Q=Q.attributes;for(var J in Q)if(Q.hasOwnProperty(J)){var N=Q[J];void 0!==N.buffer&&(e.deleteBuffer(N.buffer),delete N.buffer)}fa.disableAttributeStates();
aa=null}function h(Q){Q=Q.target;Q.removeEventListener("dispose",h);wa.freeSlot(Q);Q.__webglTexture&&(e.deleteTexture(Q.__webglTexture),Q.__webglTexture=null)}function m(Q){Q=Q.target;Q.removeEventListener("dispose",m);wa.freeSlot(Q);e.deleteTexture(Q.__webglTexture);Q.__webglTexture=null;Q.__webglFramebuffer&&C.deallocateRenderTargetRenderingBuffers(Q)}function l(Q){Q=Q.target;Q.removeEventListener("dispose",l);X.resetProgramAssignment(Q)}function q(Q,J,N){var V=N.attributes,ra=J.attributes;J=J.attributesKeys;
N=16*(N.instanceId||0);for(var ka=0,za=J.length;ka<za;ka++){var Ea=J[ka],pa=ra[Ea];if(0<=pa){var ha=V[Ea];if(void 0!==ha){Ea=ha.itemSize;var ja=ha.glType;e.bindBuffer(e.ARRAY_BUFFER,ha.buffer);ha=ha.divisor||0;fa.enableAttributeArray(pa);e.vertexAttribPointer(pa,Ea,ja,!1,0,N*ha);S&&fa.setAttributeDivisor(pa,ha)}else fa.disableAttributeArray(pa,Q.defaultAttributeValues[Ea])}}}function n(Q,J){var N=WALK.DETECTOR;e.texParameteri(Q,e.TEXTURE_WRAP_S,J.wrapS);e.texParameteri(Q,e.TEXTURE_WRAP_T,J.wrapT);
e.texParameteri(Q,e.TEXTURE_MAG_FILTER,J.magFilter);e.texParameteri(Q,e.TEXTURE_MIN_FILTER,J.minFilter);var V=N.gl.extension("EXT_texture_filter_anisotropic");V&&1<J.anisotropy&&e.texParameterf(Q,V.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(J.anisotropy,N.gl.maxAnisotropy))}function p(Q,J){var N=Q.material,V=J.material,ra=N.program,ka=V.program;return ra&&ka&&ra.id!==ka.id?ra.id-ka.id:N.id-V.id||Q.id-J.id}function r(Q,J){var N=Q.material.transparentRenderOrder-J.material.transparentRenderOrder;return N?
N:J.cameraDistance-Q.cameraDistance||Q.id-J.id}function x(Q,J,N){if(N||!1!==Q.visible){Q instanceof THREE.Mesh&&(!1===Q.frustumCulled||!0===qa.intersectsObject(Q))&&((J||Q.material).transparent?(!0===C.sortObjects&&(Q.cameraDistance=qa.nearPlaneDistanceToCenter(Q)),Z.push(Q)):M.push(Q));for(var V=0,ra=Q.children.length;V<ra;V++)x(Q.children[V],J,N)}}function w(Q){fa.setDoubleSided(Q.side===THREE.DoubleSide);fa.setFlipSided(Q.side===THREE.BackSide)}function u(Q){Q.__webglTexture||(Q.addEventListener("dispose",
h),Q.__webglTexture=e.createTexture());e.activeTexture(e.TEXTURE0+Q.__webglSlot);e.bindTexture(e.TEXTURE_2D,Q.__webglTexture);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,Q.flipY);e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Q.premultiplyAlpha);e.pixelStorei(e.UNPACK_ALIGNMENT,Q.unpackAlignment);var J=Q.image,N=THREE.Math.isPowerOfTwo(J.width)&&THREE.Math.isPowerOfTwo(J.height),V=Q.format,ra=Q.type,ka=f(V,ra);n(e.TEXTURE_2D,Q);var za=Q.mipmaps;if(Q instanceof WALK.DataTexture)if(0<za.length&&N){for(var Ea=
0,pa=za.length;Ea<pa;Ea++)J=za[Ea],e.texImage2D(e.TEXTURE_2D,Ea,ka,J.width,J.height,0,V,ra,J.data),Q.releaseOnLoadedToGpu&&(J.data=null);Q.generateMipmaps=!1}else e.texImage2D(e.TEXTURE_2D,0,ka,J.width,J.height,0,V,ra,J.data),Q.releaseOnLoadedToGpu&&(J.data=null);else if(Q instanceof WALK.CompressedTexture)for(Ea=0,pa=za.length;Ea<pa;Ea++)J=za[Ea],Q.format!==GLC.RGBA&&Q.format!==GLC.RGB?e.compressedTexImage2D(e.TEXTURE_2D,Ea,ka,J.width,J.height,0,J.data):e.texImage2D(e.TEXTURE_2D,Ea,ka,J.width,J.height,
0,V,ra,J.data),Q.releaseOnLoadedToGpu&&(J.data=null);else if(0<za.length&&N){Ea=0;for(pa=za.length;Ea<pa;Ea++)J=za[Ea],e.texImage2D(e.TEXTURE_2D,Ea,ka,V,ra,J);Q.releaseOnLoadedToGpu&&(Q.mipmaps=null);Q.generateMipmaps=!1}else e.texImage2D(e.TEXTURE_2D,0,ka,V,ra,Q.image),Q.releaseOnLoadedToGpu&&(Q.image=null);Q.generateMipmaps&&N&&e.generateMipmap(e.TEXTURE_2D);Q.needsUpdate=!1}function A(Q){fa.setBlending(Q);fa.setDepthTest(Q.depthTest);fa.setDepthWrite(Q.depthWrite);fa.setColorWrite(Q.colorWrite)}
function B(Q,J,N){if(N){var V=N;A(V);w(V)}for(var ra=0,ka=Q.length;ra<ka;ra+=1){var za=Q[ra],Ea=za.geometry,pa=za.material;try{N?N.doNotOverrideSide&&pa&&w(pa):(V=pa,A(V),w(V));var ha=pa=void 0,ja=void 0,Ca=void 0,Ta=void 0,Pa=V;if(!1!==Pa.visible&&0!==Ea.vertexCnt){var Ga=J,L=Pa;L.programNeedsUpdate&&(X.assignProgramToMaterial(L),L.addEventListener("dispose",l),L.programNeedsUpdate=!1);console.assert(!L.morphTargets);var ia=!1,Aa=!1,Ia=L.program,Ja=Ia.transformUniformCache,Va=L.uniforms;Ia.id!==
U&&(e.useProgram(Ia.program),U=Ia.id,Aa=ia=!0);L.id!==W&&(W=L.id,Aa=!0);if(ia||Ga!==R)e.uniformMatrix4fv(Ja.projectionMatrix,!1,Ga.projectionMatrix.elements),Ga!==R&&(R=Ga),console.assert(L instanceof WALK.BaseMaterial),null!==Ja.cameraPosition&&(xa.setFromMatrixPosition(Ga.matrixWorld),e.uniform3f(Ja.cameraPosition,xa.x,xa.y,xa.z)),null!==Ja.viewMatrix&&e.uniformMatrix4fv(Ja.viewMatrix,!1,Ga.matrixWorldInverse.elements);L.refreshPerObjectUniforms&&L.refreshPerObjectUniforms(za,Va)&&(Aa=!0);if(Aa){var Ra=
Aa=ia=L=void 0,Sa=void 0,db=void 0,eb=void 0,gb=void 0,P=void 0,Y=void 0,Ba=void 0,la=void 0,Fa=void 0,ca=Ia,ya=Va;Fa=ca.materialUniformCache.i;Ra=0;for(Aa=Fa.length;Ra<Aa;Ra+=1)la=Fa[Ra],Ba=la.id,Y=ya[Ba].value,la.value!==Y&&(e.uniform1i(la.location,Y),la.value=Y);Fa=ca.materialUniformCache.f;Ra=0;for(Aa=Fa.length;Ra<Aa;Ra+=1)la=Fa[Ra],Ba=la.id,Y=ya[Ba].value,la.value!==Y&&(e.uniform1f(la.location,Y),la.value=Y);Fa=ca.materialUniformCache.v2;Ra=0;for(Aa=Fa.length;Ra<Aa;Ra+=1)if(la=Fa[Ra],Ba=la.id,
Y=ya[Ba].value,P=Y.x,gb=Y.y,la.value[0]!==P||la.value[1]!==gb)e.uniform2f(la.location,P,gb),la.value[0]=P,la.value[1]=gb;Fa=ca.materialUniformCache.v3;Ra=0;for(Aa=Fa.length;Ra<Aa;Ra+=1)if(la=Fa[Ra],Ba=la.id,Y=ya[Ba].value,P=Y.x,gb=Y.y,eb=Y.z,la.value[0]!==P||la.value[1]!==gb||la.value[2]!==eb)e.uniform3f(la.location,P,gb,eb),la.value[0]=P,la.value[1]=gb,la.value[2]=eb;Fa=ca.materialUniformCache.c;Ra=0;for(Aa=Fa.length;Ra<Aa;Ra+=1)if(la=Fa[Ra],Ba=la.id,Y=ya[Ba].value,P=Y.r,gb=Y.g,eb=Y.b,la.value[0]!==
P||la.value[1]!==gb||la.value[2]!==eb)e.uniform3f(la.location,P,gb,eb),la.value[0]=P,la.value[1]=gb,la.value[2]=eb;Fa=ca.materialUniformCache.v4;Ra=0;for(Aa=Fa.length;Ra<Aa;Ra+=1)if(la=Fa[Ra],Ba=la.id,Y=ya[Ba].value,P=Y.x,gb=Y.y,eb=Y.z,db=Y.w,la.value[0]!==P||la.value[1]!==gb||la.value[2]!==eb||la.value[3]!==db)e.uniform4f(la.location,P,gb,eb,db),la.value[0]=P,la.value[1]=gb,la.value[2]=eb,la.value[3]=db;Fa=ca.materialUniformCache.m4;Ra=0;for(Aa=Fa.length;Ra<Aa;Ra+=1)la=Fa[Ra],Ba=la.id,e.uniformMatrix4fv(location,
!1,ya[Ba].value.elements);Fa=ca.materialUniformCache.t;Ra=0;for(Aa=Fa.length;Ra<Aa;Ra+=1)if(la=Fa[Ra],Ba=la.id,Sa=ya[Ba].value,ia=wa.setSlot(Sa,!0),L=Sa.__webglSlot,la.value!==L&&(e.uniform1i(la.location,L),la.value=L),ia||Sa.needsUpdate)if(Sa.isCube){if(db=Sa,e.activeTexture(e.TEXTURE0+db.__webglSlot),e.bindTexture(e.TEXTURE_CUBE_MAP,db.__webglTexture),db.needsUpdate){e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,db.flipY);var ma=db instanceof WALK.CompressedTexture,Ma=db.image,Qa=db.format,Ya=db.type,cb=
f(Qa,Ya);n(e.TEXTURE_CUBE_MAP,db);for(eb=0;6>eb;eb++)if(ma){var Na=Ma[eb].mipmaps;gb=0;for(var mb=Na.length;gb<mb;gb++){var Cb=Na[gb];db.format!==GLC.RGBA&&db.format!==GLC.RGB?e.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+eb,gb,cb,Cb.width,Cb.height,0,Cb.data):e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+eb,gb,cb,Cb.width,Cb.height,0,Qa,Ya,Cb.data);db.releaseOnLoadedToGpu&&(Cb.data=null)}}else e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+eb,0,cb,Qa,Ya,Ma[eb]),db.releaseOnLoadedToGpu&&(Ma[eb]=null);
db.generateMipmaps&&e.generateMipmap(e.TEXTURE_CUBE_MAP);db.needsUpdate=!1}}else db=Sa,db.needsUpdate?u(db):(e.activeTexture(e.TEXTURE0+db.__webglSlot),e.bindTexture(e.TEXTURE_2D,db.__webglTexture));wa.unlockAllSlots()}L=void 0;ia=Ja;za.matrixWorld?(sa.multiplyMatrices(Ga.matrixWorldInverse,za.matrixWorld),L=sa):L=Ga.matrixWorldInverse;e.uniformMatrix4fv(ia.modelViewMatrix,!1,L.elements);ia.normalMatrix&&(Da.getNormalMatrix(L),e.uniformMatrix3fv(ia.normalMatrix,!1,Da.elements));null!==Ja.modelMatrix&&
(za.matrixWorld?e.uniformMatrix4fv(Ja.modelMatrix,!1,za.matrixWorld.elements):e.uniformMatrix4fv(Ja.modelMatrix,!1,ta));var Ub=Ia;Ga=!1;if(Ea.id!==aa||Ub.id!==U)aa=Ea.id,Ga=!0;console.assert(za instanceof THREE.Mesh);var Vb=e.TRIANGLES,Nb=Ea.attributes.index;if(Nb){var mc=Nb.glType;Ta=Ea.indexUint?4:2;Ga&&(q(Pa,Ub,Ea),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,Nb.buffer));void 0!==Ea.indexOffset?(Ca=Ea.indexCnt,ja=Ta*Ea.indexOffset):(Ca=Nb.length,ja=0);Ea.isInstanced?e.drawElementsInstanced(Vb,Ca,mc,ja,
Ea.instanceCount):e.drawElements(Vb,Ca,mc,ja)}else{Ga&&q(Pa,Ub,Ea);var sb=Ea.attributes.position;void 0!==Ea.vertexOffset?(ha=Ea.vertexCnt,pa=Ea.vertexOffset):(ha=sb.length/sb.itemSize,pa=0);Ea.isInstanced?e.drawArraysInstanced(Vb,pa,ha,Ea.instanceCount):e.drawArrays(Vb,pa,ha)}S&&fa.resetAttributeDivisors()}}catch(nc){console.error("Failed to render material "+(V?V.name:"null")+": "+nc.stack)}}}function I(Q,J){e.bindRenderbuffer(e.RENDERBUFFER,Q);J.depthBuffer?(e.renderbufferStorage(e.RENDERBUFFER,
e.DEPTH_STENCIL,J.width,J.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,Q)):e.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,J.width,J.height)}function F(Q,J){J.addEventListener("dispose",m);J.__webglTexture=e.createTexture();var N=J.format,V=J.type,ra=f(N,V);wa.setSlot(J,!1);e.activeTexture(e.TEXTURE0+J.__webglSlot);if(Q){e.bindTexture(e.TEXTURE_CUBE_MAP,J.__webglTexture);n(e.TEXTURE_CUBE_MAP,J);for(Q=0;6>Q;Q++){J.__webglFramebuffer[Q]=e.createFramebuffer();
J.__webglRenderbuffer[Q]=e.createRenderbuffer();e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Q,0,ra,J.width,J.height,0,N,V,null);var ka=e.TEXTURE_CUBE_MAP_POSITIVE_X+Q,za=J.__webglTexture;e.bindFramebuffer(e.FRAMEBUFFER,J.__webglFramebuffer[Q]);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,ka,za,0);I(J.__webglRenderbuffer[Q],J)}J.generateMipmaps&&e.generateMipmap(e.TEXTURE_CUBE_MAP)}else J.__webglFramebuffer=e.createFramebuffer(),J.__webglRenderbuffer=J.shareDepthFrom?J.shareDepthFrom.__webglRenderbuffer:
e.createRenderbuffer(),e.bindTexture(e.TEXTURE_2D,J.__webglTexture),n(e.TEXTURE_2D,J),e.texImage2D(e.TEXTURE_2D,0,ra,J.width,J.height,0,N,V,null),N=e.TEXTURE_2D,V=J.__webglTexture,e.bindFramebuffer(e.FRAMEBUFFER,J.__webglFramebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,N,V,0),J.shareDepthFrom?J.depthBuffer&&e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,J.__webglRenderbuffer):I(J.__webglRenderbuffer,J),J.generateMipmaps&&e.generateMipmap(e.TEXTURE_2D);
e.bindRenderbuffer(e.RENDERBUFFER,null);e.bindFramebuffer(e.FRAMEBUFFER,null)}var E=new THREE.Color(0),K=0,M=[],Z=[];this.domElement=d;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;var C=this,U,O,W,aa,R,S,fa,X,qa=new WALK.Frustum,na=new THREE.Matrix4,xa=new THREE.Vector3;g();b(e,WALK.DETECTOR);this.webGLContextRestored=function(){g()};this.context=e;this.state=fa;var wa=c(e),ta=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setCanvasSize=
function(Q,J){d.width=Q;d.height=J;null===O&&this.setViewport(0,0,Q,J)};this.setViewport=function(Q,J,N,V){fa.setViewport(Q,J,N,V)};this.setScissor=function(Q,J,N,V){e.scissor(Q,J,N,V)};this.enableScissorTest=function(Q){Q?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST)};this.setClearColor=function(Q,J){E.copy(Q);K=void 0!==J?J:1;e.clearColor(E.r,E.g,E.b,K)};this.getClearColor=function(){return E};this.getClearAlpha=function(){return K};this.clear=function(Q,J,N){var V=0;Q&&(V|=e.COLOR_BUFFER_BIT);
J&&(V|=e.DEPTH_BUFFER_BIT);N&&(V|=e.STENCIL_BUFFER_BIT);e.clear(V)};this.clearColor=function(){e.clear(e.COLOR_BUFFER_BIT)};this.clearDepth=function(){e.clear(e.DEPTH_BUFFER_BIT)};this.clearStencil=function(){e.clear(e.STENCIL_BUFFER_BIT)};this.deallocateRenderTargetRenderingBuffers=function(Q){if(Q.isCube)for(var J=0;6>J;J++)e.deleteFramebuffer(Q.__webglFramebuffer[J]),e.deleteRenderbuffer(Q.__webglRenderbuffer[J]);else e.deleteFramebuffer(Q.__webglFramebuffer),e.deleteRenderbuffer(Q.__webglRenderbuffer);
Q.__webglFramebuffer=null;Q.__webglRenderbuffer=null};var sa=new THREE.Matrix4,Da=new THREE.Matrix3;this.setRenderTarget=function(Q){if(Q){var J=Q.isCube?Q.__webglFramebuffer[Q.activeCubeFace]:Q.__webglFramebuffer;var N=Q.x;var V=Q.y;var ra=Q.width;Q=Q.height}else J=null,V=N=0,ra=d.width,Q=d.height;J!==O&&(e.bindFramebuffer(e.FRAMEBUFFER,J),O=J);fa.setViewport(N,V,ra,Q)};this.render=function(Q,J,N,V){this.renderMeshes(Q.children,Q.overrideMaterial,J,N,V)};this.renderMeshes=function(Q,J,N,V,ra,ka){aa=
null;W=-1;R=null;N.matrixWorldInverse.getInverse(N.matrixWorld);na.multiplyMatrices(N.projectionMatrix,N.matrixWorldInverse);qa.setFromMatrix(na);M.length=0;Z.length=0;ka=void 0===ka?!1:ka;for(var za=0;za<Q.length;za+=1)x(Q[za],J,ka);!0===C.sortObjects&&(M.sort(p),Z.sort(r));this.setRenderTarget(V);(this.autoClear||ra)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);B(M,N,J);B(Z,N,J);V&&V.generateMipmaps&&(Q=wa.setSlot(V,!1),e.activeTexture(e.TEXTURE0+V.__webglSlot),V.isCube?
(Q&&e.bindTexture(e.TEXTURE_CUBE_MAP,V.__webglTexture),e.generateMipmap(e.TEXTURE_CUBE_MAP)):(Q&&e.bindTexture(e.TEXTURE_2D,V.__webglTexture),e.generateMipmap(e.TEXTURE_2D)));fa.setDepthTest(!0);fa.setDepthWrite(!0);fa.setColorWrite(!0);fa.resetAttributeStates()};this.uploadNewBuffers=function(Q){var J=Q.geometry;Q=J.attributes;var N=J.attributesKeys;void 0===J.__webglInit&&(J.__webglInit=!0,J.addEventListener("dispose",k));console.assert(J instanceof THREE.BufferGeometry);J=0;for(var V=N.length;J<
V;J+=1){var ra=N[J],ka=Q[ra];ra="index"===ra?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER;if(ka.buffer)!0===ka.needsUpdate&&console.assert(!1);else{ka.buffer=e.createBuffer();e.bindBuffer(ra,ka.buffer);var za=ka.array;WALK.DETECTOR.ios&&ra===e.ARRAY_BUFFER&&console.assert(0===ka.itemSize*za.BYTES_PER_ELEMENT%4);e.bufferData(ra,za,e.STATIC_DRAW);za instanceof Float32Array?ka.glType=e.FLOAT:za instanceof Int8Array?ka.glType=e.BYTE:za instanceof Int16Array?ka.glType=e.SHORT:za instanceof Uint16Array?ka.glType=
e.UNSIGNED_SHORT:za instanceof Uint32Array?ka.glType=e.UNSIGNED_INT:console.assert(!1);ka.releaseOnLoadedToGpu&&(ka.array=null);ka.needsUpdate=!1}}};this.uploadTexture=function(Q){wa.setSlot(Q,!1);u(Q)};this.copyBufferToCubeFaceMip=function(Q,J,N,V,ra){wa.setSlot(ra,!1);e.activeTexture(e.TEXTURE0+ra.__webglSlot);e.bindTexture(e.TEXTURE_CUBE_MAP,ra.__webglTexture);e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+N,Q,e.RGBA,J,J,0,e.RGBA,e.UNSIGNED_BYTE,V)};this.createCubeTexture=function(Q,J){var N=new WALK.Texture;
N.isCube=!0;N.minFilter=J?GLC.LINEAR_MIPMAP_NEAREST:GLC.LINEAR;N.generateMipmaps=!1;N.needsUpdate=!1;N.addEventListener("dispose",h);N.__webglTexture=e.createTexture();wa.setSlot(N,!1);e.activeTexture(e.TEXTURE0+N.__webglSlot);e.bindTexture(e.TEXTURE_CUBE_MAP,N.__webglTexture);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,
e.LINEAR);J?e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST):e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(var V=0;6>V;V+=1)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+V,0,e.RGBA,Q,Q,0,e.RGBA,e.UNSIGNED_BYTE,null);J&&e.generateMipmap(e.TEXTURE_CUBE_MAP);return N};this.createFrameBufferRenderTarget=function(Q){return new WALK.WebGLRenderTargetVR(Q)};this.createRenderTarget=function(Q,J,N){Q=new WALK.WebGLRenderTarget(Q,J,N);F(!1,Q);return Q};this.createRenderTargetCube=
function(Q,J,N){Q=new WALK.WebGLRenderTargetCube(Q,J,N);F(!0,Q);return Q};this.readPixels=function(Q,J,N){e.readPixels(0,0,Q,J,e.RGBA,e.UNSIGNED_BYTE,N)}}})();(function(){var a={minFilter:GLC.LINEAR,magFilter:GLC.LINEAR,format:GLC.RGBA,stencilBuffer:!1,generateMipmaps:!1};WALK.createRenderer=function(b,c){void 0===c.alpha&&(c.alpha=!0);void 0===c.depth&&(c.depth=!0);void 0===c.stencil&&(c.stencil=!1);void 0===c.premultipliedAlpha&&(c.premultipliedAlpha=!0);void 0===c.antialias&&(c.antialias=!0);void 0===c.preserveDrawingBuffer&&(c.preserveDrawingBuffer=!1);try{var d=(WALK.FORCE_WEBGL1||WALK.DETECTOR.ios?null:b.getContext("webgl2",c))||b.getContext("webgl",
c)||b.getContext("experimental-webgl",c)}catch(e){d=null}c=d;if(!c)return null;WALK.DETECTOR.resetGlDetector(c);WALK.DETECTOR.gl.reportToConsole();return new WALK.WebGLRenderer(b,c)};WALK.createWebwalkRenderer=function(b){if(b=WALK.createRenderer(b,{antialias:!WALK.FORCE_FXAA}))b.autoClear=!0,b.autoClearColor=!1,b.autoClearDepth=!0,b.autoClearStencil=!1,b.sortObjects=!0;return b};WALK.Renderer=function(b,c,d,e){var f=null,g,k,h=d.camera,m=d.threeScene,l=function(){var q=new WALK.Frustum,n=new THREE.Matrix4;
return function(p){if(0!==d.mirrors.length){p.matrixWorldInverse.getInverse(p.matrixWorld);n.multiplyMatrices(p.projectionMatrix,p.matrixWorldInverse);q.setFromMatrix(n);for(var r=0;r<d.mirrors.length;r+=1){var x=d.mirrors[r];x.updateCameraPosition(p,q);x.inFrustum()&&x.render(b)}}}}();this.resize=function(q){if(!q){var n=window.innerWidth;var p=window.innerHeight;var r=n*window.devicePixelRatio;var x=p*window.devicePixelRatio;h.aspect=r/x;h.updateProjectionMatrix();b.setCanvasSize(r,x);b.domElement.style.width=
n+"px";b.domElement.style.height=p+"px";g&&(g.configureTarget(r,x,a),k.setTargets(g.renderTarget1,g.renderTarget2));f&&f.uniforms.resolution.value.set(1/r,1/x)}n=x;q?(q=r/2,r=70):(q=r,r=h.fov);p=q/n;for(x=0;x<d.mirrors.length;x+=1)d.mirrors[x].configure(q,n,p,r)};this.renderIdle=function(q,n){0===n&&(e.adaptExposure(),k&&k.reset());if(e.exposureNeedsUpdate())return this.renderToScreen(q,!1),!0;if(!k)return!1;k.renderSample();4<=k.renderedSamplesCount()&&k.renderAccumulatedSamplesToScreen();return!k.allSamplesRendered()};
this.renderToScreen=function(q,n){e.update(q);n?c.render(m,h.matrixWorld,l):(l(h),f?g.render(q):b.render(m,h))};this.enableAutoExposure=function(){e.enableAutoExposure()};this.disableAutoExposure=function(){e.disableAutoExposure()};(function(){if(WALK.DETECTOR.gl.antialiasPostprocess){g=new THREE.EffectComposer(b);if(!WALK.DETECTOR.gl.antialiasNative){WALK.log("using FXAA");b.autoClear=!1;f=new THREE.ShaderPass(THREE.FXAAShader);f.clear=!1;f.renderToScreen=!0;f.material.depthTest=!1;f.material.depthWrite=
!1;f.uniforms.resolution.value.set(1/window.innerWidth,1/window.innerHeight);var q=new THREE.RenderPass(m,h);g.addPass(q);g.addPass(f)}k=new WALK.SsaaRenderer(b,d)}})()}})();(function(){function a(c,d,e){var f=[],g=[],k=[{totalFovFraction:.25,count:2},{totalFovFraction:.25,count:16},{totalFovFraction:.375,count:48},{totalFovFraction:.125,count:8}];(function(){for(var h=0,m=0,l=0,q=0;q<k.length;q++){var n=k[q],p=n.totalFovFraction*c/n.count;console.assert(p===Math.floor(p),"Height ("+p+")must be an integer");var r=n.totalFovFraction*Math.PI/2/n.count,x=b(e,4*d,4*p,GLC.LINEAR,!0);g.push(x);for(var w=0;w<n.count;w++)f.push({fov:r,fovOffset:h+(w+.5)*r,height:p,yOffset:m+
w*p,renderTarget:x});h+=n.count*r;m+=n.count*p;l+=n.totalFovFraction}console.assert(1===l,"Invalid fractions sum");console.assert(h===Math.PI/2,"Invalid fov definition for rectangles");console.assert(m===c,"Invalid rectangles height")})();this.getRectangleHeight=function(h){return f[h].height};this.getRectangleOffset=function(h){return f[h].yOffset};this.getRectangleFov=function(h){return f[h].fov};this.getRectangleFovOffset=function(h){return f[h].fovOffset};this.getRectangleRenderTarget=function(h){return f[h].renderTarget};
this.dispose=function(){g.forEach(function(h){h.dispose()});f.length=0;g.length=0};this.getRectangleCount=function(){return f.length}}var b=function(c,d,e,f,g){return c.createRenderTarget(d,e,{format:GLC.RGBA,magFilter:f,minFilter:f,depthBuffer:g,stencilBuffer:!1,generateMipmaps:!1})};WALK.ScreenshotTaker=function(c,d,e){function f(){var r=(document.body.offsetWidth-document.body.offsetHeight*m)/2,x=r+"px";r=Math.max(r,0)+"px";l.style.width=r;q.style.width=r;n.style.left=x;n.style.right=x}function g(r,
x,w,u,A,B){var I=d.camera.near,F=d.camera.far;console.assert(0===w%512,"Invalid width for stereo panorama");var E=w/2,K=new THREE.Vector3(0,-1,0),M=E/2,Z=2*Math.PI/512,C=w/512,U=-C,O=Symbol("Bottom"),W=Symbol("Top"),aa=Math.floor(x/Z)*Z,R=I*Math.tan(Z/2),S=new THREE.PerspectiveCamera;S.up.set(0,0,1);var fa=new a(M,C,c),X=fa.getRectangleCount(),qa=new THREE.Vector3,na=new THREE.Vector3,xa=new THREE.Vector3,wa=new THREE.Matrix4,ta=function(za,Ea,pa,ha){Ea=-(Ea*Z-aa);za=za===W?-fa.getRectangleFovOffset(pa):
fa.getRectangleFovOffset(pa);qa.set(ha,0,0).applyMatrix4(wa.makeRotationZ(Ea));S.position.copy(r).add(qa);na.copy(K).applyMatrix4(wa.makeRotationX(za)).applyMatrix4(wa.makeRotationZ(Ea));xa.copy(S.position).add(na);S.lookAt(xa);pa=I*Math.tan(fa.getRectangleFov(pa)/2);ha=R*Math.cos(za);S.projectionMatrix.makeFrustum(-ha,ha,-pa,pa,I,F);S.updateMatrix();S.updateMatrixWorld()},sa=b(c,w,2*E,GLC.NEAREST,!1);sa.width=C;var Da=new WALK.AccumulatePass,Q=function(za){sa.dispose();fa.dispose();Da.dispose();
A(za)},J=[{hemisphere:W,eyeOffset:.03,parallaxOffset:U,targetYOffset:E},{hemisphere:O,eyeOffset:.03,parallaxOffset:U,targetYOffset:E},{hemisphere:W,eyeOffset:-.03,parallaxOffset:C,targetYOffset:0},{hemisphere:O,eyeOffset:-.03,parallaxOffset:C,targetYOffset:0}],N=function(za,Ea){Ea++;if(512===Ea){za++;if(za===J.length)return[-1,-1];Ea=0}return[za,Ea]},V=512*J.length,ra=Math.ceil(V/100),ka=function(za,Ea){for(var pa=J[za].hemisphere,ha=J[za].eyeOffset,ja=J[za].parallaxOffset,Ca=J[za].targetYOffset,
Ta=0;Ta<X;Ta++){ta(pa,Ea,Ta,ha);var Pa=fa.getRectangleRenderTarget(Ta);c.render(d.threeScene,S,Pa);var Ga=fa.getRectangleHeight(Ta),L=fa.getRectangleOffset(Ta);sa.y=pa===W?Ca+M+L:Ca+M-L-Ga;sa.x=(Ea*C+ja+w)%w;sa.height=Ga;Da.render(c,sa,Pa)}B()?Q(null):(pa=$jscomp.makeIterator(N(za,Ea)),za=pa.next().value,Ea=pa.next().value,-1===za?(pa=new Uint8Array(2*w*E*4),c.readPixels(w,2*E,pa),Q(pa)):(0===Ea%ra&&u({done:512*za+Ea,total:V}),setTimeout(function(){return ka(za,Ea)},0)))};ka(0,0)}function k(r,x,w,
u){var A=new WALK.CubeCamera(d.camera.near,d.camera.far);A.rotateZ(x);A.position.copy(r);A.updateMatrixWorld();r=c.createRenderTargetCube(4096,4096,{format:GLC.RGBA,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR,stencilBuffer:!1,generateMipmaps:!1});for(x=0;6>x;x+=1)r.activeCubeFace=x,c.render(d.threeScene,A.sideCameras[x],r);A=b(c,w,u,GLC.NEAREST,!0);x={uniforms:{panoramaCube:{type:"t",value:null}},vertexShader:WALK.getShader("cube_to_equirect_vertex.glsl"),fragmentShader:WALK.getShader("cube_to_equirect_fragment.glsl")};
x=new THREE.ShaderPass(x,"panoramaCube");x.render(c,A,r);x.dispose();r.dispose();r=new Uint8Array(w*u*4);c.readPixels(w,u,r);A.dispose();return r}function h(r,x){var w=b(c,r,x,GLC.NEAREST,!0);r=b(c,r,x,GLC.NEAREST,!1);x=new WALK.SsaaRenderer(c,d);for(x.setTargets(w,r);!x.allSamplesRendered();)x.renderSample();var u=x.copyAccumulatedSamplesToBuffer();w.dispose();r.dispose();x.dispose();return u}var m=null,l=null,q=null,n=null,p=new THREE.Vector3;this.markArea=function(r){function x(u,A){u.style.zIndex=
1;u.style.pointerEvents="none";u.style.position="absolute";u.style.top=0;u.style.bottom=0;u.style[A]=0;u.style.backgroundColor="rgba(0, 0, 0, 0.5)"}function w(u){u.style.zIndex=1;u.style.pointerEvents="none";u.style.position="absolute";u.style.boxSizing="border-box";u.style.top=0;u.style.bottom=0;u.style.border="4px solid rgba(35, 181, 233, 0.5)"}n||(l=document.createElement("div"),x(l,"left"),q=document.createElement("div"),x(q,"right"),n=document.createElement("div"),w(n),document.body.appendChild(l),
document.body.appendChild(q),document.body.appendChild(n),window.addEventListener("resize",f));m=r;f()};this.unmarkArea=function(){n&&(l.remove(),q.remove(),n.remove(),window.removeEventListener("resize",f),n=q=l=m=null)};this.monoScreenToBuffer=function(r,x,w){return r?k(e.cameraWorldPosition(),e.getYawAngle(),x,w):h(x,w)};this.stereoPanoramaToBuffer=function(r,x,w,u){g(e.cameraWorldPosition(),e.getYawAngle(),r,x,w,u)};this.monoScreenToDataUrl=function(r,x,w){r=this.monoScreenToBuffer(r,x,w);for(var u=
0;u<w;++u)for(var A=0;A<x;++A){var B=4*(u*x+A);if(u<w/2)for(var I=4*((w-u-1)*x+A),F=0;3>F;++F){var E=r[B+F];r[B+F]=r[I+F];r[I+F]=E}r[B+3]=255}r=new Uint8ClampedArray(r);r=new ImageData(r,x,w);u=document.createElement("canvas");u.width=x;u.height=w;u.getContext("2d").putImageData(r,0,0);return u.toDataURL("image/jpeg")};this.monoScreenToLocalImage=function(r,x,w){r=this.monoScreenToDataUrl(r,x,w);navigator.msSaveOrOpenBlob?fetch(r).then(function(u){return u.blob()}).then(function(u){return navigator.msSaveOrOpenBlob(u,
"screen.jpg")}):(x=document.createElement("a"),document.body.appendChild(x),x.style.cssText="display: none",x.href=r,x.download="screenshot",x.click(),window.URL.revokeObjectURL(r),x.parentNode.removeChild(x))};this.coverToServer=function(r,x){var w=h(r,x);WALK.ajaxPost("screenshot?width="+r+"&height="+x,"application/binary",w)};this.monoPanoramaToServer=function(r,x){r.position?p.fromArray(r.position):p.copy(e.cameraWorldPosition());var w=void 0!==r.width?r.width:8E3,u=void 0!==r.height?r.height:
4E3,A=$jscomp,B=A.makeIterator;var I=Math.min(WALK.MAX_PANORAMA_SIZE,WALK.DETECTOR.gl.maxRenderBufferSize);if(w<=I&&u<=I)w=[w,u];else{var F=w/u;w=w>u?[I,Math.floor(I/F)]:[Math.floor(I*F),I]}u=B.call(A,w);w=u.next().value;u=u.next().value;A=void 0!==r.rotation?THREE.Math.degToRad(r.rotation):0;A=k(p,A,w,u);WALK.ajaxPost("panorama?width="+w+"&height="+u+"&name="+r.name,"application/binary",A,x,x)}}})();(function(){function a(f,g,k){f=new WALK.OutlineMaterial(k,f/g);g=new WALK.StandardMaterial;g.lightMapped=!0;g.setUniforms();return{outlineMaterial:f,planMaterial:g}}function b(f){f=f.size().y/f.size().x;return{width:1>f?700:Math.round(1/f*700),height:1>f?Math.round(700*f):700}}function c(f,g,k,h){f=Math.max(f,g);k=Math.max(k.size().x,k.size().y);return f/k*h}function d(f,g,k){for(var h=0;h<k;++h)for(var m=0;m<g;++m){var l=4*(h*g+m);if(h<k/2)for(var q=4*((k-h-1)*g+m),n=0;4>n;++n){var p=f[l+n];f[l+
n]=f[q+n];f[q+n]=p}}}function e(f,g){return 1>f[g+3]&&0===g%4}WALK.MinimapRenderer=function(f,g){function k(p,r,x,w,u,A){A=void 0===A?!0:A;var B=new WALK.AutoClearAlter(f);B.set(!0,!0,!1);r.near=x;r.far=w;r.updateProjectionMatrix();p instanceof WALK.StandardMaterial&&!g.hasLightMap()&&(p.lightMapped=!1,p.specularOff=!0);A?(x=g.gpuMeshes.filter(function(I){return!I.material.transparent}),f.renderMeshes(x,p,r,u)):f.renderMeshes(g.gpuMeshes,p,r,u);p=new Uint8Array(m*l*4);f.readPixels(m,l,p);B.restore();
d(p,m,l);return p}var h=b(g.boundingBox),m=h.width,l=h.height,q=c(m,l,g.boundingBox,.1),n=a(g.minimapConfig.outlineThickness,q,g.minimapConfig.outlineColor);this.createMinimapImageDataComponents=function(p,r){n.outlineMaterial.setUniform("thickness","f",p.outlineThickness/q);var x=f.createRenderTarget(m,l,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,generateMipmaps:!1});p=new THREE.OrthographicCamera(r.cropRange.min.x,r.cropRange.max.x,r.cropRange.max.y,r.cropRange.min.y,
0,10);p.position.set(0,0,r.slicePlaneHeight);p.updateMatrixWorld(!0);var w=r.slicePlaneHeight-r.farPlaneHeight;r=k(n.outlineMaterial,p,0,.1,x);p=k(n.planMaterial,p,0,w,x);x.dispose();if(g.minimapConfig.fillEnabled){x=g.minimapConfig.outlineColor;var u=void 0;u=void 0===u?.02:u;w=new Uint8Array(r.length);u*=r.length/4;for(var A=[-4,4,4*-m,4*m],B=0;B<r.length;B+=4)if(0===w[B]&&e(r,B)){var I=[],F=[],E=B,K=F;w[E]=1;for(K.push(E);F.length;){E=F.pop();I.push(E);K=F;for(var M=0;M<A.length;++M){var Z=E+A[M];
if(Z=0===w[Z]&&e(r,Z)){Z=E+A[M];var C=K;w[Z]=1;C.push(Z)}}}if(I.length<u)for(F=x,E=0;E<I.length;++E)r[I[E]]=255*F.r,r[I[E]+1]=255*F.g,r[I[E]+2]=255*F.b,r[I[E]+3]=255}}x=new Uint8Array(p.length);for(w=0;w<p.length;w+=4)if(0!==p[w+3]&&0===w%4&&e(r,w))for(u=0;4>u;++u)x[w+u]=255;if(0<g.minimapConfig.outlineThickness)for(w=0;w<p.length;w+=4)if(0!==r[w+3]&&0===w%4)for(u=0;4>u;++u)p[w+u]=r[w+u];r=new Uint8ClampedArray(p.buffer);r=new ImageData(r,m,l);p=new Uint8ClampedArray(x.buffer);p=new ImageData(p,m,
l);return{minimapImageData:r,walkableImageData:p}};this.getMinimapSize=function(){return{width:m,height:l}}}})();(function(){WALK.InteractionDispatcher=function(a,b,c,d,e,f,g,k){function h(F,E){F=F?e:d;for(var K=0;K<F.length;K+=1)if(F[K](E.object,E.point,E.distance))return!0;return!1}function m(){return b.findIntersectionAtPosition(0,0,!0,x)}function l(){h(!1,x)}function q(F,E,K){k&&k.reset();return b.findIntersectionAtPosition(F,E,!0,A)?h(K,A):!1}function n(F){k&&k.reset();F.action===WALK.GAMEPAD_ACTION.TRIGGER&&q(0,0,!1)}function p(F,E){for(var K=0;K<f.length&&!f[K](F,E);K+=1);}var r=!1,x=new WALK.RayIntersection,
w=null;k&&k.setGazeHandlers(m,l);var u=new WALK.PointerEventHelper(a,WALK.POINTER_PRIORITY.INTERACTION_DISPATCHER);a=u.callbacks;var A=new WALK.RayIntersection,B=null,I=null;a.onPointerMove=function(F,E){console.assert(r);0!==f.length&&(B=F,I=E,c());return!1};a.onClick=function(F,E){return q(F,E,!1)};a.onDoubleClick=function(F,E){return q(F,E,!0)};g.addEventListener("actionActivated",n);this.handleHover=function(){if(r&&0!==f.length){var F=b.findObstacleMeshAtPosition(B,I,!0);null===F?w&&(p(w,!1),
w=null):F!==w&&(w&&p(w,!1),p(F,!0),w=F)}};this.enable=function(){r=!0;u.enable();console.assert(null===w)};this.disable=function(){r=!1;null!==w&&(p(w,!1),w=null);u.disable()};this.dispose=function(){this.disable();g.removeEventListener("actionActivated",n)};this.enable()}})();(function(){function a(ca,ya){return ra.renderIdle(ca,ya)}function b(ca,ya){ya&&P.update();ja.update(ca);WALK.ENABLE_MINIMAP&&V.minimapConfig.enabled&&Ja.update();Da.enableCollisions&&!ya&&ka.handleCollisions(ca);pa&&pa.handleHover();ha.update(ca);ta.update(ca);za&&za.updateCameraHeight(ca);Ea&&Ea.updateCameraHeight();ya&&!ja.teleportingToPoint&&(xa.update(),sa.requestFrame());Ca&&(ya&&!P.hasGamepads()?Ca.update(ca):Ca.reset());for(var ma=!1,Ma=$jscomp.makeIterator(V.getAnimatedRootNodes()),Qa=Ma.next();!Qa.done;Qa=
Ma.next())Qa.value.update(ca,ta.cameraWorldPosition())&&(ma=!0);Ma=$jscomp.makeIterator(V.getAnimatedMaterials());for(Qa=Ma.next();!Qa.done;Qa=Ma.next())Qa=Qa.value,Qa.isPlaying&&(Qa.update(ca),ma=!0);ma&&sa.requestFrame();Ga&&Ga.update(ca);la._update(ca);ra.renderToScreen(ca,ya);ia&&ia.animate()}function c(ca){ca.view&&(za&&za.disable(),pa&&pa.disable())}function d(ca){!za||za.isEnabled()||xa.vrEnabled()||za.enable();if(Ea&&xa.vrEnabled())Ea.onTeleportDone();ca.view&&pa&&pa.enable();xa.vrEnabled()&&
ta.hmdReset()}function e(){if("hidden"===document.visibilityState){if(V)for(var ca=$jscomp.makeIterator(V.getAnimatedMaterials()),ya=ca.next();!ya.done;ya=ca.next())ya.value.sleepAnimation()}else if("visible"===document.visibilityState&&V){ca=$jscomp.makeIterator(V.getAnimatedMaterials());for(ya=ca.next();!ya.done;ya=ca.next())ya.value.wakeAnimation();sa.requestFrame()}}function f(){WALK.DETECTOR.ios&&(document.documentElement.style.height=window.innerHeight+"px",0!==document.body.scrollTop&&window.scrollTo(0,
0));ra.resize(xa.vrEnabled());sa.requestFrame();Y.onResize()}function g(){return document.pointerLockElement===X||document.mozPointerLockElement===X||document.webkitPointerLockElement===X}function k(){return document.fullscreenElement||document.mozFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}function h(){if(g()){ta.mousePressLook=!1;Y.onPointerLockChange(!0);var ca=WALK.urlHashContains("gazeinpointerlock");ca?gb.enableMode():gb.disableMode();
la.anchorsVisible=ca}else ta.mousePressLook=!0,Y.onPointerLockChange(!1),gb.disableMode(),la.anchorsVisible=!0;ia&&dat.GUI.toggleHide()}function m(){if(k())Y.onFullScreenChange(!0),screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary");else Y.onFullScreenChange(!1)}function l(){var ca=document.body;return void 0!==document.fullscreenEnabled||void 0!==document.webkitFullscreenEnabled||void 0!==document.mozFullScreenEnabled||void 0!==document.msFullscreenEnabled?!!(document.fullscreenEnabled||
document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled):void 0!==ca.mozRequestFullScreen||void 0!==ca.webkitRequestFullscreen||void 0!==ca.msRequestFullscreen||void 0!==ca.requestFullscreen}function q(ca){na.uploadNewBuffers(ca);sa&&sa.requestFrame()}function n(ca){na.uploadTexture(ca);ca.isAtlas()?ca.forEachAtlasEntry(function(ya){console.assert(null===ya.isCutout);Aa.isCutoutTexture(ya)}):null===ca.isCutout&&Aa.isCutoutTexture(ca);sa&&sa.requestFrame()}function p(ca){ca=
[];var ya=[],ma=[];ca.push(la._clickListener.bind(la));var Ma=la._createHoverListener();Ma&&ma.push(Ma);ha=new WALK.ClickNavigator(V,ka,ta,ja);ya.push(ha.onMeshClicked);qa||ca.push(ha.onMeshClicked);pa=new WALK.InteractionDispatcher(Q,ka,function(){sa.requestFrame()},ca,ya,ma,P,Ca)}function r(){za&&za.disable();Ea&&Ea.enable();ta.mouseControlsPitch=!1;ta.hmdReset();ja.onVrChange(!0);gb.enableMode();Y.onVrChange(!0);la._vrChange(!0);f()}function x(ca){sa.isEnabled()&&(ca?r():(ta.resetRollAngle(),ta.resetPitchAngle(),
ta.mouseControlsPitch=!0,console.assert(!xa.vrEnabled()),Ea&&Ea.disable(),za&&za.enable(),ja.onVrChange(!1),gb.disableMode(),Y.onVrChange(!1),la._vrChange(!1),f(),setTimeout(f,1E3)))}function w(ca){qa||WALK.DETECTOR.mobile&&!WALK.ALLOW_MOBILE_VR||(WALK.DETECTOR.ios||WALK.DETECTOR.mobile&&WALK.DETECTOR.firefox)&&WALK.DETECTOR.inCrossOriginIframe||Y.setVrSupported(ca)}function u(ca,ya){if(Ea&&null!==ya)Ea.onHmdPositionUpdate(ya);ta.onHmdUpdate(ca,ya)}function A(ca,ya){ca&&ta.cameraWorldPosition().set(ca[0],
ca[1],ca[2]);ya&&(ca=new WALK.Euler,ca.setFromDegTriple(ya),ta.setYawAngle(ca.yaw),ta.setPitchAngle(ca.pitch))}function B(ca){for(var ya=0;ya<ca.length;ya+=1)if(!ca[ya].lightProbe)return!1;return!0}function I(ca,ya,ma){ka=new WALK.Collider(ca,ya,ma);ya.visitAllNodes(function(Ma){Ma.mesh&&ka.addStaticObstacle(Ma.mesh)})}function F(){var ca=THREE.Scene.prototype.add;THREE.Object3D.prototype.add=function(ya){ya instanceof THREE.Mesh&&na.uploadNewBuffers(ya);ca.call(this,ya)}}function E(ca){var ya=WALK.urlHashGetArgument("view"),
ma=null;ya&&(ma=ca.findViewByName(ya));return ma||ca.views[0]}function K(ca){function ya(){sa.requestFrame()}V=ca;V.adjustSkiesAndCameraFarToSpanWholeScene();V.headLight=WALK.HEAD_LIGHT;V.addEventListener("updated",function(){return sa.requestFrame()});V.addEventListener("anyViewUpdated",function(){return Y.refresh()});V.disableLightProbesForMaterials();ta.enable();V.threeScene.updateMatrixWorld(!0);xa.setCameraFar(V.camera.far);ra=new WALK.Renderer(na,xa,V,N);Q=new WALK.PointerEventDispatcher(na.domElement,
qa);if((ca=Da.enableCollisions)||qa)I(na,V,ta),ta.orbit.collider=ka;ja=new WALK.Teleport(V,ta,ka,sa);ja.addEventListener("teleportStarted",c);ja.addEventListener("teleportDone",d);Pa=new WALK.AutoTour(V,ja);ca&&V.camera.autoClimb&&(za=new WALK.StepsClimber(ka,ta,sa));ca&&(Ea=new WALK.VRHeightController(ta,ka));ja.switchToView(E(V),0);N.updateWithoutDelay();Ta=new WALK.HashChangeTeleport(V,ja);Ia=new WALK.ScreenshotTaker(na,V,ta);ca&&!WALK.urlHashContains("nogazeteleport")&&(Ca=new WALK.GazePointer(V,
ta,ya,gb));la._sceneReadyToDisplay(na,V,ta,ja,Pa,ka,Ia,J,gb,Q,sa,wa);p(ca);document.addEventListener("visibilitychange",e);window.addEventListener("resize",function(){WALK.DETECTOR.ios?setTimeout(f,1E3):f()},!1);l()&&Y.setFullScreenSupported();WALK.DETECTOR.mobile||WALK.DETECTOR.opera||void 0===document.pointerLockElement&&void 0===document.mozPointerLockElement&&void 0===document.webkitPointerLockElement||Y.setPointerLockSupported();Y.sceneReadyToDisplay(V,ja,Pa,Ia);f();WALK.DEBUG&&WALK.DebugUI&&
(ia=new WALK.DebugUI(V,ta,f,sa));WALK.focusWalkCanvas();WALK.DEBUG_SHARED_BUFFERS&&(V.threeScene.overrideMaterial=new WALK.DebugMaterial);V.startAutoTourOnLoad()&&Pa.start();sa.enable();xa.vrEnabled()&&r();eb=L.elapsedLoadTimeSec()}function M(ca){qa||WALK.urlHashContains("nostats")||0!==Ra||Y.cover.sendStats&&WALK.ajaxPost("./stats/"+ca,null,null)}function Z(ca,ya){function ma(Na){function mb(){Ya.delete(Cb);null!==ca.findLightProbe(Cb.id)&&(ya.assignLightProbesToObjects(),ya.createLightProbeTexture(Cb,
!1),sa.requestFrame())}var Cb=Na.target;Na=Ya.get(Cb);void 0===Na&&(Na=new WALK.DeferringExecutorOnce(mb,1E3),Ya.set(Cb,Na));Na.deferRun()}function Ma(Na){Na=Na.target;ya.createLightProbeTexture(Na,!0);if(!Na.isBoundingBoxInitialized()){var mb=Na.boxMax;Na.boxMin.copy(Na.position).addScalar(-1);mb.copy(Na.position).addScalar(1);Na.enableBoundingBox()}}function Qa(Na){for(Na=0;Na<ca.materials.length;Na+=1)ca.materials[Na].forceObjectUniformsRefresh()}var Ya=new Map;ca.addEventListener("lightProbeAdded",
function(Na){Na=Na.lightProbe;ya.assignLightProbesToObjects();ya.createLightProbeTexture(Na,!0);Na.isBoundingBoxInitialized()||Na.disableBoundingBox();Na.addEventListener("boundsInit",Ma);Na.addEventListener("positionUpdated",ma);Na.addEventListener("boundsUpdated",Qa)});ca.addEventListener("lightProbeRemoved",function(){ya.assignLightProbesToObjects()});for(var cb=0;cb<ca.lightProbes.length;cb+=1)ca.lightProbes[cb].addEventListener("positionUpdated",ma),ca.lightProbes[cb].addEventListener("boundsInit",
Ma),ca.lightProbes[cb].addEventListener("boundsUpdated",Qa)}function C(ca,ya,ma){function Ma(Ya){if(Ya===ca.length)ma();else{var cb=ca[Ya],Na=cb.name;Qa.has(Na)?Ma(Ya+1):(Qa.add(Na),ya.monoPanoramaToServer(cb,function(){return Ma(Ya+1)}))}}var Qa=new Set;Ma(0)}function U(ca){function ya(){if(Da.onSceneLoaded)Da.onSceneLoaded(new WALK.EditorHooks(ca,Y,ta,ja,Ga,wa,Ia,sa,Ja));Y.sceneLoadComplete();for(var Na=$jscomp.makeIterator(ca.getAnimatedMaterials()),mb=Na.next();!mb.done;mb=Na.next())mb.value.play();
la._sceneLoadComplete();sa.requestFrame();Na=L.elapsedLoadTimeSec();M("loaded?readyToDisplayTime="+eb.toFixed(1)+"&loadTime="+Na.toFixed(1));L=null}var ma=WALK.urlHashContains("headless");Aa.dispose();Aa=null;if(0<ca.lightProbes.length||qa){var Ma=new WALK.LightProbeMaker(ca,na,WALK.DETECTOR.gl.textureLod,WALK.DETECTOR.gl.mirrorCubeMaps,qa);0===ca.lightProbes.length&&qa&&ca.autoAddLightProbes&&WALK.arrangeLightProbes(ca,Ma,ma);if(0<ca.lightProbes.length){B(ca.gpuMeshes)||(console.warn("Some objects do not have light probes assigned, this is not optimal."),
Ma.assignLightProbesToObjects());var Qa;for(Qa=0;Qa<ca.views.length&&"orbit"===ca.views[Qa].mode;Qa+=1);Qa===ca.views.length&&(Qa=0);ja.executeWithViewVisibilitySettings(ca.views[Qa],function(){Ma.createAllLightProbeTextures()});ca.enableLightProbesForMaterials()}}ca.hasLightMap()&&ra.enableAutoExposure();if(qa){Ma?Z(ca,Ma):console.warn("Cube maps support is required in the edit mode");Qa=new WALK.LightControls(ca,sa);var Ya=new WALK.LightProbeControls(ca,sa),cb=new WALK.CameraVolumeControls(ca,sa);
Ga=new WALK.EditorSelector(Q,ca,na,ka,Qa,Ya,cb,sa,ta);Ia.coverToServer(WALK.EDITOR_COVER_WIDTH,WALK.EDITOR_COVER_HEIGHT);A(Da.forcedInitialCameraPosition,Da.forcedInitialCameraRotation)}else Ma&&(Ma.dispose(),Ma=null);WALK.ENABLE_MINIMAP&&(Va=new WALK.MinimapRenderer(na,ca),Ja=new WALK.Minimap(Va,ca,ja,la));qa&&ma?C(L.panoramas,Ia,ya):ya()}function O(){Sa&&(Sa=!1,L.load(),Y.sceneLoadStarted(),WALK.urlHashContains("help")&&(Y.helpVisible=!0),M("play"))}function W(ca){Y.updateCover(ca);wa.updateConfig(ca.extensions||
[]);WALK.DETECTOR.canForceBrotliBuffers=!0===ca.canForceBrotliBuffers;1===ca.webwalkLogMode?(WALK.logInfoMessages(),WALK.initLoggingToServer(!0)):2===ca.webwalkLogMode&&WALK.initLoggingToServer(!1);qa||wa.startExtensions();la._viewerConfigLoaded(ca);if(ca.language){var ya=WALK.STRINGS[ca.language];ya?WALK.updateViewerStrings(ya):console.log("Unknown language: "+ca.language)}Aa=new WALK.CutoutTextureDetector(na);Sa=!0;ca=new WALK.Scene(ta.camera());void 0!==Da.assetsUrl&&null!==Da.assetsUrl&&(WALK.ASSETS_URL=
Da.assetsUrl);L=new WALK.SceneLoader(ca,WALK.ASSETS_URL,qa,Ba);J=new WALK.LumaMeter(na,ca);N=new WALK.ExposureController(ca,ta,J);L.onProgress=Y.loadProgress;L.onTextureLoaded=n;L.onMeshBuffersLoaded=q;L.onReadyToDisplay=K;L.onComplete=U;WALK.urlHashContains("autoplay")||db||0<Ra?O():WALK.urlHashContains("hideplay")||Y.enablePlayButton(O)}function aa(ca){ca.preventDefault();Ra+=1;sa.disable();!qa&&null===L&&Ra<=WALK.CONTEXT_LOST_RESTORE_LIMIT?(wa.stopExtensions(),la._contextLost(),Ta.dispose(),Ta=
null,pa.dispose(),pa=null,ha&&(ha.dispose(),ha=null),Y.contextLost()):WALK.USER_MSG.error("Graphics context lost, reload to retry.")}function R(ca){ca.preventDefault();!qa&&null===L&&Ra<=WALK.CONTEXT_LOST_RESTORE_LIMIT&&(WALK.USER_MSG.info("Graphics context switched, reloading the scene to use the new context.",5E3),WALK.DETECTOR.resetGlDetector(na.context),WALK.DETECTOR.gl.reportToConsole(),na.webGLContextRestored(),W(Y.cover))}function S(){WALK.ajaxGet(WALK.COVER_JSON_URL,!1,function(ca){WALK.DETECTOR.onAsyncPropertiesDetected(function(){W(ca)})},
function(){WALK.USER_MSG.error("Failed to initialize the scene.")})}function fa(ca){F();Da=ca;if(na=WALK.createWebwalkRenderer(X))if(WALK.DETECTOR.gl.missingCapabilities)WALK.USER_MSG.error(WALK.DETECTOR.gl.missingCapabilities);else{X.addEventListener("webglcontextlost",aa,!1);X.addEventListener("webglcontextrestored",R,!1);Y.init();wa=new WALK.ExtensionManager;ca=null;try{WALK.urlHashContains("vrlo")?WebXRConfig.cardboardConfig.BUFFER_SCALE*=.5:WALK.urlHashContains("vrhi")&&(WebXRConfig.cardboardConfig.BUFFER_SCALE*=
1.5),ca=new WebXRPolyfill(WebXRConfig)}catch(ya){WALK.log("Failed to initialize WebXR polyfill")}xa=new WALK.VRManager(na,P,ca,w,u,function(ya){ya?sa.disable():sa.enable()},x);sa=new WALK.AnimationController(xa,b,a);sa.disable();ca=new WALK.Camera;ta=new WALK.Controls(ca,X,P,sa);ta.mousePressLook=!0;WALK.urlHashContains("flipmouse")&&(ta.flipMouseLook=!0);ta.disable();S();WALK.getExtraAssetUrl=function(ya){return ya.startsWith("extra-assets/")?WALK.ASSETS_URL+ya:WALK.ASSETS_URL+"extra-assets/"+ya}}else WALK.USER_MSG.error(window.WebGLRenderingContext?
'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">WebGL</a> or your browser has WebGL disabled.<br/><a href="http://get.webgl.org/" target="_blank">Find out how to get it.</a>':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">WebGL</a>.<br/><a href="http://get.webgl.org/" target="_blank">Find out how to get it.</a>')}var X=document.getElementById("walk-canvas"),
qa=WALK.EDIT_MODE,na,xa,wa,ta,sa,Da,Q,J,N,V,ra,ka,za,Ea,pa,ha,ja,Ca,Ta,Pa,Ga,L=null,ia=null,Aa,Ia,Ja,Va,Ra=0,Sa=!1,db=!1,eb,gb=new WALK.GazeModeObserver;var P=new WALK.GamepadManager;var Y=new WALK.Menu(qa,P,function(){xa.vrEnabled()?xa.disableVr():(Pa.isRunning()&&Pa.stop(),xa.enableVr(na.context))},function(){if(k())k()&&(document.exitFullScreen=document.exitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitExitFullscreen,document.exitFullScreen&&document.exitFullScreen());
else{var ca=document.body;(ca.mozRequestFullScreen||ca.webkitRequestFullscreen||ca.msRequestFullscreen||ca.requestFullscreen).call(ca);document.addEventListener("fullscreenchange",m,!1);document.addEventListener("mozfullscreenchange",m,!1);document.addEventListener("webkitfullscreenchange",m,!1);document.addEventListener("MSFullscreenChange",m,!1)}},function(){g()?g()&&(document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock&&
document.exitPointerLock()):(X.requestPointerLock=X.requestPointerLock||X.mozRequestPointerLock||X.webkitRequestPointerLock,X.requestPointerLock(),document.addEventListener("pointerlockchange",h,!1),document.addEventListener("mozpointerlockchange",h,!1),document.addEventListener("webkitpointerlockchange",h,!1))});var Ba=new WALK.MergeConfig;qa&&Ba.setAllMaterialsEditable();var la=new WALK.Viewer(qa,Y,Ba);var Fa={FontAwesomeSolid:"\uf2b9",FontAwesomeRegular:"\uf2b9",FontAwesomeBrands:"\uf293"};WALK.loadFontFamilies=
function(ca,ya,ma){function Ma(Na){Na?++Ya:++cb;Ya+cb===ca.length&&(0===cb?ya():ma&&ma())}if(0===ca.length)ya();else{var Qa={};ca.forEach(function(Na){console.assert(Fa[Na],"Font "+JSON.stringify(Na)+" is not supported.");Qa[Na]=Fa[Na]});var Ya=0,cb=0;WebFont.load({custom:{families:ca,testStrings:Qa},timeout:1E4,fontactive:function(){Ma(!0)},fontinactive:function(Na){console.error("Cannot load font: "+Na);Ma(!1)}})}};WALK.getViewerAssetUrl=function(){var ca=function(){for(var ya=document.getElementsByTagName("script"),
ma=0;ma<ya.length;++ma){var Ma=ya[ma].src.match(/^(.*\/)walk(\.min)?\.js$/);if(Ma)return Ma[1]}console.error("Cannot determine webwalk URL.");return"/webwalk/"}();return function(ya){return ca+ya}}();WALK.initEditMode=function(ca){var ya=document.createElement("base");ya.target="_blank";document.head.appendChild(ya);WALK.loadFontFamilies(Object.keys(Fa),function(){fa(ca)})};WALK.init=function(ca){qa||fa(ca)};WALK.play=function(){Sa?O():db=!0};WALK.getViewer=function(){return la};WALK.Extensions={}})();(function(){WALK.STRINGS.English={help:{basic:"BASIC",advanced:"ADVANCED",mouse:"Mouse",or:"or",keyboard:"Keyboard",vrTeleport:"VR teleport",holdLeftButton:"Hold the left button",clickLeftButton:"Click the left button",lookAround:"Look around",walkToClickedPlace:"Walk to the clicked place",selectMaterialLightObject:"Select material, light, object",scroll:"Scroll",walkStraight:"Walk straight",walkStraightAndLookAround:"Walk straight and look around",walkStraightAndSideways:"Walk straight and sideways",
changeHeight:"Change height",switchView:"Switch view",screenshot:"Screenshot",illuminationPreview:"Illumination preview",hideShowMenu:"Hide/show menu",hideShowMousePointer:"Hide/show mouse pointer",vrMode:"VR Mode",gazeAtFixedPlace:"Gaze at a fixed place",clickControllerButton:"Click a controller button",teleport:"Teleport",touch:"Touch"}}})();(function(){WALK.STRINGS.Chinese={help:{basic:"\u57fa\u672c",advanced:"\u9ad8\u7ea7",mouse:"\u6ed1\u9f20",or:"\u6216",keyboard:"\u952e\u76d8",vrTeleport:"VR \u4f20\u9001",holdLeftButton:"\u6309\u4f4f\u5de6\u952e",clickLeftButton:"\u5355\u6309\u5de6\u952e",lookAround:"\u8c03\u6574\u89c6\u89d2",walkToClickedPlace:"\u8d70\u53bb\u6307\u5b9a\u5730\u70b9",selectMaterialLightObject:"\u9009\u62e9\u6750\u8d28\uff0c\u706f\u5149\uff0c\u7269\u4f53",scroll:"\u6ed1\u8f6e",walkStraight:"\u76f4\u8d70",walkStraightAndLookAround:"\u8c03\u6574\u89c6\u89d2",
walkStraightAndSideways:"\u79fb\u52a8",changeHeight:"\u8c03\u6574\u9ad8\u5ea6",switchView:"\u79fb\u52a8\u81f3\u6307\u5b9a\u89c6\u89d2",screenshot:"\u622a\u56fe",illuminationPreview:"\u7167\u660e\u9884\u89c8",hideShowMenu:"\u9690\u85cf/\u663e\u793a\u83dc\u5355",hideShowMousePointer:"\u9690\u85cf/\u663e\u793a\u9f20\u6807",vrMode:"VR \u6a21\u5f0f",gazeAtFixedPlace:"\u51dd\u89c6\u4e00\u4e2a\u56fa\u5b9a\u7684\u5730\u65b9",clickControllerButton:"\u5355\u51fb\u63a7\u5236\u5668\u6309\u94ae",teleport:"\u4f20\u9001",
touch:"\u89e6\u78b0"}}})();(function(){WALK.STRINGS.French={help:{basic:"BASIQUES",advanced:"AVANC\u00c9S",mouse:"Souris",or:"ou",keyboard:"Clavier",vrTeleport:"T\u00e9l\u00e9portation VR",holdLeftButton:"Maintenez le bouton gauche",clickLeftButton:"Cliquez sur le bouton gauche",lookAround:"Regardez autour",walkToClickedPlace:"D\u00e9placez-vous jusqu\u2019\u00e0 l\u2019endroit cliqu\u00e9",selectMaterialLightObject:"S\u00e9lectionnez le mat\u00e9riel, la lumi\u00e8re, l\u2019objet",scroll:"D\u00e9filement",walkStraight:"Allez tout droit",
walkStraightAndLookAround:"Allez tout droit et regardez autour",walkStraightAndSideways:"Allez tout droit et de c\u00f4t\u00e9",changeHeight:"Changez la hauteur",switchView:"Changez de vue",screenshot:"Capture d\u2019\u00e9cran",illuminationPreview:"Aper\u00e7u de l\u2019\u00e9clairage",hideShowMenu:"Masquer / Afficher le menu",hideShowMousePointer:"Masquer / Afficher le pointeur de la souris",vrMode:"Mode RV",gazeAtFixedPlace:"Fixez un endroit pr\u00e9cis",clickControllerButton:"Appuyez sur un bouton du contr\u00f4leur",
teleport:"T\u00e9l\u00e9portation",touch:"Touchez"}}})();(function(){WALK.STRINGS.German={help:{basic:"GRUNDLAGEN",advanced:"ERWEITERT",mouse:"Maus",or:"oder",keyboard:"Tastatur",vrTeleport:"VR-Teleport",holdLeftButton:"Linke Maustaste gedr\u00fcckt halten",clickLeftButton:"Klick auf die linke Maustaste",lookAround:"Umschauen",walkToClickedPlace:"Zum angeklickten Punkt bewegen",selectMaterialLightObject:"Material, Licht, Objekt ausw\u00e4hlen",scroll:"Mausrad",walkStraight:"Geradeaus gehen",walkStraightAndLookAround:"Geradeaus gehen und umsehen",walkStraightAndSideways:"Geradeaus und seitw\u00e4rts gehen",
changeHeight:"H\u00f6he \u00e4ndern",switchView:"Ansicht wechseln",screenshot:"Bildschirmfoto",illuminationPreview:"Beleuchtungsvorschau",hideShowMenu:"Men\u00fc aus- / einblenden",hideShowMousePointer:"Mauszeiger aus-/einblenden",vrMode:"VR-Modus",gazeAtFixedPlace:"Blick auf einem Punkt fixieren",clickControllerButton:"Controller Taste dr\u00fccken",teleport:"Teleportieren",touch:"Tippen"}}})();(function(){WALK.STRINGS.Spanish={help:{basic:"B\u00c1SICO",advanced:"AVANZADO",mouse:"Rat\u00f3n",or:"o",keyboard:"Teclado",vrTeleport:"Teletransporte VR",holdLeftButton:"Mant\u00e9n presionado el bot\u00f3n izquierdo",clickLeftButton:"Haz clic en el bot\u00f3n izquierdo",lookAround:"Mira a tu alrededor",walkToClickedPlace:"Camina hasta el lugar donde hiciste clic",selectMaterialLightObject:"Selecciona material, luz, objeto",scroll:"Despl\u00e1zate",walkStraight:"Camina en l\u00ednea recta",walkStraightAndLookAround:"Camina en l\u00ednea recta y mira a tu alrededor",
walkStraightAndSideways:"Camina recto y de lado",changeHeight:"Cambiar altura",switchView:"Cambiar vista",screenshot:"Captura de pantalla",illuminationPreview:"Vista previa de iluminaci\u00f3n",hideShowMenu:"Ocultar / mostrar men\u00fa",hideShowMousePointer:"Ocultar / mostrar el puntero del rat\u00f3n",vrMode:"Modo VR",gazeAtFixedPlace:"Mira a un punto fijo",clickControllerButton:"Pulsa un bot\u00f3n del mando",teleport:"Teletransporte",touch:"Tocar"}}})();(function(){WALK.STRINGS.Korean={help:{basic:"\uae30\ubcf8 \uc870\uc791\ubc95",advanced:"\uc0c1\uc138 \uc870\uc791\ubc95",mouse:"\ub9c8\uc6b0\uc2a4",or:"\ud639\uc740",keyboard:"\ud0a4\ubcf4\ub4dc",vrTeleport:"VR \uc774\ub3d9",holdLeftButton:"\uc88c\uce21 \ubc84\ud2bc \ub4dc\ub798\uadf8",clickLeftButton:"\uc88c\uce21 \ubc84\ud2bc \ud074\ub9ad",lookAround:"\uc8fc\ubcc0 \ub458\ub7ec\ubcf4\uae30",walkToClickedPlace:"\ud074\ub9ad\ud55c \uacf3\uc73c\ub85c \uc774\ub3d9",selectMaterialLightObject:"\uc7ac\uc9c8, \uc870\uba85, \uc0ac\ubb3c \uc120\ud0dd",
scroll:"\uc2a4\ud06c\ub864",walkStraight:"\uc9c1\uc9c4 \uc774\ub3d9",walkStraightAndLookAround:"\uc9c1\uc9c4 \uc774\ub3d9 / \uc8fc\ubcc0 \ub458\ub7ec\ubcf4\uae30",walkStraightAndSideways:"\uc9c1\uc9c4 \uc774\ub3d9 / \uc606\uc73c\ub85c \uc774\ub3d9",changeHeight:"\ub192\uc774 \uc870\uc808",switchView:"\ubdf0 \uc120\ud0dd",screenshot:"\uc2a4\ud06c\ub9b0\uc0f7",illuminationPreview:"\uc77c\ub8e8\ubbf8\ub124\uc774\uc158 \ud504\ub9ac\ubdf0",hideShowMenu:"\uba54\ub274 On/Off",hideShowMousePointer:"\ub9c8\uc6b0\uc2a4 \ud3ec\uc778\ud130 On/Off",
vrMode:"VR \ubaa8\ub4dc",gazeAtFixedPlace:"\ud2b9\uc815 \uc7a5\uc18c \ubc14\ub77c\ubcf4\uae30",clickControllerButton:"\ucee8\ud2b8\ub864\ub7ec \ubc84\ud2bc \ud074\ub9ad",teleport:"\ud154\ub808\ud3ec\ud2b8",touch:"\ud130\uce58"}}})();(function(){WALK.STRINGS.Polish={help:{basic:"PODSTAWOWE",advanced:"ZAAWANSOWANE",mouse:"Myszka",or:"lub",keyboard:"Klawiatura",vrTeleport:"Teleportacja VR",holdLeftButton:"Przytrzymaj lewy przycisk",clickLeftButton:"Naci\u015bnij lewy przycisk",lookAround:"Rozgl\u0105daj si\u0119",walkToClickedPlace:"Id\u017a do naci\u015bni\u0119tego miejsca",selectMaterialLightObject:"Wybierz materia\u0142, \u015bwiat\u0142o, obiekt",scroll:"Przewi\u0144",walkStraight:"Id\u017a prosto",walkStraightAndLookAround:"Id\u017a prosto i rozgl\u0105daj si\u0119",
walkStraightAndSideways:"Id\u017a prosto i na boki",changeHeight:"Zmie\u0144 wysoko\u015b\u0107",switchView:"Zmie\u0144 widok",screenshot:"Zrzut ekranu",illuminationPreview:"Podgl\u0105d o\u015bwietlenia",hideShowMenu:"Schowaj/poka\u017c menu",hideShowMousePointer:"Schowaj/poka\u017c kursor myszki",vrMode:"Tryb VR",gazeAtFixedPlace:"Patrz w ustalone miejsce",clickControllerButton:"Naci\u015bnij przycisk kontrolera",teleport:"Teleportacja",touch:"Dotyk"}}})();(function(){WALK.STRINGS.Portuguese={help:{basic:"B\u00c1SICO",advanced:"AVAN\u00c7ADO",mouse:"Mouse",or:"ou",keyboard:"Teclado",vrTeleport:"Teletransporte VR",holdLeftButton:"Mantenha pressionado o bot\u00e3o esquerdo",clickLeftButton:"Clique com o bot\u00e3o esquerdo",lookAround:"Olhe ao redor",walkToClickedPlace:"Ande at\u00e9 o lugar que foi clicado",selectMaterialLightObject:"Selecione material, luz, objeto",scroll:"Rolagem",walkStraight:"Ande em frente",walkStraightAndLookAround:"Ande em frente e olhe ao redor",
walkStraightAndSideways:"Ande em frente e para os lados",changeHeight:"Variar altura",switchView:"Alternar entre cenas",screenshot:"Captura de imagem",illuminationPreview:"Visualiza\u00e7\u00e3o de ilumina\u00e7\u00e3o",hideShowMenu:"Ocultar/mostrar menu",hideShowMousePointer:"Ocultar/mostrar a seta do mouse",vrMode:"Modo VR",gazeAtFixedPlace:"Olhe para um lugar fixo",clickControllerButton:"Clique num bot\u00e3o controlador",teleport:"Teletransporte",touch:"Toque"}}})();(function(){WALK.STRINGS.Turkish={help:{basic:"Basit",advanced:"\u0130leri D\u00fczey",mouse:"Fare",or:"veya",keyboard:"Klavye",vrTeleport:"VR I\u015f\u0131nlanma",holdLeftButton:"Sol tu\u015fa bas\u0131l\u0131 tut",clickLeftButton:"Sol tu\u015fa t\u0131kla",lookAround:"\u00c7evrene bak",walkToClickedPlace:"T\u0131klad\u0131\u011f\u0131n alana y\u00fcr\u00fc",selectMaterialLightObject:"Materyal, \u0131\u015f\u0131k veya obje se\u00e7",scroll:"A\u015fa\u011f\u0131 kayd\u0131r",walkStraight:"D\u00fcz y\u00fcr\u00fc",
walkStraightAndLookAround:"D\u00fcz y\u00fcr\u00fc ve \u00e7evrene bak\u0131n",walkStraightAndSideways:"D\u00fcz ve yanlana do\u011fru y\u00fcr\u00fc",changeHeight:"Y\u00fckseklik de\u011fi\u015ftir",switchView:"G\u00f6r\u00fcn\u00fcm de\u011fi\u015ftir",screenshot:"Ekran G\u00f6r\u00fcnt\u00fcs\u00fc",illuminationPreview:"Ayd\u0131nlatma \u00f6nizlemesi",hideShowMenu:"Men\u00fcy\u00fc g\u00f6ster/gizle",hideShowMousePointer:"\u0130mleci g\u00f6ster/gizle",vrMode:"VR Modu",gazeAtFixedPlace:"Bir noktaya kitlenerek bak",
clickControllerButton:"Kumanda butonuna t\u0131kla",teleport:"I\u015f\u0131nlan",touch:"Dokun"}}})();(function(){function a(){for(var c=document.querySelectorAll("[data-strings]"),d=0;d<c.length;++d){var e=c.item(d);a:{var f=e.getAttribute("data-strings").split(".");for(var g=b,k=0;k<f.length;k++)if(g=g[f[k]],!g){f=null;break a}f="string"===typeof g?g:null}e.textContent=f}}var b=WALK.cloneObject(WALK.STRINGS[WALK.DEFAULT_LANGUAGE]);WALK.updateViewerStrings=function(c){function d(e,f,g){Object.keys(f).forEach(function(k){var h=""===g?k:g+"."+k;if(void 0===e[k])console.warn("Viewer string "+h+" doesn\u2019t exist");
else if(typeof e[k]!==typeof f[k])console.error(h+" should be "+typeof e[k]);else switch(typeof f[k]){case "string":e[k]=f[k];break;case "object":d(e[k],f[k],h)}})}d(b,c,"");a()};WALK.getViewerStrings=function(){return WALK.readOnlyCopy(b)};a()})();(function(){WALK.ExtensionManager=function(){this.extensionTypes=WALK.Extensions};WALK.ExtensionManager.getExtensionDefinition=function(a){return WALK.Extensions[a].definition};WALK.ExtensionManager.prototype={constructor:WALK.ExtensionManager,updateConfig:function(a){this.extensions=[];a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())this._createExtensionFromConfig(b.value)},_createExtensionFromConfig:function(a){function b(e,f){return e.some(function(g){return g.name===f&&g.config.type===
a.type})}a.name=a.name.toString();for(var c=a.name,d=2;b(this.extensions,a.name);)a.name=c+d.toString(),d+=1;c=new this.extensionTypes[a.type](a);this.extensions.push(c);return c},startExtensions:function(){var a=this;this._loadFontAwesomeIfNeeded(function(){for(var b=0;b<a.extensions.length;b+=1)a.extensions[b].start()})},_loadFontAwesomeIfNeeded:function(a){var b=this,c=this.extensions.map(function(d){return b._getFonts(d.config)}).concat(WALK.FONT_FAMILIES_TO_LOAD).reduce(function(d,e){return d.concat(e)},
[]).filter(function(d,e,f){return e===f.indexOf(d)});0<c.length&&!WALK.EDIT_MODE?WALK.loadFontFamilies(c,a,a):a()},_getFonts:function(a){for(var b=[],c=$jscomp.makeIterator(this.extensionTypes[a.type].definition.properties),d=c.next();!d.done;d=c.next())if(d=d.value,"trigger"===d.type&&a[d.id])d=a[d.id],(d=d.icon&&WALK.ICONS[d.icon].fontFamily)&&b.push(d);else if("list"===d.type&&"trigger"===d.elementType&&a[d.id]){d=$jscomp.makeIterator(a[d.id]);for(var e=d.next();!e.done;e=d.next())e=e.value,(e=
e.icon&&WALK.ICONS[e.icon].fontFamily)&&b.push(e)}return b},stopExtensions:function(){for(var a=0;a<this.extensions.length;a+=1)this.extensions[a].stop()},getEditableExtensionDefinitions:function(){for(var a=[],b=$jscomp.makeIterator(Object.entries(this.extensionTypes||{})),c=b.next();!c.done;c=b.next()){var d=$jscomp.makeIterator(c.value);c=d.next().value;d=d.next().value;d.definition.hideFromEditor||a.push({type:c,definition:d.definition})}return a},getEditableExtensions:function(){for(var a=[],
b=$jscomp.makeIterator(this.extensions),c=b.next();!c.done;c=b.next())c=c.value,c.definition.hideFromEditor||a.push(c);return a},addExtension:function(a){a=this._createExtensionFromConfig(a);a.start();return a},removeExtension:function(a){a.stop();for(var b=0;b<this.extensions.length;b+=1)if(this.extensions[b]===a){this.extensions.splice(b,1);break}},getConfig:function(){return this.extensions.map(function(a){return a.config})},getExtension:function(a,b){for(var c=$jscomp.makeIterator(this.extensions),
d=c.next();!d.done;d=c.next())if(d=d.value,d.type===a&&d.name===b)return d;console.error("Unrecognized extension "+a+" "+b+", supported types: "+Object.keys(this.extensionTypes))}}})();(function(){function a(){}function b(f){console.error("This extension cannot be triggered on/off")}function c(f,g){var k=new THREE.Vector3,h=new THREE.Vector3;if(g&&"node"!==g.type){k.fromArray(g.position);var m=g.radius}else m=WALK.Extensions.MaterialPicker.VR_RADIUS;this.getPosition=function(l){g&&"node"!==g.type||(h.copy(f.getCameraPosition()),h.sub(l),h.normalize().multiplyScalar(m),k.copy(l).add(h));return k};this.getRadius=function(){return m}}function d(f){var g=$jscomp.makeIterator(f.split(":"));
f=g.next().value;g=g.next().value;return[f,g]}var e={"\uf2b9":"address-book","\uf2bb":"address-card","\uf1fe":"area-chart","\uf047":"arrows","\uf062":"arrow-up","\uf063":"arrow-down","\uf2a2":"assistive-listening-systems","\uf069":"asterisk","\uf29e":"audio-description","\uf1fa":"at","\uf0c9":"bars","\uf0f3":"bell","\uf02d":"book","\uf02e":"bookmark","\uf0a1":"bullhorn","\uf1ec":"calculator","\uf030":"camera","\uf080":"chart-bar","\uf200":"chart-pie","\uf0c2":"cloud","\uf013":"cog","\uf075":"comment",
"\uf14e":"compass","\uf09d":"credit-card","\uf05b":"crosshairs","\uf019":"download","\uf0e0":"envelope","\uf08e":"external-link","\uf06e":"eye","\uf1fb":"eye-dropper","\uf008":"film","\uf024":"flag","\uf07b":"folder","\uf06b":"gift","\uf025":"headphones","\uf015":"home","\uf03e":"image","\uf090":"sign-in","\uf129":"info","\uf0eb":"lightbulb","\uf0d0":"magic","\uf076":"magnet","\uf041":"map-marker","\uf276":"map-pin","\uf277":"map-signs","\uf1fc":"paint-brush","\uf040":"pencil","\uf095":"phone","\uf128":"question",
"\uf064":"share","\uf1e0":"share-alt","\uf07a":"shopping-cart","\uf1de":"sliders","\uf005":"star","\uf0e4":"tachometer","\uf02b":"tag","\uf03d":"video","\uf0ad":"wrench","\uf04b":"play","\uf16a":"youtube","\uf27d":"vimeo","\uf09a":"facebook","\uf099":"twitter","\uf16d":"instagram"};WALK.Extension=function(f){function g(l){return k.definition.properties.some(function(q){return q.id===l})}var k=this;this.triggers=[];var h=[];this.definition=this.constructor.definition;this.viewerApi=WALK.getViewer();
this.running=!1;var m=[];this.config=WALK.readOnlyCopy(function(l){l=WALK.cloneObject(l);if(void 0!==l.anchor&&void 0===l.trigger&&!g("anchor")&&g("trigger")){var q=l.anchor;q.icon&&q.icon.font&&(q.icon=e[q.icon.value]);l.trigger=q;l.anchor=void 0}q=$jscomp.makeIterator(k.definition.properties);for(var n=q.next();!n.done;n=q.next())n=n.value,void 0===l[n.id]&&void 0!==n.defaultValue&&(l[n.id]=n.defaultValue);return l}(f));Object.defineProperty(this,"name",{get:function(){return this.config.name}});
Object.defineProperty(this,"type",{get:function(){return this.config.type}});Object.defineProperty(this,"vrCompatible",{get:function(){return this.definition.vrCompatible},configurable:!0});this.cloneConfig=function(){return WALK.cloneObject(this.config)};this.updateConfig=function(l){this.stop();this.config=WALK.readOnlyCopy(l);this.start()};this.doStop=this.doStart=a;this.trigger=b;this.start=function(){this.running||(this.doStart(),this.running=!0)};this.stop=function(){if(this.running){this.doStop();
for(var l=$jscomp.makeIterator(h),q=l.next();!q.done;q=l.next())this.viewerApi.removeAnchor(q.value);l=$jscomp.makeIterator(m);for(q=l.next();!q.done;q=l.next())q=q.value,this.viewerApi.removeOnNodeTypeClicked(q[0],q[1]);m.length=0;this.triggers.length=0;h.length=0;this.running=!1}};this._vrChanged=function(l){l&&!this.vrCompatible?this.stop():l||this.vrCompatible||this.start()};this.addTrigger=function(l,q){function n(p,r,x){q(p,r,x);return!0}"node"===l.type?(l=l.nodeType,m.push([l,n]),this.viewerApi.onNodeTypeClicked(l,
n),this.triggers.push.apply(this.triggers,$jscomp.arrayFromIterable(this.viewerApi.findNodesOfType(l)))):(l=this.viewerApi.addAnchor(l,q),l.extension=this,h.push(l),this.triggers.push(l))};this.viewerApi.onVrChange(this._vrChanged.bind(this))};WALK.Extensions.HtmlLabel=function(f){var g=this;WALK.Extension.call(this,f);var k=null,h=function(){WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping&&(g.viewerApi.wakeAnimatedMaterials(),WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping=!1)},m=
function(q){if(q instanceof HTMLVideoElement||q instanceof HTMLIFrameElement)return!0;q=$jscomp.makeIterator(q.children);for(var n=q.next();!n.done;n=q.next())if(m(n.value))return!0;return!1},l=function(){k=null;WALK.Extensions.HtmlLabel._activeLabel===g&&(WALK.Extensions.HtmlLabel._activeLabel=null,h())};this.trigger=function(q){var n=WALK.Extensions.HtmlLabel._activeLabel===this;!0===q&&n||!1===q&&!n||(n?(console.assert(null!==k),k.close()):(WALK.Extensions.HtmlLabel._activeLabel=this,k=this.viewerApi.openPopup(this.config.content,
this.config,l),q=document.createElement("div"),q.innerHTML=this.config.content,m(q)?WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping||(g.viewerApi.sleepAnimatedMaterials(),WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping=!0):h()))};this.doStart=function(){var q=this;q.viewerApi.onSceneReadyToDisplay(function(){q.config.trigger&&q.addTrigger(q.config.trigger,function(){return q.trigger()})})};this.doStop=function(){null!==k&&k.close()}};WALK.Extensions.HtmlLabel.definition={name:"HTML label",
properties:[{id:"trigger",type:"trigger",label:"Trigger",optional:!0},{id:"content",type:"textArea",label:"Content",optional:!0,defaultValue:"Content to display..."},{id:"centerHorizontally",type:"bool",label:"Center horizontally",defaultValue:!1},{id:"centerVertically",type:"bool",label:"Center vertically",defaultValue:!1},{id:"padding",type:"bool",label:"Padding",defaultValue:!0}],vrCompatible:!1};WALK.Extensions.HtmlLabel._activeLabel=null;WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping=
!1;WALK.Extensions.Audio=function(f){function g(){h.trigger()}function k(){var w=h.config;w.trigger&&h.addTrigger(w.trigger,g);w.menuButton&&(p=m.addMenuButton(q.src),p.addEventListener("click",g),r=m.getMenuButtonIcon(p));if(w.autoplay)h.viewerApi.onNextPageInteraction(function(){g()})}f.url&&!f.file&&(f.file={file:f.url.split("/").pop(),url:f.url},delete f.url);f.file.path&&f.file.url&&delete f.file.url;WALK.Extension.call(this,f);var h=this,m=this.viewerApi,l=null,q=null,n=null,p=null,r=null,x=
!1;this.trigger=function(w){!0===w&&x||!1===w&&!x||(x?n.pause():n.play())};this.doStart=function(){WALK.log("Audio start");this.config.menuButton&&!l&&(l=WALK.preloadImage(m.getViewerAssetUrl("img/audio-on.svg")),q=WALK.preloadImage(m.getViewerAssetUrl("img/audio-off.svg")));n=document.createElement("audio");this.config.file&&(this.config.file.path?n.src=WALK.getExtraAssetUrl(this.config.file.path):this.config.file.url&&(n.src=this.config.file.url));n.src&&(n.loop=this.config.loop,n.addEventListener("play",
function(){x=!0;r&&(r.src=l.src)}),n.addEventListener("pause",function(){x=!1;r&&(r.src=q.src)}),document.body.appendChild(n),m.onSceneReadyToDisplay(k))};this.doStop=function(){WALK.log("Audio stop");x=!1;p&&(this.viewerApi.removeMenuButton(p),r=p=null);n.pause();n.remove();n=null}};WALK.Extensions.Audio.definition={name:"Audio",properties:[{id:"file",type:"file",label:"File",fileType:"audio"},{id:"autoplay",type:"bool",label:"Autoplay",defaultValue:!1},{id:"loop",type:"bool",label:"Loop",defaultValue:!0},
{id:"menuButton",type:"bool",label:"Show menu button",defaultValue:!0},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};WALK.Extensions.MaterialPicker=function(f){function g(){return(n.config.toReplace?[n.config.toReplace]:[]).concat(n.config.toPick||[])}function k(){return g().map(function(w){return n.viewerApi.findMaterial(w)})}function h(w){n.viewerApi.apiUserChangeState(x,w.name)}function m(w,u){console.assert(w===x);if(w=n.viewerApi.findMaterial(u))for(u=0;u<p.length;u+=
1)n.viewerApi.setMaterialForMesh(w,p[u])}function l(w,u,A){n.triggerAtPosition(void 0,u)}function q(){n.config.trigger&&n.addTrigger(n.config.trigger,l);p=n.viewerApi.findMeshesWithMaterial(n.config.toReplace||[])}WALK.Extension.call(this,f);var n=this,p=[],r=new c(n.viewerApi,n.config.trigger),x="MaterialPicker:"+this.name;this.config.materials&&(f=WALK.cloneObject(this.config),0<f.materials.length&&(f.toReplace=f.materials[0],f.toPick=f.materials.slice(1)),f.materials=void 0,this.config=WALK.readOnlyCopy(f));
n.viewerApi.isSceneReadyToDisplay()||g().map(function(w){n.viewerApi.setMaterialEditable(w)});this.trigger=function(w){!1!==w&&n.viewerApi.openMaterialPicker(k(),h)};this.triggerAtPosition=function(w,u){!1!==w&&n.viewerApi.openMaterialPicker(k(),h,null,r.getPosition(u),r.getRadius())};this.doStart=function(){this.viewerApi.onSceneReadyToDisplay(q);this.viewerApi.onApiUserStateChanged(x,m)};this.doStop=function(){var w=n.viewerApi.findMaterial(n.config.toReplace);w&&h(w);this.viewerApi.removeOnApiUserStateChanged(x,
m)}};WALK.Extensions.MaterialPicker.VR_RADIUS=.07;WALK.Extensions.MaterialPicker.definition={name:"Material picker",properties:[{id:"toReplace",type:"material",label:"Material to replace"},{id:"toPick",type:"list",elementType:"material",label:"Materials to pick"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};WALK.Extensions.MaterialComboPicker=function(f){function g(){for(var C=new Set,U=$jscomp.makeIterator(M),O=U.next();!O.done;O=U.next()){O=$jscomp.makeIterator(O.value);
for(var W=O.next();!W.done;W=O.next())W=W.value,C.add(W.toReplace),C.add(W.toUse)}return C}function k(){for(var C=[M[0][0].toReplace],U=$jscomp.makeIterator(M),O=U.next();!O.done;O=U.next())C.push(O.value[0].toUse);return C}function h(){return k().map(function(C){return K.findMaterial(C)})}function m(){if(-1!==Z)for(var C=0;C<M[Z].length;++C){var U=M[Z][C],O=K.findMaterial(U.toUse);U=K.findMaterial(U.toReplace);O.setUvOffsetAndScale(I[O]);O.setUniforms();O=$jscomp.makeIterator(A[Z][C]);for(var W=
O.next();!W.done;W=O.next())K.setMaterialForMesh(U,W.value)}}function l(C,U){K.apiUserChangeState(E,U)}function q(C,U){console.assert(C===E);m();if(0!==U)for(Z=U-1,C=0;C<M[Z].length;++C){var O=M[Z][C];U=K.findMaterial(O.toUse);var W=I[U];U.setUvOffsetAndScale(W.x,W.y,W.z*(O.uvScale?O.uvScale[0]:B[0]),W.w*(O.uvScale?O.uvScale[1]:B[1]));U.setUniforms();O=$jscomp.makeIterator(A[Z][C]);for(W=O.next();!W.done;W=O.next())K.setMaterialForMesh(U,W.value)}}function n(){WALK.Extensions.MaterialComboPicker._menuPopup.close();
WALK.Extensions.MaterialComboPicker._menuPopup=null}function p(){WALK.Extensions.MaterialComboPicker._pickerOpened=!1}function r(C,U,O){WALK.Extensions.MaterialComboPicker._menuPopup&&n();C=h();K.openMaterialPicker(C,l,p,F.getPosition(U),F.getRadius());WALK.Extensions.MaterialComboPicker._pickerOpened=!0}function x(){for(var C=$jscomp.makeIterator(u.config.triggers),U=C.next();!U.done;U=C.next())u.addTrigger(U.value,r);for(C=0;C<M.length;++C){A[C]=[];U=$jscomp.makeIterator(M[C]);for(var O=U.next();!O.done;O=
U.next()){O=O.value;var W=O.toUse;A[C].push(K.findMeshesWithMaterial(O.toReplace));O=K.findMaterial(W);I.has(O)||(W=new THREE.Vector4,I[O]=O.getUvOffsetAndScale(W))}}}function w(){var C=WALK.Extensions.MaterialComboPicker._startedPickers;console.assert(0<C.length);WALK.Extensions.MaterialComboPicker._pickerOpened&&K.closeMaterialPicker();if(WALK.Extensions.MaterialComboPicker._menuPopup)n();else{var U=document.createElement("div");U.innerHTML='\n        <div class="ext-material-combo-picker-menu-title">\n          <img src="'+
K.getViewerAssetUrl("img/sliders-horizontal.svg")+'">\n        </div>\n        <ul class="ext-material-combo-picker-menu-list">\n          <li class="ext-material-combo-picker-menu-item"></li>\n        </ul>';for(var O=U.getElementsByClassName("ext-material-combo-picker-menu-list")[0],W=O.getElementsByClassName("ext-material-combo-picker-menu-item")[0],aa={},R=0;R<C.length;aa={$jscomp$loop$prop$picker$149:aa.$jscomp$loop$prop$picker$149},++R)0<R&&(W=W.cloneNode(!0),O.appendChild(W)),aa.$jscomp$loop$prop$picker$149=
C[R],WALK.setTextContent(W,aa.$jscomp$loop$prop$picker$149.name),W.addEventListener("click",function(S){return function(){S.$jscomp$loop$prop$picker$149._openFromMenu()}}(aa));WALK.Extensions.MaterialComboPicker._menuPopup=WALK.openPopup(U,{centerHorizontally:!0,centerVertically:!0},function(){WALK.Extensions.MaterialComboPicker._menuPopup=null})}}WALK.Extension.call(this,f);var u=this,A=[],B=[1,1],I=new Map,F=new c(u.viewerApi),E="MaterialComboPicker:"+this.name,K=this.viewerApi,M=u.config.options,
Z=-1;K.isSceneReadyToDisplay()||g().forEach(function(C){K.setMaterialEditable(C)});this._openFromMenu=function(){n();var C=h();K.openMaterialPicker(C,l);WALK.Extensions.MaterialComboPicker._pickerOpened=!0};this.doStart=function(){K.onSceneReadyToDisplay(x);K.onApiUserStateChanged(E,q);var C=WALK.Extensions.MaterialComboPicker._startedPickers;C.push(this);1===C.length&&(C=K.addMenuButton(K.getViewerAssetUrl("img/sliders-horizontal.svg")),C.addEventListener("click",w),WALK.Extensions.MaterialComboPicker._menuButton=
C)};this.doStop=function(){m();this.viewerApi.removeOnApiUserStateChanged(E,q);var C=WALK.Extensions.MaterialComboPicker._startedPickers;C.splice(C.indexOf(this),1);0===C.length&&(K.removeMenuButton(WALK.Extensions.MaterialComboPicker._menuButton),WALK.Extensions.MaterialComboPicker._menuButton=null)}};WALK.Extensions.MaterialComboPicker.definition={name:"Material combo picker",hideFromEditor:!0,properties:[{id:"triggers",type:"list",label:"Triggers",elementType:"trigger"},{id:"options",type:"list",
label:"Options",elementType:{type:"list",label:"option",elementType:[{id:"toReplace",type:"material",label:"Material to replace"},{id:"toUse",type:"material",label:"Material to use"},{id:"uvScale",type:"list",label:"UV Scale",elementType:"float"}]}}],vrCompatible:!0};WALK.Extensions.MaterialComboPicker._startedPickers=[];WALK.Extensions.MaterialComboPicker._menuButton=null;WALK.Extensions.MaterialComboPicker._menuPopup=null;WALK.Extensions.MaterialComboPicker._pickerOpened=!1;WALK.Extensions.VideoTextureControl=
function(f){function g(){var l=m.baseColorTexture,q=h.config;l.loop=q.loop;if(!q.autoplay)m.pause(),l.muted=q.muted;else if(!q.muted)h.viewerApi.onNextPageInteraction(function(){l.muted=!1});q.trigger&&h.addTrigger(q.trigger,function(){return h.trigger()})}function k(){var l=h.config;(m=h.viewerApi.findMaterial(l.material))?m.baseColorTexture&&m.baseColorTexture instanceof WALK.VideoTexture?m.baseColorTexture.addLoadedListener(g):(console.error("Material '"+l.material+"' for video texture control '"+
(l.name+"' does not have a video texture")),m=null):console.error("Material '"+l.material+"' for video texture control '"+(l.name+"' does not exist"))}WALK.Extension.call(this,f);var h=this,m=null;this.viewerApi.isSceneReadyToDisplay()||this.viewerApi.setMaterialEditable(this.config.material);this.trigger=function(l){!0===l&&m.isPlaying||!1===l&&!m.isPlaying||(m.isPlaying?m.pause():m.play())};this.doStart=function(){this.viewerApi.onSceneLoadComplete(k)};this.doStop=function(){m&&(m.baseColorTexture.muted=
!0,m.pause(),m=null)}};WALK.Extensions.VideoTextureControl.definition={name:"Video texture control",properties:[{id:"material",type:"material",label:"Material with video"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0},{id:"autoplay",type:"bool",label:"Autoplay",defaultValue:!0},{id:"loop",type:"bool",label:"Loop",defaultValue:!0},{id:"muted",type:"bool",label:"Muted",defaultValue:!0}],vrCompatible:!0};WALK.Extensions.OpenWebsite=function(f){WALK.Extension.call(this,f);var g=this;this.trigger=
function(){g.viewerApi.openUrl(g.config.url,g.config.newWindow)};this.doStart=function(){this.viewerApi.onSceneReadyToDisplay(function(){g.config.trigger&&g.addTrigger(g.config.trigger,function(){return g.trigger()})})}};WALK.Extensions.OpenWebsite.definition={name:"Open URL",properties:[{id:"url",type:"text",label:"URL"},{id:"newWindow",type:"bool",label:"New window",defaultValue:!0},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};WALK.Extensions.ChangeView=function(f){WALK.Extension.call(this,
f);var g=this,k=0;this.trigger=function(){g.viewerApi.switchToView(g.config.views[k],void 0,g.config.doNotMoveCamera);k=(k+1)%g.config.views.length};this.doStart=function(){var h=this.viewerApi;k=0;h.onSceneReadyToDisplay(function(){g.config.trigger&&g.addTrigger(g.config.trigger,function(){return g.trigger()})})}};WALK.Extensions.ChangeView.definition={name:"Change view",properties:[{id:"views",type:"list",elementType:"view",label:"Views to toggle"},{id:"doNotMoveCamera",type:"bool",label:"Do not move camera",
defaultValue:!1},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};WALK.Extensions.HideAnchors=function(f){function g(p){n.src=p?m.src:l.src}WALK.Extension.call(this,f);var k=this,h=k.viewerApi,m=WALK.preloadImage(h.getViewerAssetUrl("img/anchors-on.svg")),l=WALK.preloadImage(h.getViewerAssetUrl("img/anchors-off.svg")),q=null,n=null;this.trigger=function(p){!0===p&&h.anchorsVisible||!1===p&&!h.anchorsVisible||(h.anchorsVisible=!h.anchorsVisible)};this.doStart=function(){h=
k.viewerApi;h.onAnchorsVisibilityChanged(g);q=h.addMenuButton(m.src);n=h.getMenuButtonIcon(q);q.addEventListener("click",function(){return k.trigger()});var p=k.config;h.onSceneReadyToDisplay(function(){return h.anchorsVisible=p.visibleOnStart})};this.doStop=function(){h.removeAnchorsVisibilityChangedListener(g);h.removeMenuButton(q);n=q=null;h.anchorsVisible=!0}};WALK.Extensions.HideAnchors.definition={name:"Hide triggers",properties:[{id:"visibleOnStart",type:"bool",label:"Visible on start",defaultValue:!0}],
vrCompatible:!0};WALK.Extensions.Script=function(f){function g(){k.trigger()}WALK.Extension.call(this,f);var k=this;this.trigger=function(){try{(new Function('"use strict"; '+k.config.code))()}catch(h){console.error("Script extension error: "+h)}};this.doStart=function(){var h=this;if(this.config.trigger)this.viewerApi.onSceneReadyToDisplay(function(){return h.addTrigger(h.config.trigger,g)});else g()}};WALK.Extensions.Script.definition={name:"Script",properties:[{id:"code",type:"textArea",label:"Code",
defaultValue:"\x3c!-- Put your JavaScript code here. If a trigger is set, the code is executed when the trigger is clicked. Otherwise the code is executed when a page is loaded --\x3e"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};WALK.Extensions.ProjectionScreen=function(f){function g(){var A=u.getVideoTexture1();x.baseColorTexture=A?A:w}function k(){WALK.log("Presentation stop");u&&(u.uuid===r.myUuid&&r.stopShareScreen(),u.removeEventListener("dispose",k),u.removeEventListener("avatarUpdated",
g));u=null;x.baseColorTexture=w;n.triggers[0].material.highlightMix=0}function h(){var A=r.myUuid;u&&u.getVideoTexture1()?u.uuid===A&&(WALK.log("Requesting presentation stop"),n.viewerApi.apiUserChangeState(p,null)):(WALK.log("Requesting scren share "+A),r.startShareScreen(function(){n.viewerApi.apiUserChangeState(p,A)},function(){n.viewerApi.apiUserChangeState(p,null)},function(){}))}function m(A,B){console.assert(A===p);B?(u&&u.uuid!==B&&(WALK.log("Changing presenting user"),k()),u||(WALK.log("New presenting user "+
B),(u=n.viewerApi.findAvatar(B)||null)?(u.addEventListener("dispose",k),u.addEventListener("avatarUpdated",g),A=n.triggers[0].material,A.highlight=u.getMainMaterial().baseColor,A.setUniforms(),A.highlightMix=.7,g()):console.log("Cannot attach presentation stream of a user "+B+" The user was not found."))):k()}function l(){m(p,n.viewerApi.getApiUserState(p))}function q(A){var B=n.config;(x=n.viewerApi.findMaterial(B.material))?(r=A,w=x.baseColorTexture,n.addTrigger(B.trigger,h),n.viewerApi.onApiUserStateChanged(p,
m),n.viewerApi._onAvatarListChanged(l)):(console.error("Material for a projection screen is missing"),x=null)}WALK.Extension.call(this,f);var n=this,p="ProjectionScreen:"+this.name,r=null,x=null,w=null,u=null;this.viewerApi.isSceneReadyToDisplay()||this.viewerApi.setMaterialEditable(this.config.material);this.doStart=function(){this.viewerApi._onMeetingJoined(q)};this.doStop=function(){this.viewerApi._removeOnMeetingJoined(q);r&&(this.viewerApi.removeOnApiUserStateChanged(p,m),this.viewerApi._removeOnAvatarListChanged(l));
x=r=null}};WALK.Extensions.ProjectionScreen.definition={name:"Meeting projection screen",properties:[{id:"material",type:"material",label:"Material to project on"},{id:"trigger",type:"trigger",label:"Trigger"}],vrCompatible:!0};WALK.Extensions.SwitchObjects=function(f){WALK.Extension.call(this,f);var g=this,k=this.viewerApi,h,m;if(!k.isSceneReadyToDisplay()){f=$jscomp.makeIterator(this.config.nodeTypes);for(var l=f.next();!l.done;l=f.next())k.setNodeTypeEditable(l.value)}this.trigger=function(){if(0!==
g.config.nodeTypes.length){for(var q=$jscomp.makeIterator(m),n=q.next();!n.done;n=q.next())n.value.hide();h+=1;if(h===g.config.nodeTypes.length){if(g.config.hideAllAfterLast){h=-1;m.length=0;k.requestFrame();return}h=0}m=k.findNodesOfType(g.config.nodeTypes[h]);q=$jscomp.makeIterator(m);for(n=q.next();!n.done;n=q.next())n.value.show();k.requestFrame()}};this.doStart=function(){var q=this;k.onSceneReadyToDisplay(function(){for(var n=0;n<q.config.nodeTypes.length;++n)if(0<n||q.config.hideAllOnStart){var p=
k.findNodesOfType(q.config.nodeTypes[n]),r=$jscomp.makeIterator(p);for(p=r.next();!p.done;p=r.next())p.value.hide()}if(0<q.config.nodeTypes.length&&!q.config.hideAllOnStart)for(h=0,m=k.findNodesOfType(q.config.nodeTypes[0]),n=$jscomp.makeIterator(m),p=n.next();!p.done;p=n.next())p.value.show();else h=-1,m=[];q.config.trigger&&q.addTrigger(q.config.trigger,function(){return g.trigger()});k.requestFrame()})};this.doStop=function(){for(var q=0;q<this.config.nodeTypes.length;++q)if(q!==h){var n=k.findNodesOfType(this.config.nodeTypes[q]);
n=$jscomp.makeIterator(n);for(var p=n.next();!p.done;p=n.next())p.value.show()}k.requestFrame()}};WALK.Extensions.SwitchObjects.definition={name:"Switch objects",properties:[{id:"nodeTypes",type:"list",elementType:"nodeType",label:"Objects to switch"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0},{id:"hideAllOnStart",type:"bool",label:"Hide all on start",defaultValue:!1},{id:"hideAllAfterLast",type:"bool",label:" Hide all after last",defaultValue:!1}],vrCompatible:!0};WALK.Extensions.VideoStream=
function(f){function g(){function r(x){var w=document.createElement("video");w.classList.add("video-js");w.autoplay=!0;w.muted=!0;w.type="application/x-mpegURL";if(Hls.isSupported()){var u=new Hls;u.loadSource(x);u.attachMedia(w)}else w.canPlayType("application/vnd.apple.mpegurl")?w.src=x:console.log("No Hls support");return n.createStreamTextureFromHtmlVideo(w)}(function(){var x=r(p.config.streamUrl);x.addLoadedListener(function(){q=!1;p.running&&(console.log(x),h=m.baseColorTexture,m.baseColorTexture=
x,p.viewerApi.onNextPageInteraction(function(){x.muted=!1}),l=!0)});q=!0;x.play();return!0})()}function k(){var r=p.config;(m=n.findMaterial(r.material))?m.baseColorTexture?WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/Hls.js"),function(){r.trigger&&p.addTrigger(r.trigger,function(){return p.trigger()});!r.autoplay&&r.trigger||p.trigger()},function(){return WALK.USER_MSG.error("Cannot load required library")}):(console.error("Material '"+r.material+"' for stream texture control '"+(r.name+
"' does not have a stream texture")),m=null):console.error("Material '"+r.material+"' for stream texture control '"+(r.name+"' does not exist"))}WALK.Extension.call(this,f);var h=null,m=null,l=!1,q=!1,n=WALK.getViewer(),p=this;this.viewerApi.isSceneReadyToDisplay()||this.viewerApi.setMaterialEditable(this.config.material);this.trigger=function(r){q||(l||q?!0===r&&m.isPlaying||!1===r&&!m.isPlaying||(m.isPlaying?m.pause():m.play()):!1!==r&&g())};this.doStart=function(){this.viewerApi.onSceneLoadComplete(k)};
this.doStop=function(){if(m){if(l){l=!1;var r=m.baseColorTexture;m.baseColorTexture=h;r.dispose();h=null}m=null}}};WALK.Extensions.VideoStream.definition={name:"Video Stream",properties:[{id:"material",type:"material",label:"Material with stream"},{id:"streamUrl",type:"text",label:"Stream URL"},{id:"trigger",type:"trigger",label:"Trigger",defaultValue:!1,optional:!0},{id:"autoplay",type:"bool",label:"Autoplay",defaultValue:!0}],vrCompatible:!0};WALK.Extensions.MultiTrigger=function(f){function g(){return m.config.extensions.map(function(n){var p=
$jscomp.makeIterator(d(n));n=p.next().value;p=p.next().value;return l.getExtension(n,p)}).filter(function(n){return n})}function k(n,p,r){n=$jscomp.makeIterator(g());for(r=n.next();!r.done;r=n.next()){r=r.value;try{r.triggerAtPosition?r.triggerAtPosition(q,p):r.trigger(q)}catch(x){console.error("Failed to trigger an extension "+x)}}q=!q}function h(){var n=m.config;n.trigger&&m.addTrigger(n.trigger,k)}WALK.Extension.call(this,f);var m=this,l=this.viewerApi,q=!0;Object.defineProperty(this,"vrCompatible",
{get:function(){for(var n=$jscomp.makeIterator(g()),p=n.next();!p.done;p=n.next())if(!p.value.vrCompatible)return!1;return!0}});this.doStart=function(){l.onSceneReadyToDisplay(h);q=!0}};WALK.Extensions.MultiTrigger.definition={name:"Multi trigger",getListElementsToAdd:function(f,g,k){console.assert("extensions"===f);var h=new Set(g.map(function(m){return d(m)[0]}));return k.getEditableExtensions().filter(function(m){return m.trigger!==b&&("VideoTextureControl"===m.type||"SwitchObjects"===m.type||
!h.has(m.type))}).map(function(m){return m.type+":"+m.name})},formatListElement:function(f){var g=$jscomp.makeIterator(d(f));f=g.next().value;g=g.next().value;return WALK.ExtensionManager.getExtensionDefinition(f).name+": "+g},properties:[{id:"extensions",type:"list",elementType:"string",label:"Extensions to trigger",elementLabel:"extension"},{id:"trigger",type:"trigger",label:"Trigger",defaultValue:!1,optional:!0}]}})();var MeetingUiUtils$$module$extensions$MeetingUiUtils={};
(function(){function a(d){d.style.display=""}function b(d){d.style.display="none"}function c(d){var e=null,f=null;this.showDismiss=!0;this.onDismiss=this.onClose=null;this.position=c.DEFAULT;this.modal=this.foremost=!1;this.open=function(){null===f&&(this.modal?(e=document.createElement("div"),e.className="modal-backdrop",document.body.appendChild(e),f=document.createElement("div"),e.appendChild(f)):(f=document.createElement("div"),document.body.appendChild(f)),this.update(d))};this.hide=function(){e?
b(e):b(f)};this.unhide=function(){e?a(e):a(f)};this.update=function(g){var k=this,h=this.showDismiss?'<div class="ext-popup-close-button-panel ui-close-hoverable">\n           <div class="ext-popup-close-button"></div>\n         </div>':"",m=function(){switch(k.position){case c.TOP:return"ui-top ui-center";case c.DEFAULT:return"ui-upper-half-center";case c.CENTER:return"ui-all-center";default:return console.log("Invalid popup position: "+k.position),"ui-all-center"}}();f.innerHTML='\n       <div class="ext-popup '+
m+" "+(this.foremost?"ui-foremost":"")+'">\n         <div class="ext-popup-content">\n           '+g+"\n         </div>"+h+"\n       </div>";this.showDismiss&&(f.getElementsByClassName("ext-popup-close-button")[0].onclick=function(){return k.dismiss()})};this.getElementsByClassName=function(g){return f.getElementsByClassName(g)};this.dismiss=function(){if(null!==f&&(this.close(),this.onDismiss))this.onDismiss()};this.close=function(){if(null!==f&&(this.modal?(document.body.removeChild(e),e=null):
document.body.removeChild(f),f=null,this.onClose))this.onClose()}}c.CENTER="center";c.DEFAULT="default";c.TOP="top";MeetingUiUtils$$module$extensions$MeetingUiUtils={removeChildren:function(d){for(;d.firstChild;)d.removeChild(d.firstChild)},addClickHandler:function(d,e){document.getElementById(d).onclick=e},addChangeHandler:function(d,e){document.getElementById(d).onchange=e},show:a,hide:b,setVisibility:function(d,e){e?a(d):b(d)},setButtonHighlight:function(d,e){e?d.classList.add("ext-meeting-button-highlight"):
d.classList.remove("ext-meeting-button-highlight")},highlightInput:function(d){d.classList.add("ext-meeting-input-missing");window.setTimeout(function(){d.classList.remove("ext-meeting-input-missing")},200)},highlightText:function(d){d.classList.add("ext-meeting-text-highlighted");window.setTimeout(function(){d.classList.remove("ext-meeting-text-highlighted")},200)},UiPopup:c,showMessage:function(d,e){var f="";e&&(f='<h3 class="ext-meeting-dialog-title">'+e+"</h3>");var g=new c(f+('\n      <div class="ext-meeting-dialog-message">\n        '+
d+'\n      </div>\n      <div class="ext-meeting-dialog-buttons">\n        <button class="ext-meeting-button">\n          Close\n        </button>\n      </div>\n    '));g.showDismiss=!1;g.foremost=!0;g.modal=!0;g.open();g.getElementsByClassName("ext-meeting-button")[0].onclick=function(){g.close()}},showIframePopup:function(d,e,f){var g=new c('\n      <div class="ext-meeting-dialog-iframe-container">\n        <h3 class="ext-meeting-dialog-title">'+d+'</h3>\n        <iframe src="'+e+'" class="ext-meeting-dialog-iframe">\n        </iframe>\n        <div>\n          <div class="ext-meeting-dialog-buttons">\n            <button class="ext-meeting-button">\n              Close\n            </button>\n          </div>\n        </div>\n      <div>\n    ');
g.showDismiss=!1;g.position=c.CENTER;g.onClose=f;g.open();var k=g.getElementsByClassName("ext-meeting-dialog-iframe")[0];k.style.visibility="hidden";k.onload=function(){k.style.visibility="visible"};g.getElementsByClassName("ext-meeting-button")[0].onclick=function(){return g.close()}}}})();var module$extensions$MeetingUiUtils={get MeetingUiUtils(){return MeetingUiUtils$$module$extensions$MeetingUiUtils}};var SoundUtils$$module$extensions$SoundUtils={};
(function(){function a(){null===b&&(b=new (window.AudioContext||window.webkitAudioContext));return b}var b=null,c=function(e,f,g){this._frequencyDiv=f;this._noSoundThreshold=g;this._maxFrequencyIndex=this._minFrequencyIndex=-1;this._noSoundCalls=0;this._source=null;this._analyser=a().createAnalyser();this._analyser.fftSize=2*this._frequencyDiv;this._analyser.smoothingTimeConstant=.5;e=new MediaStream([e.mediaStreamTrack]);this._source=a().createMediaStreamSource(e);this._source.connect(this._analyser);
e=a().sampleRate/this._frequencyDiv;this._minFrequencyIndex=Math.floor(c._minVoiceFrequency/e);this._maxFrequencyIndex=Math.floor(c._maxVoiceFrequency/e);this._dataArray=new Uint8Array(this._maxFrequencyIndex+1)};c.prototype.measureSoundVolume=function(){var e=this._getOverallSoundVolume();return this._shouldSkipNoSoundNotification(e)?null:e};c.prototype.dispose=function(){null!==this._source&&(this._source.disconnect(),this._source=null)};c.prototype._getOverallSoundVolume=function(){this._analyser.getByteFrequencyData(this._dataArray);
for(var e=0,f=this._minFrequencyIndex;f<=this._maxFrequencyIndex;f++)this._dataArray[f]>e&&(e=this._dataArray[f]);return e};c.prototype._shouldSkipNoSoundNotification=function(e){if(e<this._noSoundThreshold)return this._noSoundCalls++,this._noSoundCalls<c._skippedNoSoundCalls;this._noSoundCalls=0;return!1};c._minVoiceFrequency=85;c._maxVoiceFrequency=350;c._skippedNoSoundCalls=3;var d=function(e,f,g,k){this._width=e;this._height=f;this._bottomMargin=void 0!==k?k:0;this._volumeRect=null;this._rectId=
d._baseRectId+d._counter;d._counter++;this._noSoundThreshold=g;this._lengthCoef=e/(255-this._noSoundThreshold)};d.prototype.getHTML=function(){this._volumeRect=null;return'\n        <svg style="filter: drop-shadow(0px 0px 1px black);\n                    margin-bottom: '+this._bottomMargin.toString()+'px;"\n             width="'+this._width.toString()+'px"\n             height="'+this._height.toString()+'px">\n          <rect id="'+this._rectId+'"\n                x = "'+(this._width/2-1).toString()+
'" y = "0"\n                width="'+(1).toString()+'"\n                height="'+this._height.toString()+'"\n                fill="red"/>\n        </svg>\n      '};d.prototype.getEmptyHTML=function(){return'\n        <svg width="'+this._width.toString()+'px"\n             height="'+this._height.toString()+'px">\n        </svg>\n      '};d.prototype.update=function(e){null===this._volumeRect&&(this._volumeRect=document.getElementById(this._rectId));console.assert(null!==this._volumeRect,"Volume visualizer HTML not attached to any element");
if(null!==e){var f=this._getColor(e),g=Math.max(d._minimalDisplayedValue,Math.max(e,this._noSoundThreshold)-this._noSoundThreshold);e=this._width/2-g*this._lengthCoef/2;g*=this._lengthCoef;this._volumeRect.setAttribute("fill",f);this._volumeRect.setAttribute("x",e.toString());this._volumeRect.setAttribute("width",g.toString())}};d.prototype._getColor=function(e){return e<this._noSoundThreshold?"red":e<d._lowSoundThreshold?"orange":"green"};d._counter=0;d._baseRectId="ext-meeting-mic-bar-";d._lowSoundThreshold=
180;d._minimalDisplayedValue=20;SoundUtils$$module$extensions$SoundUtils={VolumeMeter:c,VolumeVisualizer:d}})();var module$extensions$SoundUtils={get SoundUtils(){return SoundUtils$$module$extensions$SoundUtils}};var MeetingStarter$$module$extensions$MeetingStarter;
(function(){function a(l,q){return l?q[0].toUpperCase()+q.slice(1):q[0].toLowerCase()+q.slice(1)}function b(l,q){var n=void 0!==q;n=a(!0,l.name)+(n?" and "+a(!1,q.name):"");l=l.error.name;console.assert(void 0===q||q.error.name===l);return"NotFoundError"===l?n+" not found":"NotAllowedError"===l?n+" blocked":"Error"===l?"Error":n+" not available"}function c(l,q){var n=void 0!==q,p=n?"they are":"it is",r=n?"them":"it",x=l.error.name;return"NotFoundError"===x?"Check if your "+(a(!1,l.name)+(n?" and "+
a(!1,q.name):""))+" "+(n?"are":"is")+" properly connected.":"NotAllowedError"===x?WALK.DETECTOR.mobile?WALK.DETECTOR.ios?"Unblock "+r+" by clicking "+(n?l.unblockIcon+" and "+q.unblockIcon:"the "+l.unblockIcon)+" "+(n?"buttons":"button")+".":"Unblock "+r+" in the browser settings for this webpage.":"Unblock "+r+" by clicking the "+(n?q.unblockIcon:l.unblockIcon)+" button in the browser\u2019s address bar and refresh the webpage.":"Error"===x?"Your browser doesn't support video meetings. Open the meeting link in another browser.":
"If "+p+" connected, close all other applications using "+(r+" and refresh the webpage.")}var d={name:"mic"},e={name:"camera",facingMode:"user"},f=function(l,q,n,p){this._firstErrorDiv=document.getElementById(l);this._secondErrorDiv=document.getElementById(q);this._devicePreview1=n;this._devicePreview2=p};f.prototype._reset=function(){this._devicePreview1.setErrorDiv(null);this._devicePreview2.setErrorDiv(null);MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(this._firstErrorDiv);MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(this._secondErrorDiv)};
f.prototype._displayAndLogErrorMessage=function(l,q,n){function p(w){if(void 0!==w)return w.device}var r=b(q.device,p(n)),x=c(q.device,p(n));l.innerHTML='\n        <div class="ext-meeting-join-error-title">'+r+'</div>\n        <div class="ext-meeting-join-error-description">'+x+"</div>\n      ";q.setErrorDiv(l);q.device.logError();void 0!==n&&(n.setErrorDiv(l),n.device.logError())};f.prototype.update=function(){this._reset();var l=this._devicePreview1.device.error,q=this._devicePreview2.device.error;
if(null!==l||null!==q)null!==l&&null!==q?l.name===q.name?this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview1,this._devicePreview2):(this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview1),this._displayAndLogErrorMessage(this._secondErrorDiv,this._devicePreview2)):null!==l?this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview1):this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview2)};var g=function(l,q){this._name=l;this._active=
!1;this._unblockIcon=q;this._error=this._track=this._trackOptions=null};g.prototype.logError=function(){null!==this._error&&WALK.log("Can't create local "+this.name+" track : "+(this._error.name+", "+this._error.message))};g.prototype._getLabel=function(){return this._track?this._track.mediaStreamTrack.label:null};g.prototype.getId=function(){return this._trackOptions&&this._trackOptions.deviceId?this._trackOptions.deviceId.exact:null};g.prototype.getErrorMessageInfo=function(){if(null===this._error)return null;
var l=b(this),q=c(this);return{title:l,description:q}};$jscomp.global.Object.defineProperties(g.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},track:{configurable:!0,enumerable:!0,get:function(){return this._track},set:function(l){this._track=l}},active:{configurable:!0,enumerable:!0,get:function(){return this._active},set:function(l){this._active=l}},unblockIcon:{configurable:!0,enumerable:!0,get:function(){return this._unblockIcon}},error:{configurable:!0,enumerable:!0,
get:function(){return this._error},set:function(l){this._error=l}},trackOptions:{configurable:!0,enumerable:!0,get:function(){return this._trackOptions},set:function(l){this._trackOptions=l}}});var k=function(l,q,n,p,r,x,w){this._device=new g(l,w);this._width=n;this._height=p;this._toggleButton=document.getElementById(r);this._previewContainer=document.getElementById(x);this._errorDiv=null;this._meetingStarter=q;MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler(this._toggleButton.id,
this._onToggleButtonClicked.bind(this));this._onStoppedBound=this._onStopped.bind(this);this._twilioCreateTrackFunction=null};k.prototype.isAvailable=function(){return null!==this._device.track};k.prototype.dispose=function(){null!==this._device.track&&this._device.track.removeListener("stopped",this._onStoppedBound);this._close()};k.prototype._pauseMonitoringTrackBeforeReset=function(){this._device.track.removeListener("stopped",this._onStoppedBound)};k.prototype._resumeMonitoringTrackAfterReset=
function(){this._device.track.addListener("stopped",this._onStoppedBound)};k.prototype.setErrorDiv=function(l){this._errorDiv=l};k.prototype.showInTestNeededMode=function(){this.setError({name:"Test needed"})};k.prototype.showInPreviewMode=function(){this.setError({name:"Initializing"});this.setToggleButtonVisibility(!0)};k.prototype.createTrack=function(l){var q=this;return new Promise(function(n,p){var r=l?l:q._device.trackOptions;q._twilioCreateTrackFunction(WALK.cloneObject(r)).then(function(x){q.setTrack(x,
r)}).catch(function(x){q.setTrack(null,r,x)}).finally(function(){q._toggleButton.disabled=!1;n()})})};k.prototype.updateTrackDeviceId=function(l){var q=function(p,r){return(p=p.find(function(x){return x.label===r}))?p.deviceId:null};if(this._device.track&&!this._device.trackOptions.deviceId){var n=this._device._getLabel();l=q(l,n);console.assert(null!==l,"deviceId not found");this._device.trackOptions={name:this._device.trackOptions.name,deviceId:{exact:l}}}};k.prototype.setTrack=function(l,q,n){q&&
(this._device.trackOptions=q);null!==l&&void 0!==n?console.assert("Invalid setTrack parameters : track and error set"):null===l&&void 0===n&&console.assert("Invalid setTrack parameters : track and error not set");this._disposeTrack();this._device.track=l;null!==this._device.track?(this._device.track.on("stopped",this._onStoppedBound),this._device.active=!0,this._showTrack(),this.setError(null)):(this._device.active=!1,this._hideTrack(),this.setError(n));this._meetingStarter.updateErrorMessage();this._updateToggleButtonState()};
k.prototype.setError=function(l){this._device.error=l};k.prototype.restartTrack=function(l){var q=this;this._toggleButton.disabled=!0;this.isAvailable()?(this._pauseMonitoringTrackBeforeReset(),this._device.trackOptions=l,this._device.track.restart(WALK.cloneObject(l)).then(function(){q._resumeMonitoringTrackAfterReset();q._meetingStarter.updateErrorMessage();q._toggleButton.disabled=!1}).catch(function(n){WALK.log("Second attempt to create track,device: "+q._device.name);window.setTimeout(function(){return q.createTrack(l)},
1E3)})):this.createTrack(l)};k.prototype.setToggleButtonVisibility=function(l){MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(this._toggleButton,l)};k.prototype._updateToggleButtonState=function(){this._device.active?(MeetingUiUtils$$module$extensions$MeetingUiUtils.setButtonHighlight(this._toggleButton,!1),MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(this._toggleButton.children[0],!0),MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(this._toggleButton.children[1],
!1)):(MeetingUiUtils$$module$extensions$MeetingUiUtils.setButtonHighlight(this._toggleButton,!0),MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(this._toggleButton.children[0],!1),MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(this._toggleButton.children[1],!0))};k.prototype._disposeTrack=function(){if(null!==this._device.track){var l=this._device.track;l.removeListener("stopped",this._onStoppedBound);l.detach();l.stop()}this._device.track=null};k.prototype._onStopped=
function(){null!==this._device.track&&this.setTrack(null,null,{name:"NotReadableError",message:"Stopped"})};k.prototype._close=function(){MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(this._previewContainer)};k.prototype._setPreviewInnerHTML=function(l){this._close();this._previewContainer.innerHTML=l;MeetingUiUtils$$module$extensions$MeetingUiUtils.show(this._previewContainer)};k.prototype._setPreviewElement=function(l){this._close();null!==l&&(l.style.width=this._width.toString()+
"px",l.style.height=this._height.toString()+"px",this._previewContainer.appendChild(l),MeetingUiUtils$$module$extensions$MeetingUiUtils.show(this._previewContainer))};k.prototype._showTrack=function(){this._device.active=!0;this._device.track.enable()};k.prototype._hideTrack=function(){this._device.active=!1};k.prototype._onToggleButtonClicked=function(){var l=this;this.isAvailable()?(this._device.active?this._onSwitchOff():this._onSwitchOn(),this._updateToggleButtonState()):this.createTrack().then(function(){l._device.error&&
MeetingUiUtils$$module$extensions$MeetingUiUtils.highlightText(l._errorDiv)})};k.prototype._onSwitchOff=function(){this._hideTrack();this._device.track.disable()};k.prototype._onSwitchOn=function(){this._showTrack();this._device.track.enable()};$jscomp.global.Object.defineProperties(k.prototype,{device:{configurable:!0,enumerable:!0,get:function(){return this._device}}});var h=function(l,q,n,p,r){l=k.call(this,"Camera",l,q,n,p,r,'<span class="fa-video-slash"></span>')||this;l._twilioCreateTrackFunction=
Twilio.Video.createLocalVideoTrack;l._device.trackOptions=e;return l};$jscomp.inherits(h,k);h.prototype.showInTestNeededMode=function(){k.prototype.showInTestNeededMode.call(this);this._showPlaceholder()};h.prototype.showInPreviewMode=function(){k.prototype.showInPreviewMode.call(this);this._showPlaceholder()};h.prototype._showPlaceholder=function(){this._setPreviewInnerHTML('\n        <div class="ext-meeting-join-camera-preview-placeholder">\n          <span class="fa-video absolute-center"></span>\n        </div>\n      ')};
h.prototype._hideTrack=function(){k.prototype._hideTrack.call(this);this._showPlaceholder()};h.prototype._showTrack=function(){k.prototype._showTrack.call(this);this._setPreviewElement(this._device.track.attach())};h.prototype._onSwitchOff=function(){k.prototype._onSwitchOff.call(this);this.setTrack(null,null,null)};var m=function(l,q,n,p,r){l=k.call(this,"Microphone",l,q,n,p,r,'<span class="fa-microphone-slash"></span>')||this;l._noSoundThreshold=80;l._volumeVisualizer=new SoundUtils$$module$extensions$SoundUtils.VolumeVisualizer(q,
n,l._noSoundThreshold);l._volumeMeter=null;l._measurementIntervalId=null;l._twilioCreateTrackFunction=Twilio.Video.createLocalAudioTrack;l._device.trackOptions=d;return l};$jscomp.inherits(m,k);m.prototype.showInTestNeededMode=function(){k.prototype.showInTestNeededMode.call(this);this._setPreviewElement(null)};m.prototype.showInPreviewMode=function(){k.prototype.showInPreviewMode.call(this);this._setPreviewElement(null)};m.prototype.dispose=function(){this._isMeasurementActive()&&this._stopMeasurement();
k.prototype.dispose.call(this)};m.prototype._measure=function(){this._volumeVisualizer.update(this._volumeMeter.measureSoundVolume())};m.prototype._hideTrack=function(){k.prototype._hideTrack.call(this);this._isMeasurementActive()&&this._stopMeasurement();this._setPreviewElement(null)};m.prototype._showTrack=function(){k.prototype._showTrack.call(this);this._setPreviewInnerHTML(this._volumeVisualizer.getHTML());this._startMeasurement()};m.prototype._startMeasurement=function(){var l=this;this._volumeMeter=
new SoundUtils$$module$extensions$SoundUtils.VolumeMeter(this._device.track,512,this._noSoundThreshold);this._measurementIntervalId=setInterval(function(){return l._measure()})};m.prototype._stopMeasurement=function(){clearInterval(this._measurementIntervalId);this._measurementIntervalId=null;this._volumeMeter.dispose();this._volumeMeter=null};m.prototype._isMeasurementActive=function(){return null!==this._measurementIntervalId};m.prototype._pauseMonitoringTrackBeforeReset=function(){k.prototype._pauseMonitoringTrackBeforeReset.call(this);
this._isMeasurementActive()&&this._stopMeasurement()};m.prototype._resumeMonitoringTrackAfterReset=function(){k.prototype._resumeMonitoringTrackAfterReset.call(this);this._startMeasurement()};m.prototype._disposeTrack=function(){this._isMeasurementActive()&&this._stopMeasurement();k.prototype._disposeTrack.call(this)};MeetingStarter$$module$extensions$MeetingStarter=function(l){this._onJoinCallback=l;this._joinMode=!1;this._micVolumePreview=this._cameraPreview=this._dialog=null;this._cameraPreviewHeight=
198;this._cameraPreviewWidth=264;this._micVolumePreviewHeight=4;this._micVolumePreviewWidth=40;this._onDevicesChangedBound=this._onDevicesChanged.bind(this);this._errorMessageActive=!0};MeetingStarter$$module$extensions$MeetingStarter.prototype.show=function(){var l=this;this._blurHelp();this._createDialog();this._cameraPreview=new h(this,this._cameraPreviewWidth,this._cameraPreviewHeight,"ext-meeting-join-camera-toggle","ext-meeting-join-camera-preview-container");this._micVolumePreview=new m(this,
this._micVolumePreviewWidth,this._micVolumePreviewHeight,"ext-meeting-join-mic-toggle","ext-meeting-join-mic-volume-container");this._errorMessageGenerator=new f("ext-meeting-join-first-error","ext-meeting-join-second-error",this._micVolumePreview,this._cameraPreview);this._setupDevicesSelection();this._checkPermissions().then(function(){l._runPreviewMode(!1);l._createMediaTracksSeparately(e,d,function(){return l._onMediaInitialized()})}).catch(function(q){void 0!==q&&WALK.log("Error checking audio/video devices permissions: "+
q.name+": "+q.message);l._runTestNeededMode()})};MeetingStarter$$module$extensions$MeetingStarter.prototype._checkPermissions=function(){return new Promise(function(l,q){return navigator.mediaDevices.enumerateDevices().then(function(n){var p=n.filter(function(r){return"audioinput"===r.kind&&""!==r.deviceId&&""!==r.label});n=n.filter(function(r){return"videoinput"===r.kind&&""!==r.deviceId&&""!==r.label});0<p.length||0<n.length?l():q()}).catch(function(n){q(n)})})};MeetingStarter$$module$extensions$MeetingStarter.prototype._setupDevicesSelection=
function(){var l=this;MeetingUiUtils$$module$extensions$MeetingUiUtils.addChangeHandler("ext-meeting-join-select-camera",function(q){l._cameraPreview.restartTrack({name:"camera",deviceId:{exact:q.currentTarget.value}})});MeetingUiUtils$$module$extensions$MeetingUiUtils.addChangeHandler("ext-meeting-join-select-microphone",function(q){l._micVolumePreview.restartTrack({name:"mic",deviceId:{exact:q.currentTarget.value}})});navigator.mediaDevices.addEventListener("devicechange",this._onDevicesChangedBound)};
MeetingStarter$$module$extensions$MeetingStarter.prototype._onDevicesChanged=function(){if(this._joinMode){var l=this._cameraPreview.device.error,q=this._micVolumePreview.device.error;l||q?this._createMediaTracksSeparately(l?e:null,q?d:null):this._fillDevicesSelectControls()}};MeetingStarter$$module$extensions$MeetingStarter.prototype._fillDevicesSelectControls=function(){var l=this;navigator.mediaDevices.enumerateDevices().then(function(q){l._cameraPreview.updateTrackDeviceId(q);l._micVolumePreview.updateTrackDeviceId(q);
var n=q.filter(function(p){return"audioinput"===p.kind});l._fillDevicesSelectControl(n,"ext-meeting-join-select-microphone-container","ext-meeting-join-select-microphone",l._micVolumePreview.device.getId());q=q.filter(function(p){return"videoinput"===p.kind});l._fillDevicesSelectControl(q,"ext-meeting-join-select-camera-container","ext-meeting-join-select-camera",l._cameraPreview.device.getId())})};MeetingStarter$$module$extensions$MeetingStarter.prototype._fillDevicesSelectControl=function(l,q,n,
p){q=document.getElementById(q);var r=document.getElementById(n);MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(q,1<l.length);MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(r);1<l.length&&(l.forEach(function(x){var w=document.createElement("option");w.value=""+x.deviceId;WALK.setTextContent(w,""+x.label);r.appendChild(w)}),r.value=p)};MeetingStarter$$module$extensions$MeetingStarter.prototype._createDialog=function(){var l=this;this._dialog=new MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup('\n        <h3 class="ext-meeting-dialog-title">Join 3D meeting</h3>\n        <div class="ext-meeting-join-row">\n          <div id="ext-meeting-join-name-label">\n            Name:\n          </div>\n          <input type="text" id="ext-meeting-join-name"\n                 class="ext-meeting-join-input"\n                 autocomplete="off">\n          </input>\n        </div>\n        <div class="ext-meeting-join-row">\n          <div class="ext-meeting-join-main-container">\n            <div id="ext-meeting-join-error-container"\n                 class="absolute-vertical-center">\n              <div id="ext-meeting-join-first-error"></div>\n              <div id="ext-meeting-join-second-error"></div>\n            </div>\n            <div id="ext-meeting-join-camera-preview-container"></div>\n            <div id="ext-meeting-join-mic-volume-container"></div>\n            <div id="ext-meeting-join-preview-toggle-container"\n                 class="absolute-horizontal-center">\n              <button id="ext-meeting-join-mic-toggle" style="display: none"\n                      class="ext-meeting-button ext-meeting-button-highlight\n                            ext-meeting-join-device-button">\n                <span class="fa-microphone" style="display: none"></span>\n                <span class="fa-microphone-slash"></span>\n              </button>\n              <button id="ext-meeting-join-camera-toggle" style="display: none"\n                      class="ext-meeting-button ext-meeting-button-highlight\n                            ext-meeting-join-device-button">\n                <span class="fa-video" style="display: none"></span>\n                <span class="fa-video-slash"></span>\n              </button>\n            </div>\n          </div>\n        </div>\n        <div class="ext-meeting-join-row">\n          <div id="ext-meeting-join-select-camera-container"\n               style="display: none">\n            Camera:\n            <select id="ext-meeting-join-select-camera"\n                    class="ext-meeting-join-input">\n            </select>\n          </div>\n          <div id="ext-meeting-join-select-microphone-container"\n               style="display: none">\n            Microphone:\n            <select id="ext-meeting-join-select-microphone"\n                    class="ext-meeting-join-input">\n            </select>\n          </div>\n        </div>\n        <div id="ext-meeting-join-button-container"\n             class="ext-meeting-join-row">\n          <button id="ext-meeting-join-button"\n                  class="ext-meeting-button ext-meeting-dialog-buttons">\n                  Join\n          </button>\n        </div>\n        <div class="ext-meeting-join-footer">\n          By joining, you agree to the\n          <span id="terms-of-service-link" class="ext-meeting-terms-link"><u>\n            Terms of Service </u></span> and\n          <span id="privacy-policy-link" class="ext-meeting-terms-link"><u>\n            Privacy Policy</u></span>.\n        </div>\n      ');
this._dialog.showDismiss=!1;this._dialog.foremost=!0;this._dialog.open();document.getElementById("terms-of-service-link").onclick=function(){l._dialog.hide();MeetingUiUtils$$module$extensions$MeetingUiUtils.showIframePopup("The 3D meeting infrastructure is provided by Shapespark under the following Terms of Service","https://www.shapespark.com/terms#in-viewer",function(){return l._dialog.unhide()})};document.getElementById("privacy-policy-link").onclick=function(){l._dialog.hide();MeetingUiUtils$$module$extensions$MeetingUiUtils.showIframePopup("The 3D meeting infrastructure is provided by Shapespark under the following Privacy Policy",
"https://www.shapespark.com/privacy#in-viewer",function(){return l._dialog.unhide()})};this._initializeDisplayName()};MeetingStarter$$module$extensions$MeetingStarter.prototype._createMediaTracksSeparately=function(l,q,n){var p=this,r=function(){p._fillDevicesSelectControls();p._errorMessageActive=!0;p.updateErrorMessage();n&&n()};this._errorMessageActive=!1;l&&q?this._cameraPreview.createTrack(l).then(function(){return p._micVolumePreview.createTrack(q)}).then(function(){r()}):l?this._cameraPreview.createTrack(l).then(function(){r()}):
this._micVolumePreview.createTrack(q).then(function(){r()})};MeetingStarter$$module$extensions$MeetingStarter.prototype._runTestNeededMode=function(){this._setTestNeededMode();this._cameraPreview.showInTestNeededMode();this._micVolumePreview.showInTestNeededMode()};MeetingStarter$$module$extensions$MeetingStarter.prototype._runPreviewMode=function(l){this._setPreviewMode(l);l?(this._cameraPreview.setToggleButtonVisibility(!0),this._micVolumePreview.setToggleButtonVisibility(!0)):(this._cameraPreview.showInPreviewMode(),
this._micVolumePreview.showInPreviewMode())};MeetingStarter$$module$extensions$MeetingStarter.prototype._onCreateMediaTracks=function(l,q,n){var p=l.filter(function(r){return"audio"===r.kind});l=l.filter(function(r){return"video"===r.kind});this._errorMessageActive=!1;0<p.length?this._micVolumePreview.setTrack(p[0],q):this._micVolumePreview.setTrack(null,q,{name:"Unknown error",message:""});0<l.length?this._cameraPreview.setTrack(l[0],n):this._cameraPreview.setTrack(null,n,{name:"Unknown error",message:""});
this._errorMessageActive=!0;this.updateErrorMessage();this._fillDevicesSelectControls();this._runPreviewMode(!0)};MeetingStarter$$module$extensions$MeetingStarter.prototype._testCamera=function(){var l=this,q={audio:WALK.cloneObject(d),video:WALK.cloneObject(e)};Twilio.Video.createLocalTracks(q).then(function(n){l._onCreateMediaTracks(n)}).catch(function(n){l._createMediaTracksSeparately(e,d,function(){return l._runPreviewMode(!0)})})};MeetingStarter$$module$extensions$MeetingStarter.prototype._setTestNeededMode=
function(){var l=this;this._joinMode=!1;var q=document.getElementById("ext-meeting-join-button-container");MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(q);q.innerHTML='\n        <button class="ext-meeting-button ext-meeting-dialog-buttons"\n                id="ext-meeting-test-button">\n          Test camera\n        </button>\n      ';MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-test-button",function(){return l._testCamera()})};MeetingStarter$$module$extensions$MeetingStarter.prototype._setPreviewMode=
function(l){var q=this;if(!this._joinMode){this._joinMode=!0;var n=document.getElementById("ext-meeting-join-button-container");MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(n);n.innerHTML='\n        <button class="ext-meeting-button ext-meeting-dialog-buttons"\n                id="ext-meeting-join-button">\n          Join\n        </button>\n      ';MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-join-button",function(){return q._joinMeeting()});l||
this.setJoinButtonEnabled(!1)}};MeetingStarter$$module$extensions$MeetingStarter.prototype._onMediaInitialized=function(){this.setJoinButtonEnabled(!0)};MeetingStarter$$module$extensions$MeetingStarter.prototype.setJoinButtonEnabled=function(l){document.getElementById("ext-meeting-join-button").disabled=!l};MeetingStarter$$module$extensions$MeetingStarter.prototype._initializeDisplayName=function(){var l=document.getElementById("ext-meeting-join-name"),q=localStorage.getItem("extMtgDisplayName");
q&&(l.value=q);l.focus();l.select()};MeetingStarter$$module$extensions$MeetingStarter.prototype._checkDisplayName=function(){var l=document.getElementById("ext-meeting-join-name"),q=l.value.trim();if(q)return q;MeetingUiUtils$$module$extensions$MeetingUiUtils.highlightInput(l)};MeetingStarter$$module$extensions$MeetingStarter.prototype._blurHelp=function(){document.getElementById("help-and-primary-progress").classList.add("ui-blur")};MeetingStarter$$module$extensions$MeetingStarter.prototype._unblurHelp=
function(){var l=document.getElementById("help-and-primary-progress");l.classList.remove("ui-blur");l.classList.add("ui-unblur")};MeetingStarter$$module$extensions$MeetingStarter.prototype._joinMeeting=function(){var l=this._checkDisplayName();if(void 0!==l){localStorage.setItem("extMtgDisplayName",l);var q=this._micVolumePreview.device,n=this._cameraPreview.device;this._dispose();this._onJoinCallback(l,q,n)}};MeetingStarter$$module$extensions$MeetingStarter.prototype.updateErrorMessage=function(){this._errorMessageActive&&
this._errorMessageGenerator.update()};MeetingStarter$$module$extensions$MeetingStarter.prototype._dispose=function(){this._dialog.close();this._unblurHelp();navigator.mediaDevices.removeEventListener("devicechange",this._onDevicesChangedBound);this._cameraPreview.dispose();this._micVolumePreview.dispose();this._micVolumePreview=this._cameraPreview=this._dialog=null}})();var module$extensions$MeetingStarter={get MeetingStarter(){return MeetingStarter$$module$extensions$MeetingStarter}};(function(){function a(){var C=window.location.hostname;return C.endsWith(".shapespark.com")?"https://cloud"+C.substr(C.indexOf(".")):C.endsWith(".shapespark.com.cn")?"https://cloud.shapespark.com.cn":WALK.DEVEL_MEETING_CLOUD_URL||"https://cloud.shapespark.com"}function b(C){C=new Date(C);var U=new Date;return U.getDate()===C.getDate()&&U.getMonth()===C.getMonth()&&U.getFullYear()===C.getFullYear()?C.toLocaleTimeString():C.toLocaleDateString()+" "+C.toLocaleTimeString()}function c(C,U,O,W){var aa=
document.createElement("li");aa.classList.add("ext-meeting-list-entry");var R=aa.appendChild(document.createElement("span"));R.classList.add("ext-meeting-list-name");R.innerText=C;R.style.color=O;W&&(aa.onclick=W,aa.style.cursor="pointer");U&&(aa.appendChild(document.createElement("br")),C=aa.appendChild(document.createElement("small")),C.innerText=U,C.style.color="white");return aa}function d(C,U,O){return{color:"#0775e8",icon:"edit",opacity:1,position:[C,U,O],radius:.07,type:"sphere"}}function e(C,
U,O,W){W=void 0===W?!0:W;var aa=new MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup("<div>\n         "+C+'\n       </div>\n       <div class ="ext-meeting-dialog-buttons">\n         <button class="ext-meeting-dialog-ok ext-meeting-button">\n           '+U+"\n         </button>\n         "+(W?'<button class="ext-meeting-dialog-cancel ext-meeting-button">\n         Cancel\n        </button>':"")+"\n       </div>");aa.showDismiss=!1;aa.open();W&&(aa.getElementsByClassName("ext-meeting-dialog-cancel")[0].onclick=
function(){return aa.dismiss()});aa.getElementsByClassName("ext-meeting-dialog-ok")[0].onclick=function(){aa.close();O()}}function f(C,U){U=U.attach();C=C.createTextureFromHtmlVideo(U);C.play();return C}function g(C){C.detach().forEach(function(U){return U.remove()})}function k(C){return C&&C.isStarted&&C.isEnabled&&!C.isStopped}function h(C,U,O){this._viewer=C;this._uuid=U;C=parseInt(U.substring(2));this._color=WALK.AVATAR_COLORS[C%WALK.AVATAR_COLORS.length];this._twilioParticipant=this._avatar=
this._displayName=null;this._lastRenderedPosition=[];this._lastRenderedPositionLength=0;this._screenTrack=this._cameraTrack=this._micTrack=this._dataTrack=null;this._noSoundThreshold=80;this._soundVolumeUpdatesScheduler=O;this._volumeVisualizer=new SoundUtils$$module$extensions$SoundUtils.VolumeVisualizer(20,3,this._noSoundThreshold,3);this._volumeMeter=null}function m(C,U,O,W,aa,R){h.call(this,C,U,W,!0);this._displayName=O;this._setUpAvatar();this._avatar.hideBody();this._isPublishingTracksDuringConnecting=
!1;this._dataTrack=new Twilio.Video.LocalDataTrack({name:"data",maxPacketLifeTime:1E3});this._isCreatingCameraTrack=this._isCreatingMicTrack=!1;this._micDevice=aa;this._cameraDevice=R;this._micTrack=this._micDevice.track;null!==this._micTrack&&this._subscribeToMicEvents();this._updateSoundMeasurementState();this._cameraTrack=this._cameraDevice.track;null!==this._cameraTrack&&(console.assert(this._cameraDevice.active,"Got inactive camera track from MeetingStarter"),this._subscribeToCameraEvents());
this._lastPosition=null;this._positionMessage=[U,O,null];this._onCameraTrackStateChanged=this._onMicTrackStateChanged=this._resendInterval=null}function l(C,U,O,W){h.call(this,C,U,O,!1);this._onUiRefreshNeeded=W;this._cameraTrackDisabledBound=this._cameraTrackEnabledBound=this._micTrackStateChangedBound=null;this._trackSubscribedBound=this._trackSubscribed.bind(this);this._trackUnsubscribedBound=this._trackUnsubscribed.bind(this);this._disposed=!1}function q(C,U,O,W,aa,R){var S=new PubNub({publishKey:U.publishKey,
subscribeKey:U.subscribeKey,authKey:U.authKey,uuid:C.uuid,ssl:!0}),fa=U.channel;S.subscribe({channels:[fa],withPresence:!0});S.addListener({message:function(X){WALK.log("listener received message",X);"SceneState"===X.message.type&&aa(X.message.state)},presence:function(X){X.uuid!==C.uuid&&(WALK.log("listener presence event",X),"join"===X.action?O(X.uuid):"leave"===X.action&&W(X.uuid))},status:function(X){"PNAccessDeniedCategory"!==X.category&&"PNNetworkIssuesCategory"!==X.category&&"PNNetworkDownCategory"!==
X.category&&"PNTimeoutCategory"!==X.category||R(X.category)}});S.hereNow({channels:[fa],includeUUIDs:!0,includeState:!0},function(X,qa){WALK.log("herenow",X,qa);qa.channels[fa].occupants.forEach(function(na){na.uuid!==C.uuid&&O(na.uuid)})});this.dispose=function(){S.unsubscribeAll()}}function n(C,U,O,W,aa,R,S){function fa(Q){var J=Q.identity.match(/^u-\d+/);J=J&&J[0];return J?J:(WALK.warn("Unknown participant",Q.identity),null)}function X(Q){WALK.log('Participant "%s" connected',Q.identity);var J=
fa(Q);J&&O(J,Q)}function qa(Q){WALK.log('Participant "%s" disconnected',Q.identity);var J=fa(Q);J&&W(J,Q)}var na=U.avToken,xa=U.channel,wa=["NotAllowedError","NotFoundError","NotReadableError","OverconstrainedError","TypeError"],ta=null,sa=!1,Da=0;this.isConnected=function(){return sa};this.disconnect=function(){sa=!1;ta&&ta.disconnect();C.disconnectedFromTwilio()};this.dispose=function(){this.disconnect()};this.connect=function(){console.assert(!sa);sa=!0;C.startedConnectingToTwilio();WALK.log('Connecting to room "%s"',
xa);Twilio.Video.connect(na,{name:xa,tracks:C.getAllTracks(),preferredVideoCodecs:["VP8"]}).then(function(Q){ta=Q;WALK.log("Connected to room");ta.participants.forEach(X);ta.on("participantConnected",X);ta.on("participantDisconnected",qa);ta.on("reconnecting",function(J){Da+=1});ta.on("reconnected",function(J){Da=0});ta.once("disconnected",function(J){sa&&(ta.participants.forEach(qa),C.disconnectedFromTwilio(),0<Da?R("TDisconnected"+J.code):S())});C.connectedToTwilio(ta.localParticipant)}).catch(function(Q){C.failedToConnectToTwilio();
wa.includes(Q.name)?aa(Q):R("T"+Q.code)})}}function p(C,U){function O(fa,X){var qa=document.createElement("span");qa.classList.add("ext-meeting-status-list-name");qa.innerText=fa;qa.style.color=X;return qa}function W(fa){var X=document.createElement("span");X.classList.add("ext-meeting-status-list-mic-indicator");fa?X.classList.add("fa-microphone"):X.classList.add("fa-microphone-slash");return X}function aa(fa){console.assert(null!==fa.volumeVisualizer,"volumeVisualizer not initialized");var X=document.createElement("span");
fa.isSoundMeasurementActive()?X.innerHTML=fa.volumeVisualizer.getHTML():X.innerHTML=fa.volumeVisualizer.getEmptyHTML();return X}var R=document.getElementById("ext-meeting-status"),S=document.getElementById("ext-meeting-who-list");this.update=function(fa){MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(S);var X=S.appendChild,qa=document.createElement("li");qa.classList.add("ext-meeting-status-list-entry");qa.appendChild(aa(C));qa.appendChild(O(C.displayName+" (me)",C.color));var na=
k(C.micTrack);qa.appendChild(W(na));X.call(S,qa);fa=$jscomp.makeIterator(Object.values(fa));for(X=fa.next();!X.done;X=fa.next())if(na=X.value,na.hasDisplayName){X=S;qa=X.appendChild;var xa=document.createElement("li");xa.classList.add("ext-meeting-status-list-entry");xa.appendChild(aa(na));var wa=O(na.displayName,na.color);wa.onclick=na.seeAvatar.bind(na);wa.style.cursor="pointer";xa.appendChild(wa);xa.appendChild(W(na.micTrack&&na.micTrack.isEnabled));qa.call(X,xa)}};this.show=function(){MeetingUiUtils$$module$extensions$MeetingUiUtils.show(R)};
this.hide=function(){MeetingUiUtils$$module$extensions$MeetingUiUtils.hide(R)};this.update([]);this.show()}function r(C){return'\n      <div>\n        <textarea id="ext-meeting-note-text"\n          class="ext-meeeting-note-edit"\n          placeholder="'+C+'"></textarea>\n      </div>\n      <button id="ext-meeting-note-publish"\n        class="ext-meeting-button ext-meeting-dialog-buttons">\n        Publish\n      </button>\n    '}function x(C,U){function O(aa){var R=W;null!==aa.location&&(R+=":"+
aa.location.join(":"));return R}var W="extMtg:"+C+":"+U+":";this.getTimeStampOfLastReadNoteAtLocation=function(aa){return localStorage.getItem(O(aa))||-1};this.isNoteRead=function(aa){return aa.ts<=this.getTimeStampOfLastReadNoteAtLocation(aa)||aa.author===U};this.markAllNotesAtLocationAsRead=function(aa){localStorage.setItem(O(aa),aa.ts)}}function w(C,U,O,W,aa,R){function S(V){if(V===U.displayName)return U.color;for(var ra=$jscomp.makeIterator(Object.values(O)),ka=ra.next();!ka.done;ka=ra.next())if(ka=
ka.value,ka.displayName===V)return ka.color;return"#ffffff"}function fa(){wa=!1;W.show();M.style.cursor="default";ta.dismiss();sa.close()}function X(V){return xa.filter(function(ra){ra=ra.location;var ka=V.location;ra=null===ra||null===ka?!1:WALK.deepEqual(ra,ka);return ra})}function qa(V,ra){function ka(ha,ja){if(!wa){pa.classList.remove("ext-meeting-note-list-unread");pa.classList.add("ext-meeting-note-list-selected");ja&&pa.scrollIntoView();ha.material.highlightMix=.7;C.requestFrame();var Ca="";
ja=new Map;for(var Ta=aa.getTimeStampOfLastReadNoteAtLocation(V),Pa=null,Ga=$jscomp.makeIterator(X(V)),L=Ga.next();!L.done;L=Ga.next()){Pa=L.value;L="ext-meeting-note-text"+Pa.id;var ia="ext-meeting-note-author"+Pa.id,Aa="ext-meeting-note-entry";Pa.ts>Ta&&Pa.author!==U.displayName&&(Aa+=" ext-meeting-note-unread");Ca+='<div class="'+Aa+'">\n               <strong id="'+ia+'"\n                   style="color: '+S(Pa.author)+'">\n               </strong> <span>'+b(Pa.ts)+'</span>\n               <div id="'+
L+'">\n               </div>\n             </div>';ja.set(L,Pa.text);ja.set(ia,Pa.author)}Ca+=r("Type your response");Da?Da.update(Ca):(Da=new MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup(Ca),Da.top=!0,Da.onClose=function(){pa.classList.remove("ext-meeting-note-list-selected");ha.material.highlightMix=0;C.requestFrame();Da=null});aa.markAllNotesAtLocationAsRead(Pa);Q=V.location;Da.open();ja.forEach(function(Ia,Ja){document.getElementById(Ja).innerText=Ia});MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-note-publish",
function(){var Ia=document.getElementById("ext-meeting-note-text"),Ja=Ia.value.trim();if(Ja){var Va=ha.position;R(Ja,[Va.x,Va.y,Va.z]);Ia.value=""}else MeetingUiUtils$$module$extensions$MeetingUiUtils.highlightInput(Ia)})}}var za=C.addAnchor(d(V.location[0],V.location[1],V.location[2],"#0775e8"),function(ha){return ka(ha,!0)});za.material.highlight=K;za.material.setUniforms();na.push(za);var Ea=V.author;var pa=c(Ea,b(V.ts),S(Ea),function(){C.seeItem(za);ka(za,!1)});aa.isNoteRead(V)||pa.classList.add("ext-meeting-note-list-unread");
ra.appendChild(pa);null!==Da&&WALK.deepEqual(Q,V.location)&&ka(za,!0)}var na=[],xa=[],wa=!1,ta=new MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup("\n      <h2>\n        Click a place to leave a note there.\n      </h2>");ta.top=!0;var sa=new MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup(r("Type your note"));sa.top=!0;var Da=null,Q=null;MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-add-note",function(){wa=!0;W.hide();M.style.cursor="pointer";Da&&
Da.close();C.onNodeTypeClicked(N);ta.onDismiss=function(){C.removeOnNodeTypeClicked(N);fa()};ta.open()});var J=new THREE.Vector3;var N=function(V,ra,ka){M.style.cursor="default";J.copy(ra);WALK.movePointTowards(J,C.getCameraPosition(),.1);C.removeOnNodeTypeClicked(N);var za=C.addAnchor(d(J.x,J.y,J.z));za.material.highlight=K;za.material.setUniforms();za.material.highlightMix=.7;ta.close();sa.onClose=function(){C.removeAnchor(za);fa()};sa.open();MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-note-publish",
function(){var Ea=document.getElementById("ext-meeting-note-text"),pa=Ea.value.trim();pa?R(pa,[J.x,J.y,J.z]):MeetingUiUtils$$module$extensions$MeetingUiUtils.highlightInput(Ea)});return!0};C.onApiUserStateChanged("MeetingNotes",function(V,ra){console.assert("MeetingNotes"===V);xa=ra.sort(function(pa,ha){var ja=aa.isNoteRead(pa),Ca=aa.isNoteRead(ha);return ja!==Ca?ja?-1:1:pa.ts-ha.ts});fa();V=$jscomp.makeIterator(na);for(ra=V.next();!ra.done;ra=V.next())C.removeAnchor(ra.value);na.length=0;V=document.getElementById("ext-meeting-note-list");
MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(V);ra=new Map;for(var ka=xa.length-1;0<=ka;ka--){var za=xa[ka];if(null!==za.location){var Ea=za.location.join("/");ra.has(Ea)||(ra.set(Ea,ka),qa(za,V),V.lastChild.scrollIntoView())}}})}function u(C,U){function O(){fa=S=null;R.pointerX=null;R.pointerY=null;R.pointerZ=null;C._enableControls()}function W(){R.isEnabled()?(M.style.cursor="default",O(),qa.disable(),X.close(),U.show()):(M.style.cursor="pointer",X.open(),qa.enable(),X.onDismiss=
W,U.hide())}var aa=this,R=this,S=null,fa=null,X=new MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup("\n      <h2>\n        Point a place by clicking.\n      </h2>");X.top=!0;var qa=C._createPointerEventHelper(0);qa.disable();this.pointerZ=this.pointerY=this.pointerX=null;this.isEnabled=function(){return qa.isEnabled()};this.showPointer=function(){return null!==this.pointerX};C.onBeforeRender(function(){if(null!==S){var na=C._findIntersectionAtPosition(S,fa);Infinity!==na.distance&&(aa.pointerX=
na.point.x,aa.pointerY=na.point.y,aa.pointerZ=na.point.z)}});qa.callbacks.onPointerDown=function(na,xa){S=na;fa=xa;C._disableControls();C.requestFrame();return!0};qa.callbacks.onPointerMove=function(na,xa){if(null===S)return!1;S=na;fa=xa;C.requestFrame();return!0};qa.callbacks.onPointerUp=function(){O();C.requestFrame();return!0};MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-pointer",function(){W()})}function A(){var C=[0,0,0,0,0],U=[0,0,0,0,0,0,0,0],O=null,W=!1;this.newUpdateWithPointer=
function(){W=!1;O!==U&&(W=!0,O=U)};this.newUpdateNoPointer=function(){W=!1;O!==C&&(W=!0,O=C)};this.set=function(aa,R){O[aa]!==R&&(O[aa]=R,W=!0)};this.getFilledArray=function(){return W?O:null}}function B(){function C(S){MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(S.children[0],!0);MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(S.children[1],!1)}function U(S){MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(S.children[0],!1);MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(S.children[1],
!0)}var O=document.getElementById("ext-meeting-mic-toggle"),W=document.getElementById("ext-meeting-camera-toggle"),aa=document.getElementById("ext-meeting-camera-preview"),R=null;this.refreshMicControls=function(S){k(S)?(MeetingUiUtils$$module$extensions$MeetingUiUtils.setButtonHighlight(O,!1),C(O)):(MeetingUiUtils$$module$extensions$MeetingUiUtils.setButtonHighlight(O,!0),U(O))};this.refreshCameraControls=function(S){k(S)?(R||(R=S.attach(),aa.appendChild(R)),MeetingUiUtils$$module$extensions$MeetingUiUtils.show(aa),
MeetingUiUtils$$module$extensions$MeetingUiUtils.setButtonHighlight(W,!1),C(W)):(R&&(S.detach(),R.remove(),R=null),MeetingUiUtils$$module$extensions$MeetingUiUtils.hide(aa),MeetingUiUtils$$module$extensions$MeetingUiUtils.setButtonHighlight(W,!0),U(W))};this.setToggleButtonHandlers=function(S,fa){O.onclick=S;W.onclick=fa}}function I(C,U,O,W){function aa(ja){WALK.USER_MSG.error("Connection lost. Reload the page to rejoin the meeting.<br/>(Code:"+ja+")")}function R(ja,Ca){ja={meetingKey:ka,author:C,
text:ja,location:Ca};WALK.ajaxPost(a()+"/meetings/"+ra+"/notes","application/json",JSON.stringify(ja),function(){return WALK.log("Note added.")},function(){return WALK.log("Failed to add note")})}function S(ja){N.update(J)}function fa(ja){var Ca=J[ja];Ca||(Ca=new l(ta,ja,Da,S),J[ja]=Ca);return Ca}function X(ja){ja in J&&(J[ja].dispose(),delete J[ja],N.update(J),ha.isConnected()&&0===Object.keys(J).length&&ha.disconnect())}function qa(ja){za=ja;for(var Ca=$jscomp.makeIterator(Object.keys(ja)),Ta=Ca.next();!Ta.done;Ta=
Ca.next())Ta=Ta.value,ta.apiUserChangeState(Ta,ja[Ta])}function na(){Q.dispose();ha.dispose();pa.dispose();for(var ja in J)J.hasOwnProperty(ja)&&J[ja].dispose();Da.dispose()}function xa(ja){Ea.showPointer()?(sa.newUpdateWithPointer(),sa.set(5,WALK.round(Ea.pointerX,3)),sa.set(6,WALK.round(Ea.pointerY,3)),sa.set(7,WALK.round(Ea.pointerZ,3))):sa.newUpdateNoPointer();ja=ta.getCameraPosition();var Ca=ta.getCameraRotation();sa.set(0,WALK.round(ja.x,3));sa.set(1,WALK.round(ja.y,3));sa.set(2,WALK.round(ja.z,
3));sa.set(3,WALK.round(Ca.yaw,1));sa.set(4,WALK.round(Ca.pitch,1));(ja=sa.getFilledArray())&&Q.updatePosition(ja)}function wa(){WALK.USER_MSG.error("The meeting has ended. Maximum duration of meeting reached.)");na();N.update({})}var ta=WALK.getViewer(),sa=new A,Da=new Z;this.myUuid=W.uuid;var Q=new m(ta,this.myUuid,C,Da,U,O),J={},N=new p(Q,ta),V=new B,ra=W.id,ka=W.meetingKey,za;V.setToggleButtonHandlers(function(){Q.toggleMic()},function(){Q.toggleCamera()});Q.setAvTracksStateHandlers(function(ja){V.refreshMicControls(ja);
N.update(J)},function(ja){V.refreshCameraControls(ja)});V.refreshMicControls(Q.micTrack);V.refreshCameraControls(Q.cameraTrack);var Ea=new u(ta,N);WALK.urlHashContains("meeting-notes")&&(MeetingUiUtils$$module$extensions$MeetingUiUtils.show(document.getElementById("ext-meeting-notes-preview")),w(ta,Q,J,N,new x(ra,C),R));null!==W.sceneState&&qa(W.sceneState);var pa=new q(Q,W,function(ja){fa(ja);ha.isConnected()||ha.connect()},X,qa,aa);var ha=new n(Q,W,function(ja,Ca){fa(ja).connectedToTwilio(Ca)},
function(ja,Ca){X(ja)},function(ja){WALK.USER_MSG.info("Failed to acquire media.<br/>"+ja.message,6E3)},aa,function(){WALK.USER_MSG.error("The meeting has been ended.")});MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-leave",function(){e("Do you want to leave this meeting?","Leave meeting",function(){na();document.body.innerHTML='<div id="cover-image"></div>';e("You have left the meeting.","Join again",function(){location.reload()},!1)})});ta.onBeforeRender(xa);xa();
ta.onApiUserStateChanged(function(ja,Ca){ja=ta.getApiUserState();WALK.deepEqual(ja,za)||(ja={meetingKey:ka,sceneState:ja},WALK.ajaxPost(a()+"/meetings/"+ra+"/scene-state","application/json",JSON.stringify(ja),function(){return WALK.log("State updated.")},function(){return WALK.log("Failed to update state.")}))});this.startShareScreen=function(ja,Ca,Ta){WALK.log("Screen share start requested");Q.startShareScreen(ja,Ca,Ta)};this.stopShareScreen=function(){WALK.log("Screen share stop requested");Q.stopShareScreen()};
null!==W.remainingTimeSeconds&&setTimeout(wa,1E3*(W.remainingTimeSeconds+5))}function F(C){(new MeetingStarter$$module$extensions$MeetingStarter(function(U,O,W){U=new I(U,O,W,C);WALK.getViewer()._meetingJoined(U)})).show()}function E(C){WALK.getViewer().onSceneLoadComplete(function(){var U=WALK.getViewerAssetUrl("3dassets/avatar.obj");WALK.loadGeometriesFromObj(U,function(O){WALK.setAvatarGeometries(O);C()},function(){return WALK.USER_MSG.error("Failed to load the meeting")})})}if(WALK.urlHashContains("meeting-key")||
WALK.urlHashContains("meeting")){WALK.FONT_FAMILIES_TO_LOAD.push("FontAwesomeSolid");WALK.FONT_FAMILIES_TO_LOAD.push("FontAwesomeRegular");var K=new THREE.Color(0,1,0),M=document.getElementById("walk-canvas");h.prototype={constructor:h,_setUpAvatar:function(){console.assert(this._displayName,"Display name must be known to set up the avatar");WALK.log("Setting up avatar for %s:%s",this._uuid,this._displayName);this._avatar=this._viewer.addAvatar(this._uuid,{displayName:this._displayName,color:this._color})},
get uuid(){return this._uuid},get color(){return this._color},get displayName(){return this._displayName},get hasDisplayName(){return null!==this._displayName},_positionChanged:function(C){if(this._lastRenderedPositionLength!==C.length)return!0;for(var U=0;U<C.length;U++)if(1E-5<Math.abs(this._lastRenderedPosition[U]-C[U]))return!0;return!1},_setLastRenderedPosition:function(C){this._lastRenderedPositionLength=C.length;for(var U=0;U<C.length;U++)this._lastRenderedPosition[U]=C[U]},get volumeVisualizer(){return this._volumeVisualizer},
updatePosition:function(C){if(this.hasDisplayName&&this._positionChanged(C)){this._setLastRenderedPosition(C);var U=this._avatar;U.setPositionFromArray(C);U.rotate(C[3],C[4]);6<=C.length?U.placePointer(C[5],C[6],C[7]):U.hidePointer();U.visible&&(U.updateMatrixWorld(!0),this._viewer.requestFrame())}},updateSoundVolumeVisualization:function(){console.assert(null!==this._volumeMeter,"this._voulmeMeter not created");var C=this._volumeMeter.measureSoundVolume();this._onSoundVolumeUpdated(C)},_onSoundVolumeUpdated:function(C){this._volumeVisualizer.update(C)},
dispose:function(){this.isSoundMeasurementActive()&&this._stopSoundMeasurement();this._avatar&&(this._viewer.removeAvatar(this._avatar),this._avatar=null,this._viewer.requestFrame())},_updateSoundMeasurementState:function(){null!==this._micTrack&&this._micTrack.isEnabled?this._startSoundMeasurement():this._stopSoundMeasurement()},isSoundMeasurementActive:function(){return null!==this._volumeMeter},_startSoundMeasurement:function(){this.isSoundMeasurementActive()||(this._volumeMeter=new SoundUtils$$module$extensions$SoundUtils.VolumeMeter(this._micTrack,
512,this._noSoundThreshold),this._soundVolumeUpdatesScheduler.registerUser(this))},_stopSoundMeasurement:function(){this.isSoundMeasurementActive()&&(this._soundVolumeUpdatesScheduler.unregisterUser(this),this._volumeMeter.dispose(),this._volumeMeter=null,this._avatar.onSoundSwitchedOff())}};Object.defineProperty(h.prototype,"micTrack",{get:function(){return this._micTrack}});Object.defineProperty(h.prototype,"cameraTrack",{get:function(){return this._cameraTrack}});m.prototype=Object.create(h.prototype);
m.prototype.constructor=m;Object.defineProperty(m.prototype,"dataTrack",{get:function(){return this._dataTrack}});Object.defineProperty(m.prototype,"screenTrack",{get:function(){return this._screenTrack}});m.prototype.getAllTracks=function(){var C=[this._dataTrack];this._micTrack&&C.push(this._micTrack);this._cameraTrack&&C.push(this._cameraTrack);this._screenTrack&&C.push(this._screenTrack);return C};m.prototype._sendPosition=function(C){this._positionMessage[2]=C;this._dataTrack.send(JSON.stringify(this._positionMessage))};
m.prototype._resendLastPosition=function(){null!==this._lastPosition&&this._sendPosition(this._lastPosition)};m.prototype.startedConnectingToTwilio=function(){this._isPublishingTracksDuringConnecting=!0};m.prototype.failedToConnectToTwilio=function(){this._isPublishingTracksDuringConnecting=!1};m.prototype.connectedToTwilio=function(C){var U=this;this._twilioParticipant=C;C.publishTracks(this.getAllTracks()).finally(function(){U._isPublishingTracksDuringConnecting=!1});this._resendLastPosition();
this._resendInterval=setInterval(function(){return U._resendLastPosition()},1E3)};m.prototype.disconnectedFromTwilio=function(){this._twilioParticipant=null;clearInterval(this._resendInterval);this._resendInterval=null};Object.defineProperty(m.prototype,"isConnectedToTwilio",{get:function(){return null!==this._twilioParticipant}});m.prototype.updatePosition=function(C){WALK.log("Update local position",C);h.prototype.updatePosition.call(this,C);this._lastPosition=C;this.isConnectedToTwilio&&this._sendPosition(C)};
m.prototype.setAvTracksStateHandlers=function(C,U){this._onMicTrackStateChanged=C;this._onCameraTrackStateChanged=U};m.prototype._removeStoppedMicTrack=function(){console.assert(this._micTrack&&this._micTrack.isStopped);WALK.log("Removing stopped local mic track");this._twilioParticipant&&(WALK.log("Unpublishing stopped local mic track"),this._twilioParticipant.unpublishTrack(this._micTrack));this._micTrack=null};m.prototype._subscribeToMicEvents=function(){var C=this,U=function(){C._updateSoundMeasurementState();
C._onMicTrackStateChanged&&C._onMicTrackStateChanged(C._micTrack)};this._micTrack.on("started",U);this._micTrack.on("enabled",U);this._micTrack.on("disabled",U);this._micTrack.on("stopped",function(){U();C._removeStoppedMicTrack()})};m.prototype._createMicTrack=function(){var C=this;WALK.log("Creating local mic track");if(this._isCreatingMicTrack)WALK.log("Local mic track is already being created");else{this._isCreatingMicTrack=!0;var U=null;Twilio.Video.createLocalAudioTrack(this._micDevice.trackOptions).then(function(O){U=
O;if(C.isConnectedToTwilio)return WALK.log("Publishing local mic track"),C._twilioParticipant.publishTrack(U)}).then(function(O){O?WALK.log("Local mic track created and published"):WALK.log("Local mic track created but not yet published");C._micTrack=U;C._subscribeToMicEvents();C._onMicTrackStateChanged&&C._onMicTrackStateChanged(C._micTrack);C._isCreatingMicTrack=!1}).catch(function(O){U&&U.stop();C._micDevice.error=O;C._showCreateTrackError(C._micDevice);C._isCreatingMicTrack=!1})}};m.prototype.toggleMic=
function(){this._micTrack?this._micTrack.isEnabled?(WALK.log("Disabling local mic track"),this._micTrack.disable()):(WALK.log("Enabling local mic track"),this._micTrack.enable()):this._createMicTrack()};m.prototype._removeStoppedCameraTrack=function(){console.assert(this._cameraTrack&&this._cameraTrack.isStopped);WALK.log("Removing stopped local camera track");this._twilioParticipant&&(WALK.log("Unpublishing stopped local camera track"),this._twilioParticipant.unpublishTrack(this._cameraTrack));this._cameraTrack=
null};m.prototype._subscribeToCameraEvents=function(){var C=this,U=function(){C._onCameraTrackStateChanged&&C._onCameraTrackStateChanged(C._cameraTrack)};this._cameraTrack.on("started",U);this._cameraTrack.on("enabled",U);this._cameraTrack.on("disabled",U);this._cameraTrack.on("stopped",function(){U();C._removeStoppedCameraTrack()})};m.prototype._createCameraTrack=function(){var C=this;WALK.log("Creating local camera track");if(this._isCreatingCameraTrack)WALK.log("Local camera track is already being created");
else{this._isCreatingCameraTrack=!0;var U=null;Twilio.Video.createLocalVideoTrack(this._cameraDevice.trackOptions).then(function(O){U=O;if(C.isConnectedToTwilio)return WALK.log("Publishing local camera track"),C._twilioParticipant.publishTrack(U)}).then(function(O){O?WALK.log("Local camera track created and published"):WALK.log("Local camera track created but not yet published");C._cameraTrack=U;C._subscribeToCameraEvents();C._onCameraTrackStateChanged&&C._onCameraTrackStateChanged(C._cameraTrack);
C._isCreatingCameraTrack=!1}).catch(function(O){U&&U.stop();C._cameraDevice.error=O;C._showCreateTrackError(C._cameraDevice);C._isCreatingCameraTrack=!1})}};m.prototype._showCreateTrackError=function(C){C=C.getErrorMessageInfo();MeetingUiUtils$$module$extensions$MeetingUiUtils.showMessage(C.description,C.title)};m.prototype.toggleCamera=function(){this._cameraTrack?this._isPublishingTracksDuringConnecting?WALK.log("Cannot disable the camera track during connection process"):this._cameraTrack.stop():
this._createCameraTrack()};m.prototype.startShareScreen=function(C,U,O){var W=this;null!==this._screenTrack?C():(WALK.log("Share screen start"),navigator.mediaDevices.getDisplayMedia().then(function(aa){WALK.log("share screen - stream:",aa);var R=new Twilio.Video.LocalVideoTrack(aa.getTracks()[0],{name:"screen"});W._screenTrack=R;aa=f(W._viewer,R);W._avatar.setVideoTexture1(aa);W._viewer.requestFrame();W.isConnectedToTwilio&&W._twilioParticipant.publishTrack(R);C();R.once("stopped",function(){WALK.log("Screen track stopped");
W.isConnectedToTwilio&&W._twilioParticipant.unpublishTrack(R);W._avatar.setVideoTexture1(null);g(R);W._screenTrack=null;W._viewer.requestFrame();U()})}).catch(function(aa){O()}))};m.prototype.stopShareScreen=function(){null!==this._screenTrack&&(WALK.log("Share screen stop"),this._screenTrack.stop())};m.prototype.dispose=function(){this._micTrack&&this._micTrack.stop();this._cameraTrack&&this._cameraTrack.stop();this._screenTrack&&this._screenTrack.stop();h.prototype.dispose.call(this)};l.prototype=
Object.create(h.prototype);l.prototype.constructor=l;l.prototype._refreshUi=function(){this._onUiRefreshNeeded&&this._onUiRefreshNeeded(this)};l.prototype._setUpMicTrack=function(){var C=this;WALK.log("Setting up remote mic track for %s:%s",this._uuid,this._displayName);this._micTrackStateChangedBound=function(){C._updateSoundMeasurementState();C._refreshUi()};this._micTrack.on("enabled",this._micTrackStateChangedBound);this._micTrack.on("disabled",this._micTrackStateChangedBound);this._updateSoundMeasurementState();
this._micTrack.attach()};l.prototype._tearDownMicTrack=function(){WALK.log("Tearing down remote mic track for %s:%s",this._uuid,this._displayName);g(this._micTrack);this._micTrack.removeListener("enabled",this._micTrackStateChangedBound);this._micTrack.removeListener("disabled",this._micTrackStateChangedBound);this._micTrackStateChangedBound=null};l.prototype._setUpCameraTrack=function(){var C=this;WALK.log("Setting up remote camera track for %s:%s",this._uuid,this._displayName);var U=f(this._viewer,
this._cameraTrack);this._cameraTrackEnabledBound=function(){C._avatar.setVideoTexture0(U)};this._cameraTrackDisabledBound=function(){C._avatar.setVideoTexture0(null)};this._cameraTrack.on("enabled",this._cameraTrackEnabledBound);this._cameraTrack.on("disabled",this._cameraTrackDisabledBound);this._avatar.setVideoTexture0(U)};l.prototype._tearDownCameraTrack=function(){WALK.log("Tearing down remote camera track for %s:%s",this._uuid,this._displayName);this._avatar.setVideoTexture0(null);g(this._cameraTrack);
this._cameraTrack.removeListener("enabled",this._cameraTrackEnabledBound);this._cameraTrack.removeListener("disabled",this._cameraTrackDisabledBound);this._cameraTrackDisabledBound=this._cameraTrackEnabledBound=null};l.prototype._setUpScreenTrack=function(){WALK.log("Setting up remote screen track for %s:%s",this._uuid,this._displayName);var C=f(this._viewer,this._screenTrack);this._avatar.setVideoTexture1(C)};l.prototype._tearDownScreenTrack=function(){WALK.log("Tearing down remote screen track for %s:%s",
this._uuid,this._displayName);this._avatar.setVideoTexture1(null);g(this._screenTrack)};l.prototype._setDisplayName=function(C){WALK.log("Remote display name known for %s:%s",this._uuid,C);this._displayName=C;this._setUpAvatar();this._micTrack&&this._setUpMicTrack();this._cameraTrack&&this._setUpCameraTrack();this._screenTrack&&this._setUpScreenTrack();this._refreshUi()};l.prototype._trackSubscribed=function(C){var U=this;WALK.log("Remote %s:%s track subscribed for %s:%s",C.kind,C.name,this._uuid,
this._displayName);this._disposed||("data"===C.kind&&"data"===C.name?this._dataTrack?WALK.log("Ignoring duplicate data track"):(this._dataTrack=C,C.on("message",function(O){O=JSON.parse(O);var W=O[1];O=O[2];U.hasDisplayName||U._setDisplayName(W);U.updatePosition(O)})):"audio"===C.kind&&"mic"===C.name?this._micTrack?WALK.log("Ignoring duplicate mic track"):(this._micTrack=C,this.hasDisplayName&&(this._setUpMicTrack(),this._refreshUi())):"video"===C.kind&&("camera"===C.name?this._cameraTrack?WALK.log("Ignoring duplicate camera track"):
(this._cameraTrack=C,this._avatar&&(this._setUpCameraTrack(),this._viewer.requestFrame())):"screen"===C.name&&(this._screenTrack?WALK.log("Ignoring duplicate screen track"):(this._screenTrack=C,this._avatar&&(this._setUpScreenTrack(),this._viewer.requestFrame())))))};l.prototype._trackUnsubscribed=function(C){WALK.log("Remote %s:%s track unsubscribed for %s:%s",C.kind,C.name,this._uuid,this._displayName);this._disposed||(C===this._dataTrack?this._dataTrack=null:C===this._micTrack?(this.hasDisplayName&&
this._tearDownMicTrack(),this._micTrack=null,this._refreshUi()):C===this._cameraTrack?(this._avatar&&(this._tearDownCameraTrack(),this._viewer.requestFrame()),this._cameraTrack=null):C===this._screenTrack&&(this._avatar&&(this._tearDownScreenTrack(),this._viewer.requestFrame()),this._screenTrack=null))};l.prototype.connectedToTwilio=function(C){var U=this;this._twilioParticipant=C;C.on("trackSubscribed",this._trackSubscribedBound);C.on("trackUnsubscribed",this._trackUnsubscribedBound);C.tracks.forEach(function(O){O.isSubscribed&&
U._trackSubscribed(O.track)})};l.prototype.seeAvatar=function(){this._avatar&&this._viewer.seeItem(this._avatar)};l.prototype._onSoundVolumeUpdated=function(C){h.prototype._onSoundVolumeUpdated.call(this,C);this._avatar.onSoundVolumeUpdated(C)};l.prototype.dispose=function(){this._onUiRefreshNeeded=null;this._micTrack&&this._trackUnsubscribed(this._micTrack);this._cameraTrack&&this._trackUnsubscribed(this._cameraTrack);this._screenTrack&&this._trackUnsubscribed(this._screenTrack);this.isConnectedToTwilio&&
(this._twilioParticipant.removeListener("trackSubscribed",this._trackSubscribedBound),this._twilioParticipant.removeListener("trackUnsubscribed",this._trackUnsubscribedBound),this._twilioParticipant=null);h.prototype.dispose.call(this);this._disposed=!0};var Z=function(){var C=this;this._users=new Set;this._maxIntervalBetweenUpdates=100;this._idleCallback=new WALK.DeferringExecutorInterval(function(){return C._execute()},this._maxIntervalBetweenUpdates);WALK.getViewer().onBeforeRender(function(){return C._onBeforeRender()})};
Z.prototype.registerUser=function(C){this._users.add(C)};Z.prototype.unregisterUser=function(C){this._users.delete(C)};Z.prototype.dispose=function(){this._users.clear()};Z.prototype._onBeforeRender=function(){this._execute();this._idleCallback.deferRun()};Z.prototype._execute=function(){this._users.forEach(function(C){return C.updateSoundVolumeVisualization()})};WALK.loadScriptsUrlAndExecute(["https://cdn.pubnub.com/sdk/javascript/pubnub.4.29.11.min.js","https://media.twiliocdn.com/sdk/js/video/releases/2.18.1/twilio-video.min.js"],
function(){var C=WALK.urlHashGetArgument("meeting"),U=WALK.urlHashGetArgument("meeting-key"),O=WALK.urlHashGetArgument("av-mode"),W={url:WALK.DEVEL_MEETING_SCENE_URL||window.location.href};C&&(W.meetingName=C);U&&(W.meetingKey=U);O&&(W.avMode=O);WALK.ajaxPost(a()+"/meetings/join","application/json",JSON.stringify(W),function(aa){return E(function(){return F(aa)})},function(aa,R){void 0!==R?WALK.USER_MSG.error(R):WALK.USER_MSG.error("Failed to join the meeting. Is your link valid?")})},function(){return WALK.USER_MSG.error("Cannot load required library")});
WALK.play()}})();var module$extensions$meeting={};
